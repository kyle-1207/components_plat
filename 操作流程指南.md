# 🚀 Docker 容器化迁移操作流程指南

## 📋 文档使用指南

根据你的角色和阶段，按照以下流程操作：

---

## 🎯 第一步：确定你的角色

### 角色A：准备阶段（有网络的机器）
- ✅ 你有网络连接
- ✅ 你需要构建 Docker 镜像
- ✅ 你需要打包迁移文件
- **推荐文档**：按照下面的"准备阶段流程"

### 角色B：部署阶段（Windows 7 离线机器）
- ✅ 你没有网络连接
- ✅ 你已经有了打包好的文件
- ✅ 你需要在 Windows 7 上部署
- **推荐文档**：按照下面的"部署阶段流程"

---

## 📦 准备阶段流程（有网络的机器）

### 步骤1：了解整体流程
**阅读文档**：`MIGRATION_SUMMARY.md`
- 了解迁移的整体思路
- 了解需要准备什么文件
- 了解文件大小估算

### 步骤2：执行打包操作
**使用脚本**：`scripts/package_docker.ps1`

```powershell
# 在项目根目录执行
cd scripts
.\package_docker.ps1
```

**脚本会自动完成：**
- ✅ 构建生产环境 Docker 镜像
- ✅ 备份 MongoDB 数据库（如果运行中）
- ✅ 导出所有 Docker 镜像
- ✅ 压缩镜像文件
- ✅ 生成迁移包

### 步骤3：验证打包结果
**检查清单**：`MIGRATION_CHECKLIST.md` - 阶段1部分

确认以下文件已生成：
- ✅ `docker_package/business_plat_images.7z` - Docker 镜像（压缩）
- ✅ `docker_package/docker-compose.prod.yml` - 生产环境配置
- ✅ `docker_package/mongodb_backup/` - 数据库备份（如果有）

### 步骤4：传输到 Windows 7
将 `docker_package` 目录复制到移动硬盘/U盘，然后传输到 Windows 7 机器。

---

## 🖥️ 部署阶段流程（Windows 7 离线机器）

### 快速路径（推荐 ⭐）

**如果你熟悉 Docker 或想要快速部署：**

**使用文档**：`WINDOWS7_PRODUCTION_QUICKSTART.md`

这个文档包含：
- ✅ 5 步快速部署流程
- ✅ 常用命令
- ✅ 常见问题快速解决

**操作步骤：**
1. 按照文档中的 5 步操作
2. 遇到问题查看"常见问题"部分
3. 如果还有问题，参考详细指南

---

### 详细路径（推荐新手或遇到问题）

**如果你不熟悉 Docker 或遇到问题：**

**使用文档**：`DOCKER_MIGRATION_GUIDE.md`

这个文档包含：
- ✅ 详细的 Windows 7 部署步骤
- ✅ Docker Toolbox 安装详解
- ✅ 每个步骤的详细说明和验证方法
- ✅ 完整的故障排除指南
- ✅ 性能优化建议

**操作步骤：**
1. 阅读"阶段2：在 Windows 7 上部署"部分
2. 按照步骤1-8逐步操作
3. 每步完成后验证结果
4. 遇到问题查看"故障排除"部分

---

### 检查清单路径（确保不遗漏）

**如果你想确保每个步骤都完成：**

**使用文档**：`MIGRATION_CHECKLIST.md`

这个文档包含：
- ✅ 分阶段的检查清单
- ✅ 每个步骤的验证命令
- ✅ 最终验证清单

**操作步骤：**
1. 按照检查清单逐项完成
2. 每完成一项打勾 ✅
3. 确保所有项目都完成

---

## 📚 文档对照表

| 文档 | 用途 | 适合人群 | 长度 |
|------|------|----------|------|
| **WINDOWS7_PRODUCTION_QUICKSTART.md** | 快速参考 | 熟悉 Docker，想要快速部署 | ~125 行 |
| **DOCKER_MIGRATION_GUIDE.md** | 详细指南 | 新手或遇到问题需要详细说明 | ~919 行 |
| **MIGRATION_CHECKLIST.md** | 检查清单 | 想要确保不遗漏任何步骤 | ~187 行 |
| **MIGRATION_SUMMARY.md** | 总览 | 了解整体流程和文件大小 | ~295 行 |

---

## 🎯 推荐操作流程

### 场景1：我是新手，第一次部署

```
1. 先看 MIGRATION_SUMMARY.md（了解整体）
   ↓
2. 再看 DOCKER_MIGRATION_GUIDE.md（详细步骤）
   ↓
3. 同时参考 MIGRATION_CHECKLIST.md（确保不遗漏）
   ↓
4. 遇到问题回到 DOCKER_MIGRATION_GUIDE.md 的故障排除部分
```

### 场景2：我熟悉 Docker，想要快速部署

```
1. 直接看 WINDOWS7_PRODUCTION_QUICKSTART.md
   ↓
2. 按照 5 步快速操作
   ↓
3. 遇到问题查看文档中的"常见问题"部分
   ↓
4. 如果还有问题，参考 DOCKER_MIGRATION_GUIDE.md
```

### 场景3：我已经开始部署，想确认进度

```
1. 打开 MIGRATION_CHECKLIST.md
   ↓
2. 检查当前阶段的所有项目
   ↓
3. 未完成的项目继续完成
   ↓
4. 完成所有项目后执行最终验证
```

---

## ⚡ 快速决策树

```
开始部署
  │
  ├─ 你是新手？ → 看 DOCKER_MIGRATION_GUIDE.md
  │
  ├─ 你熟悉 Docker？ → 看 WINDOWS7_PRODUCTION_QUICKSTART.md
  │
  ├─ 你想确保不遗漏？ → 看 MIGRATION_CHECKLIST.md
  │
  └─ 你想了解整体？ → 看 MIGRATION_SUMMARY.md
```

---

## 🔍 遇到问题怎么办？

### 问题类型1：Docker Toolbox 无法启动
**查看**：`DOCKER_MIGRATION_GUIDE.md` → "故障排除" → "问题1：Docker Toolbox 无法启动"

### 问题类型2：容器无法启动
**查看**：`DOCKER_MIGRATION_GUIDE.md` → "故障排除" → "问题2：容器无法启动"

### 问题类型3：无法访问服务
**查看**：
- `WINDOWS7_PRODUCTION_QUICKSTART.md` → "常见问题" → "无法访问服务"
- `DOCKER_MIGRATION_GUIDE.md` → "故障排除" → "问题3：无法访问服务"

### 问题类型4：数据库连接失败
**查看**：
- `WINDOWS7_PRODUCTION_QUICKSTART.md` → "常见问题" → "数据库连接失败"
- `DOCKER_MIGRATION_GUIDE.md` → "故障排除" → "问题4：数据库连接失败"

---

## ✅ 最终验证

部署完成后，使用 `MIGRATION_CHECKLIST.md` 中的"最终验证"部分：

```powershell
# 1. 检查 Docker 环境
docker --version
docker-compose --version
docker-machine ip default

# 2. 检查容器状态
docker-compose -f docker-compose.prod.yml ps

# 3. 测试服务
$vmIp = docker-machine ip default
curl http://$vmIp:3001/health
```

---

## 📞 总结

**最简单的流程：**

1. **准备阶段**（有网络）：
   - 运行 `scripts/package_docker.ps1`
   - 传输 `docker_package` 目录到 Windows 7

2. **部署阶段**（Windows 7）：
   - 打开 `WINDOWS7_PRODUCTION_QUICKSTART.md`
   - 按照 5 步操作
   - 遇到问题查看文档中的"常见问题"

3. **验证**：
   - 使用 `MIGRATION_CHECKLIST.md` 验证所有步骤

---

**推荐阅读顺序：**
1. `MIGRATION_SUMMARY.md` - 了解整体（5分钟）
2. `WINDOWS7_PRODUCTION_QUICKSTART.md` - 快速开始（10分钟）
3. `DOCKER_MIGRATION_GUIDE.md` - 详细参考（需要时查阅）
4. `MIGRATION_CHECKLIST.md` - 检查清单（部署时使用）

