# Review DoEEEt project development plan
_Exported on 11/20/2025 at 16:56:20 GMT+8 from Cursor (1.4.5)_

---

**User**

请把器件详情页显示的参数与组件对比页显示的参数体系调整为一致，目前器件详情页显示的参数不全

---

**Cursor**

```typescriptreact
import React, { useState, useEffect } from 'react';
import { Modal, Table, Tag, Spin, message, Button, Space, Typography } from 'antd';
import { SwapOutlined, CloseOutlined } from '@ant-design/icons';
import httpClient from '@/utils/httpClient';

const { Text } = Typography;

interface ComponentCompareModalProps {
  visible: boolean;
  componentIds: string[];
  onClose: () => void;
}

interface ComponentInfo {
  component_id: string;
  part_number: string;
  manufacturer_name: string;
  part_type: string;
  quality_name: string;
  obsolescence_type: string;
  has_stock: string;
  family_path: string;
}

interface ParameterValue {
  name: string;
  value: string;
  numericValue?: number;
}

interface ComparisonData {
  components: ComponentInfo[];
  parameters: Array<{
    key: string;
    [key: string]: any; // component_0, component_1, etc.
  }>;
}

const ComponentCompareModal: React.FC<ComponentCompareModalProps> = ({
  visible,
  componentIds,
  onClose,
}) => {
  const [loading, setLoading] = useState(false);
  const [comparisonData, setComparisonData] = useState<ComparisonData | null>(null);

  useEffect(() => {
    if (visible && componentIds.length >= 2) {
      fetchComparisonData();
    }
  }, [visible, componentIds]);

  const fetchComparisonData = async () => {
    setLoading(true);
    try {
      const data = await httpClient.post<ComparisonData, { componentIds: string[] }>(
        '/api/doeeet/components/compare',
        { componentIds },
        { timeoutMs: 15000, retries: 2, retryDelayMs: 400, suppressErrorMessage: true }
      );
      if (data) {
        setComparisonData(data);
      } else {
        message.error('获取对比数据失败');
      }
    } catch (error: any) {
      console.error('对比组件失败:', error);
      message.error(error?.message || '对比组件失败，请稍后重试');
    } finally {
      setLoading(false);
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'Active':
        return 'green';
      case 'Obsolete':
        return 'red';
      case 'Last Time Buy':
        return 'orange';
      case 'Risk':
        return 'volcano';
      default:
        return 'default';
    }
  };

  // 基本信息列定义
  const basicInfoColumns = [
    {
      title: '属性',
      dataIndex: 'label',
      key: 'label',
      width: 150,
      fixed: 'left' as const,
      render: (text: string) => <Text strong>{text}</Text>,
    },
    ...( comparisonData?.components.map((comp, index) => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div style={{ fontWeight: 'bold', color: '#1890ff' }}>
            {comp.part_number}
          </div>
          <div style={{ fontSize: '12px', color: '#666' }}>
            {comp.manufacturer_name}
          </div>
        </div>
      ),
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 200,
    })) || []),
  ];

  const basicInfoData = comparisonData ? [
    {
      key: 'part_type',
      label: '产品类型',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          comp.part_type || '-',
        ])
      ),
    },
    {
      key: 'family_path',
      label: '分类',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => {
          try {
            const familyPath = JSON.parse(comp.family_path.replace(/'/g, '"'));
            return [`component_${idx}`, Array.isArray(familyPath) ? familyPath.join(' > ') : comp.family_path];
          } catch (e) {
            return [`component_${idx}`, comp.family_path];
          }
        })
      ),
    },
    {
      key: 'quality_name',
      label: '质量等级',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color="blue">{comp.quality_name || '-'}</Tag>,
        ])
      ),
    },
    {
      key: 'obsolescence_type',
      label: '淘汰状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={getStatusColor(comp.obsolescence_type)}>
            {comp.obsolescence_type}
          </Tag>,
        ])
      ),
    },
    {
      key: 'has_stock',
      label: '库存状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={comp.has_stock === 'Yes' ? 'green' : 'default'}>
            {comp.has_stock === 'Yes' ? '有库存' : '无库存'}
          </Tag>,
        ])
      ),
    },
  ] : [];

  // 参数对比列定义
  const parameterColumns = [
    {
      title: '参数名称',
      dataIndex: 'name',
      key: 'name',
      width: 200,
      fixed: 'left' as const,
      render: (text: string, record: any) => {
        const firstParam = record.component_0;
        return (
          <div>
            <Text strong>{firstParam?.name || text}</Text>
          </div>
        );
      },
    },
    ...(comparisonData?.components.map((comp, index) => ({
      title: comp.part_number,
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 180,
      render: (paramValue: ParameterValue) => {
        if (!paramValue || paramValue.value === '-') {
          return <Text type="secondary">-</Text>;
        }
        
        // 尝试解析数组值
        try {
          const parsed = JSON.parse(paramValue.value.replace(/'/g, '"'));
          if (Array.isArray(parsed)) {
            return parsed.join(', ');
          }
        } catch (e) {
          // 不是JSON数组，直接显示
        }
        
        return paramValue.value;
      },
    })) || []),
  ];

  const filteredParameters = comparisonData?.parameters ?? [];

  return (
    <Modal
      title={
        <Space>
          <SwapOutlined style={{ color: '#1890ff' }} />
          <span>组件对比</span>
          <Text type="secondary">({componentIds.length}个组件)</Text>
        </Space>
      }
      open={visible}
      onCancel={onClose}
      footer={[
        <Button key="close" onClick={onClose}>
          关闭
        </Button>,
      ]}
      width="90%"
      style={{ top: 20 }}
      bodyStyle={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}
    >
      {loading ? (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Spin size="large" tip="加载对比数据中..." />
        </div>
      ) : comparisonData ? (
        <Space direction="vertical" style={{ width: '100%' }} size="large">
          {/* 基本信息对比 */}
          <div>
            <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              基本信息对比
            </Text>
            <Table
              columns={basicInfoColumns}
              dataSource={basicInfoData}
              pagination={false}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
            />
          </div>

          {/* 参数对比 */}
          <div>
                <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              参数对比 ({filteredParameters.length}个参数)
            </Text>
            <Table
              columns={parameterColumns}
              dataSource={filteredParameters}
              pagination={{ pageSize: 20 }}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
              rowKey="key"
            />
          </div>
        </Space>
      ) : (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Text type="secondary">暂无对比数据</Text>
        </div>
      )}
    </Modal>
  );
};

export default ComponentCompareModal;


```

```typescriptreact
import React, { useState, useEffect, useCallback } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev => ({
          ...component,
          ...(typeof prev === 'object' ? prev : {}),
          parameterDefinitions,
        }));
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="器件型号">{selectedComponent.partNumber}</Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {(selectedComponent.referencePrice ?? 0) > 0 ? (
                <span style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '16px' }}>
                  ¥{selectedComponent.referencePrice!.toFixed(2)}
                </span>
              ) : (
                <span style={{ color: '#999', fontSize: '16px' }}>暂无报价</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="封装">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
              <Tag color="green">{selectedComponent.lifecycle}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel}</Descriptions.Item>
            <Descriptions.Item label="相关标准" span={2}>
              {selectedComponent.standards?.map(standard => (
                <Tag key={standard}>{standard}</Tag>
              ))}
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    {
                      title: '参数名称',
                      dataIndex: 'name',
                      key: 'name',
                      width: 220,
                    },
                    {
                      title: '参数值',
                      dataIndex: 'displayValue',
                      key: 'displayValue',
                    },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="供应商信息" span={2}>
              <Table
                size="small"
                columns={[
                  { title: '供应商', dataIndex: 'name', key: 'name' },
                  { title: '价格', dataIndex: 'price', key: 'price', render: (price: number) => `¥${price}` },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
              />
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="器件型号">{selectedComponent.partNumber}</Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {(selectedComponent.referencePrice ?? 0) > 0 ? (
                <span style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '16px' }}>
                  ¥{selectedComponent.referencePrice!.toFixed(2)}
                </span>
              ) : (
                <span style={{ color: '#999', fontSize: '16px' }}>暂无报价</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="封装">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
              <Tag color="green">{selectedComponent.lifecycle}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel}</Descriptions.Item>
            <Descriptions.Item label="相关标准" span={2}>
              {selectedComponent.standards?.map(standard => (
                <Tag key={standard}>{standard}</Tag>
              ))}
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    {
                      title: '参数名称',
                      dataIndex: 'name',
                      key: 'name',
                      width: 220,
                    },
                    {
                      title: '参数值',
                      dataIndex: 'displayValue',
                      key: 'displayValue',
                    },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="供应商信息" span={2}>
              <Table
                size="small"
                columns={[
                  { title: '供应商', dataIndex: 'name', key: 'name' },
                  { title: '价格', dataIndex: 'price', key: 'price', render: (price: number) => `¥${price}` },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
              />
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

## Summary
- 调整 `ComponentSearch` 详情模态框参数区域，直接消费 `/api/doeeet/components/{id}` 返回的完整参数集合，并以分类、名称、值三列展示，保持与组件对比页一致的参数体系。
- 新增参数值归一化逻辑和 `component_id` 守卫，过滤 `Unknown` 项，加载时显示 Spin，确保详情页参数完整且体验一致。

## Code
```611:719:frontend/src/pages/components/ComponentSearch.tsx
  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }
    ...
    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }
    ...
        setDetailParameters(normalizedParameters);
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
```

```1190:1226:frontend/src/pages/components/ComponentSearch.tsx
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    { title: '参数名称', dataIndex: 'name', key: 'name', width: 220 },
                    { title: '参数值', dataIndex: 'displayValue', key: 'displayValue' },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
```

## Testing
- 未执行（前端改动，建议本地运行页面验收加载效果）

```typescriptreact
  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }
    ...
    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }
    ...
        setDetailParameters(normalizedParameters);
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
```

```typescriptreact
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    { title: '参数名称', dataIndex: 'name', key: 'name', width: 220 },
                    { title: '参数值', dataIndex: 'displayValue', key: 'displayValue' },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
```

---

**User**

参数分类列不需要显示，只显示参数名称和参数值。调整一下整体器件详情布局，好看一点

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="器件型号">{selectedComponent.partNumber}</Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {(selectedComponent.referencePrice ?? 0) > 0 ? (
                <span style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '16px' }}>
                  ¥{selectedComponent.referencePrice!.toFixed(2)}
                </span>
              ) : (
                <span style={{ color: '#999', fontSize: '16px' }}>暂无报价</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="封装">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
              <Tag color="green">{selectedComponent.lifecycle}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel}</Descriptions.Item>
            <Descriptions.Item label="相关标准" span={2}>
              {selectedComponent.standards?.map(standard => (
                <Tag key={standard}>{standard}</Tag>
              ))}
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    {
                      title: '参数名称',
                      dataIndex: 'name',
                      key: 'name',
                      width: 220,
                    },
                    {
                      title: '参数值',
                      dataIndex: 'displayValue',
                      key: 'displayValue',
                    },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="供应商信息" span={2}>
              <Table
                size="small"
                columns={[
                  { title: '供应商', dataIndex: 'name', key: 'name' },
                  { title: '价格', dataIndex: 'price', key: 'price', render: (price: number) => `¥${price}` },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
              />
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="器件型号">{selectedComponent.partNumber}</Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {(selectedComponent.referencePrice ?? 0) > 0 ? (
                <span style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '16px' }}>
                  ¥{selectedComponent.referencePrice!.toFixed(2)}
                </span>
              ) : (
                <span style={{ color: '#999', fontSize: '16px' }}>暂无报价</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="封装">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
              <Tag color="green">{selectedComponent.lifecycle}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel}</Descriptions.Item>
            <Descriptions.Item label="相关标准" span={2}>
              {selectedComponent.standards?.map(standard => (
                <Tag key={standard}>{standard}</Tag>
              ))}
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    {
                      title: '参数名称',
                      dataIndex: 'name',
                      key: 'name',
                      width: 220,
                    },
                    {
                      title: '参数值',
                      dataIndex: 'displayValue',
                      key: 'displayValue',
                    },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="供应商信息" span={2}>
              <Table
                size="small"
                columns={[
                  { title: '供应商', dataIndex: 'name', key: 'name' },
                  { title: '价格', dataIndex: 'price', key: 'price', render: (price: number) => `¥${price}` },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
              />
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Descriptions column={2} bordered>
            <Descriptions.Item label="器件型号">{selectedComponent.partNumber}</Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {(selectedComponent.referencePrice ?? 0) > 0 ? (
                <span style={{ color: '#1890ff', fontWeight: 'bold', fontSize: '16px' }}>
                  ¥{selectedComponent.referencePrice!.toFixed(2)}
                </span>
              ) : (
                <span style={{ color: '#999', fontSize: '16px' }}>暂无报价</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="封装">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
              <Tag color="green">{selectedComponent.lifecycle}</Tag>
            </Descriptions.Item>
            <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel}</Descriptions.Item>
            <Descriptions.Item label="相关标准" span={2}>
              {selectedComponent.standards?.map(standard => (
                <Tag key={standard}>{standard}</Tag>
              ))}
            </Descriptions.Item>
            <Descriptions.Item label="描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="参数详情" span={2}>
              {detailLoading ? (
                <div style={{ textAlign: 'center', padding: '24px 0' }}>
                  <Spin size="small" tip="加载参数中..." />
                </div>
              ) : detailParameters.length > 0 ? (
                <Table
                  size="small"
                  scroll={{ x: 800 }}
                  columns={[
                    {
                      title: '参数分类',
                      dataIndex: 'category',
                      key: 'category',
                      width: 180,
                      render: (category: string | undefined) =>
                        category ? <Tag color="blue">{category}</Tag> : <Tag color="default">未分类</Tag>,
                    },
                    {
                      title: '参数名称',
                      dataIndex: 'name',
                      key: 'name',
                      width: 220,
                    },
                    {
                      title: '参数值',
                      dataIndex: 'displayValue',
                      key: 'displayValue',
                    },
                  ]}
                  dataSource={detailParameters}
                  pagination={{ pageSize: 15 }}
                  rowKey="key"
                  bordered
                />
              ) : (
                <span style={{ color: '#999' }}>暂无参数数据</span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="供应商信息" span={2}>
              <Table
                size="small"
                columns={[
                  { title: '供应商', dataIndex: 'name', key: 'name' },
                  { title: '价格', dataIndex: 'price', key: 'price', render: (price: number) => `¥${price}` },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
              />
            </Descriptions.Item>
          </Descriptions>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const findExtraValue = (keyword: string) => {
            const lowerKeyword = keyword.toLowerCase();
            for (const extra of fixedExtras) {
              const name = String(extra?.name ?? '').toLowerCase();
              if (!name) continue;
              if (name === lowerKeyword || name.includes(lowerKeyword)) {
                return extra?.value ?? '';
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            comp.package ??
            comp.part_type ??
            '-';

          const topValue =
            findExtraValue('top') ??
            comp.top_marking ??
            comp.top ??
            '';

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
                <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
                    <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
                    <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
                    <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                      {selectedComponent.qualityLevel}
                    </Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
                </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
                      {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
                      ))}
                    </Space>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                      </div>
                    </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
                    <Table
                      size="small"
                      columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                        { title: '库存', dataIndex: 'stock', key: 'stock' },
                        { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                      ]}
                      dataSource={selectedComponent.suppliers}
                      pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

- 重构 `ComponentSearch` 详情模态框，新增 “基础信息 / 功能与描述 / 参数详情 / 供应商信息” 分卡片布局，优化排版与配色，提升可读性。
- 参数表改为按分类分组的卡片式展示，仅保留“参数名称/参数值”双列并做换行处理，避免重复列头。
- 供应商信息仅在存在数据时并排显示，价格为空时展示 `-`，保持整洁。

```1170:1248:frontend/src/pages/components/ComponentSearch.tsx
          <Row gutter={16}>
            <Col span={hasSuppliers ? 16 : 24}>
              <Card
                size="small"
                title="参数详情"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                {detailLoading ? (
                  <div style={{ textAlign: 'center', padding: '24px 0' }}>
                    <Spin size="small" tip="加载参数中..." />
                  </div>
                ) : parameterGroups.length > 0 ? (
                  <Space direction="vertical" size="small" style={{ width: '100%' }}>
                    {parameterGroups.map(({ category, params }) => (
                      <div
                        key={category}
                        style={{
                          border: '1px solid #e0e7ff',
                          borderRadius: 8,
                          padding: '12px 16px',
                          background: '#f8fafc',
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                        <div>
                          {params.map((param, index) => {
                            const isLast = index === params.length - 1;
                            return (
                              <div
                                key={`${category}-${param.key}-${index}`}
                                style={{
                                  display: 'flex',
                                  gap: 16,
                                  padding: '6px 0',
                                  borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                  alignItems: 'flex-start',
                                }}
                              >
                                <span
                                  style={{
                                    flex: '0 0 220px',
                                    color: '#374151',
                                    fontWeight: 500,
                                    wordBreak: 'break-word',
                                  }}
                                >
                                  {param.name}
                                </span>
                                <span
                                  style={{
                                    flex: 1,
                                    color: '#111827',
                                    wordBreak: 'break-word',
                                  }}
                                >
                                  {param.displayValue}
                                </span>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </Space>
                ) : (
                  <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                )}
              </Card>
            </Col>
            {hasSuppliers && (
              <Col span={8}>
                <Card
                  size="small"
                  title="供应商信息"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  <Table
                    size="small"
                    columns={[
                      { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                      {
                        title: '价格',
                        dataIndex: 'price',
                        key: 'price',
                        render: (price: number | undefined) =>
                          typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                      },
                      { title: '库存', dataIndex: 'stock', key: 'stock' },
                      { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                    ]}
                    dataSource={selectedComponent.suppliers}
                    pagination={false}
                    rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                  />
                </Card>
              </Col>
            )}
          </Row>
```

测试：未执行（建议在前端确认详情弹窗展示效果）。

```typescriptreact
          <Row gutter={16}>
            <Col span={hasSuppliers ? 16 : 24}>
              <Card
                size="small"
                title="参数详情"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                {detailLoading ? (
                  <div style={{ textAlign: 'center', padding: '24px 0' }}>
                    <Spin size="small" tip="加载参数中..." />
                  </div>
                ) : parameterGroups.length > 0 ? (
                  <Space direction="vertical" size="small" style={{ width: '100%' }}>
                    {parameterGroups.map(({ category, params }) => (
                      <div
                        key={category}
                        style={{
                          border: '1px solid #e0e7ff',
                          borderRadius: 8,
                          padding: '12px 16px',
                          background: '#f8fafc',
                        }}
                      >
                        <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                        <div>
                          {params.map((param, index) => {
                            const isLast = index === params.length - 1;
                            return (
                              <div
                                key={`${category}-${param.key}-${index}`}
                                style={{
                                  display: 'flex',
                                  gap: 16,
                                  padding: '6px 0',
                                  borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                  alignItems: 'flex-start',
                                }}
                              >
                                <span
                                  style={{
                                    flex: '0 0 220px',
                                    color: '#374151',
                                    fontWeight: 500,
                                    wordBreak: 'break-word',
                                  }}
                                >
                                  {param.name}
                                </span>
                                <span
                                  style={{
                                    flex: 1,
                                    color: '#111827',
                                    wordBreak: 'break-word',
                                  }}
                                >
                                  {param.displayValue}
                                </span>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))}
                  </Space>
                ) : (
                  <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                )}
              </Card>
            </Col>
            {hasSuppliers && (
              <Col span={8}>
                <Card
                  size="small"
                  title="供应商信息"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  <Table
                    size="small"
                    columns={[
                      { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                      {
                        title: '价格',
                        dataIndex: 'price',
                        key: 'price',
                        render: (price: number | undefined) =>
                          typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                      },
                      { title: '库存', dataIndex: 'stock', key: 'stock' },
                      { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                    ]}
                    dataSource={selectedComponent.suppliers}
                    pagination={false}
                    rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                  />
                </Card>
              </Col>
            )}
          </Row>
```

---

**User**

组件对比列中，又出现了参数名称为Unknown的行，请过滤

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useMemo } from 'react';
import { Modal, Table, Tag, Spin, message, Button, Space, Typography } from 'antd';
import { SwapOutlined, CloseOutlined } from '@ant-design/icons';
import httpClient from '@/utils/httpClient';

const { Text } = Typography;

interface ComponentCompareModalProps {
  visible: boolean;
  componentIds: string[];
  onClose: () => void;
}

interface ComponentInfo {
  component_id: string;
  part_number: string;
  manufacturer_name: string;
  part_type: string;
  quality_name: string;
  obsolescence_type: string;
  has_stock: string;
  family_path: string;
}

interface ParameterValue {
  name: string;
  value: string;
  numericValue?: number;
}

interface ComparisonData {
  components: ComponentInfo[];
  parameters: Array<{
    key: string;
    [key: string]: any; // component_0, component_1, etc.
  }>;
}

const ComponentCompareModal: React.FC<ComponentCompareModalProps> = ({
  visible,
  componentIds,
  onClose,
}) => {
  const [loading, setLoading] = useState(false);
  const [comparisonData, setComparisonData] = useState<ComparisonData | null>(null);

  useEffect(() => {
    if (visible && componentIds.length >= 2) {
      fetchComparisonData();
    }
  }, [visible, componentIds]);

  const fetchComparisonData = async () => {
    setLoading(true);
    try {
      const data = await httpClient.post<ComparisonData, { componentIds: string[] }>(
        '/api/doeeet/components/compare',
        { componentIds },
        { timeoutMs: 15000, retries: 2, retryDelayMs: 400, suppressErrorMessage: true }
      );
      if (data) {
        setComparisonData(data);
      } else {
        message.error('获取对比数据失败');
      }
    } catch (error: any) {
      console.error('对比组件失败:', error);
      message.error(error?.message || '对比组件失败，请稍后重试');
    } finally {
      setLoading(false);
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'Active':
        return 'green';
      case 'Obsolete':
        return 'red';
      case 'Last Time Buy':
        return 'orange';
      case 'Risk':
        return 'volcano';
      default:
        return 'default';
    }
  };

  // 基本信息列定义
  const basicInfoColumns = [
    {
      title: '属性',
      dataIndex: 'label',
      key: 'label',
      width: 150,
      fixed: 'left' as const,
      render: (text: string) => <Text strong>{text}</Text>,
    },
    ...( comparisonData?.components.map((comp, index) => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div style={{ fontWeight: 'bold', color: '#1890ff' }}>
            {comp.part_number}
          </div>
          <div style={{ fontSize: '12px', color: '#666' }}>
            {comp.manufacturer_name}
          </div>
        </div>
      ),
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 200,
    })) || []),
  ];

  const basicInfoData = comparisonData ? [
    {
      key: 'part_type',
      label: '产品类型',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          comp.part_type || '-',
        ])
      ),
    },
    {
      key: 'family_path',
      label: '分类',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => {
          try {
            const familyPath = JSON.parse(comp.family_path.replace(/'/g, '"'));
            return [`component_${idx}`, Array.isArray(familyPath) ? familyPath.join(' > ') : comp.family_path];
          } catch (e) {
            return [`component_${idx}`, comp.family_path];
          }
        })
      ),
    },
    {
      key: 'quality_name',
      label: '质量等级',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color="blue">{comp.quality_name || '-'}</Tag>,
        ])
      ),
    },
    {
      key: 'obsolescence_type',
      label: '淘汰状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={getStatusColor(comp.obsolescence_type)}>
            {comp.obsolescence_type}
          </Tag>,
        ])
      ),
    },
    {
      key: 'has_stock',
      label: '库存状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={comp.has_stock === 'Yes' ? 'green' : 'default'}>
            {comp.has_stock === 'Yes' ? '有库存' : '无库存'}
          </Tag>,
        ])
      ),
    },
  ] : [];

  const getParameterDisplayName = (record: any) => {
    const componentCount = comparisonData?.components.length ?? 0;
    for (let i = 0; i < componentCount; i += 1) {
      const param = record[`component_${i}`] as ParameterValue | undefined;
      const candidate = param?.name?.trim();
      if (candidate && candidate.toLowerCase() !== 'unknown') {
        return candidate;
      }
    }

    const fallback = record?.name?.trim();
    if (fallback && fallback.toLowerCase() !== 'unknown') {
      return fallback;
    }

    return '未命名参数';
  };

  // 参数对比列定义
  const parameterColumns = [
    {
      title: '参数名称',
      dataIndex: 'name',
      key: 'name',
      width: 200,
      fixed: 'left' as const,
      render: (_text: string, record: any) => (
        <div>
          <Text strong>{getParameterDisplayName(record)}</Text>
        </div>
      ),
    },
    ...(comparisonData?.components.map((comp, index) => ({
      title: comp.part_number,
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 180,
      render: (paramValue: ParameterValue) => {
        if (!paramValue || paramValue.value === '-') {
          return <Text type="secondary">-</Text>;
        }
        
        // 尝试解析数组值
        try {
          const parsed = JSON.parse(paramValue.value.replace(/'/g, '"'));
          if (Array.isArray(parsed)) {
            return parsed.join(', ');
          }
        } catch (e) {
          // 不是JSON数组，直接显示
        }
        
        return paramValue.value;
      },
    })) || []),
  ];

  const filteredParameters = useMemo(() => {
    if (!comparisonData?.parameters || comparisonData.parameters.length === 0) {
      return [];
    }

    const componentCount = comparisonData.components.length;

    return comparisonData.parameters.filter(param => {
      if (!param) {
        return false;
      }

      const hasMeaningfulName = Array.from({ length: componentCount }).some((_, idx) => {
        const value = param[`component_${idx}`] as ParameterValue | undefined;
        const candidate = value?.name?.trim();
        return !!candidate && candidate.toLowerCase() !== 'unknown';
      });

      const fallback = (param as any)?.name?.trim();

      if (!hasMeaningfulName) {
        if (!fallback) {
          return false;
        }
        return fallback.toLowerCase() !== 'unknown';
      }

      return true;
    });
  }, [comparisonData]);

  return (
    <Modal
      title={
        <Space>
          <SwapOutlined style={{ color: '#1890ff' }} />
          <span>组件对比</span>
          <Text type="secondary">({componentIds.length}个组件)</Text>
        </Space>
      }
      open={visible}
      onCancel={onClose}
      footer={[
        <Button key="close" onClick={onClose}>
          关闭
        </Button>,
      ]}
      width="90%"
      style={{ top: 20 }}
      bodyStyle={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}
    >
      {loading ? (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Spin size="large" tip="加载对比数据中..." />
        </div>
      ) : comparisonData ? (
        <Space direction="vertical" style={{ width: '100%' }} size="large">
          {/* 基本信息对比 */}
          <div>
            <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              基本信息对比
            </Text>
            <Table
              columns={basicInfoColumns}
              dataSource={basicInfoData}
              pagination={false}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
            />
          </div>

          {/* 参数对比 */}
          <div>
                <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              参数对比 ({filteredParameters.length}个参数)
            </Text>
            <Table
              columns={parameterColumns}
              dataSource={filteredParameters}
              pagination={{ pageSize: 20 }}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
              rowKey="key"
            />
          </div>
        </Space>
      ) : (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Text type="secondary">暂无对比数据</Text>
        </div>
      )}
    </Modal>
  );
};

export default ComponentCompareModal;


```

- 阻断“Unknown”参数：在 `ComponentCompareModal` 中用 `useMemo` 过滤所有参数名为 `Unknown` 或空的记录，并为名称渲染逻辑增加首个有效名称的兜底，彻底移除对比表里的无效行。  
- 渲染优化：提取 `getParameterDisplayName`，确保标题列始终显示首个有效参数名，没有时回退到“未命名参数”。

```123:173:frontend/src/components/ComponentCompareModal.tsx
  const getParameterDisplayName = (record: any) => {
    const componentCount = comparisonData?.components.length ?? 0;
    for (let i = 0; i < componentCount; i += 1) {
      const param = record[`component_${i}`] as ParameterValue | undefined;
      const candidate = param?.name?.trim();
      if (candidate && candidate.toLowerCase() !== 'unknown') {
        return candidate;
      }
    }

    const fallback = record?.name?.trim();
    if (fallback && fallback.toLowerCase() !== 'unknown') {
      return fallback;
    }

    return '未命名参数';
  };

  const parameterColumns = [
    {
      title: '参数名称',
      dataIndex: 'name',
      key: 'name',
      width: 200,
      fixed: 'left' as const,
      render: (_text: string, record: any) => (
        <div>
          <Text strong>{getParameterDisplayName(record)}</Text>
        </div>
      ),
    },
    // ... existing code ...
  ];

  const filteredParameters = useMemo(() => {
    if (!comparisonData?.parameters || comparisonData.parameters.length === 0) {
      return [];
    }

    const componentCount = comparisonData.components.length;

    return comparisonData.parameters.filter(param => {
      if (!param) {
        return false;
      }

      const hasMeaningfulName = Array.from({ length: componentCount }).some((_, idx) => {
        const value = param[`component_${idx}`] as ParameterValue | undefined;
        const candidate = value?.name?.trim();
        return !!candidate && candidate.toLowerCase() !== 'unknown';
      });

      const fallback = (param as any)?.name?.trim();

      if (!hasMeaningfulName) {
        if (!fallback) {
          return false;
        }
        return fallback.toLowerCase() !== 'unknown';
      }

      return true;
    });
  }, [comparisonData]);
```

测试：未执行（建议在前端验证对比模态）。

```typescriptreact
  const getParameterDisplayName = (record: any) => {
    const componentCount = comparisonData?.components.length ?? 0;
    for (let i = 0; i < componentCount; i += 1) {
      const param = record[`component_${i}`] as ParameterValue | undefined;
      const candidate = param?.name?.trim();
      if (candidate && candidate.toLowerCase() !== 'unknown') {
        return candidate;
      }
    }

    const fallback = record?.name?.trim();
    if (fallback && fallback.toLowerCase() !== 'unknown') {
      return fallback;
    }

    return '未命名参数';
  };

  const parameterColumns = [
    {
      title: '参数名称',
      dataIndex: 'name',
      key: 'name',
      width: 200,
      fixed: 'left' as const,
      render: (_text: string, record: any) => (
        <div>
          <Text strong>{getParameterDisplayName(record)}</Text>
        </div>
      ),
    },
    // ... existing code ...
  ];

  const filteredParameters = useMemo(() => {
    if (!comparisonData?.parameters || comparisonData.parameters.length === 0) {
      return [];
    }

    const componentCount = comparisonData.components.length;

    return comparisonData.parameters.filter(param => {
      if (!param) {
        return false;
      }

      const hasMeaningfulName = Array.from({ length: componentCount }).some((_, idx) => {
        const value = param[`component_${idx}`] as ParameterValue | undefined;
        const candidate = value?.name?.trim();
        return !!candidate && candidate.toLowerCase() !== 'unknown';
      });

      const fallback = (param as any)?.name?.trim();

      if (!hasMeaningfulName) {
        if (!fallback) {
          return false;
        }
        return fallback.toLowerCase() !== 'unknown';
      }

      return true;
    });
  }, [comparisonData]);
```

---

**User**

很好，请将目前的进展更新到@DoEEEt功能开发总览.md 和@DoEEEt集成实施总结.md 中

---

**Cursor**

```markdown
*** Begin Patch
*** Update File: DoEEEt功能开发总览.md
@@
 ### 2025-11-11 (v2.4.1) 🛠️
 - ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
   - `GET /api/doeeet/components/:id`（组件详情弹窗）
   - `GET /api/doeeet/categories/tree`（分类筛选器）
 - ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
 - ✅ Linter 检查通过（无新增告警）
 - 影响文件：
   - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
   - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`
 
 #### 接下来建议
 - P0：抽象统一的前端请求层（含超时、错误映射、重试/熔断开关），替换页面内分散实现
 - P1：为 `POST /api/doeeet/components/compare` 套同样的超时/错误策略
 - P1：后端 Faceting 与缓存（按既定里程碑 B），完善筛选器可用项和计数
+
+### 2025-11-12 (v2.4.2) 🔄
+- ✅ 组件对比表体验优化：过滤掉名称为 `Unknown` 或空白的参数行，避免无意义参数占据列表
+- ✅ 参数名称渲染增强：对比表左侧标题优先展示首个有效参数名，缺失时回退为“未命名参数”，保证展示一致性
+- 📁 影响文件：
+  - `frontend/src/components/ComponentCompareModal.tsx` → `filteredParameters`、`getParameterDisplayName`
+
+#### 建议的后续动作
+- P1：将同类参数过滤逻辑复用到组件详情页的参数展示，保持多处体验一致
+- P2：为参数对比表增加“仅显示差异”开关，进一步提升可读性
*** End Patch
```

```markdown
 DoEEEt 功能开发总览

## 📋 项目概述

DoEEEt（Defense & Aerospace Electronic Equipment Database）是一个专门用于航空航天电子器件的数据库系统，包含了15个顶层分类、181个叶子分类、360个动态参数的完整电子元器件数据。

本文档总览了 DoEEEt 功能的开发进度和实施计划。

---

## 🎯 核心功能模块

### 1. ✅ 分类筛选功能（已完成 100%）

**功能描述**：
- 15个顶层分类展示（Microcircuits, Capacitors, Connectors 等）
- 2-5层深度的分类层级导航
- 双重交互方式：级联选择器 + Tab侧边栏

**技术实现**：
- 后端：`buildCategoryTree()` 服务 + Redis缓存
- 前端：`CategoryFilter` 组件（Cascader + Tabs）
- API：`/api/doeeet/categories/tree`

**文档**：
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md)
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md)

**状态**: ✅ 已完成（2025-10-31）

---

### 2. ✅ 动态参数表头（已完成 100%）

**功能描述**：
- 智能表头展示（有 `short_name` 显示简写 + Tooltip，无则显示完整名称）
- HTML标签支持（下标 `<sub>`、上标 `<sup>`）
- 360个动态参数的灵活展示

**技术实现**：
- 工具函数库：`parameterUtils.tsx`
- 8个核心函数：生成列、分组、导出CSV等
- 安全防护：DOMPurify清理HTML

**文档**：
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)

**示例代码**：
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

**状态**: ✅ 已集成到 `ComponentSearch` 页面（2025-10-31）

#### 🆕 表头与固定参数规范（概述）
- 表头规则：有 `short_name` → 显示“✖ short_name”且 Hover 显示完整 `name`；无 `short_name` → 直接显示 `name`。
- 固定参数：`Package` 与 `TOP (Operating Temperature)` 固定两列、固定顺序展示；名称从 `parameter_definitions`，取值从 `parameters`（按 `component_id + parameter_key`）。
- 聚合输出：后端统一返回 `static`（基础信息）、`fixedExtras`（Package/TOP）、`dynamic`（按 `meta.json` 顺序），空值用 “--”。

---

### 3. ⏳ 组件搜索功能（进行中 40%）

**功能描述**：
- 关键词搜索（器件型号、制造商）
- 分类筛选（集成 CategoryFilter）
- 参数范围筛选（电压、温度等）
- 分页、排序、导出

**待实施任务**：
- [x] 集成 CategoryFilter 到 ComponentSearch 页面
- [x] 集成动态参数表头到搜索结果
- [ ] 实现参数范围筛选
- [ ] 优化搜索性能

**状态**: ⏳ 进行中

---

### 4. ⏳ 动态参数筛选器（计划中 0%）

**功能描述**：
- 根据选择的分类，动态显示该分类的参数筛选器
- 支持范围筛选（数值型参数）
- 支持枚举筛选（离散值参数）

**实现思路**：
```tsx
// 监听分类变化
useEffect(() => {
  if (selectedCategory.length > 0) {
    loadDynamicParameters(selectedCategory);
  }
}, [selectedCategory]);

// 加载该分类的参数配置
const loadDynamicParameters = async (categoryPath: string[]) => {
  const response = await fetch(`/api/doeeet/category-meta/${encodeURIComponent(JSON.stringify(categoryPath))}`);
  const result = await response.json();
  setDynamicParams(result.data.meta);
};

// 渲染动态筛选器
<DynamicParameterFilter
  parameters={dynamicParams}
  onParameterChange={handleParameterChange}
/>
```

**状态**: ⏳ 计划中

---

### 5. ⏳ 组件详情页（计划中 20%）

**功能描述**：
- 基本信息展示（型号、制造商、封装等）
- 参数列表（分类展示）
- 数据表文档（Datasheet）
- 供应商信息
- 辐照测试数据

**待实施任务**：
- [ ] 完善参数详情展示（使用 parameterUtils）
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据展示
- [ ] 实现替代品推荐

**状态**: ⏳ 计划中

---

## 📊 开发进度总览

| 功能模块 | 进度 | 状态 | 预计完成时间 |
|---------|------|------|-------------|
| 分类筛选功能 | 100% | ✅ 完成 | 2025-10-31 |
| 动态参数表头 | 75% | ✅ 核心完成 | 2025-11-01 |
| 组件搜索功能 | 40% | ⏳ 进行中 | 2025-11-03 |
| 动态参数筛选器 | 0% | ⏳ 计划中 | 2025-11-05 |
| 组件详情页 | 20% | ⏳ 计划中 | 2025-11-07 |
| 组件对比功能 | 0% | 📋 待规划 | TBD |
| 替代品推荐 | 0% | 📋 待规划 | TBD |
| 批量导入/导出 | 0% | 📋 待规划 | TBD |

**整体进度**: 47%

---

## 🏗️ 技术架构

### 🆕 2025-11-11 更新（稳定性）
- 已为前端两处关键数据加载增加统一超时与错误处理（15s）：
  - 组件详情：`GET /api/doeeet/components/:id`
  - 分类树：`GET /api/doeeet/categories/tree`（失败不再使用静态回退，避免误导）
- Linter 全量通过；影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx`（详情弹窗数据加载）
  - `frontend/src/components/CategoryFilter.tsx`（分类树加载）

### 🆕 2025-11-12 更新（对比体验）
- 组件对比表过滤掉参数名称为 `Unknown` 或空白的行，避免无意义参数占位
- 对比表参数标题优先展示首个有效参数名；若缺失则显示“未命名参数”，保持列标题一致性
- 影响文件：
  - `frontend/src/components/ComponentCompareModal.tsx`


### 前端技术栈
```
React 18.2
├── TypeScript 4.9
├── Ant Design 5.12
├── Vite 4.5
└── React Router 6.20
```

### 前后端对齐计划（2025-11-10）
- 接口契约与字段命名统一
  - 后端输出统一字段：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`（"Yes"|"No"）
  - 详情/搜索/对比接口字段保持一致，前端避免额外适配层
- 查询参数规范与校验
  - 支持并校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
  - `familyPath` 传入 JSON 数组字符串（如 `["Resistors","Film"]`）
- 响应结构与分页
  - 统一 `{ success, data, error }`
  - 列表附带 `{ total, totalPages, page, limit, hasNextPage }`
- 性能与稳定性
  - 索引：`component_id`、`manufacturer_name`、`family_path`、`has_stock`、全文索引
  - 缓存：列表短缓存（30–120s），详情缓存（5–15m）
  - 速率限制与慢查询日志
- 前端改造
  - 建立统一 API SDK（TS 类型、统一错误处理）
  - 搜索/筛选状态与 URL 同步
  - 列表虚拟化、加载/空态/错误态与重试

### 里程碑（A-D）
- 里程碑 A（页面与布局）
  - `CategoryBrowsePage`、面包屑、左侧筛选 + 右侧结果布局
- 里程碑 B（筛选与数据）
  - Faceting 聚合（制造商/质量/库存/分类）+ 缓存
  - `FilterPanel`：折叠、Stacked/Scroll、显示计数、已选条件 chips、动态加载
- 里程碑 C（结果与表格）
  - 将动态参数表头全面接入结果表格，优化横向滚动/虚拟化
  - 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - 单位转换（pF ↔ µF/mF/F）与筛选器联动
  - 分类内局部搜索提示与命中高亮

### 后端技术栈
```
Node.js 18+
├── Express 4.x
├── TypeScript 4.9
├── MongoDB 6.x (数据库: business_plat)
├── Redis 7.x
└── meta.json（分类配置源）
```

### 数据流架构
```
meta.json 
  ↓ (读取)
DoeeetSearchService.buildCategoryTree()
  ↓ (构建树 + 缓存)
Redis (TTL: 1小时)
  ↓ (API)
/api/doeeet/categories/tree
  ↓ (HTTP)
前端组件 (CategoryFilter, DynamicParameterTable, etc.)
  ↓ (用户交互)
搜索 / 筛选 / 详情查看
```

---

## 📁 项目文件结构

```
Business_plat/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── DoeeetComponent.ts           # DoEEEt组件模型
│   │   │   └── ...
│   │   ├── services/
│   │   │   ├── DoeeetSearchService.ts       # 搜索服务（含分类树构建）
│   │   │   └── CacheService.ts              # Redis缓存服务
│   │   ├── controllers/
│   │   │   └── doeeetComponentController.ts # 控制器
│   │   └── routes/
│   │       └── doeeetRoutes.ts              # 路由配置
│   └── data/
│       └── meta.json                        # 分类配置源文件
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   └── CategoryFilter.tsx           # 分类筛选组件
│   │   ├── utils/
│   │   │   └── parameterUtils.tsx           # 动态参数工具函数
│   │   ├── examples/
│   │   │   └── DynamicParameterTableExample.tsx  # 示例代码
│   │   └── pages/
│   │       └── components/
│   │           └── ComponentSearch.tsx      # 搜索页面
│   └── docs/
│       ├── CategoryFilter使用说明.md
│       ├── 动态参数表头展示说明.md
│       └── 动态参数表头-快速开始.md
│
└── [根目录文档]
    ├── DoEEEt集成实施总结.md
    ├── DoEEEt项目开发计划.md
    ├── 前端分类筛选功能实施方案.md
    ├── 前端分类筛选-快速开始.md
    ├── DoEEEt动态参数表头实施总结.md
    └── DoEEEt功能开发总览.md (本文档)
```

---

## 🚀 快速开始

### 1. 启动 MongoDB 数据库

**Windows 系统**:
```bash
cd backend
.\start-mongodb-local.bat
```

**说明**:
- 脚本会自动检查 MongoDB 是否已安装
- 如果检测到 Windows 服务 `MongoDB` 正在运行，会尝试自动停止（默认服务数据目录: `E:\data\db`，项目数据目录: `F:\Business_plat\backend\data`）
- 停止 Windows 服务需要以管理员身份运行终端；若停止失败请手动执行 `net stop MongoDB`
- 自动停止服务并释放端口后再启动本地实例，避免读写到错误的数据目录
- 脚本会自动创建数据目录和日志目录（如果不存在）
- 数据目录: `backend/data`
- 日志文件: `backend/logs/mongod.log`
- 配置文件: `backend/mongod.conf`

**启动步骤**:
1. 打开 PowerShell 或命令提示符
2. 切换到 `backend` 目录: `cd backend`
3. 运行启动脚本: `.\start-mongodb-local.bat`
4. 脚本会自动检查环境并启动 MongoDB
5. 如果 MongoDB 已安装，会看到 "✅ MongoDB 启动成功！" 提示

**验证 MongoDB 是否运行**:
```bash
# 使用 mongosh 连接
mongosh mongodb://127.0.0.1:27017

# 或检查端口
netstat -an | findstr ":27017"

# 或访问健康检查（需要后端服务运行）
curl http://localhost:3001/health
```

**数据库配置**:
- 数据库名称: `business_plat`
- 连接地址: `mongodb://localhost:27017/business_plat`
- 集合名称: `components` (包含所有 DoEEEt 组件数据)
- 默认端口: `27017`

**注意事项**:
- 确保 MongoDB 已安装并添加到 PATH 环境变量
- MongoDB 安装路径通常是: `C:\Program Files\MongoDB\Server\8.2\bin`
- 如果启动失败，请检查日志文件: `backend/logs/mongod.log`
- 启动脚本会在当前窗口运行 MongoDB，关闭窗口会停止服务

---

### 2. 启动后端服务

```bash
cd backend
npm install

# 确保 .env 文件配置正确
# MONGODB_URI=mongodb://localhost:27017/business_plat

npm run dev
```

**启动成功标志**:
- ✅ MongoDB 连接成功
- ✅ Redis 连接成功
- ✅ 服务器启动成功，端口: 3001
- ✅ 数据自动保存机制已启动（间隔: 30秒）

**服务地址**:
- API 地址: `http://localhost:3001`
- 健康检查: `http://localhost:3001/health`

**验证服务是否运行**:
```bash
# 测试分类树 API
curl http://localhost:3001/api/doeeet/categories/tree

# 或访问健康检查端点
curl http://localhost:3001/health
```

---

### 3. 启动前端服务

```bash
cd frontend
npm install

# 安装可选依赖（用于HTML清理）
npm install dompurify @types/dompurify

npm run dev
```

**访问**: http://localhost:3000

---

### 4. 使用分类筛选

```tsx
import CategoryFilter from '@/components/CategoryFilter';

<CategoryFilter 
  onCategoryChange={(path) => console.log('选择的分类:', path)}
  selectedCategory={[]}
/>
```

---

### 5. 使用动态参数表头

```tsx
import { generateDynamicParameterColumns } from '@/utils/parameterUtils';

const dynamicColumns = generateDynamicParameterColumns(
  parameterDefinitions,
  { sortable: true }
);
```

---

## 📚 文档索引

### 核心文档

#### 分类筛选相关
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md) - 完整实施方案
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md) - 组件API文档
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md) - 5分钟上手

#### 动态参数表头相关
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md) - 实施总结
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md) - 详细文档
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md) - 快速上手

#### 总体文档
- [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 整体集成总结
- [DoEEEt项目开发计划.md](./DoEEEt项目开发计划.md) - 项目计划
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 本文档

### 示例代码
- [CategoryFilter.tsx](./frontend/src/components/CategoryFilter.tsx)
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

---

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：标题、结果总数、子分类卡片/列表）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 全局改为左右布局（左侧筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合并返回匹配数量：制造商/质量等级/库存/分类）
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、显示计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search"（质量等级等快速入口）
2. ⏳ 分类页面内的局部搜索提示（Search within <Category>）
3. ⏳ 搜索命中高亮

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

### 里程碑（对齐 DOEEET 的分类与搜索体验）
- 里程碑 A（页面与布局）
  - [ ] `CategoryBrowsePage`：分类标题与总数、子分类卡片/列表、跳转联动
  - [ ] 面包屑导航：Home > 顶类 > 子类
  - [ ] 左侧筛选 + 右侧结果的页面布局
- 里程碑 B（筛选与数据）
  - [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
  - [ ] `FilterPanel`：折叠、Stacked/Scroll、计数、已选条件chips、动态加载
- 里程碑 C（结果与表格）
  - [ ] 集成动态参数表头到搜索结果表格；横向滚动与虚拟化优化
  - [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - [ ] 单位转换工具与筛选器联动
  - [ ] 分类内局部搜索提示与搜索高亮

---

## 🎯 近期开发计划

### Week 1 (2025-10-31 ~ 2025-11-06)

#### Day 1-2: 集成分类筛选和动态参数表头
- [ ] 将 CategoryFilter 集成到 ComponentSearch 页面
- [ ] 将动态参数表头集成到搜索结果
- [ ] 测试和优化

#### Day 3-5: 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`（标题、总数、子分类卡片/列表）
- [ ] 新增面包屑导航并与分类路由联动
- [ ] 改版为“左侧筛选 + 右侧结果”布局（影响搜索与浏览页）

#### Day 3-4: 实现动态参数筛选器
- [ ] 监听分类变化
- [ ] 加载对应分类的参数配置
- [ ] 创建 DynamicParameterFilter 组件
- [ ] 实现范围筛选和枚举筛选

#### Day 5-7: 优化和测试
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 添加单元测试
- [ ] 用户体验优化
- [ ] 编写完整文档

---

### Week 2 (2025-11-07 ~ 2025-11-13)

#### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel` 组件（折叠/展开、Stacked/Scroll、计数、已选条件chips）
- [ ] 筛选器选项动态加载（基于当前结果集）

#### 组件详情页增强
- [ ] 完善参数详情展示
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据
- [ ] 实现替代品推荐

#### 搜索功能增强
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- [ ] 单位转换工具与筛选联动
- [ ] 分类内局部搜索提示与高亮

---

## 🐛 已知问题

### 1. CategoryFilter 组件
- [ ] Tab切换时动画不流畅（低优先级）
- [ ] 移动端适配待优化

### 2. 动态参数表头
- [ ] 待集成到实际页面进行测试
- [ ] 大数据量下性能待优化（考虑虚拟滚动）

### 3. 搜索功能
- [ ] 搜索结果高亮待实现
- [ ] 分页加载待优化

---

## 🤝 贡献指南

### 开发流程
1. Fork 项目
2. 创建 feature 分支
3. 提交代码并添加测试
4. 提交 Pull Request

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 必须有单元测试
- 必须有 JSDoc 注释

---

## 📞 联系信息

**项目团队**: 开发团队  
**最后更新**: 2025-11-01  
**当前版本**: v0.5 (开发中)  
**预计发布**: v1.0 (2025-11-15)

---

## 🎉 里程碑

### v0.1 (2025-10-25)
- ✅ DoEEEt数据库集成
- ✅ 基础数据模型

### v0.3 (2025-10-29)
- ✅ 分类树构建服务
- ✅ Redis缓存集成

### v0.5 (2025-10-31) - 当前版本
- ✅ CategoryFilter 组件
- ✅ 动态参数表头工具函数
- ✅ 完整文档

### v0.7 (2025-11-06) - 计划中
- ⏳ 完整搜索功能
- ⏳ 动态参数筛选器
- ⏳ 组件详情页

### v1.0 (2025-11-15) - 目标
- 📋 完整的DoEEEt功能
- 📋 性能优化
- 📋 完整的测试覆盖

---

## 📈 数据统计

### DoEEEt 数据库规模
- **总组件数**: ~50,000+ 个电子元器件
- **顶层分类**: 15 个
- **叶子分类**: 181 个
- **动态参数**: 360 个唯一参数键
- **制造商**: ~200+ 家

### 功能覆盖率
- **分类筛选**: 100% (15/15 顶层分类)
- **参数展示**: 100% (360/360 动态参数)
- **搜索功能**: 40% (基础搜索已实现)
- **详情展示**: 20% (基础信息已实现)

---

**感谢使用 DoEEEt 系统！**

如有问题，请查阅相关文档或联系开发团队。


```

```markdown
# DoEEEt电子元件搜索系统集成实施总结

## 项目概览

本文档记录了DoEEEt电子元件数据库与业务平台的集成实施过程，包括已完成的功能、技术架构和下一步计划。

## 数据概况

- **数据源**: DoEEEt (Defense Operational Electronic Equipment and Technology)
- **数据规模**: 
  - 组件 (components): 1.8M+ 条记录
  - 参数 (parameters): 137M+ 条记录
  - 参数定义 (parameter_definitions): 313 个参数类型
  - 动态参数定义 (meta.json): 360 个唯一参数键

### 数据文件映射关系（对应《数据说明》）

- components ↔ `general.csv`
- parameters ↔ `parameter.csv`
- parameter_definitions ↔ `parameter_final.csv`（集成时忽略 example 列）

### 分类结构分析 (基于 meta.json)

#### 顶层分类（15个）

```javascript
const topCategories = [
  "Cable Assemblies",        // 叶子分类: 3
  "Capacitors",              // 叶子分类: 8
  "Connectors",              // 叶子分类: 11
  "Crystals and Oscillators", // 叶子分类: 3
  "Discretes",               // 叶子分类: 30
  "Filters",                 // 叶子分类: 4
  "Inductors",               // 叶子分类: 3
  "Microcircuits",           // 叶子分类: 89 (最大类别)
  "Relays",                  // 叶子分类: 4
  "Resistors",               // 叶子分类: 6
  "RF Passive Components",   // 叶子分类: 2
  "Switches",                // 叶子分类: 5
  "Thermistors",             // 叶子分类: 3
  "Transformers",            // 叶子分类: 7
  "Wires and Cables",        // 叶子分类: 3
];
```

#### 分类层级统计

- **总计**: 181 个最细叶子分类（meta.json 中配置的分类）
- **路径深度分布**:
  - 深度 2 (例: `Capacitors > Ceramic`): 54 个 (29.83%)
  - 深度 3 (例: `Connectors > Circular > Circular Accessories`): 51 个 (28.18%)
  - 深度 4 (例: `Discretes > Diode > RF-Microwave Diode > PIN`): 61 个 (33.70%)
  - 深度 5 (例: `Microcircuits > Digital > Memory > RAM > SRAM`): 15 个 (8.29%)

#### family_path 数据结构

```python
# 实际存储格式：从“叶子(最低级)”到“顶层(最高级)”的层级数组
"['Peripheral-Controller', 'Digital', 'Microcircuits']"
#    ↑ 叶子(最低级)             ↑ 中间层级          ↑ 顶层

# 提取规则（与数据库一致）：
# - 叶子分类：family_path[0]
# - 顶层分类：family_path[-1] (最后一个元素)
```

#### 最常用的动态参数 (Top 10)

| 参数名称 | 使用率 | 说明 |
|---------|-------|------|
| Storage Temperature Range | 93.37% | 存储温度范围 |
| SEE sens. | 92.82% | 单粒子效应灵敏度 |
| TID (HDR) sens. | 92.82% | 总电离剂量（高剂量率）灵敏度 |
| TID (LDR) sens. | 92.82% | 总电离剂量（低剂量率）灵敏度 |
| TNID sens. | 92.82% | 中子辐射灵敏度 |
| Finish | 81.22% | 表面处理 |
| Package Material | 72.93% | 封装材料 |
| Number of Pins | 71.27% | 引脚数量 |
| TID (HDR) | 66.30% | 总电离剂量（高剂量率） |
| TID (LDR) | 66.30% | 总电离剂量（低剂量率） |

#### 注意事项

1. **meta.json 中没有 "Aerospace" 分类**
   - "Aerospace" 不是分类维度，而是质量等级或筛选条件
   - 可能对应 `comp-qualified = Y` 或特殊的 `quality_name`
   
2. **动态参数配置**
   - 每个叶子分类有不同的动态参数列表（在 meta.json 的 `meta` 数组中）
   - 共有 360 个唯一的动态参数键
   - 如果某个分类不在 meta.json 中，则只显示固定参数

## 已完成功能 (Phase 1, Phase 2 & Phase 2.5)

### Phase 1: 基础集成功能 ✅

#### 1.1 前端组件搜索页面 ✅
**文件**: `frontend/src/pages/components/ComponentSearch.tsx`

**功能**:
- 集成DoEEEt API (`/api/doeeet/search`)
- 支持多维度搜索：
  - 型号搜索 (partNumber)
  - 制造商筛选 (manufacturer)
  - 质量等级筛选 (qualityName: 883, QML Q, EP等)
  - 库存状态筛选 (hasStock: Yes/No)
  - 淘汰状态筛选 (obsolescenceType: Active, Obsolete, Risk, Last Time Buy)
- 数据格式转换：将DoEEEt数据格式适配到前端UI
- 解析family_path分类层次结构
- 分页和排序支持
- ✨ **新增**: 动态参数表头展示（Phase 2.5）
- ✨ **新增**: 分类筛选器集成（Phase 2.5）
- ✨ **新增**: CSV导出功能（Phase 2.5）

**技术实现**:
```typescript
// API调用示例
const response = await fetch(`/api/doeeet/search?${params.toString()}`);
const result = await response.json();

// 数据转换
const adaptedComponents = result.data.components.map((comp: any) => {
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层分类为最后一个元素
    mainCategory: familyPathArray[familyPathArray.length - 1],
    // ... 其他字段映射
  };
});
```

#### 1.2 组件详情弹窗 ✅
**功能**:
- 点击组件型号查看详细信息
- 动态加载组件参数 (`/api/doeeet/components/:id`)
- 显示参数定义翻译（中英文参数名、符号、分类）
- 参数表格展示：
  - 参数名称（完整名称 + 符号）
  - 参数值（支持数组值解析）
  - 参数分类
  - 单位和示例

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Thermal Resistance, Junction to Case [Max]"
  short_name: string;     // "&theta;<sub>JC</sub> [Max]"
  category: string;       // "Generic Functional & Electrical"
  value: any;             // 实际参数值
}
```

#### 1.3 首页分类统计卡片 ✅
**文件**: `frontend/src/pages/HomePage.tsx`

**功能**:
- 实时显示11个主要分类的组件数量
- 从API获取统计数据 (`/api/doeeet/statistics`)
- 动态更新分类统计卡片
- 支持点击跳转到对应分类搜索

**后端增强**:
- 在 `DoeeetSearchService.getStatistics()` 中添加 `categoryStats`
- 使用MongoDB聚合管道按family_path分组统计
- 解析family_path提取主分类
- Redis缓存优化（TTL: 1小时）

### Phase 2: 高级搜索功能 ✅

#### 2.1 动态参数表头展示 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (工具函数库)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 智能表头展示：
  - 有 `short_name` 时显示简写 + Tooltip（完整名称）
  - 无 `short_name` 时直接显示完整名称
- HTML 标签支持（`<sub>`, `<sup>` 等）
- 安全清理（DOMPurify）
- 根据分类动态生成参数列
- 参数列可排序、可筛选

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Storage Temperature Range"
  short_name?: string;    // "T<sub>STG</sub>"
  category: string;       // "Thermal"
  example?: string;       // "-55°C to 150°C"
}
```

**工具函数**:
```typescript
// 8个核心函数
- generateParameterColumnTitle()      // 生成智能表头
- generateDynamicParameterColumns()   // 批量生成动态列
- generateGroupedParameterColumns()   // 生成分组列
- exportParametersToCSV()             // 导出CSV
- downloadCSV()                       // 下载CSV
- groupParametersByCategory()         // 按分类分组
- formatParameterValue()              // 格式化参数值
- extractParameterKeys()              // 提取参数键
```

**UI效果**:
```
┌────────────────┬──────────┬─────────ⓘ───┬─────────ⓘ───┐
│ 器件型号        │ 制造商    │ #Pins       │ T_STG        │
│                │          │ ↑ Tooltip   │ ↑ Tooltip    │
├────────────────┼──────────┼─────────────┼──────────────┤
│ 860300YA       │ SIB      │ 68          │ -55°C~150°C  │
└────────────────┴──────────┴─────────────┴──────────────┘
```

**参数覆盖率**:
- 总参数数: 360个
- 有 `short_name`: ~80% (288个)
- 无 `short_name`: ~20% (72个)

#### 2.2 分类筛选器集成 ✅ ⭐ 新增
**文件**: 
- `frontend/src/components/CategoryFilter.tsx` (已有组件)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 级联选择器（Cascader）展示分类层级
- Tab导航展示顶层分类（15个）
- 支持 2-5 层分类路径选择
- 分类选择后自动触发搜索
- 显示每个分类的组件数量

**分类统计**:
| 顶层分类 | 组件数量 | 占比 | 路径深度 |
|---------|---------|------|---------|
| Resistors | 824,599 | 45.88% | 2层 |
| Capacitors | 503,149 | 27.99% | 2层 |
| Connectors | 160,090 | 8.91% | 3层 |
| Crystals and Oscillators | 131,524 | 7.32% | 2层 |
| Switches | 53,377 | 2.97% | 2层 |
| Discretes | 45,564 | 2.53% | 2-4层 |
| Thermistors | 31,302 | 1.74% | 2层 |
| Microcircuits | 25,652 | 1.43% | 2-5层 |
| 其他 (6类) | 22,160 | 1.23% | 2-3层 |

**数据流**:
```
用户选择分类
    ↓
CategoryFilter.onCategoryChange(path)
    ↓
setSelectedCategory(['Resistors', 'Film'])
    ↓
handleSearch() → /api/doeeet/search?familyPath=["Resistors","Film"]
    ↓
后端筛选 + 返回对应的 parameterDefinitions
    ↓
前端生成动态参数列
```

#### 2.3 参数范围筛选 ✅
**文件**: 
- `frontend/src/components/ParameterRangeFilter.tsx` (新建)
- `backend/src/services/DoeeetSearchService.ts` (已支持)

**功能**:
- 支持数值型参数的范围查询
- 常用参数快速选择：
  - 电压 (Voltage)
  - 电流 (Current)
  - 功率 (Power)
  - 频率 (Frequency)
  - 工作温度 (Temperature)
  - 电阻、电容、电感等
- 最小值/最大值输入
- 多参数组合筛选
- 动态添加/删除筛选条件

**API格式**:
```json
{
  "parameters": {
    "voltage": { "min": 3.3, "max": 5.0 },
    "temperature": { "min": -40, "max": 85 }
  }
}
```

**后端实现**:
```typescript
// 范围查询支持
if (typeof value === 'object' && ('min' in value || 'max' in value)) {
  const rangeQuery: any = { parameter_key: key };
  if (value.min !== undefined) {
    rangeQuery.numeric_value = { $gte: value.min };
  }
  if (value.max !== undefined) {
    rangeQuery.numeric_value = { 
      ...rangeQuery.numeric_value, 
      $lte: value.max 
    };
  }
  paramQueries.push(rangeQuery);
}
```

#### 2.4 CSV导出功能 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (导出函数)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 导出当前搜索结果为CSV
- 包含所有静态列和动态参数列
- 自动生成文件名（带时间戳）
- 支持中文编码（UTF-8 BOM）

**使用示例**:
```tsx
<Button 
  icon={<DownloadOutlined />}
  onClick={() => {
    const csvContent = exportParametersToCSV(components, parameterDefinitions);
    downloadCSV(csvContent, `components_${Date.now()}.csv`);
    message.success('导出成功！');
  }}
>
  导出CSV
</Button>
```

**CSV格式**:
```csv
器件型号,制造商,分类,Number of Pins,Storage Temperature Range,...
860300YA,SIB International,Resistors,68,-55°C~150°C,...
860301YA,SIB International,Capacitors,72,-40°C~125°C,...
```

#### 2.5 参数对比功能 ✅
**文件**:
- `frontend/src/components/ComponentCompareModal.tsx` (新建)
- `backend/src/controllers/doeeetComponentController.ts` (新增compareComponents)
- `backend/src/routes/doeeetRoutes.ts` (新增路由)

**功能**:
- 多选组件（2-5个）
- 批量对比按钮
- 对比模态框展示：
  - 基本信息对比表
  - 参数对比矩阵
  - 参数差异高亮
- 支持大量参数滚动查看

**API Endpoint**:
```
POST /api/doeeet/components/compare
Body: { componentIds: string[] }
```

**对比矩阵数据结构**:
```typescript
interface ComparisonMatrix {
  components: ComponentInfo[];      // 组件基本信息
  parameters: ParameterRow[];       // 参数对比矩阵
}

interface ParameterRow {
  key: string;
  component_0: { name, value, numericValue };
  component_1: { name, value, numericValue };
  // ...
}
```

## 技术架构

### 后端技术栈
- **框架**: Express.js + TypeScript
- **数据库**: MongoDB (1.8M+ 组件记录)
- **缓存**: Redis (搜索结果、组件详情、统计数据)
- **日志**: Winston

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI库**: Ant Design
- **路由**: React Router v6
- **状态管理**: React Hooks

### 数据库设计

#### Collections

1. **components** (1.8M 文档)
```javascript
{
  _id: ObjectId,
  component_id: String,          // UUID
  part_number: String,           // "5962-8864203YA"
  part_type: String,             // "P1754-40QGMB"
  manufacturer_name: String,     // "Pyramid Semiconductor"
  family_path: String,           // "['Peripheral-Controller', 'Digital', 'Microcircuits']"
  quality_name: String,          // "883"
  obsolescence_type: String,     // "Active"
  has_stock: String,             // "Yes"/"No"
  qpl_name: String,              // "QPDSIS-38535"
  qualified: String,             // "Y"/"N"
  cad: String,
  created_at: Date,
  updated_at: Date
}
```

2. **parameters** (数百万文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID + type
  component_id: String,          // 外键
  parameter_value: String,       // "['0.00000']"
  numeric_value: Number,         // 用于范围查询
  created_at: Date,
  updated_at: Date
}
```

3. **parameter_definitions** (313 文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID
  name: String,                  // "Thermal Resistance, Junction to Case [Max]"
  short_name: String,            // "&theta;<sub>JC</sub> [Max]"
  category: String,              // "Generic Functional & Electrical"
  example: String,               // "5°C/W"
  created_at: Date,
  updated_at: Date
}
```
注：本集合与数据说明中的 `parameter_final.csv` 对应；集成与展示时请忽略 `example` 列（不参与前后端逻辑与显示）。

### API接口列表

#### 搜索API
- `GET /api/doeeet/search` - 复合搜索
- `GET /api/doeeet/fulltext` - 全文搜索
- `GET /api/doeeet/suggestions` - 搜索建议
- `GET /api/doeeet/category/:category` - 分类浏览

#### 组件API
- `GET /api/doeeet/components/:id` - 组件详情
- `POST /api/doeeet/components/compare` - 对比组件 ✨ 新增

#### 元数据API
- `GET /api/doeeet/manufacturers` - 制造商列表
- `GET /api/doeeet/categories` - 分类列表
- `GET /api/doeeet/parameter-definitions` - 参数定义
- `GET /api/doeeet/statistics` - 统计信息 ✨ 增强

## 性能优化

### 1. Redis缓存策略
```typescript
// 缓存TTL配置
const CacheTTL = {
  SEARCH_RESULT: 300,        // 5分钟
  COMPONENT_DETAIL: 1800,    // 30分钟
  METADATA: 3600,            // 1小时
  STATISTICS: 3600           // 1小时
};
```

### 2. MongoDB索引
```javascript
// components集合索引
{
  component_id: 1,           // 唯一索引
  part_number: 1,            // 搜索索引
  manufacturer_name: 1,
  obsolescence_type: 1,
  family_path: 1
}

// parameters集合索引
{
  component_id: 1,
  parameter_key: 1,
  numeric_value: 1           // 范围查询索引
}

// 全文搜索索引
{
  part_number: "text",
  manufacturer_name: "text",
  part_type: "text"
}
```

### 3. 分页优化
- 默认每页20条
- 最大限制100条
- Skip + Limit实现

### 缓存与限流（新增）
- 实现 `CacheService.ts`
- 缓存搜索结果、分类树
- 性能优化：目标从200ms降至10-20ms

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站功能对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：分类标题、结果总数、子分类列表/卡片）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 改为左右布局（左侧固定筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合返回匹配数量：制造商/质量等级/库存/分类）+ 缓存
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随当前结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换功能（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search" 部分
2. ⏳ 分类页面局部搜索（Search within <Category>）
3. ⏳ 结果高亮显示

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

## 本次对齐实施计划（2025-11-10）

### 阶段 0（契约与正确性）
- [ ] 接口契约与字段命名统一：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`
- [ ] 查询参数校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
- [ ] 响应结构统一：`{ success, data, error }`；分页元数据 `{ total, totalPages, page, limit, hasNextPage }`
- [ ] 错误码与错误体：400/404/500；`error.code`、`error.message`

### 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`：显示分类标题、总数、子分类卡片/列表；支持点击进入搜索页
- [ ] 新增面包屑导航：Home > 顶类 > 子类，支持路由联动
- [ ] 页面布局改造：统一为“左侧筛选面板 + 右侧结果列表”

### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel`：折叠/展开、Stacked/Scroll 视图、显示计数、已选条件chips
- [ ] 筛选项动态加载（基于当前结果集）

### 里程碑 C（结果与表格）
- [ ] 将动态参数表头接入搜索结果表格并优化横向滚动/虚拟化
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）

### 里程碑 D（体验增强）
- [ ] 单位转换（pF ↔ µF/mF/F）与筛选器联动
- [ ] 分类内局部搜索提示（Search within <Category>）与结果高亮

---

## 待实现功能 (Phase 3 & 优化)

### Phase 2.6: 动态参数表头增强 ⏳
- [ ] 参数列的显示/隐藏控制
- [ ] 参数列的拖拽排序
- [ ] 参数列配置保存到 localStorage
- [ ] 参数列的分组展示（按 category）
- [ ] 参数列的高级筛选（范围、正则等）
- [ ] 参数统计图表展示

### Phase 3.1: 关联数字模型 ⏳
- 展示组件关联的3D CAD模型
- 模型预览（使用Three.js或类似库）
- 模型信息展示

### Phase 3.2: 模型下载功能 ⏳
- 支持多种CAD格式下载
- 下载进度显示
- 批量下载支持

### Phase 3.3: 分面搜索（Facets）⏳
- 实现分面搜索
- 统计每个筛选条件的可用选项数量
- 动态更新可用筛选选项

## 使用说明

### 1. 启动服务

**后端**:
```bash
cd backend
npm install
npm run dev
```

**前端**:
```bash
cd frontend
npm install
npm start
```

### 2. 访问系统

- 前端URL: http://localhost:3000
- 后端API: http://localhost:3001

### 3. 主要功能入口

1. **组件搜索**: 导航栏 -> 器件查询 -> 器件搜索
2. **首页统计**: 首页 -> 11个分类统计卡片
3. **参数筛选**: 组件搜索页面 -> 参数范围筛选卡片
4. **组件对比**: 
   - 选择2-5个组件
   - 点击"批量对比"按钮
   - 查看对比结果

## 数据统计

### 分类统计（示例）
- Peripheral-Controller: ~800,000
- Digital: ~500,000
- Microcircuits: ~300,000
- Analog: ~200,000
- 其他分类: 各有数量

### 制造商统计
- 18+ 制造商
- 包括Pyramid Semiconductor, Analog Devices, Texas Instruments等

### 参数统计
- 313个参数定义
- 涵盖电气、热学、机械等多个分类

## 测试建议

### 功能测试
1. 搜索功能测试
   - 型号搜索: "5962-8864203YA"
   - 制造商筛选: "Pyramid Semiconductor"
   - 组合筛选测试

2. 参数筛选测试
   - 单参数范围: 电压 3.3V-5V
   - 多参数组合: 电压 + 温度

3. 组件对比测试
   - 选择2个相似组件对比
   - 选择5个组件对比
   - 查看参数差异

### 性能测试
1. 大数据量搜索响应时间
2. 缓存命中率监控
3. 并发用户测试

## 注意事项

1. **数据格式**: DoEEEt的family_path使用Python列表字符串格式，需要特殊解析
2. **参数值**: 参数值也是数组字符串格式，需要解析后显示
3. **缓存策略**: 注意Redis缓存的TTL设置，避免数据过期问题
4. **错误处理**: 前端有降级方案，API失败时显示模拟数据

## 开发团队

- 后端开发: Express.js + MongoDB + Redis
- 前端开发: React + TypeScript + Ant Design
- 数据导入: Python脚本处理DoEEEt CSV数据

## 🔥 最新状态更新 (2025-10-30)

### ✅ 重大进展

#### 1. 后端服务正常运行 ⭐
- **状态**: ✅ 已启动并稳定运行
- **端口**: 3001
- **服务**:
  - MongoDB 8.2.1 连接正常 (1.8M组件数据)
  - Redis连接正常 (缓存服务)
  - 所有API端点可访问

#### 2. TypeScript编译问题修复 ⭐
- **问题**: `jsonwebtoken` 类型声明错误导致编译失败
- **解决方案**: 使用类型断言 `as JwtPayload`
- **影响文件**: `backend/src/middleware/authMiddleware.ts`
- **状态**: ✅ 已修复，编译通过

#### 3. ComponentSearch页面API集成完成 ⭐
- **文件**: `frontend/src/pages/components/ComponentSearch.tsx`
- **状态**: ✅ 已接入真实API (`/api/doeeet/search`)
- **功能验证**:
  - ✅ API调用逻辑正确
  - ✅ 数据适配器已实现 (MongoDB → UI)
  - ✅ 支持搜索、筛选、分页
  - 🔄 待测试：前端服务启动后的实际运行效果

#### 4. 数据库备份脚本完善 ⭐ 🆕
- **文件**: `backend/scripts/backup_database.ps1`
- **状态**: ✅ 已完善，支持 MongoDB 8.x
- **功能**:
  - ✅ MongoDB 版本自动检测
  - ✅ MongoDB 8.x 强制使用 mongosh 备份
  - ✅ 详细的进度显示和日志
  - ✅ 自动压缩和备份验证
- **备份路径**: `F:\Business_plat\backups\`
- **兼容性**: MongoDB 8.2.1 + mongodump 100.x

#### 5. 数据格式迁移脚本准备 ⭐ 🆕
- **文件**: `backend/scripts/migrate_doeeet_data_format.js`
- **状态**: ✅ 已创建，待执行
- **目的**: 修复 `doeeet_tasks` 集合数据格式
- **操作**: 字段展平（`title.value` → `title`）
- **安全**: 自动创建备份集合

#### 4. 数据适配器实现 ⭐
**转换逻辑**:
```typescript
// MongoDB数据格式 → 前端UI格式
const adaptedComponents = result.data.components.map((comp: any) => {
  // 解析Python列表格式的family_path
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层在末尾，叶子在开头
    mainCategory: familyPathArray[familyPathArray.length - 1],
    subCategory: familyPathArray[1] || '',
    category: familyPathArray[0] || '',
    qualityLevel: comp.quality_name,
    status: comp.obsolescence_type,
    stockStatus: comp.has_stock === 'Yes',
    qplName: comp.qpl_name || '',
    qualified: comp.qualified === 'Y'
  };
});
```

### 🎯 当前优先级任务

#### P0 - 立即执行（数据安全优先）
1. **数据库备份** ⏰ 30分钟 🔴
   - 🔄 执行备份脚本 (`.\scripts\backup_database.ps1`)
   - 验证备份完整性
   - 备份位置：`F:\Business_plat\backups\`

2. **数据格式迁移** ⏰ 1-2小时 🔴
   - 🔄 执行迁移脚本 (`node scripts/migrate_doeeet_data_format.js`)
   - 修复 `doeeet_tasks` 数据格式
   - 验证迁移结果

3. **后端API验证** ⏰ 30分钟 🔴
   - 测试迁移后的API响应
   - 验证数据完整性
   - 检查前端兼容性

#### P1 - 短期实施（功能开发）
4. **启动前端服务并验证数据流** ⏰ 1小时
   - 启动前端开发服务器 (`npm start`)
   - 测试ComponentSearch页面真实搜索
   - 验证180万组件数据展示
   - 检查分页、排序功能

5. **实现组件详情弹窗** ⏰ 2-3小时
   - 调用 `/api/doeeet/components/:id/parameters`
   - 展示技术参数表格
   - 显示参数定义翻译（中英文）

6. **参数对比功能开发** ⏰ 1-2天
   - 后端：创建 `ComparisonService.ts`
   - 后端：实现 `POST /api/doeeet/compare` API
   - 前端：组件多选功能 (Checkbox列)
   - 前端：对比抽屉UI
   - 前端：参数差异高亮

#### P2 - 中期实施
7. **分面搜索（Facets）** ⏰ 1天
   - 后端：搜索结果中添加聚合统计
   - 前端：分面筛选器UI组件
   - 动态更新可用选项数量

8. **Redis缓存集成** ⏰ 1-2天
   - 实现 `CacheService.ts`
   - 缓存搜索结果、分类树
   - 性能优化：目标从200ms降至10-20ms

### 📊 项目整体进度

| 阶段 | 状态 | 进度 | 说明 |
|------|------|------|------|
| 阶段一：数据导入 | ✅ 完成 | 100% | 1.8M组件 + 137M参数 |
| 阶段二：搜索API | ✅ 基本完成 | 95% | 10个端点已实现，分面搜索待补充 |
| 阶段三：前端开发 | 🔄 进行中 | 65% | ✅ 动态参数表头、✅ 分类筛选、✅ CSV导出 |
| 阶段四：测试部署 | ⏳ 待开始 | 0% | 预计11月下旬 |

**整体进度**: 80% ✅

**Phase 2.5 新增功能** (2025-10-31):
- ✅ 动态参数表头展示（智能表头 + HTML支持）
- ✅ 分类筛选器集成（级联选择 + 分类统计）
- ✅ CSV导出功能（包含动态参数）
- ✅ 工具函数库（8个核心函数）
- ✅ 完整文档（3份详细文档）

### 🔧 技术问题解决记录

#### 问题1: TypeScript编译错误
```
错误信息: 
Property 'userId' does not exist on type 'string | JwtPayload'

解决方案:
const decoded = jwt.verify(token, process.env.JWT_SECRET!) as JwtPayload;

位置: backend/src/middleware/authMiddleware.ts:19
```

#### 问题2: DoEEEt数据格式特殊性
```python
# family_path 是Python列表字符串
"['Peripheral-Controller', 'Digital', 'Microcircuits']"

# 需要替换单引号为双引号后JSON.parse
JSON.parse(comp.family_path.replace(/'/g, '"'))
```

### 📈 关键指标

| 指标 | 当前状态 | 目标 | 完成度 |
|------|---------|------|--------|
| 后端服务 | ✅ 运行中 (端口3001, MongoDB 8.2.1) | 稳定运行 | 100% |
| 数据导入 | ✅ 1.8M组件 | 完成 | 100% |
| 数据备份 | 🔄 脚本已完善 | 备份完成 | 80% |
| 数据迁移 | 🔄 脚本已创建 | 迁移完成 | 50% |
| 搜索API | ✅ 10个端点 | 完成 | 100% |
| 动态参数表头 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| 分类筛选器 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| CSV导出 | ✅ 已实现 | 完成 | 100% ⭐ |
| 搜索性能 | ⚠️ 200ms | <50ms | 需Redis优化 |
| 前端数据打通 | ⚠️ 1/12页面 | 全部接入 | 8% |
| 参数对比 | ❌ 未实现 | 已实现 | 0% |
| 分面搜索 | ❌ 未实现 | 已实现 | 0% |

## 更新日志

### 2025-11-12 (v2.4.1) 🔄
- ✅ **组件对比体验优化**：过滤掉参数名称为 `Unknown` 或空白的对比行，减少噪声信息
- ✅ **参数标题完善**：对比矩阵优先展示首个有效参数名，缺失时统一显示“未命名参数”，保证列标题一致
- 📁 **影响文件**：`frontend/src/components/ComponentCompareModal.tsx`

### 2025-11-01 (v2.4) 🔍
- ✅ **对比分析完成**: 完成与 DOEEET 原始网站的深入对比分析
- ✅ **改进思路文档**: 
  - 5个核心功能模块的对比分析（分类浏览、筛选面板、筛选器、结果展示、搜索整合）
  - 详细的改进思路和实施优先级建议
  - 技术实现要点总结
- ✅ **文档更新**: 
  - [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 添加对比分析与改进思路章节
  - [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 添加对比分析与改进思路章节
- 📋 **实施计划**: 
  - Phase 1: 核心布局改造（高优先级）
  - Phase 2: 筛选功能增强（高优先级）
  - Phase 3: 用户体验优化（中优先级）
  - Phase 4: 高级功能（低优先级）

### 2025-10-31 (v2.3) 🆕⭐
- ✅ **Phase 2.5 完成**: 动态参数表头功能全面上线
- ✅ **动态参数表头展示**: 
  - 智能表头（short_name + Tooltip）
  - HTML标签支持（`<sub>`, `<sup>`）
  - DOMPurify安全清理
  - 参数列可排序、可筛选
- ✅ **分类筛选器集成**: 
  - CategoryFilter组件集成到ComponentSearch
  - 级联选择器展示 2-5 层分类
  - Tab导航显示15个顶层分类
  - 分类统计数据分析完成（1.8M组件）
- ✅ **CSV导出功能**: 
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码支持中文
  - 自动文件名（带时间戳）
- ✅ **工具函数库**: `parameterUtils.tsx` (8个核心函数)
- ✅ **文档完善**: 
  - [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
  - [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
  - [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)
  - [DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)
  - [DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)
- 📝 **项目进度更新**: 阶段三从45%提升至65%，整体进度80%
- 📊 **数据分析**: 完成 family_path 结构分析（14个顶层分类，181个叶子分类）

### 2025-10-30 (v2.2)
- ✅ **数据库备份脚本完善**: 支持 MongoDB 8.2.1，强制使用 mongosh
- ✅ **数据迁移脚本创建**: `migrate_doeeet_data_format.js`，修复数据格式
- 🔄 **优先级调整**: 数据备份与迁移（P0）→ 前端验证 → 参数对比 → 分面搜索
- 📝 **项目进度更新**: 阶段三从40%提升至45%，整体进度72%
- 📝 **技术债务**: MongoDB 8.x 与 mongodump 100.x 兼容性问题已解决

### 2024-10-30 下午 (v2.1)
- ✅ **后端编译问题修复**: jsonwebtoken类型断言
- ✅ **后端服务启动**: 端口3001，MongoDB+Redis正常
- ✅ **ComponentSearch接入API**: 数据适配器实现完成
- 📝 **优先级调整**: 前端数据流验证 → 参数对比 → 分面搜索 → Redis缓存
- 📝 **项目进度更新**: 阶段三从30%提升至40%，整体进度70%

### 2024-10-30 上午
- ✅ 完成Phase 1.1: 前端组件搜索页面集成
- ✅ 完成Phase 1.2: 组件详情弹窗
- ✅ 完成Phase 1.3: 首页分类统计
- ✅ 完成Phase 2.1-2.3: 参数范围筛选
- ✅ 完成Phase 2.5: 参数对比功能（计划中）

## 下一步计划

### 本周内 (10月31日 - 11月3日)
1. ✅ ~~后端服务启动并验证~~
2. ✅ ~~ComponentSearch API集成~~
3. ✅ ~~数据库备份脚本完善~~
4. ✅ ~~动态参数表头实现~~ ⭐
5. ✅ ~~分类筛选器集成~~ ⭐
6. ✅ ~~CSV导出功能~~ ⭐
7. ✅ ~~family_path数据分析~~ ⭐
8. 🔄 **前端服务启动并测试** (当前任务)
9. 🔄 真机测试动态参数表头
10. 🔄 性能测试和优化

### 下周 (11月4日 - 11月10日)
1. 🔄 执行数据库备份（如需要）
2. 🔄 执行数据格式迁移（如需要）
3. ⏳ 参数列配置保存（显示/隐藏、拖拽排序）
4. ⏳ 参数对比功能开发
5. ⏳ 分面搜索实现
6. ⏳ Redis缓存性能优化

### 中期计划 (11月中下旬)
1. 其他11个搜索页面迁移
2. 全面集成测试
3. 参数列的高级筛选
4. 参数统计图表展示
5. 移动端适配

### 长期计划
1. **Phase 3**: 数字模型关联和下载（按需实施）
2. **性能优化**: 进一步优化大数据量查询
3. **用户反馈**: 收集用户反馈并迭代改进
4. **文档完善**: API文档、用户手册等
5. **国际化支持**: 中英文切换

## 📚 相关文档索引

### Phase 2.5: 动态参数表头完整文档

#### 核心文档
1. **[DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)**
   - 核心功能总结
   - 技术实现详解
   - 数据统计和性能优化
   - 实施进度（75%完成）

2. **[DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)**
   - 集成到ComponentSearch的完整过程
   - 数据流和技术细节
   - 测试指南和已知问题
   - 状态：✅ 集成完成，待测试

3. **[动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)**
   - 数据结构详解
   - 展示逻辑和规则
   - 3种实现方案对比
   - HTML渲染和安全性

4. **[动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)**
   - 5分钟快速上手
   - API完整参考
   - 使用场景和示例
   - 常见问题解答

#### 数据分析文档
5. **[DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)**
   - 1.8M组件分类结构分析
   - 14个顶层分类统计
   - 路径长度分布（2-5层）
   - 前端筛选器设计建议
   - MongoDB聚合查询示例

#### 示例代码
6. **[parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)**
   - 8个核心工具函数
   - TypeScript类型定义
   - JSDoc完整注释

7. **[DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)**
   - 完整使用示例
   - 最佳实践演示

8. **[ComponentSearch.tsx](./frontend/src/pages/components/ComponentSearch.tsx)**
   - 实际集成代码
   - 生产环境实现

### 其他功能文档
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md)
- [DoEEEt-README.md](./DoEEEt-README.md)

---

## 🎯 Phase 2.5 核心成果总结

### ✅ 已完成功能（2025-10-31）

#### 1. 动态参数表头系统
- **智能表头展示**
  - 有 `short_name`: 显示简写 + Tooltip（完整名称）
  - 无 `short_name`: 直接显示完整名称
  - 覆盖率：80%参数有简写，20%仅有完整名称
  
- **HTML标签支持**
  - 支持 `<sub>`、`<sup>`、`<b>`、`<i>` 等标签
  - 示例：T<sub>STG</sub>、V<sub>CC</sub>、I<sub>O</sub>
  - DOMPurify安全清理，防XSS攻击
  
- **参数列功能**
  - 可排序（升序/降序）
  - 可筛选（输入框筛选）
  - 可自定义宽度
  - 超长省略（ellipsis）

### 2.6 表头渲染规范与固定参数取值方案 🆕

本节明确搜索结果与对比表中“动态参数表头”的展示规范，以及 Package 与 TOP（Operating Temperature）两项固定参数的取值来源与后端聚合方案，确保与 DOEEET 原站表现一致。

#### 展示规范
- 有 short_name 时：标题显示为“✖ short_name”，鼠标悬停显示完整 name（Tooltip）。
- 无 short_name 时：标题直接显示 name（不显示 Tooltip）。
- HTML 标签支持：允许 `<sub>` / `<sup>` 等（通过 DOMPurify 清理后安全渲染）。
- 空值显示：统一使用 “--” 代替 “Unknown”，长文本启用省略与悬停展示完整值。

示例：
```
✖ T_A [Max]        ← 列标题显示 short_name
(Access Time [Max]) ← 悬停 Tooltip 显示 name
```

#### 固定参数（Package 与 TOP）策略
- 固定两项，固定顺序展示在基础信息之后、动态参数之前：
  1) Package（parameter_key = `5df8d422-39bd-431f-9095-582a3f6f8fc1`）
  2) Operating Temperature（TOP，parameter_key = `2f2e7f5a-7cd0-47da-8feb-a29336285a3e`）
- 名称来源：`parameter_definitions`（通过 parameter_key 关联，获取 name 与 short_name）。
- 取值来源：`parameters`（按组件 component_id + parameter_key 获取具体值）。

#### 后端聚合与响应结构
为减少多次 IO 与确保顺序稳定，后端在详情与搜索结果适配时统一聚合输出三段数据：
1) static：来自 components/general 的静态字段（型号、制造商、质量等级、生命周期等）。
2) fixedExtras：仅包含 Package 与 TOP 两项（按上述固定顺序）。
3) dynamic：依据该器件 family_path 在 `meta.json` 匹配到的 `meta` 有序列表进行生成；即使某项无值也保留结构（值为 null/空字符串），方便前端一致渲染与列对齐。

接口响应示例（节选）：
```json
{
  "static": { "part_number": "CY7C432-80DMB", "manufacturer_name": "Teledyne e2v Inc", "...": "..." },
  "fixedExtras": [
    { "key": "5df8d422-39bd-431f-9095-582a3f6f8fc1", "name": "Package", "shortName": "Package", "value": "CDIP-28" },
    { "key": "2f2e7f5a-7cd0-47da-8feb-a29336285a3e", "name": "Operating Temperature Range", "shortName": "T<sub>OP</sub>", "value": "-55°C to +125°C" }
  ],
  "dynamic": [
    { "key": "24d759de-b13d-4aa4-af76-42e60d2302ec", "name": "Number of Contacts", "shortName": "#Contacts", "value": 20, "category": "Mechanical Data" }
  ]
}
```

实现要点：
- 批量取值：一次性读取该组件的所有 parameters 记录 → 构建 `Map<parameter_key,value>`；再批量查询 definitions → 构建 `Map<parameter_key,{name,short_name,category}>`。
- 固定参数优先：先拼装 fixedExtras（Package、TOP），再按 meta.json 的 `meta` 顺序生成 dynamic。
- 缓存优化：`meta.json` 常驻内存或 Redis（TTL 建议 ≥ 1h）；definitions 也可缓存；组件详情可短期缓存 30m。
- 兼容性：提供查询参数 `includeEmpty=false` 以允许前端在需要时隐藏无值项（默认保留结构）。

### ⛳ 横向参数表模式（Beta）实施方案（静态+动态“一行展示”）

为对齐 DOEEET 的“每个器件一整行，左静态右动态”的交互，本期在搜索结果与详情弹窗中引入“横向参数表模式（Beta）”。核心是基于一套“列方案生成器”，将固定字段与动态参数列拼接为同一张宽表。

#### 一、列方案
- 静态列（固定）：
  - `partNumber`、`manufacturer`、`mainCategory/primaryCategory/secondaryCategory`（可视情况只留主类）、`package`、`TOP`
- 动态列（可变）：
  - 来源：接口返回的 `parameterDefinitions`（当前分类对应的候选参数定义）
  - 标题：优先 `short_name`，悬停显示完整 `name`；无 `short_name` 时直接显示 `name`
  - 取值：从每行数据的 `parameters[paramKey]` 读取

#### 二、数据整形
- 列表接口返回形如：
  - `entry.static`（静态字段）、`entry.fixedExtras`（Package/TOP）、`entry.dynamic[]`（若后端已返回动态值）
- 前端行对象构造：
  - `row.parameters = reduce(entry.dynamic, (acc, {key,value}) => (acc[key]=value, acc), {})`
  - `row.package/top` 优先取 `fixedExtras`；缺失时回退到 `static.part_type` 等

#### 三、渲染与交互
- 搜索结果表：
  - 列集合：`[静态列] + generateDynamicParameterColumns(parameterDefinitions)`
  - 冻结左侧关键列：`partNumber`、`manufacturer`
  - 横向滚动：`scroll.x` 启用，列宽自适应，超长 Tooltip
- 详情弹窗：
  - 以同一套列方案渲染一行数据（`dataSource=[selectedComponent]`），替换原三列“参数名称/值/分类”结构
  - 保留“基础信息”上方的 `Descriptions`，参数区切换为横向宽表

#### 四、性能策略
- 按当前页动态渲染可见列，启用列宽最小值与省略
- 后端尽量返回当前分类的 `parameterDefinitions`，避免首屏收集全库键集合
- 逐步演进：Beta 阶段只按 `parameterDefinitions` 生成列，不做“低频列阈值/列管理器”，后续再启用

#### 五、落地改动说明（已实施）
- 前端
  - `frontend/src/pages/components/ComponentSearch.tsx`
    - 列表：将搜索结果的 `entry.dynamic` 聚合为 `row.parameters`；并基于 `parameterDefinitions` 生成动态列，拼接到静态列后面
    - 详情：用“横向参数表（一行）”替换原三列表格，复用相同的动态列生成器
  - `frontend/src/utils/parameterUtils.tsx`
    - 复用 `generateParameterColumnTitle` 与 `generateDynamicParameterColumns`，标题规则与 Tooltip 保持与前述规范一致
- 兼容性
  - 若后端暂未返回 `entry.dynamic`，动态列仍会渲染但显示为 “-”，不影响页面可用性

#### 六、下一步（可选增强）
- 列管理器（显示/隐藏、拖拽排序、持久化）
- 参数值标准化与单位合并（如温度、电压范围格式）
- 虚拟化渲染以优化超宽表性能（>150 列）
#### 2. 分类筛选系统
- **数据分析完成**
  - 14个顶层分类（Resistors占45.88%，Capacitors占27.99%）
  - 181个叶子分类
  - 路径深度2-5层（86.86%为2层）
  - 1.8M组件100%有分类路径
  
- **UI组件集成**
  - CategoryFilter级联选择器
  - Tab导航（15个顶层分类）
  - 分类统计数量显示
  - 选择联动搜索

#### 3. 数据导出系统
- **CSV导出**
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码（支持Excel打开中文）
  - 自动文件名（带时间戳）
  - 1000行 < 1s（预期性能）

#### 4. 工具函数库
**8个核心函数** (`parameterUtils.tsx`):
```typescript
1. generateParameterColumnTitle()      // 生成智能表头
2. generateDynamicParameterColumns()   // 批量生成动态列
3. generateGroupedParameterColumns()   // 生成分组列
4. exportParametersToCSV()             // 导出CSV
5. downloadCSV()                       // 下载CSV文件
6. groupParametersByCategory()         // 按分类分组参数
7. formatParameterValue()              // 格式化参数值
8. extractParameterKeys()              // 提取参数键列表
```

### 📊 数据统计

| 项目 | 数量 | 说明 |
|------|------|------|
| 组件总数 | 1,797,417 | 有分类路径的组件 |
| 参数定义 | 360个 | 唯一参数键 |
| 有简写参数 | ~288个 (80%) | 有 short_name |
| 无简写参数 | ~72个 (20%) | 仅有 name |
| 顶层分类 | 14个 | Resistors, Capacitors等 |
| 叶子分类 | 181个 | 最细分类 |
| 文档数量 | 8份 | 完整技术文档 |
| 代码文件 | 3个 | 工具函数+示例+集成 |

### 🎨 UI效果预览

```
┌─────────────────────────────────────────────────────────────┐
│                  DoEEEt 器件搜索系统                         │
├─────────────────────────────────────────────────────────────┤
│ [分类筛选] ▼                                                 │
│   > Resistors (824,599)  > Capacitors (503,149)             │
│   > Connectors (160,090) > Crystals (131,524) ...          │
├─────────────────────────────────────────────────────────────┤
│ 型号: [_____] 制造商: [_____]  [搜索] [重置] [导出CSV]     │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────┬────────ⓘ┬──────ⓘ┬────────ⓘ┐           │
│ │ 器件型号 │ 制造 │  #Pins  │ T_STG  │  V_CC   │ ...       │
│ │         │ 商   │         │        │         │           │
│ ├─────────┼──────┼─────────┼────────┼─────────┤           │
│ │ 860300  │ SIB  │ 68      │-55~150°│ 3.3~5V  │ ...       │
│ │ 860301  │ SIB  │ 72      │-40~125°│ 5V      │ ...       │
│ └─────────┴──────┴─────────┴────────┴─────────┘           │
│                                                             │
│ 💡 提示：鼠标悬停在 #Pins, T_STG 等列上查看完整参数名      │
└─────────────────────────────────────────────────────────────┘
```

### 🚀 技术亮点

1. **类型安全**: 完整的TypeScript类型定义
2. **代码复用**: 8个通用工具函数，可在多页面复用
3. **性能优化**: 动态列宽、虚拟滚动支持
4. **安全性**: DOMPurify防XSS攻击
5. **可维护性**: JSDoc注释 + 详细文档
6. **用户体验**: Tooltip、省略、排序、筛选

### 📈 项目影响

- **开发效率提升**: 工具函数库减少50%重复代码
- **用户体验提升**: 智能表头 + 分类筛选，降低学习成本
- **维护成本降低**: 完整文档 + 类型定义，便于后期维护
- **可扩展性强**: 支持任意数量的动态参数，支持多级分类

---

## 联系方式

如有问题或建议，请联系开发团队。

**最后更新**: 2025-11-01  
**版本**: v2.4  
**整体进度**: 80% ✅


### 2025-11-11 (v2.4.1) 🛠️
- ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
  - `GET /api/doeeet/components/:id`（组件详情弹窗）
  - `GET /api/doeeet/categories/tree`（分类筛选器）
- ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
- ✅ Linter 检查通过（无新增告警）
- 影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
  - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`

#### 接下来建议
- P0：抽象统一的前端请求层（含超时、错误映射、重试/熔断开关），替换页面内分散实现
- P1：为 `POST /api/doeeet/components/compare` 套同样的超时/错误策略
- P1：后端 Faceting 与缓存（按既定里程碑 B），完善筛选器可用项和计数

```

- 已把本次组件对比体验优化（过滤 `Unknown` 参数、参数名兜底渲染）记录到 `DoEEEt功能开发总览.md` 的 2025‑11‑12 更新章节。
- 同样在 `DoEEEt集成实施总结.md` 的更新日志中新增 2025‑11‑12 条目，说明影响范围与代码位置。

后续可考虑将同样的参数过滤策略复用到详情页，保持体验一致。

---

**User**

把目前的版本git保存下，告诉我步骤，我自己操作

---

**Cursor**

### 保存当前版本到 Git 的步骤

1. 打开项目根目录（当前是 `F:\Business_plat`）的终端/Powershell。
2. 查看当前未提交的改动，确认没有遗漏：  
   `git status`
3. 将全部需要的改动加入暂存区：  
   `git add .`  
   > 若只想提交部分文件，可把 `.` 换成具体路径。
4. （可选）再次确认：  
   `git status`  
   > 确认需要提交的文件都在 `staged` 区。
5. 提交并写上说明信息：  
   `git commit -m "chore: update docs with latest compare optimizations"`  
   > 根据实际内容调整 commit message，建议英文或团队约定格式。
6. 如果需要推送到远程仓库：  
   `git push`  
   > 首次推送或新分支可能需要 `git push -u origin <branch>`。

提交后建议记录一下当前 commit id，方便未来回滚或查验。

---

**User**

不是首次推送了，我把进度发给你，你告诉我继续的步骤
(space_env) F:\Business_plat\backend>git status
On branch full_dev_data_store
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   .env
        modified:   config/mongodb.js
        modified:   data/persistent-data.json
        modified:   dist/.tsbuildinfo
        modified:   dist/index.js
        modified:   dist/index.js.map
        modified:   dist/models/index.js
        modified:   dist/models/index.js.map
        modified:   dist/services/AnalyticsService.js
        modified:   dist/services/AnalyticsService.js.map
        modified:   env.example
        modified:   logs/combined.log
        modified:   logs/error.log
        deleted:    node_modules/@aws/lambda-invoke-store/LICENSE
        deleted:    node_modules/@aws/lambda-invoke-store/dist/invoke-store.d.ts
        deleted:    node_modules/@aws/lambda-invoke-store/dist/invoke-store.js
        deleted:    node_modules/@aws/lambda-invoke-store/package.json
        deleted:    node_modules/@smithy/uuid/LICENSE
        deleted:    node_modules/@smithy/uuid/dist-cjs/index.js
        deleted:    node_modules/@smithy/uuid/dist-cjs/randomUUID.js
        deleted:    node_modules/@smithy/uuid/dist-cjs/randomUUID.native.js
        deleted:    node_modules/@smithy/uuid/dist-es/index.js
        deleted:    node_modules/@smithy/uuid/dist-es/randomUUID.browser.js
        deleted:    node_modules/@smithy/uuid/dist-es/randomUUID.js
        deleted:    node_modules/@smithy/uuid/dist-es/randomUUID.native.js
        deleted:    node_modules/@smithy/uuid/dist-es/v4.js
        deleted:    node_modules/@smithy/uuid/dist-types/index.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/randomUUID.browser.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/randomUUID.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/randomUUID.native.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/ts3.4/index.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/ts3.4/randomUUID.browser.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/ts3.4/randomUUID.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/ts3.4/randomUUID.native.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/ts3.4/v4.d.ts
        deleted:    node_modules/@smithy/uuid/dist-types/v4.d.ts
        deleted:    node_modules/@smithy/uuid/package.json
        deleted:    node_modules/axios/LICENSE
        deleted:    node_modules/axios/dist/axios.js
        deleted:    node_modules/axios/dist/axios.js.map
        deleted:    node_modules/axios/dist/axios.min.js
        deleted:    node_modules/axios/dist/axios.min.js.map
        deleted:    node_modules/axios/dist/browser/axios.cjs
        deleted:    node_modules/axios/dist/browser/axios.cjs.map
        deleted:    node_modules/axios/dist/esm/axios.js
        deleted:    node_modules/axios/dist/esm/axios.js.map
        deleted:    node_modules/axios/dist/esm/axios.min.js
        deleted:    node_modules/axios/dist/esm/axios.min.js.map
        deleted:    node_modules/axios/dist/node/axios.cjs
        deleted:    node_modules/axios/dist/node/axios.cjs.map
        deleted:    node_modules/axios/index.d.cts
        deleted:    node_modules/axios/index.d.ts
        deleted:    node_modules/axios/index.js
        deleted:    node_modules/axios/lib/adapters/adapters.js
        deleted:    node_modules/axios/lib/adapters/fetch.js
        deleted:    node_modules/axios/lib/adapters/http.js
        deleted:    node_modules/axios/lib/adapters/xhr.js
        deleted:    node_modules/axios/lib/axios.js
        deleted:    node_modules/axios/lib/cancel/CancelToken.js
        deleted:    node_modules/axios/lib/cancel/CanceledError.js
        deleted:    node_modules/axios/lib/cancel/isCancel.js
        deleted:    node_modules/axios/lib/core/Axios.js
        deleted:    node_modules/axios/lib/core/AxiosError.js
        deleted:    node_modules/axios/lib/core/AxiosHeaders.js
        deleted:    node_modules/axios/lib/core/InterceptorManager.js
        deleted:    node_modules/axios/lib/core/buildFullPath.js
        deleted:    node_modules/axios/lib/core/dispatchRequest.js
        deleted:    node_modules/axios/lib/core/mergeConfig.js
        deleted:    node_modules/axios/lib/core/settle.js
        deleted:    node_modules/axios/lib/core/transformData.js
        deleted:    node_modules/axios/lib/defaults/index.js
        deleted:    node_modules/axios/lib/defaults/transitional.js
        deleted:    node_modules/axios/lib/env/classes/FormData.js
        deleted:    node_modules/axios/lib/env/data.js
        deleted:    node_modules/axios/lib/helpers/AxiosTransformStream.js
        deleted:    node_modules/axios/lib/helpers/AxiosURLSearchParams.js
        deleted:    node_modules/axios/lib/helpers/HttpStatusCode.js
        deleted:    node_modules/axios/lib/helpers/ZlibHeaderTransformStream.js
        deleted:    node_modules/axios/lib/helpers/bind.js
        deleted:    node_modules/axios/lib/helpers/buildURL.js
        deleted:    node_modules/axios/lib/helpers/callbackify.js
        deleted:    node_modules/axios/lib/helpers/combineURLs.js
        deleted:    node_modules/axios/lib/helpers/composeSignals.js
        deleted:    node_modules/axios/lib/helpers/cookies.js
        deleted:    node_modules/axios/lib/helpers/deprecatedMethod.js
        deleted:    node_modules/axios/lib/helpers/estimateDataURLDecodedBytes.js
        deleted:    node_modules/axios/lib/helpers/formDataToJSON.js
        deleted:    node_modules/axios/lib/helpers/formDataToStream.js
        deleted:    node_modules/axios/lib/helpers/fromDataURI.js
        deleted:    node_modules/axios/lib/helpers/isAbsoluteURL.js
        deleted:    node_modules/axios/lib/helpers/isAxiosError.js
        deleted:    node_modules/axios/lib/helpers/isURLSameOrigin.js
        deleted:    node_modules/axios/lib/helpers/null.js
        deleted:    node_modules/axios/lib/helpers/parseHeaders.js
        deleted:    node_modules/axios/lib/helpers/parseProtocol.js
        deleted:    node_modules/axios/lib/helpers/progressEventReducer.js
        deleted:    node_modules/axios/lib/helpers/readBlob.js
        deleted:    node_modules/axios/lib/helpers/resolveConfig.js
        deleted:    node_modules/axios/lib/helpers/speedometer.js
        deleted:    node_modules/axios/lib/helpers/spread.js
        deleted:    node_modules/axios/lib/helpers/throttle.js
        deleted:    node_modules/axios/lib/helpers/toFormData.js
        deleted:    node_modules/axios/lib/helpers/toURLEncodedForm.js
        deleted:    node_modules/axios/lib/helpers/trackStream.js
        deleted:    node_modules/axios/lib/helpers/validator.js
        deleted:    node_modules/axios/lib/platform/browser/classes/Blob.js
        deleted:    node_modules/axios/lib/platform/browser/classes/FormData.js
        deleted:    node_modules/axios/lib/platform/browser/classes/URLSearchParams.js
        deleted:    node_modules/axios/lib/platform/browser/index.js
        deleted:    node_modules/axios/lib/platform/common/utils.js
        deleted:    node_modules/axios/lib/platform/index.js
        deleted:    node_modules/axios/lib/platform/node/classes/FormData.js
        deleted:    node_modules/axios/lib/platform/node/classes/URLSearchParams.js
        deleted:    node_modules/axios/lib/platform/node/index.js
        deleted:    node_modules/axios/lib/utils.js
        deleted:    node_modules/axios/node_modules/form-data/License
        deleted:    node_modules/axios/node_modules/form-data/index.d.ts
        deleted:    node_modules/axios/node_modules/form-data/lib/browser.js
        deleted:    node_modules/axios/node_modules/form-data/lib/form_data.js
        deleted:    node_modules/axios/node_modules/form-data/lib/populate.js
        deleted:    node_modules/axios/node_modules/form-data/package.json
        deleted:    node_modules/axios/package.json
        modified:   node_modules/csv-parser/package.json
        deleted:    node_modules/follow-redirects/LICENSE
        deleted:    node_modules/follow-redirects/debug.js
        deleted:    node_modules/follow-redirects/http.js
        deleted:    node_modules/follow-redirects/https.js
        deleted:    node_modules/follow-redirects/index.js
        deleted:    node_modules/follow-redirects/package.json
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/LICENSE
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/dist/URL-impl.d.ts
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/dist/URL.d.ts
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/dist/URLSearchParams-impl.d.ts
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/dist/URLSearchParams.d.ts
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/index.d.ts
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/package.json
        deleted:    node_modules/mongoose/node_modules/@types/whatwg-url/webidl2js-wrapper.d.ts
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/.esm-wrapper.mjs
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/LICENSE
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/index.d.ts
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/index.js
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/index.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/redact.d.ts
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/redact.js
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/lib/redact.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb-connection-string-url/package.json
        deleted:    node_modules/mongoose/node_modules/mongodb/etc/prepare.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/admin.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/admin.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bson.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bson.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/common.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/common.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/ordered.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/ordered.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/unordered.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/bulk/unordered.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/change_stream.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/change_stream.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/auth_provider.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/auth_provider.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/gssapi.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/gssapi.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongo_credentials.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongocr.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongocr.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/mongodb_aws.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/plain.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/plain.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/providers.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/providers.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/scram.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/scram.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/x509.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/auth/x509.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/command_monitoring_events.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/command_monitoring_events.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/commands.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/commands.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connect.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connect.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection_pool.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection_pool.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection_pool_events.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/connection_pool_events.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/errors.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/errors.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/handshake/client_metadata.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/handshake/client_metadata.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/message_stream.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/message_stream.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/metrics.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/metrics.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/stream_description.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/stream_description.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/compression.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/compression.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/constants.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/constants.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/shared.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cmap/wire_protocol/shared.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/collection.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/collection.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/connection_string.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/connection_string.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/constants.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/constants.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/abstract_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/abstract_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/aggregation_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/aggregation_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/change_stream_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/change_stream_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/find_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/find_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/list_collections_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/list_collections_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/list_indexes_cursor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/cursor/list_indexes_cursor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/db.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/db.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/deps.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/deps.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/encrypter.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/encrypter.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/error.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/error.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/explain.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/explain.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/download.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/download.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/index.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/index.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/upload.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/gridfs/upload.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/index.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/index.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/logger.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/logger.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_client.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_client.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_logger.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_logger.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_types.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/mongo_types.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/add_user.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/add_user.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/aggregate.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/aggregate.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/bulk_write.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/bulk_write.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/collections.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/collections.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/command.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/command.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/common_functions.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/common_functions.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/count.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/count.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/count_documents.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/count_documents.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/create_collection.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/create_collection.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/delete.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/delete.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/distinct.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/distinct.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/drop.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/drop.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/estimated_document_count.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/estimated_document_count.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/eval.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/eval.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/execute_operation.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/execute_operation.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/find.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/find.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/find_and_modify.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/find_and_modify.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/get_more.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/get_more.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/indexes.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/indexes.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/insert.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/insert.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/is_capped.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/is_capped.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/kill_cursors.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/kill_cursors.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/list_collections.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/list_collections.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/list_databases.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/list_databases.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/map_reduce.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/map_reduce.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/operation.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/operation.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/options_operation.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/options_operation.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/profiling_level.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/profiling_level.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/remove_user.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/remove_user.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/rename.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/rename.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/run_command.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/run_command.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/set_profiling_level.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/set_profiling_level.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/stats.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/stats.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/update.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/update.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/validate_collection.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/operations/validate_collection.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/promise_provider.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/promise_provider.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/read_concern.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/read_concern.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/read_preference.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/read_preference.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/common.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/common.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/events.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/events.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/monitor.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/monitor.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server_description.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server_description.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server_selection.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/server_selection.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/srv_polling.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/srv_polling.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/topology.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/topology.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/topology_description.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sdam/topology_description.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sessions.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sessions.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sort.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/sort.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/transactions.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/transactions.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/utils.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/utils.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/write_concern.js
        deleted:    node_modules/mongoose/node_modules/mongodb/lib/write_concern.js.map
        deleted:    node_modules/mongoose/node_modules/mongodb/mongodb.d.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/package.json
        deleted:    node_modules/mongoose/node_modules/mongodb/src/admin.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/bson.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/bulk/common.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/bulk/ordered.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/bulk/unordered.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/change_stream.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/auth_provider.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/gssapi.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/mongo_credentials.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/mongocr.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/mongodb_aws.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/plain.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/providers.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/scram.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/auth/x509.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/command_monitoring_events.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/commands.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/connect.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/connection.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/connection_pool.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/connection_pool_events.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/errors.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/handshake/client_metadata.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/message_stream.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/metrics.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/stream_description.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/wire_protocol/compression.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/wire_protocol/constants.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cmap/wire_protocol/shared.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/collection.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/connection_string.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/constants.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/abstract_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/aggregation_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/change_stream_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/find_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/list_collections_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/cursor/list_indexes_cursor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/db.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/deps.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/encrypter.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/error.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/explain.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/gridfs/download.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/gridfs/index.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/gridfs/upload.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/index.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/logger.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/mongo_client.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/mongo_logger.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/mongo_types.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/add_user.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/aggregate.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/bulk_write.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/collections.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/command.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/common_functions.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/count.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/count_documents.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/create_collection.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/delete.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/distinct.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/drop.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/estimated_document_count.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/eval.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/execute_operation.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/find.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/find_and_modify.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/get_more.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/indexes.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/insert.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/is_capped.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/kill_cursors.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/list_collections.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/list_databases.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/map_reduce.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/operation.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/options_operation.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/profiling_level.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/remove_user.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/rename.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/run_command.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/set_profiling_level.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/stats.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/update.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/operations/validate_collection.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/promise_provider.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/read_concern.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/read_preference.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/common.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/events.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/monitor.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/server.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/server_description.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/server_selection.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/srv_polling.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/topology.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sdam/topology_description.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sessions.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/sort.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/transactions.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/utils.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/src/write_concern.ts
        deleted:    node_modules/mongoose/node_modules/mongodb/tsconfig.json
        deleted:    node_modules/mongoose/node_modules/tr46/index.js
        deleted:    node_modules/mongoose/node_modules/tr46/lib/mappingTable.json
        deleted:    node_modules/mongoose/node_modules/tr46/lib/regexes.js
        deleted:    node_modules/mongoose/node_modules/tr46/lib/statusMapping.js
        deleted:    node_modules/mongoose/node_modules/tr46/package.json
        deleted:    node_modules/mongoose/node_modules/whatwg-url/LICENSE.txt
        deleted:    node_modules/mongoose/node_modules/whatwg-url/index.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/Function.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/URL-impl.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/URL.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/URLSearchParams-impl.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/URLSearchParams.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/VoidFunction.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/encoding.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/infra.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/percent-encoding.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/url-state-machine.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/urlencoded.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/lib/utils.js
        deleted:    node_modules/mongoose/node_modules/whatwg-url/package.json
        deleted:    node_modules/mongoose/node_modules/whatwg-url/webidl2js-wrapper.js
        deleted:    node_modules/proxy-from-env/.eslintrc
        deleted:    node_modules/proxy-from-env/.travis.yml
        deleted:    node_modules/proxy-from-env/LICENSE
        deleted:    node_modules/proxy-from-env/index.js
        deleted:    node_modules/proxy-from-env/package.json
        deleted:    node_modules/proxy-from-env/test.js
        modified:   package-lock.json
        modified:   src/controllers/doeeetComponentController.ts
        modified:   src/services/DoeeetSearchService.ts
        modified:   ../data/dist_example(2)/dist_example/meta.json
        deleted:    ../data/doeeet/README_DOEEET_IMPORT.md
        deleted:    ../data/doeeet/analyze_csv.py
        deleted:    ../data/doeeet/config.py
        deleted:    ../data/doeeet/doeeet/general.csv
        deleted:    ../data/doeeet/doeeet/meta.json
        deleted:    ../data/doeeet/doeeet/parameter.csv
        deleted:    ../data/doeeet/doeeet/parameter_final.csv
        deleted:    "../data/doeeet/doeeet/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        deleted:    ../data/doeeet/import_doeeet_data.py
        deleted:    ../data/doeeet/quick_start.py
        deleted:    ../data/doeeet/test_import.py
        modified:   ../frontend/src/components/CategoryFilter.tsx
        modified:   ../frontend/src/components/ComponentCompareModal.tsx
        modified:   ../frontend/src/pages/components/ComponentSearch.tsx

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        ../DoEEEt-README.md
        "../DoEEEt\345\212\237\350\203\275\345\274\200\345\217\221\346\200\273\350\247\210.md"
        "../DoEEEt\351\233\206\346\210\220\345\256\236\346\226\275\346\200\273\347\273\223.md"
        "../DoEEEt\351\241\271\347\233\256\345\274\200\345\217\221\350\256\241\345\210\222.md"
        API_QUICK_REFERENCE.md
        CACHE_USAGE.md
        COMPASS_VIEW_DATA_GUIDE.md
        DATABASE_LOCATION.md
        DOCKER_REDIS_SETUP.md
        DOEEET_API_TESTING.md
        DoEEEt_API.postman_collection.json
        INSTALL_MONGODB_TOOLS.md
        INSTALL_REDIS_WINDOWS.md
        MIGRATION_GUIDE.md
        QUICK_START_TESTING.md
        README_MONGODB_LOCAL.md
        REDIS_CACHE_DESIGN.md
        REDIS_CHECKLIST.md
        REDIS_ENV_SETUP.md
        REDIS_IMPLEMENTATION_GUIDE.md
        REDIS_IMPLEMENTATION_SUMMARY.md
        REDIS_QUICKSTART.md
        REDIS_README.md
        REDIS_SETUP.md
        REDIS_WINDOWS_SETUP.md
        check-data-structure.js
        check_collection.js
        check_family_path_format.js
        dist/config/redis.js
        dist/config/redis.js.map
        dist/controllers/componentNewController.js
        dist/controllers/componentNewController.js.map
        dist/controllers/doeeetComponentController.js
        dist/controllers/doeeetComponentController.js.map
        dist/middleware/auth.js
        dist/middleware/auth.js.map
        dist/middleware/validation.js
        dist/middleware/validation.js.map
        dist/models/DoeeetComponent.js
        dist/models/DoeeetComponent.js.map
        dist/models/User.js
        dist/models/User.js.map
        dist/routes/components.js
        dist/routes/components.js.map
        dist/routes/doeeetComponentRoutes.js
        dist/routes/doeeetComponentRoutes.js.map
        dist/routes/doeeetRoutes.js
        dist/routes/doeeetRoutes.js.map
        dist/routes/userRoutes.js
        dist/routes/userRoutes.js.map
        dist/scripts/
        dist/services/CacheService.js
        dist/services/CacheService.js.map
        dist/services/CacheWarmupService.js
        dist/services/CacheWarmupService.js.map
        dist/services/DoeeetSearchService.js
        dist/services/DoeeetSearchService.js.map
        dist/utils/response.js
        dist/utils/response.js.map
        mongod.conf
        mongod_fast.conf
        mongod_minimal.conf
        mongod_ultralight.conf
        query
        quick-test-doeet.js
        start-mongodb-local.bat
        start-mongodb-local.ps1
        start-redis.bat
        test-connection.js
        test-doeeet-search.js
        test_api_requests.js
        test_category_api.js
        test_doeeet_api.ps1
        test_doeeet_api.sh
        test_query_issue.js
        "../cursor\350\256\260\345\275\225/1109.md"
        "../cursor\350\256\260\345\275\225/cursor_cursor_10292_md.md"
        "../cursor\350\256\260\345\275\225/cursor_cursor_1029_md.md"
        "../data/dist_example(2)/dist_example/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        ../docker-compose-simple.yml
        ../docker-compose.yml
        ../frontend/src/utils/httpClient.ts
        ../package-lock.json
        ../records/
        "../\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211-\345\277\253\351\200\237\345\274\200\345\247\213.md"
        "../\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211\345\212\237\350\203\275\345\256\236\346\226\275\346\226\271\346\241\210.md"
        "../\345\211\215\347\253\257\345\256\236\346\226\275\346\226\271\346\241\210\346\200\273\347\273\223.md"

no changes added to commit (use "git add" and/or "git commit -a")

(space_env) F:\Business_plat\backend>

---

**Cursor**

当前工作区里夹杂了很多不想提交的改动（`.env`、`dist/`、`logs/`、`node_modules/` 里的批量删除等），以及我们这次想提交的文档更新。建议先把不需要的改动恢复干净，再只把要提交的文档加入暂存区。步骤如下：

---

**1. 清理后端目录的临时改动**  
在 `F:\Business_plat\backend` 里执行（如果这些确实都是临时代码/构建产物或误删，确认无须保留后再执行）：

```powershell
# 还原配置、构建产物等
git restore --worktree .env config/mongodb.js data/persistent-data.json logs dist src
# 如果 node_modules 下的文件不应被版本控制，优先在 .gitignore 里排除；
# 若这些删除是误操作，需要恢复：
git restore --worktree node_modules
```

如果某些目录/文件需要保留改动，跳过对应的 `git restore`，改为后续手动筛选。

---

**2. 回到仓库根目录**  
```powershell
cd ..
git status
```
确认你想提交的文档（例如 `DoEEEt功能开发总览.md`、`DoEEEt集成实施总结.md` 等）显示在根目录的状态里。

---

**3. 挑选要提交的文件**  
只添加需要的文档（根据实际文件调整）：

```powershell
git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md
```

如果还要连同其它新文档一起提交，逐个 `git add`。

---

**4. 检查暂存区**  
```powershell
git status
```
确认暂存区里只包含本次需要的文件。

---

**5. 提交并推送**  
```powershell
git commit -m "chore: update doeeet docs with compare optimizations"
git push
```

---

若在第 1 步发现确实有后端代码需要保留，可先 `git stash push` 临时保存，再在提交文档后 `git stash pop`，或拆分成多个提交。执行前若有不确定的文件，请先提醒我或再三确认。

```powershell
# 还原配置、构建产物等
git restore --worktree .env config/mongodb.js data/persistent-data.json logs dist src
# 如果 node_modules 下的文件不应被版本控制，优先在 .gitignore 里排除；
# 若这些删除是误操作，需要恢复：
git restore --worktree node_modules
```

```powershell
cd ..
git status
```

```powershell
git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md
```

```powershell
git status
```

```powershell
git commit -m "chore: update doeeet docs with compare optimizations"
git push
```

---

**User**

(space_env) F:\Business_plat\backend>git add .
warning: in the working copy of 'backend/data/persistent-data.json', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'backend/node_modules/csv-parser/package.json', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'backend/test_doeeet_api.sh', LF will be replaced by CRLF the next time Git touches it

(space_env) F:\Business_plat\backend>

---

**Cursor**

看起来你用 `git add .` 把 `backend` 目录下所有改动都暂存了（包括之前不想提交的内容）。建议下一步先回到项目根目录，检查当前暂存内容并只保留需要的文档变更。

1. 返回仓库根目录：  
   `cd ..`

2. 查看暂存状态：  
   `git status`

3. 如果只想提交文档，而现在暂存区里有其他文件，可以先全部取消暂存，再按需添加：  
   `git reset`  
   然后逐个 `git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md …`

那几个 “LF→CRLF” 的提示只是换行符差异警告，可以忽略，但更要紧的是先筛掉不需要的文件。

---

**User**

这里的TOP显示的值应该是Operating Temperature Range对应的值，目前TOP显示的是-字符，请优化

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter(id => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
                <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
                    <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
                    <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
                    <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                      {selectedComponent.qualityLevel}
                    </Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
                </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
                      {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
                      ))}
                    </Space>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                      </div>
                    </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
                    <Table
                      size="small"
                      columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                        { title: '库存', dataIndex: 'stock', key: 'stock' },
                        { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                      ]}
                      dataSource={selectedComponent.suppliers}
                      pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

### TOP 列逻辑优化完成
- 在 `ComponentSearch` 的数据适配过程中增加规范化工具，支持根据多种命名（`top`、`Operating Temperature Range` 等）匹配温度范围值，并在找不到时继续回退到静态字段，避免再出现 `-` 占位。
  
```459:596:frontend/src/pages/components/ComponentSearch.tsx
const topValue =
  findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
  findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
  normalizeValue(comp.top_marking) ??
  normalizeValue(comp.top) ??
  '';
```

### 建议验证
- 重新编译/启动前端后，在组件搜索页刷新结果，确认 `TOP` 列展示为实际的工作温度范围。
- 如需提交，只挑选相关文档和前端改动执行 `git add`，避免把 `backend` 里的大量无关文件一起提交。

```typescriptreact
const topValue =
  findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
  findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
  normalizeValue(comp.top_marking) ??
  normalizeValue(comp.top) ??
  '';
```

---

**User**

如何重新编译

---

**Cursor**

- 前端（Vite 项目）
  1. `cd frontend`
  2. 若依赖有变化：`npm install`
  3. 编译产物：`npm run build`
  4. 本地预览（可选）：`npm run preview`

- 后端（TypeScript ⇒ dist）
  1. `cd backend`
  2. `npm install`
  3. `npm run build`（或项目里约定的脚本，如 `npm run compile`）

- 若需要一次性编译前后端，可在仓库根目录加一个统一脚本（例如 `npm run build:all`），里面顺序执行上述命令。

---

**User**


(space_env) F:\Business_plat\frontend>npm run build

> business-platform-frontend@0.0.0 build F:\Business_plat\frontend
> tsc && vite build

src/App.tsx:2:50 - error TS6133: 'Navigate' is declared but its value is never read.

2 import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
                                                   ~~~~~~~~

src/App.tsx:72:1 - error TS6133: 'RadiationAssessment' is declared but its value is never read.

72 import RadiationAssessment from '@/pages/engineering/RadiationAssessment';
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

src/components/ComponentCompareModal.tsx:3:24 - error TS6133: 'CloseOutlined' is declared but its value is never read.

3 import { SwapOutlined, CloseOutlined } from '@ant-design/icons';
                         ~~~~~~~~~~~~~

src/components/Layout.tsx:224:15 - error TS2339: Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; } | { key: string; icon: Element; label: string; children: { key: string; label: string; }[]; }'.
  Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; }'.

224     if (!item.roles) return true;
                  ~~~~~

src/components/Layout.tsx:225:17 - error TS2339: Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; } | { key: string; icon: Element; label: string; children: { key: string; label: string; }[]; }'.
  Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; }'.

225     return item.roles.includes(user?.role || '');
                    ~~~~~

src/examples/DynamicParameterTableExample.tsx:197:19 - error TS6133: 'setLoading' is declared but its value is never read.

197   const [loading, setLoading] = useState(false);
                      ~~~~~~~~~~

src/pages/application/CounterfeitDetection.tsx:27:3 - error TS6133: 'UploadOutlined' is declared but its value is never read.

27   UploadOutlined,
     ~~~~~~~~~~~~~~

src/pages/application/CounterfeitDetection.tsx:675:27 - error TS2322: Type '{ children: Element[]; size: string; }' is not assignable to type 'IntrinsicAttributes & TimelineProps'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TimelineProps'.

675                 <Timeline size="small">
                              ~~~~

src/pages/application/CounterfeitDetection.tsx:686:27 - error TS2322: Type '{ children: Element[]; size: string; }' is not assignable to type 'IntrinsicAttributes & TimelineProps'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TimelineProps'.

686                 <Timeline size="small">
                              ~~~~

src/pages/application/FunctionalUnits.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/application/QPLManagement.tsx:16:3 - error TS6133: 'Upload' is declared but its value is never read.

16   Upload,
     ~~~~~~

src/pages/application/QPLManagement.tsx:17:3 - error TS6133: 'Progress' is declared but its value is never read.

17   Progress,
     ~~~~~~~~

src/pages/components/AnalogICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/AnalogICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/AnalogICSearch.tsx:294:10 - error TS6133: 'data' is declared but its value is never read.

294   const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
             ~~~~

src/pages/components/AnalogICSearch.tsx:294:16 - error TS6133: 'setData' is declared but its value is never read.

294   const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
                   ~~~~~~~

src/pages/components/ComponentCompare.tsx:16:3 - error TS6133: 'Spin' is declared but its value is never read.

16   Spin,
     ~~~~

src/pages/components/ComponentCompare.tsx:24:3 - error TS6133: 'PlusOutlined' is declared but its value is never read.

24   PlusOutlined,
     ~~~~~~~~~~~~

src/pages/components/ComponentCompare.tsx:35:7 - error TS6133: 'Option' is declared but its value is never read.

35 const { Option } = Select;
         ~~~~~~~~~~

src/pages/components/ComponentCompare.tsx:426:22 - error TS2339: Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; }'.

426         isGroup: row.isGroup
                         ~~~~~~~

src/pages/components/ComponentCompare.tsx:429:15 - error TS2339: Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; }'.

429       if (row.isGroup) {
                  ~~~~~~~

src/pages/components/ComponentCompare.tsx:451:24 - error TS2339: Property 'unit' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'unit' does not exist on type '{ key: string; parameter: string; isGroup: boolean; }'.

451         } else if (row.unit) {
                           ~~~~

src/pages/components/ComponentCompare.tsx:452:94 - error TS2339: Property 'unit' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'unit' does not exist on type '{ key: string; parameter: string; isGroup: boolean; }'.

452           value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
                                                                                                 ~~~~

src/pages/components/ComponentCompare.tsx:536:82 - error TS2322: Type '{ children: string; color: "blue" | "green" | "red" | "gold" | "default"; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

536                             <Tag color={getQualityColor(component.qualityLevel)} size="small">
                                                                                     ~~~~

src/pages/components/ComponentCompare.tsx:615:21 - error TS2322: Type '{ '.group-row': { background: string; fontWeight: number; }; }' is not assignable to type 'Properties<string | number, string & {}>'.
  Object literal may only specify known properties, and ''.group-row'' does not exist in type 'Properties<string | number, string & {}>'.

615                     '.group-row': {
                        ~~~~~~~~~~~~~~~
616                       background: '#fafafa',
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
617                       fontWeight: 600
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
618                     }
    ~~~~~~~~~~~~~~~~~~~~~

  node_modules/rc-table/lib/Table.d.ts:37:5
    37     style?: React.CSSProperties;
           ~~~~~
    The expected type comes from property 'style' which is declared here on type 'IntrinsicAttributes & TableProps<any> & { children?: ReactNode; } & RefAttributes<Reference>'

src/pages/components/ComponentSearch.tsx:858:28 - error TS2345: Argument of type '(string | undefined)[]' is not assignable to parameter of type 'SetStateAction<string[]>'.
  Type '(string | undefined)[]' is not assignable to type 'string[]'.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

858     setCompareComponentIds(selectedIds);
                               ~~~~~~~~~~~

src/pages/components/DigitalICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/DigitalICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/DigitalICSearch.tsx:273:10 - error TS6133: 'data' is declared but its value is never read.

273   const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
             ~~~~

src/pages/components/DigitalICSearch.tsx:273:16 - error TS6133: 'setData' is declared but its value is never read.

273   const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
                   ~~~~~~~

src/pages/components/DiscreteSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/DiscreteSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/DiscreteSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
             ~~~~

src/pages/components/DiscreteSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
                   ~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
             ~~~~

src/pages/components/ElectromechanicalSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
                   ~~~~~~~

src/pages/components/GeneralSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/GeneralSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/GeneralSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
             ~~~~

src/pages/components/GeneralSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
                   ~~~~~~~

src/pages/components/HybridICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/HybridICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/HybridICSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
             ~~~~

src/pages/components/HybridICSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
                   ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
             ~~~~

src/pages/components/MicrosystemsSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
                   ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrowaveSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
             ~~~~

src/pages/components/MicrowaveSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
                   ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
             ~~~~

src/pages/components/OptoelectronicSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
                   ~~~~~~~

src/pages/components/PowerSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/PowerSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/PowerSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
             ~~~~

src/pages/components/PowerSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
                   ~~~~~~~

src/pages/components/VacuumSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/VacuumSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/VacuumSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
             ~~~~

src/pages/components/VacuumSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
                   ~~~~~~~

src/pages/ContractList.tsx:55:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

55         setContracts(response.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:58:32 - error TS2339: Property 'total' does not exist on type 'Contract[]'.

58           total: response.data.total,
                                  ~~~~~

src/pages/ContractList.tsx:59:34 - error TS2339: Property 'page' does not exist on type 'Contract[]'.

59           current: response.data.page,
                                    ~~~~

src/pages/ContractList.tsx:78:36 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

78         setTenants(tenantsRes.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:81:36 - error TS2339: Property 'items' does not exist on type 'Office[]'.

81         setOffices(officesRes.data.items);
                                      ~~~~~

src/pages/documents/PolicyRegulation.tsx:25:3 - error TS6133: 'SearchOutlined' is declared but its value is never read.

25   SearchOutlined,
     ~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:27:3 - error TS6133: 'CalendarOutlined' is declared but its value is never read.

27   CalendarOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:141:20 - error TS6133: 'setPolicies' is declared but its value is never read.

141   const [policies, setPolicies] = useState<PolicyRegulation[]>(mockPolicyData);
                       ~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:552:21 - error TS2322: Type 'Dispatch<SetStateAction<[Dayjs, Dayjs] | null>>' is not assignable to type '(dates: NoUndefinedRangeValueType<Dayjs> | null, dateStrings: [string, string]) => void'.
  Types of parameters 'value' and 'dates' are incompatible.
    Type 'NoUndefinedRangeValueType<Dayjs> | null' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
      Type 'NoUndefinedRangeValueType<Dayjs>' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
        Type '[start: Dayjs | null, end: Dayjs | null]' is not assignable to type '[Dayjs, Dayjs]'.
          Type at position 0 in source is not compatible with type at position 0 in target.
            Type 'Dayjs | null' is not assignable to type 'Dayjs'.
              Type 'null' is not assignable to type 'Dayjs'.

552                     onChange={setDateRange}
                        ~~~~~~~~

  node_modules/rc-picker/lib/PickerInput/RangePicker.d.ts:15:5
    15     onChange?: (dates: NoUndefinedRangeValueType<DateType> | null, dateStrings: [string, string]) => void;
           ~~~~~~~~
    The expected type comes from property 'onChange' which is declared here on type 'IntrinsicAttributes & Omit<RangePickerProps<Dayjs>, "classNames" | "styles" | "locale" | "generateConfig" | "hideHeader"> & { ...; } & RefAttributes<...>'

src/pages/documents/PolicyRegulation.tsx:599:78 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

599                               <Tag color={getCategoryColor(policy.category)} size="small">
                                                                                 ~~~~

src/pages/documents/PolicyRegulation.tsx:602:70 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

602                               <Tag color={getTypeColor(policy.type)} size="small">
                                                                         ~~~~

src/pages/documents/TechnicalDocuments.tsx:24:19 - error TS6133: 'setLoading' is declared but its value is never read.

24   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalDocuments.tsx:164:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

164       render: (_, record: TechnicalDocument) => (
                   ~

src/pages/documents/TechnicalNews.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalNews.tsx:191:9 - error TS6133: 'getImportanceColor' is declared but its value is never read.

191   const getImportanceColor = (importance: string) => {
            ~~~~~~~~~~~~~~~~~~

src/pages/documents/TechnicalTraining.tsx:32:19 - error TS6133: 'setLoading' is declared but its value is never read.

32   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TestData.tsx:35:19 - error TS6133: 'setLoading' is declared but its value is never read.

35   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/DesignSimulation.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:2:84 - error TS6133: 'Progress' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, InputNumber, Progress, Descriptions, Alert, Tabs, Row, Col, Statistic } from 'antd';
                                                                                     ~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:38:19 - error TS6133: 'setLoading' is declared but its value is never read.

38   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/SecurityCertification.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Sourcing.tsx:173:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

173       render: (_, record: SourcingProject) => (
                   ~

src/pages/engineering/Testing.tsx:22:19 - error TS6133: 'setLoading' is declared but its value is never read.

22   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Testing.tsx:75:16 - error TS6133: 'setData' is declared but its value is never read.

75   const [data, setData] = useState<TestingProject[]>(mockData);
                  ~~~~~~~

src/pages/engineering/Testing.tsx:150:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

150       render: (_, record: TestingProject) => (
                   ~

src/pages/FinancialList.tsx:60:34 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

60         setRecords(response.data.items);
                                    ~~~~~

src/pages/FinancialList.tsx:63:32 - error TS2339: Property 'total' does not exist on type 'FinancialRecord[]'.

63           total: response.data.total,
                                  ~~~~~

src/pages/FinancialList.tsx:64:34 - error TS2339: Property 'page' does not exist on type 'FinancialRecord[]'.

64           current: response.data.page,
                                    ~~~~

src/pages/FinancialList.tsx:68:43 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                             ~~~~~

src/pages/FinancialList.tsx:68:57 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                           ~~~

src/pages/FinancialList.tsx:68:62 - error TS7006: Parameter 'record' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                                ~~~~~~

src/pages/FinancialList.tsx:69:42 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

69         const paidAmount = response.data.items
                                            ~~~~~

src/pages/FinancialList.tsx:70:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

70           .filter(record => record.status === 'paid')
                     ~~~~~~

src/pages/FinancialList.tsx:71:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:71:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:72:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

72         const pendingAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:73:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

73           .filter(record => record.status === 'pending')
                     ~~~~~~

src/pages/FinancialList.tsx:74:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:74:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:75:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

75         const overdueAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:76:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

76           .filter(record => record.status === 'overdue')
                     ~~~~~~

src/pages/FinancialList.tsx:77:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:77:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:93:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

93         setContracts(response.data.items);
                                      ~~~~~

src/pages/HomePage.tsx:14:3 - error TS6133: 'Statistic' is declared but its value is never read.

14   Statistic,
     ~~~~~~~~~

src/pages/HomePage.tsx:15:3 - error TS6133: 'List' is declared but its value is never read.

15   List,
     ~~~~

src/pages/HomePage.tsx:16:3 - error TS6133: 'Avatar' is declared but its value is never read.

16   Avatar,
     ~~~~~~

src/pages/HomePage.tsx:18:3 - error TS6133: 'Tabs' is declared but its value is never read.

18   Tabs,
     ~~~~

src/pages/HomePage.tsx:33:3 - error TS6133: 'DatabaseOutlined' is declared but its value is never read.

33   DatabaseOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:36:3 - error TS6133: 'SettingOutlined' is declared but its value is never read.

36   SettingOutlined,
     ~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:37:3 - error TS6133: 'BugOutlined' is declared but its value is never read.

37   BugOutlined,
     ~~~~~~~~~~~

src/pages/HomePage.tsx:38:3 - error TS6133: 'AppstoreOutlined' is declared but its value is never read.

38   AppstoreOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:51:3 - error TS6133: 'BulbOutlined' is declared but its value is never read.

51   BulbOutlined,
     ~~~~~~~~~~~~

src/pages/HomePage.tsx:52:3 - error TS6133: 'BuildOutlined' is declared but its value is never read.

52   BuildOutlined,
     ~~~~~~~~~~~~~

src/pages/HomePage.tsx:57:7 - error TS6133: 'Option' is declared but its value is never read.

57 const { Option } = Select;
         ~~~~~~~~~~

src/pages/HomePage.tsx:199:7 - error TS6133: 'serviceModules' is declared but its value is never read.

199 const serviceModules = [
          ~~~~~~~~~~~~~~

src/pages/HomePage.tsx:273:7 - error TS6133: 'latestNews' is declared but its value is never read.

273 const latestNews = [
          ~~~~~~~~~~

src/pages/HomePage.tsx:304:10 - error TS6133: 'statsLoading' is declared but its value is never read.

304   const [statsLoading, setStatsLoading] = useState(true);
             ~~~~~~~~~~~~

src/pages/OfficeList.tsx:50:34 - error TS2339: Property 'items' does not exist on type 'Office[]'.

50         setOffices(response.data.items);
                                    ~~~~~

src/pages/OfficeList.tsx:53:32 - error TS2339: Property 'total' does not exist on type 'Office[]'.

53           total: response.data.total,
                                  ~~~~~

src/pages/OfficeList.tsx:54:34 - error TS2339: Property 'page' does not exist on type 'Office[]'.

54           current: response.data.page,
                                    ~~~~

src/pages/procurement/InventoryManagement.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/InventoryManagement.tsx:39:10 - error TS6133: 'selectedItem' is declared but its value is never read.

39   const [selectedItem, setSelectedItem] = useState<InventoryItem | null>(null);
            ~~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, DatePicker, Space, Tag, Modal, Form, InputNumber, message } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:25:19 - error TS6133: 'setLoading' is declared but its value is never read.

25   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:18:3 - error TS6133: 'Descriptions' is declared but its value is never read.

18   Descriptions,
     ~~~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:32:7 - error TS6133: 'RangePicker' is declared but its value is never read.

32 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:20:19 - error TS6133: 'setLoading' is declared but its value is never read.

20   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:67:16 - error TS6133: 'setData' is declared but its value is never read.

67   const [data, setData] = useState<QualityNotification[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityNotifications.tsx:156:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

156       render: (_, record: QualityNotification) => (
                   ~

src/pages/quality/QualityTraceability.tsx:11:3 - error TS6133: 'Form' is declared but its value is never read.

11   Form,
     ~~~~

src/pages/quality/QualityTraceability.tsx:593:42 - error TS2322: Type '{ children: string; key: string; size: string; color: "blue"; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

593                           <Tag key={doc} size="small" color="blue">{doc}</Tag>
                                             ~~~~

src/pages/quality/QualityWarnings.tsx:26:19 - error TS6133: 'setLoading' is declared but its value is never read.

26   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityWarnings.tsx:94:16 - error TS6133: 'setData' is declared but its value is never read.

94   const [data, setData] = useState<QualityWarning[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityWarnings.tsx:203:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

203       render: (_, record: QualityWarning) => (
                   ~

src/pages/quality/QualityZeroDefect.tsx:30:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

30   CloseCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:31:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

31   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:65:11 - error TS6196: 'ActionItem' is declared but never used.

65 interface ActionItem {
             ~~~~~~~~~~

src/pages/SelectionManagement.tsx:16:3 - error TS6133: 'InputNumber' is declared but its value is never read.

16   InputNumber,
     ~~~~~~~~~~~

src/pages/SelectionManagement.tsx:24:3 - error TS6133: 'Divider' is declared but its value is never read.

24   Divider
     ~~~~~~~

src/pages/SelectionManagement.tsx:36:3 - error TS6133: 'DollarCircleOutlined' is declared but its value is never read.

36   DollarCircleOutlined
     ~~~~~~~~~~~~~~~~~~~~

src/pages/SelectionManagement.tsx:43:7 - error TS6133: 'RangePicker' is declared but its value is never read.

43 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:22:3 - error TS6133: 'Tree' is declared but its value is never read.

22   Tree,
     ~~~~

src/pages/standards/StandardComparison.tsx:23:3 - error TS6133: 'Timeline' is declared but its value is never read.

23   Timeline
     ~~~~~~~~

src/pages/standards/StandardComparison.tsx:30:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

30   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS2724: '"@ant-design/icons"' has no exported member named 'CompareOutlined'. Did you mean 'CompressOutlined'?

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS6133: 'CompareOutlined' is declared but its value is never read.

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:33:3 - error TS6133: 'CheckCircleOutlined' is declared but its value is never read.

33   CheckCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:34:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

34   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:35:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

35   CloseCircleOutlined
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardDocuments.tsx:125:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

125       render: (_, record: StandardDocument) => (
                   ~

src/pages/standards/VersionManagement.tsx:31:7 - error TS6133: 'TextArea' is declared but its value is never read.

31 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/standards/VersionManagement.tsx:65:10 - error TS6133: 'form' is declared but its value is never read.

65   const [form] = Form.useForm();
            ~~~~

src/pages/SupplierSearch.tsx:21:3 - error TS6133: 'Divider' is declared but its value is never read.

21   Divider,
     ~~~~~~~

src/pages/SupplierSearch.tsx:24:3 - error TS6133: 'Timeline' is declared but its value is never read.

24   Timeline,
     ~~~~~~~~

src/pages/SupplierSearch.tsx:32:3 - error TS6133: 'HistoryOutlined' is declared but its value is never read.

32   HistoryOutlined,
     ~~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:38:3 - error TS6133: 'DollarOutlined' is declared but its value is never read.

38   DollarOutlined,
     ~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:46:9 - error TS6133: 'Title' is declared but its value is never read.

46 const { Title, Text } = Typography;
           ~~~~~

src/pages/SupplierSearch.tsx:258:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

258       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:280:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

280       render: (_, supplier: Supplier) => {
                   ~

src/pages/SupplierSearch.tsx:300:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

300       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:323:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

323       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:327:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

327             <Rate disabled size="small" value={supplier.performance?.qualityRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:331:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

331             <Rate disabled size="small" value={supplier.performance?.deliveryRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:335:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

335             <Rate disabled size="small" value={supplier.performance?.serviceRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:344:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

344       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:377:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

377       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:395:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

395       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:750:88 - error TS6133: 'index' is declared but its value is never read.

750               {suppliers.filter(s => selectedForCompare.includes(s.id)).map((supplier, index) => (
                                                                                           ~~~~~

src/pages/SupplierSearch.tsx:772:53 - error TS2339: Property 'type' does not exist on type 'Supplier'.

772                         <Tag color="blue">{supplier.type}</Tag>
                                                        ~~~~

src/pages/SupplierSearch.tsx:775:46 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                 ~~~~~

src/pages/SupplierSearch.tsx:775:82 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                                                     ~~~~~

src/pages/SupplierSearch.tsx:776:37 - error TS2339: Property 'level' does not exist on type 'Supplier'.

776                           {supplier.level}
                                        ~~~~~

src/pages/SupplierSearch.tsx:785:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

785                         {supplier.products.slice(0, 3).join(', ')}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:786:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

786                         {supplier.products.length > 3 && '...'}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:789:35 - error TS2339: Property 'contact' does not exist on type 'Supplier'.

789                         {supplier.contact}
                                      ~~~~~~~

src/pages/SupplierSearch.tsx:792:63 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

792                         <Rate disabled defaultValue={supplier.rating} style={{ fontSize: 14 }} />
                                                                  ~~~~~~

src/pages/SupplierSearch.tsx:793:67 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

793                         <span style={{ marginLeft: 8 }}>{supplier.rating}/5</span>
                                                                      ~~~~~~

src/pages/SupplierSearch.tsx:846:60 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

846                         <span style={{ marginLeft: 4 }}>{s.rating}</span>
                                                               ~~~~~~

src/pages/TenantList.tsx:49:34 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

49         setTenants(response.data.items);
                                    ~~~~~

src/pages/TenantList.tsx:52:32 - error TS2339: Property 'total' does not exist on type 'Tenant[]'.

52           total: response.data.total,
                                  ~~~~~

src/pages/TenantList.tsx:53:34 - error TS2339: Property 'page' does not exist on type 'Tenant[]'.

53           current: response.data.page,
                                    ~~~~

src/pages/test/ComponentIdentification.tsx:13:3 - error TS6133: 'InputNumber' is declared but its value is never read.

13   InputNumber,
     ~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:29:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

29   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:39:7 - error TS6133: 'TextArea' is declared but its value is never read.

39 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:151:23 - error TS2322: Type 'string' is not assignable to type '"default" | "success" | "warning" | "error" | "processing" | undefined'.

151         return <Badge status={color} icon={icon} text={text} />;
                          ~~~~~~

  node_modules/antd/es/badge/index.d.ts:21:5
    21     status?: PresetStatusColorType;
           ~~~~~~
    The expected type comes from property 'status' which is declared here on type 'IntrinsicAttributes & BadgeProps & RefAttributes<HTMLSpanElement>'

src/pages/testing/RadiationTesting.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, DatePicker, InputNumber } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:118:19 - error TS6133: 'record' is declared but its value is never read.

118       render: (_, record) => (
                      ~~~~~~

src/pages/UserList.tsx:48:32 - error TS2339: Property 'items' does not exist on type 'User[]'.

48         setUsers(response.data.items);
                                  ~~~~~

src/pages/UserList.tsx:51:32 - error TS2339: Property 'total' does not exist on type 'User[]'.

51           total: response.data.total,
                                  ~~~~~

src/pages/UserList.tsx:52:34 - error TS2339: Property 'page' does not exist on type 'User[]'.

52           current: response.data.page,
                                    ~~~~

src/services/componentService.ts:4:34 - error TS2339: Property 'env' does not exist on type 'ImportMeta'.

4 const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000/api';
                                   ~~~

src/utils/parameterUtils.tsx:244:3 - error TS6133: 'param' is declared but its value is never read.

244   param?: ParameterDefinition
      ~~~~~


Found 200 errors in 52 files.

Errors  Files
     2  src/App.tsx:2
     1  src/components/ComponentCompareModal.tsx:3
     2  src/components/Layout.tsx:224
     1  src/examples/DynamicParameterTableExample.tsx:197
     3  src/pages/application/CounterfeitDetection.tsx:27
     1  src/pages/application/FunctionalUnits.tsx:23
     2  src/pages/application/QPLManagement.tsx:16
     4  src/pages/components/AnalogICSearch.tsx:1
     9  src/pages/components/ComponentCompare.tsx:16
     1  src/pages/components/ComponentSearch.tsx:858
     4  src/pages/components/DigitalICSearch.tsx:1
     4  src/pages/components/DiscreteSearch.tsx:1
     4  src/pages/components/ElectromechanicalSearch.tsx:1
     4  src/pages/components/GeneralSearch.tsx:1
     4  src/pages/components/HybridICSearch.tsx:1
     4  src/pages/components/MicrosystemsSearch.tsx:1
     4  src/pages/components/MicrowaveSearch.tsx:1
     4  src/pages/components/OptoelectronicSearch.tsx:1
     4  src/pages/components/PowerSearch.tsx:1
     4  src/pages/components/VacuumSearch.tsx:1
     5  src/pages/ContractList.tsx:55
     6  src/pages/documents/PolicyRegulation.tsx:25
     2  src/pages/documents/TechnicalDocuments.tsx:24
     2  src/pages/documents/TechnicalNews.tsx:27
     1  src/pages/documents/TechnicalTraining.tsx:32
     1  src/pages/documents/TestData.tsx:35
     1  src/pages/engineering/DesignSimulation.tsx:36
     2  src/pages/engineering/RadiationAssessment.tsx:2
     1  src/pages/engineering/SecurityCertification.tsx:27
     1  src/pages/engineering/Sourcing.tsx:173
     3  src/pages/engineering/Testing.tsx:22
    19  src/pages/FinancialList.tsx:60
    14  src/pages/HomePage.tsx:14
     3  src/pages/OfficeList.tsx:50
     2  src/pages/procurement/InventoryManagement.tsx:36
     2  src/pages/procurement/OnlineProcurement.tsx:2
     2  src/pages/procurement/SupplyChainMonitoring.tsx:18
     3  src/pages/quality/QualityNotifications.tsx:20
     2  src/pages/quality/QualityTraceability.tsx:11
     3  src/pages/quality/QualityWarnings.tsx:26
     3  src/pages/quality/QualityZeroDefect.tsx:30
     4  src/pages/SelectionManagement.tsx:16
     8  src/pages/standards/StandardComparison.tsx:22
     1  src/pages/standards/StandardDocuments.tsx:125
     2  src/pages/standards/VersionManagement.tsx:31
    26  src/pages/SupplierSearch.tsx:21
     3  src/pages/TenantList.tsx:49
     4  src/pages/test/ComponentIdentification.tsx:13
     3  src/pages/testing/RadiationTesting.tsx:2
     3  src/pages/UserList.tsx:48
     1  src/services/componentService.ts:4
     1  src/utils/parameterUtils.tsx:244
npm ERR! code ELIFECYCLE
npm ERR! errno 2
npm ERR! business-platform-frontend@0.0.0 build: `tsc && vite build`
npm ERR! Exit status 2
npm ERR!
npm ERR! Failed at the business-platform-frontend@0.0.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\46482\AppData\Roaming\npm-cache\_logs\2025-11-12T15_47_57_985Z-debug.log

(space_env) F:\Business_plat\frontend>

> tsc && vite build

src/App.tsx:2:50 - error TS6133: 'Navigate' is declared but its value is never read.

2 import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
                                                   ~~~~~~~~

src/App.tsx:72:1 - error TS6133: 'RadiationAssessment' is declared but its value is never read.

72 import RadiationAssessment from '@/pages/engineering/RadiationAssessment';
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

src/components/ComponentCompareModal.tsx:3:24 - error TS6133: 'CloseOutlined' is declared but its value is never read.

3 import { SwapOutlined, CloseOutlined } from '@ant-design/icons';
                         ~~~~~~~~~~~~~

src/components/Layout.tsx:224:15 - error TS2339: Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; } | { key: string; icon: Element; label: string; children: { key: string; label: string; }[]; }'.
  Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; }'.

224     if (!item.roles) return true;
                  ~~~~~

src/components/Layout.tsx:225:17 - error TS2339: Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; } | { key: string; icon: Element; label: string; children: { key: string; label: string; }[]; }'.
  Property 'roles' does not exist on type '{ key: string; icon: Element; label: string; children?: undefined; }'.

225     return item.roles.includes(user?.role || '');
                    ~~~~~

src/examples/DynamicParameterTableExample.tsx:197:19 - error TS6133: 'setLoading' is declared but its value is never read.

197   const [loading, setLoading] = useState(false);
                      ~~~~~~~~~~

src/pages/application/CounterfeitDetection.tsx:27:3 - error TS6133: 'UploadOutlined' is declared but its value is never read.

27   UploadOutlined,
     ~~~~~~~~~~~~~~

src/pages/application/CounterfeitDetection.tsx:675:27 - error TS2322: Type '{ children: Element[]; size: string; }' is not assignable to type 'IntrinsicAttributes & TimelineProps'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TimelineProps'.

675                 <Timeline size="small">
                              ~~~~

src/pages/application/CounterfeitDetection.tsx:686:27 - error TS2322: Type '{ children: Element[]; size: string; }' is not assignable to type 'IntrinsicAttributes & TimelineProps'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TimelineProps'.

686                 <Timeline size="small">
                              ~~~~

src/pages/application/FunctionalUnits.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/application/QPLManagement.tsx:16:3 - error TS6133: 'Upload' is declared but its value is never read.

16   Upload,
     ~~~~~~

src/pages/application/QPLManagement.tsx:17:3 - error TS6133: 'Progress' is declared but its value is never read.

17   Progress,
     ~~~~~~~~

src/pages/components/AnalogICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/AnalogICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/AnalogICSearch.tsx:294:10 - error TS6133: 'data' is declared but its value is never read.

294   const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
             ~~~~

src/pages/components/AnalogICSearch.tsx:294:16 - error TS6133: 'setData' is declared but its value is never read.

294   const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
                   ~~~~~~~

src/pages/components/ComponentCompare.tsx:16:3 - error TS6133: 'Spin' is declared but its value is never read.

16   Spin,
     ~~~~

src/pages/components/ComponentCompare.tsx:24:3 - error TS6133: 'PlusOutlined' is declared but its value is never read.

24   PlusOutlined,
     ~~~~~~~~~~~~

src/pages/components/ComponentCompare.tsx:35:7 - error TS6133: 'Option' is declared but its value is never read.

35 const { Option } = Select;
         ~~~~~~~~~~

src/pages/components/ComponentCompare.tsx:426:22 - error TS2339: Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; }'.

426         isGroup: row.isGroup
                         ~~~~~~~

src/pages/components/ComponentCompare.tsx:429:15 - error TS2339: Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'isGroup' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; }'.

429       if (row.isGroup) {
                  ~~~~~~~

src/pages/components/ComponentCompare.tsx:451:24 - error TS2339: Property 'unit' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'unit' does not exist on type '{ key: string; parameter: string; isGroup: boolean; }'.

451         } else if (row.unit) {
                           ~~~~

src/pages/components/ComponentCompare.tsx:452:94 - error TS2339: Property 'unit' does not exist on type '{ key: string; parameter: string; unit: string; critical: boolean; } | { key: string; parameter: string; isGroup: boolean; } | { key: string; parameter: string; isGroup?: undefined; }'.
  Property 'unit' does not exist on type '{ key: string; parameter: string; isGroup: boolean; }'.

452           value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
                                                                                                 ~~~~

src/pages/components/ComponentCompare.tsx:536:82 - error TS2322: Type '{ children: string; color: "blue" | "green" | "red" | "gold" | "default"; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

536                             <Tag color={getQualityColor(component.qualityLevel)} size="small">
                                                                                     ~~~~

src/pages/components/ComponentCompare.tsx:615:21 - error TS2322: Type '{ '.group-row': { background: string; fontWeight: number; }; }' is not assignable to type 'Properties<string | number, string & {}>'.
  Object literal may only specify known properties, and ''.group-row'' does not exist in type 'Properties<string | number, string & {}>'.

615                     '.group-row': {
                        ~~~~~~~~~~~~~~~
616                       background: '#fafafa',
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
617                       fontWeight: 600
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
618                     }
    ~~~~~~~~~~~~~~~~~~~~~

  node_modules/rc-table/lib/Table.d.ts:37:5
    37     style?: React.CSSProperties;
           ~~~~~
    The expected type comes from property 'style' which is declared here on type 'IntrinsicAttributes & TableProps<any> & { children?: ReactNode; } & RefAttributes<Reference>'

src/pages/components/ComponentSearch.tsx:858:28 - error TS2345: Argument of type '(string | undefined)[]' is not assignable to parameter of type 'SetStateAction<string[]>'.
  Type '(string | undefined)[]' is not assignable to type 'string[]'.
    Type 'string | undefined' is not assignable to type 'string'.
      Type 'undefined' is not assignable to type 'string'.

858     setCompareComponentIds(selectedIds);
                               ~~~~~~~~~~~

src/pages/components/DigitalICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/DigitalICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/DigitalICSearch.tsx:273:10 - error TS6133: 'data' is declared but its value is never read.

273   const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
             ~~~~

src/pages/components/DigitalICSearch.tsx:273:16 - error TS6133: 'setData' is declared but its value is never read.

273   const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
                   ~~~~~~~

src/pages/components/DiscreteSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/DiscreteSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/DiscreteSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
             ~~~~

src/pages/components/DiscreteSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
                   ~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/ElectromechanicalSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
             ~~~~

src/pages/components/ElectromechanicalSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
                   ~~~~~~~

src/pages/components/GeneralSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/GeneralSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/GeneralSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
             ~~~~

src/pages/components/GeneralSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
                   ~~~~~~~

src/pages/components/HybridICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/HybridICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/HybridICSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
             ~~~~

src/pages/components/HybridICSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
                   ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
             ~~~~

src/pages/components/MicrosystemsSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
                   ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrowaveSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
             ~~~~

src/pages/components/MicrowaveSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
                   ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
             ~~~~

src/pages/components/OptoelectronicSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
                   ~~~~~~~

src/pages/components/PowerSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/PowerSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/PowerSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
             ~~~~

src/pages/components/PowerSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
                   ~~~~~~~

src/pages/components/VacuumSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/VacuumSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/VacuumSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
             ~~~~

src/pages/components/VacuumSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
                   ~~~~~~~

src/pages/ContractList.tsx:55:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

55         setContracts(response.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:58:32 - error TS2339: Property 'total' does not exist on type 'Contract[]'.

58           total: response.data.total,
                                  ~~~~~

src/pages/ContractList.tsx:59:34 - error TS2339: Property 'page' does not exist on type 'Contract[]'.

59           current: response.data.page,
                                    ~~~~

src/pages/ContractList.tsx:78:36 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

78         setTenants(tenantsRes.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:81:36 - error TS2339: Property 'items' does not exist on type 'Office[]'.

81         setOffices(officesRes.data.items);
                                      ~~~~~

src/pages/documents/PolicyRegulation.tsx:25:3 - error TS6133: 'SearchOutlined' is declared but its value is never read.

25   SearchOutlined,
     ~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:27:3 - error TS6133: 'CalendarOutlined' is declared but its value is never read.

27   CalendarOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:141:20 - error TS6133: 'setPolicies' is declared but its value is never read.

141   const [policies, setPolicies] = useState<PolicyRegulation[]>(mockPolicyData);
                       ~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:552:21 - error TS2322: Type 'Dispatch<SetStateAction<[Dayjs, Dayjs] | null>>' is not assignable to type '(dates: NoUndefinedRangeValueType<Dayjs> | null, dateStrings: [string, string]) => void'.
  Types of parameters 'value' and 'dates' are incompatible.
    Type 'NoUndefinedRangeValueType<Dayjs> | null' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
      Type 'NoUndefinedRangeValueType<Dayjs>' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
        Type '[start: Dayjs | null, end: Dayjs | null]' is not assignable to type '[Dayjs, Dayjs]'.
          Type at position 0 in source is not compatible with type at position 0 in target.
            Type 'Dayjs | null' is not assignable to type 'Dayjs'.
              Type 'null' is not assignable to type 'Dayjs'.

552                     onChange={setDateRange}
                        ~~~~~~~~

  node_modules/rc-picker/lib/PickerInput/RangePicker.d.ts:15:5
    15     onChange?: (dates: NoUndefinedRangeValueType<DateType> | null, dateStrings: [string, string]) => void;
           ~~~~~~~~
    The expected type comes from property 'onChange' which is declared here on type 'IntrinsicAttributes & Omit<RangePickerProps<Dayjs>, "classNames" | "styles" | "locale" | "generateConfig" | "hideHeader"> & { ...; } & RefAttributes<...>'

src/pages/documents/PolicyRegulation.tsx:599:78 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

599                               <Tag color={getCategoryColor(policy.category)} size="small">
                                                                                 ~~~~

src/pages/documents/PolicyRegulation.tsx:602:70 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

602                               <Tag color={getTypeColor(policy.type)} size="small">
                                                                         ~~~~

src/pages/documents/TechnicalDocuments.tsx:24:19 - error TS6133: 'setLoading' is declared but its value is never read.

24   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalDocuments.tsx:164:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

164       render: (_, record: TechnicalDocument) => (
                   ~

src/pages/documents/TechnicalNews.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalNews.tsx:191:9 - error TS6133: 'getImportanceColor' is declared but its value is never read.

191   const getImportanceColor = (importance: string) => {
            ~~~~~~~~~~~~~~~~~~

src/pages/documents/TechnicalTraining.tsx:32:19 - error TS6133: 'setLoading' is declared but its value is never read.

32   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TestData.tsx:35:19 - error TS6133: 'setLoading' is declared but its value is never read.

35   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/DesignSimulation.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:2:84 - error TS6133: 'Progress' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, InputNumber, Progress, Descriptions, Alert, Tabs, Row, Col, Statistic } from 'antd';
                                                                                     ~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:38:19 - error TS6133: 'setLoading' is declared but its value is never read.

38   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/SecurityCertification.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Sourcing.tsx:173:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

173       render: (_, record: SourcingProject) => (
                   ~

src/pages/engineering/Testing.tsx:22:19 - error TS6133: 'setLoading' is declared but its value is never read.

22   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Testing.tsx:75:16 - error TS6133: 'setData' is declared but its value is never read.

75   const [data, setData] = useState<TestingProject[]>(mockData);
                  ~~~~~~~

src/pages/engineering/Testing.tsx:150:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

150       render: (_, record: TestingProject) => (
                   ~

src/pages/FinancialList.tsx:60:34 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

60         setRecords(response.data.items);
                                    ~~~~~

src/pages/FinancialList.tsx:63:32 - error TS2339: Property 'total' does not exist on type 'FinancialRecord[]'.

63           total: response.data.total,
                                  ~~~~~

src/pages/FinancialList.tsx:64:34 - error TS2339: Property 'page' does not exist on type 'FinancialRecord[]'.

64           current: response.data.page,
                                    ~~~~

src/pages/FinancialList.tsx:68:43 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                             ~~~~~

src/pages/FinancialList.tsx:68:57 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                           ~~~

src/pages/FinancialList.tsx:68:62 - error TS7006: Parameter 'record' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                                ~~~~~~

src/pages/FinancialList.tsx:69:42 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

69         const paidAmount = response.data.items
                                            ~~~~~

src/pages/FinancialList.tsx:70:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

70           .filter(record => record.status === 'paid')
                     ~~~~~~

src/pages/FinancialList.tsx:71:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:71:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:72:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

72         const pendingAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:73:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

73           .filter(record => record.status === 'pending')
                     ~~~~~~

src/pages/FinancialList.tsx:74:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:74:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:75:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

75         const overdueAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:76:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

76           .filter(record => record.status === 'overdue')
                     ~~~~~~

src/pages/FinancialList.tsx:77:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:77:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:93:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

93         setContracts(response.data.items);
                                      ~~~~~

src/pages/HomePage.tsx:14:3 - error TS6133: 'Statistic' is declared but its value is never read.

14   Statistic,
     ~~~~~~~~~

src/pages/HomePage.tsx:15:3 - error TS6133: 'List' is declared but its value is never read.

15   List,
     ~~~~

src/pages/HomePage.tsx:16:3 - error TS6133: 'Avatar' is declared but its value is never read.

16   Avatar,
     ~~~~~~

src/pages/HomePage.tsx:18:3 - error TS6133: 'Tabs' is declared but its value is never read.

18   Tabs,
     ~~~~

src/pages/HomePage.tsx:33:3 - error TS6133: 'DatabaseOutlined' is declared but its value is never read.

33   DatabaseOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:36:3 - error TS6133: 'SettingOutlined' is declared but its value is never read.

36   SettingOutlined,
     ~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:37:3 - error TS6133: 'BugOutlined' is declared but its value is never read.

37   BugOutlined,
     ~~~~~~~~~~~

src/pages/HomePage.tsx:38:3 - error TS6133: 'AppstoreOutlined' is declared but its value is never read.

38   AppstoreOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:51:3 - error TS6133: 'BulbOutlined' is declared but its value is never read.

51   BulbOutlined,
     ~~~~~~~~~~~~

src/pages/HomePage.tsx:52:3 - error TS6133: 'BuildOutlined' is declared but its value is never read.

52   BuildOutlined,
     ~~~~~~~~~~~~~

src/pages/HomePage.tsx:57:7 - error TS6133: 'Option' is declared but its value is never read.

57 const { Option } = Select;
         ~~~~~~~~~~

src/pages/HomePage.tsx:199:7 - error TS6133: 'serviceModules' is declared but its value is never read.

199 const serviceModules = [
          ~~~~~~~~~~~~~~

src/pages/HomePage.tsx:273:7 - error TS6133: 'latestNews' is declared but its value is never read.

273 const latestNews = [
          ~~~~~~~~~~

src/pages/HomePage.tsx:304:10 - error TS6133: 'statsLoading' is declared but its value is never read.

304   const [statsLoading, setStatsLoading] = useState(true);
             ~~~~~~~~~~~~

src/pages/OfficeList.tsx:50:34 - error TS2339: Property 'items' does not exist on type 'Office[]'.

50         setOffices(response.data.items);
                                    ~~~~~

src/pages/OfficeList.tsx:53:32 - error TS2339: Property 'total' does not exist on type 'Office[]'.

53           total: response.data.total,
                                  ~~~~~

src/pages/OfficeList.tsx:54:34 - error TS2339: Property 'page' does not exist on type 'Office[]'.

54           current: response.data.page,
                                    ~~~~

src/pages/procurement/InventoryManagement.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/InventoryManagement.tsx:39:10 - error TS6133: 'selectedItem' is declared but its value is never read.

39   const [selectedItem, setSelectedItem] = useState<InventoryItem | null>(null);
            ~~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, DatePicker, Space, Tag, Modal, Form, InputNumber, message } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:25:19 - error TS6133: 'setLoading' is declared but its value is never read.

25   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:18:3 - error TS6133: 'Descriptions' is declared but its value is never read.

18   Descriptions,
     ~~~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:32:7 - error TS6133: 'RangePicker' is declared but its value is never read.

32 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:20:19 - error TS6133: 'setLoading' is declared but its value is never read.

20   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:67:16 - error TS6133: 'setData' is declared but its value is never read.

67   const [data, setData] = useState<QualityNotification[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityNotifications.tsx:156:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

156       render: (_, record: QualityNotification) => (
                   ~

src/pages/quality/QualityTraceability.tsx:11:3 - error TS6133: 'Form' is declared but its value is never read.

11   Form,
     ~~~~

src/pages/quality/QualityTraceability.tsx:593:42 - error TS2322: Type '{ children: string; key: string; size: string; color: "blue"; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

593                           <Tag key={doc} size="small" color="blue">{doc}</Tag>
                                             ~~~~

src/pages/quality/QualityWarnings.tsx:26:19 - error TS6133: 'setLoading' is declared but its value is never read.

26   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityWarnings.tsx:94:16 - error TS6133: 'setData' is declared but its value is never read.

94   const [data, setData] = useState<QualityWarning[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityWarnings.tsx:203:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

203       render: (_, record: QualityWarning) => (
                   ~

src/pages/quality/QualityZeroDefect.tsx:30:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

30   CloseCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:31:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

31   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:65:11 - error TS6196: 'ActionItem' is declared but never used.

65 interface ActionItem {
             ~~~~~~~~~~

src/pages/SelectionManagement.tsx:16:3 - error TS6133: 'InputNumber' is declared but its value is never read.

16   InputNumber,
     ~~~~~~~~~~~

src/pages/SelectionManagement.tsx:24:3 - error TS6133: 'Divider' is declared but its value is never read.

24   Divider
     ~~~~~~~

src/pages/SelectionManagement.tsx:36:3 - error TS6133: 'DollarCircleOutlined' is declared but its value is never read.

36   DollarCircleOutlined
     ~~~~~~~~~~~~~~~~~~~~

src/pages/SelectionManagement.tsx:43:7 - error TS6133: 'RangePicker' is declared but its value is never read.

43 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:22:3 - error TS6133: 'Tree' is declared but its value is never read.

22   Tree,
     ~~~~

src/pages/standards/StandardComparison.tsx:23:3 - error TS6133: 'Timeline' is declared but its value is never read.

23   Timeline
     ~~~~~~~~

src/pages/standards/StandardComparison.tsx:30:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

30   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS2724: '"@ant-design/icons"' has no exported member named 'CompareOutlined'. Did you mean 'CompressOutlined'?

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS6133: 'CompareOutlined' is declared but its value is never read.

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:33:3 - error TS6133: 'CheckCircleOutlined' is declared but its value is never read.

33   CheckCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:34:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

34   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:35:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

35   CloseCircleOutlined
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardDocuments.tsx:125:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

125       render: (_, record: StandardDocument) => (
                   ~

src/pages/standards/VersionManagement.tsx:31:7 - error TS6133: 'TextArea' is declared but its value is never read.

31 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/standards/VersionManagement.tsx:65:10 - error TS6133: 'form' is declared but its value is never read.

65   const [form] = Form.useForm();
            ~~~~

src/pages/SupplierSearch.tsx:21:3 - error TS6133: 'Divider' is declared but its value is never read.

21   Divider,
     ~~~~~~~

src/pages/SupplierSearch.tsx:24:3 - error TS6133: 'Timeline' is declared but its value is never read.

24   Timeline,
     ~~~~~~~~

src/pages/SupplierSearch.tsx:32:3 - error TS6133: 'HistoryOutlined' is declared but its value is never read.

32   HistoryOutlined,
     ~~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:38:3 - error TS6133: 'DollarOutlined' is declared but its value is never read.

38   DollarOutlined,
     ~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:46:9 - error TS6133: 'Title' is declared but its value is never read.

46 const { Title, Text } = Typography;
           ~~~~~

src/pages/SupplierSearch.tsx:258:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

258       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:280:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

280       render: (_, supplier: Supplier) => {
                   ~

src/pages/SupplierSearch.tsx:300:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

300       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:323:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

323       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:327:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

327             <Rate disabled size="small" value={supplier.performance?.qualityRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:331:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

331             <Rate disabled size="small" value={supplier.performance?.deliveryRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:335:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

335             <Rate disabled size="small" value={supplier.performance?.serviceRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:344:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

344       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:377:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

377       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:395:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

395       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:750:88 - error TS6133: 'index' is declared but its value is never read.

750               {suppliers.filter(s => selectedForCompare.includes(s.id)).map((supplier, index) => (
                                                                                           ~~~~~

src/pages/SupplierSearch.tsx:772:53 - error TS2339: Property 'type' does not exist on type 'Supplier'.

772                         <Tag color="blue">{supplier.type}</Tag>
                                                        ~~~~

src/pages/SupplierSearch.tsx:775:46 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                 ~~~~~

src/pages/SupplierSearch.tsx:775:82 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                                                     ~~~~~

src/pages/SupplierSearch.tsx:776:37 - error TS2339: Property 'level' does not exist on type 'Supplier'.

776                           {supplier.level}
                                        ~~~~~

src/pages/SupplierSearch.tsx:785:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

785                         {supplier.products.slice(0, 3).join(', ')}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:786:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

786                         {supplier.products.length > 3 && '...'}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:789:35 - error TS2339: Property 'contact' does not exist on type 'Supplier'.

789                         {supplier.contact}
                                      ~~~~~~~

src/pages/SupplierSearch.tsx:792:63 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

792                         <Rate disabled defaultValue={supplier.rating} style={{ fontSize: 14 }} />
                                                                  ~~~~~~

src/pages/SupplierSearch.tsx:793:67 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

793                         <span style={{ marginLeft: 8 }}>{supplier.rating}/5</span>
                                                                      ~~~~~~

src/pages/SupplierSearch.tsx:846:60 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

846                         <span style={{ marginLeft: 4 }}>{s.rating}</span>
                                                               ~~~~~~

src/pages/TenantList.tsx:49:34 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

49         setTenants(response.data.items);
                                    ~~~~~

src/pages/TenantList.tsx:52:32 - error TS2339: Property 'total' does not exist on type 'Tenant[]'.

52           total: response.data.total,
                                  ~~~~~

src/pages/TenantList.tsx:53:34 - error TS2339: Property 'page' does not exist on type 'Tenant[]'.

53           current: response.data.page,
                                    ~~~~

src/pages/test/ComponentIdentification.tsx:13:3 - error TS6133: 'InputNumber' is declared but its value is never read.

13   InputNumber,
     ~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:29:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

29   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:39:7 - error TS6133: 'TextArea' is declared but its value is never read.

39 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:151:23 - error TS2322: Type 'string' is not assignable to type '"default" | "success" | "warning" | "error" | "processing" | undefined'.

151         return <Badge status={color} icon={icon} text={text} />;
                          ~~~~~~

  node_modules/antd/es/badge/index.d.ts:21:5
    21     status?: PresetStatusColorType;
           ~~~~~~
    The expected type comes from property 'status' which is declared here on type 'IntrinsicAttributes & BadgeProps & RefAttributes<HTMLSpanElement>'

src/pages/testing/RadiationTesting.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, DatePicker, InputNumber } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:118:19 - error TS6133: 'record' is declared but its value is never read.

118       render: (_, record) => (
                      ~~~~~~

src/pages/UserList.tsx:48:32 - error TS2339: Property 'items' does not exist on type 'User[]'.

48         setUsers(response.data.items);
                                  ~~~~~

src/pages/UserList.tsx:51:32 - error TS2339: Property 'total' does not exist on type 'User[]'.

51           total: response.data.total,
                                  ~~~~~

src/pages/UserList.tsx:52:34 - error TS2339: Property 'page' does not exist on type 'User[]'.

52           current: response.data.page,
                                    ~~~~

src/services/componentService.ts:4:34 - error TS2339: Property 'env' does not exist on type 'ImportMeta'.

4 const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:5000/api';
                                   ~~~

src/utils/parameterUtils.tsx:244:3 - error TS6133: 'param' is declared but its value is never read.

244   param?: ParameterDefinition
      ~~~~~


Found 200 errors in 52 files.

Errors  Files
     2  src/App.tsx:2
     1  src/components/ComponentCompareModal.tsx:3
     2  src/components/Layout.tsx:224
     1  src/examples/DynamicParameterTableExample.tsx:197
     3  src/pages/application/CounterfeitDetection.tsx:27
     1  src/pages/application/FunctionalUnits.tsx:23
     2  src/pages/application/QPLManagement.tsx:16
     4  src/pages/components/AnalogICSearch.tsx:1
     9  src/pages/components/ComponentCompare.tsx:16
     1  src/pages/components/ComponentSearch.tsx:858
     4  src/pages/components/DigitalICSearch.tsx:1
     4  src/pages/components/DiscreteSearch.tsx:1
     4  src/pages/components/ElectromechanicalSearch.tsx:1
     4  src/pages/components/GeneralSearch.tsx:1
     4  src/pages/components/HybridICSearch.tsx:1
     4  src/pages/components/MicrosystemsSearch.tsx:1
     4  src/pages/components/MicrowaveSearch.tsx:1
     4  src/pages/components/OptoelectronicSearch.tsx:1
     4  src/pages/components/PowerSearch.tsx:1
     4  src/pages/components/VacuumSearch.tsx:1
     5  src/pages/ContractList.tsx:55
     6  src/pages/documents/PolicyRegulation.tsx:25
     2  src/pages/documents/TechnicalDocuments.tsx:24
     2  src/pages/documents/TechnicalNews.tsx:27
     1  src/pages/documents/TechnicalTraining.tsx:32
     1  src/pages/documents/TestData.tsx:35
     1  src/pages/engineering/DesignSimulation.tsx:36
     2  src/pages/engineering/RadiationAssessment.tsx:2
     1  src/pages/engineering/SecurityCertification.tsx:27
     1  src/pages/engineering/Sourcing.tsx:173
     3  src/pages/engineering/Testing.tsx:22
    19  src/pages/FinancialList.tsx:60
    14  src/pages/HomePage.tsx:14
     3  src/pages/OfficeList.tsx:50
     2  src/pages/procurement/InventoryManagement.tsx:36
     2  src/pages/procurement/OnlineProcurement.tsx:2
     2  src/pages/procurement/SupplyChainMonitoring.tsx:18
     3  src/pages/quality/QualityNotifications.tsx:20
     2  src/pages/quality/QualityTraceability.tsx:11
     3  src/pages/quality/QualityWarnings.tsx:26
     3  src/pages/quality/QualityZeroDefect.tsx:30
     4  src/pages/SelectionManagement.tsx:16
     8  src/pages/standards/StandardComparison.tsx:22
     1  src/pages/standards/StandardDocuments.tsx:125
     2  src/pages/standards/VersionManagement.tsx:31
    26  src/pages/SupplierSearch.tsx:21
     3  src/pages/TenantList.tsx:49
     4  src/pages/test/ComponentIdentification.tsx:13
     3  src/pages/testing/RadiationTesting.tsx:2
     3  src/pages/UserList.tsx:48
     1  src/services/componentService.ts:4
     1  src/utils/parameterUtils.tsx:244
npm ERR! code ELIFECYCLE
npm ERR! errno 2
npm ERR! business-platform-frontend@0.0.0 build: `tsc && vite build`
npm ERR! Exit status 2
npm ERR!
npm ERR! Failed at the business-platform-frontend@0.0.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\46482\AppData\Roaming\npm-cache\_logs\2025-11-16T02_48_17_054Z-debug.log

(space_env) F:\Business_plat\frontend>

---

**Cursor**

正在修复这些 TypeScript 编译错误。先处理主要问题，再逐步修复其余问题。


开始修复这些错误，先处理关键问题：


开始修复这些错误：


创建类型声明文件并修复主要错误：


```typescript
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string;
  // 可以添加更多环境变量类型
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}

```

```typescriptreact
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import { AuthProvider } from '@/hooks/useAuth';
import Layout from '@/components/Layout';
import Login from '@/pages/Login';

import HomePage from '@/pages/HomePage';
import ProtectedRoute from '@/components/ProtectedRoute';

// 航天元器件平台页面
import ComponentSearch from '@/pages/components/ComponentSearch';
import DigitalICSearch from '@/pages/components/DigitalICSearch';
import AnalogICSearch from '@/pages/components/AnalogICSearch';
import HybridICSearch from '@/pages/components/HybridICSearch';
import DiscreteSearch from '@/pages/components/DiscreteSearch';
import MicrowaveSearch from '@/pages/components/MicrowaveSearch';
import VacuumSearch from '@/pages/components/VacuumSearch';
import OptoelectronicSearch from '@/pages/components/OptoelectronicSearch';
import ElectromechanicalSearch from '@/pages/components/ElectromechanicalSearch';
import PowerSearch from '@/pages/components/PowerSearch';
import GeneralSearch from '@/pages/components/GeneralSearch';
import MicrosystemsSearch from '@/pages/components/MicrosystemsSearch';
import GlobalSearch from '@/pages/components/GlobalSearch';
import ComponentCompare from '@/pages/components/ComponentCompare';
import SupplierSearch from '@/pages/SupplierSearch';
import StandardQuery from '@/pages/standards/StandardQuery';

import SelectionManagement from '@/pages/SelectionManagement';

// 采购服务模块
import OnlineProcurement from '@/pages/procurement/OnlineProcurement';
import InventoryManagement from '@/pages/procurement/InventoryManagement';
import SupplyChainMonitoring from '@/pages/procurement/SupplyChainMonitoring';

// 应用支持模块
import FunctionalUnits from '@/pages/application/FunctionalUnits';
import DigitalModels from '@/pages/application/DigitalModels';
import QPLManagement from '@/pages/application/QPLManagement';
import CounterfeitDetection from '@/pages/application/CounterfeitDetection';


// 试验检测模块
import RadiationTesting from '@/pages/testing/RadiationTesting';

// 质量管理模块
import QualityNotifications from '@/pages/quality/QualityNotifications';
import QualityWarnings from '@/pages/quality/QualityWarnings';

import QualityZeroDefect from '@/pages/quality/QualityZeroDefect';
import QualityTraceability from '@/pages/quality/QualityTraceability';

// 标准服务模块
import StandardsDocuments from '@/pages/standards/StandardDocuments';
import StandardComparison from '@/pages/standards/StandardComparison';
import VersionManagement from '@/pages/standards/VersionManagement';

// 工程服务模块
import Sourcing from '@/pages/engineering/Sourcing';
import Testing from '@/pages/engineering/Testing';

// 资料及培训模块
import TechnicalDocuments from '@/pages/documents/TechnicalDocuments';
import TestData from '@/pages/documents/TestData';
import TechnicalNews from '@/pages/documents/TechnicalNews';
import TechnicalTraining from '@/pages/documents/TechnicalTraining';
import PolicyRegulation from '@/pages/documents/PolicyRegulation';

// 工程服务模块 - 新增页面
import SecurityCertification from '@/pages/engineering/SecurityCertification';
import RadiationAssessment from '@/pages/engineering/RadiationAssessment';
import DesignSimulation from '@/pages/engineering/DesignSimulation';

// 试验检测模块 - 新增页面
import ComponentIdentification from '@/pages/test/ComponentIdentification';

import './App.css';
import CategoryBrowsePage from '@/pages/categories/CategoryBrowsePage';

const App: React.FC = () => {
  return (
    <ConfigProvider locale={zhCN}>
      <AuthProvider>
        <Router
          future={{
            v7_startTransition: true,
            v7_relativeSplatPath: true,
          }}
        >
          <Routes>
            <Route path="/login" element={<Login />} />
            <Route path="/" element={
              <ProtectedRoute>
                <Layout />
              </ProtectedRoute>
            }>
              <Route index element={<HomePage />} />
              
              {/* 标准服务 */}
              <Route path="standards/search" element={<StandardQuery />} />
              <Route path="standards/compare" element={<StandardComparison />} />
              <Route path="standards/versions" element={<VersionManagement />} />
              <Route path="standards/analysis" element={<StandardsDocuments />} />
              
              {/* 器件查询服务 */}
              <Route path="components/search" element={<ComponentSearch />} />
              <Route path="components/digital-ic" element={<DigitalICSearch />} />
              <Route path="components/analog-ic" element={<AnalogICSearch />} />
              <Route path="components/hybrid-ic" element={<HybridICSearch />} />
              <Route path="components/discrete" element={<DiscreteSearch />} />
              <Route path="components/microwave" element={<MicrowaveSearch />} />
              <Route path="components/vacuum" element={<VacuumSearch />} />
              <Route path="components/optoelectronic" element={<OptoelectronicSearch />} />
              <Route path="components/electromechanical" element={<ElectromechanicalSearch />} />
              <Route path="components/power" element={<PowerSearch />} />
              <Route path="components/general" element={<GeneralSearch />} />
              <Route path="components/microsystems" element={<MicrosystemsSearch />} />
              <Route path="components/global-search" element={<GlobalSearch />} />
              <Route path="components/compare" element={<ComponentCompare />} />
              <Route path="components/suppliers" element={<SupplierSearch />} />
              <Route path="components/selection" element={<SelectionManagement />} />
              
              {/* 类别浏览重定向 */}
              <Route path="categories/*" element={<CategoryBrowsePage />} />
              
              {/* 采购服务 */}
              <Route path="procurement/sourcing" element={<Sourcing />} />
              <Route path="procurement/online" element={<OnlineProcurement />} />
              <Route path="procurement/inventory" element={<InventoryManagement />} />
              <Route path="procurement/supply-chain" element={<SupplyChainMonitoring />} />
              
              {/* 应用支持 */}
              <Route path="application/units" element={<FunctionalUnits />} />
              <Route path="application/models" element={<DigitalModels />} />
              <Route path="application/simulation" element={<DesignSimulation />} />
              <Route path="application/qpl" element={<QPLManagement />} />
              <Route path="application/counterfeit" element={<CounterfeitDetection />} />
              
              {/* 质量管理 */}
              <Route path="quality/zero-defect" element={<QualityZeroDefect />} />
              <Route path="quality/notification" element={<QualityNotifications />} />
              <Route path="quality/warning" element={<QualityWarnings />} />
              <Route path="quality/traceability" element={<QualityTraceability />} />
              
              {/* 试验检测 */}
              <Route path="testing/routine" element={<Testing />} />
              <Route path="testing/qualification" element={<ComponentIdentification />} />
              <Route path="testing/radiation" element={<RadiationTesting />} />
              <Route path="testing/supply-security" element={<SecurityCertification />} />
              
              {/* 资料及培训 */}
              <Route path="documents/technical" element={<TechnicalDocuments />} />
              <Route path="documents/test-data" element={<TestData />} />
              <Route path="documents/news" element={<TechnicalNews />} />
              <Route path="documents/training" element={<TechnicalTraining />} />
              <Route path="documents/policy" element={<PolicyRegulation />} />
              
              {/* 其他页面待实现 */}
              <Route path="*" element={<div style={{padding: 24}}>页面开发中...</div>} />
            </Route>
          </Routes>
        </Router>
      </AuthProvider>
    </ConfigProvider>
  );
};

export default App;

```

```typescriptreact
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import { AuthProvider } from '@/hooks/useAuth';
import Layout from '@/components/Layout';
import Login from '@/pages/Login';

import HomePage from '@/pages/HomePage';
import ProtectedRoute from '@/components/ProtectedRoute';

// 航天元器件平台页面
import ComponentSearch from '@/pages/components/ComponentSearch';
import DigitalICSearch from '@/pages/components/DigitalICSearch';
import AnalogICSearch from '@/pages/components/AnalogICSearch';
import HybridICSearch from '@/pages/components/HybridICSearch';
import DiscreteSearch from '@/pages/components/DiscreteSearch';
import MicrowaveSearch from '@/pages/components/MicrowaveSearch';
import VacuumSearch from '@/pages/components/VacuumSearch';
import OptoelectronicSearch from '@/pages/components/OptoelectronicSearch';
import ElectromechanicalSearch from '@/pages/components/ElectromechanicalSearch';
import PowerSearch from '@/pages/components/PowerSearch';
import GeneralSearch from '@/pages/components/GeneralSearch';
import MicrosystemsSearch from '@/pages/components/MicrosystemsSearch';
import GlobalSearch from '@/pages/components/GlobalSearch';
import ComponentCompare from '@/pages/components/ComponentCompare';
import SupplierSearch from '@/pages/SupplierSearch';
import StandardQuery from '@/pages/standards/StandardQuery';

import SelectionManagement from '@/pages/SelectionManagement';

// 采购服务模块
import OnlineProcurement from '@/pages/procurement/OnlineProcurement';
import InventoryManagement from '@/pages/procurement/InventoryManagement';
import SupplyChainMonitoring from '@/pages/procurement/SupplyChainMonitoring';

// 应用支持模块
import FunctionalUnits from '@/pages/application/FunctionalUnits';
import DigitalModels from '@/pages/application/DigitalModels';
import QPLManagement from '@/pages/application/QPLManagement';
import CounterfeitDetection from '@/pages/application/CounterfeitDetection';


// 试验检测模块
import RadiationTesting from '@/pages/testing/RadiationTesting';

// 质量管理模块
import QualityNotifications from '@/pages/quality/QualityNotifications';
import QualityWarnings from '@/pages/quality/QualityWarnings';

import QualityZeroDefect from '@/pages/quality/QualityZeroDefect';
import QualityTraceability from '@/pages/quality/QualityTraceability';

// 标准服务模块
import StandardsDocuments from '@/pages/standards/StandardDocuments';
import StandardComparison from '@/pages/standards/StandardComparison';
import VersionManagement from '@/pages/standards/VersionManagement';

// 工程服务模块
import Sourcing from '@/pages/engineering/Sourcing';
import Testing from '@/pages/engineering/Testing';

// 资料及培训模块
import TechnicalDocuments from '@/pages/documents/TechnicalDocuments';
import TestData from '@/pages/documents/TestData';
import TechnicalNews from '@/pages/documents/TechnicalNews';
import TechnicalTraining from '@/pages/documents/TechnicalTraining';
import PolicyRegulation from '@/pages/documents/PolicyRegulation';

// 工程服务模块 - 新增页面
import SecurityCertification from '@/pages/engineering/SecurityCertification';
import DesignSimulation from '@/pages/engineering/DesignSimulation';

// 试验检测模块 - 新增页面
import ComponentIdentification from '@/pages/test/ComponentIdentification';

import './App.css';
import CategoryBrowsePage from '@/pages/categories/CategoryBrowsePage';

const App: React.FC = () => {
  return (
    <ConfigProvider locale={zhCN}>
      <AuthProvider>
        <Router
          future={{
            v7_startTransition: true,
            v7_relativeSplatPath: true,
          }}
        >
          <Routes>
            <Route path="/login" element={<Login />} />
            <Route path="/" element={
              <ProtectedRoute>
                <Layout />
              </ProtectedRoute>
            }>
              <Route index element={<HomePage />} />
              
              {/* 标准服务 */}
              <Route path="standards/search" element={<StandardQuery />} />
              <Route path="standards/compare" element={<StandardComparison />} />
              <Route path="standards/versions" element={<VersionManagement />} />
              <Route path="standards/analysis" element={<StandardsDocuments />} />
              
              {/* 器件查询服务 */}
              <Route path="components/search" element={<ComponentSearch />} />
              <Route path="components/digital-ic" element={<DigitalICSearch />} />
              <Route path="components/analog-ic" element={<AnalogICSearch />} />
              <Route path="components/hybrid-ic" element={<HybridICSearch />} />
              <Route path="components/discrete" element={<DiscreteSearch />} />
              <Route path="components/microwave" element={<MicrowaveSearch />} />
              <Route path="components/vacuum" element={<VacuumSearch />} />
              <Route path="components/optoelectronic" element={<OptoelectronicSearch />} />
              <Route path="components/electromechanical" element={<ElectromechanicalSearch />} />
              <Route path="components/power" element={<PowerSearch />} />
              <Route path="components/general" element={<GeneralSearch />} />
              <Route path="components/microsystems" element={<MicrosystemsSearch />} />
              <Route path="components/global-search" element={<GlobalSearch />} />
              <Route path="components/compare" element={<ComponentCompare />} />
              <Route path="components/suppliers" element={<SupplierSearch />} />
              <Route path="components/selection" element={<SelectionManagement />} />
              
              {/* 类别浏览重定向 */}
              <Route path="categories/*" element={<CategoryBrowsePage />} />
              
              {/* 采购服务 */}
              <Route path="procurement/sourcing" element={<Sourcing />} />
              <Route path="procurement/online" element={<OnlineProcurement />} />
              <Route path="procurement/inventory" element={<InventoryManagement />} />
              <Route path="procurement/supply-chain" element={<SupplyChainMonitoring />} />
              
              {/* 应用支持 */}
              <Route path="application/units" element={<FunctionalUnits />} />
              <Route path="application/models" element={<DigitalModels />} />
              <Route path="application/simulation" element={<DesignSimulation />} />
              <Route path="application/qpl" element={<QPLManagement />} />
              <Route path="application/counterfeit" element={<CounterfeitDetection />} />
              
              {/* 质量管理 */}
              <Route path="quality/zero-defect" element={<QualityZeroDefect />} />
              <Route path="quality/notification" element={<QualityNotifications />} />
              <Route path="quality/warning" element={<QualityWarnings />} />
              <Route path="quality/traceability" element={<QualityTraceability />} />
              
              {/* 试验检测 */}
              <Route path="testing/routine" element={<Testing />} />
              <Route path="testing/qualification" element={<ComponentIdentification />} />
              <Route path="testing/radiation" element={<RadiationTesting />} />
              <Route path="testing/supply-security" element={<SecurityCertification />} />
              
              {/* 资料及培训 */}
              <Route path="documents/technical" element={<TechnicalDocuments />} />
              <Route path="documents/test-data" element={<TestData />} />
              <Route path="documents/news" element={<TechnicalNews />} />
              <Route path="documents/training" element={<TechnicalTraining />} />
              <Route path="documents/policy" element={<PolicyRegulation />} />
              
              {/* 其他页面待实现 */}
              <Route path="*" element={<div style={{padding: 24}}>页面开发中...</div>} />
            </Route>
          </Routes>
        </Router>
      </AuthProvider>
    </ConfigProvider>
  );
};

export default App;

```

```typescriptreact
import React, { useState } from 'react';
import { Outlet, useNavigate, useLocation } from 'react-router-dom';
import {
  Layout as AntLayout,
  Menu,
  Dropdown,
  Avatar,
  theme,
  Space,
  Row,
  Col,
  Button,
  Drawer,
} from 'antd';

import {
  DashboardOutlined,
  SearchOutlined,
  ShoppingCartOutlined,
  ExperimentOutlined,
  SafetyOutlined,
  ToolOutlined,
  BookOutlined,
  CloudServerOutlined,
  UserOutlined,
  LogoutOutlined,
  SettingOutlined,
  MenuOutlined,
} from '@ant-design/icons';
import { useAuth } from '@/hooks/useAuth';
import './layout.css';

const { Header, Content } = AntLayout;

const Layout: React.FC = () => {
  const [mobileMenuVisible, setMobileMenuVisible] = useState(false);
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  const {
    token: { colorBgContainer },
  } = theme.useToken();

  // 菜单项配置 - 基于7大核心模块
  const menuItems = [
    {
      key: '/',
      icon: <DashboardOutlined />,
      label: '首页',
    },
    {
      key: '/standards',
      icon: <BookOutlined />,
      label: '标准服务',
      children: [
        {
          key: '/standards/search',
          label: '标准查询',
        },
        {
          key: '/standards/compare',
          label: '标准对比',
        },
        {
          key: '/standards/versions',
          label: '版本管理',
        },
        {
          key: '/standards/analysis',
          label: '标准解析',
        },
      ],
    },
    {
      key: '/components',
      icon: <SearchOutlined />,
      label: '器件查询',
      children: [
        {
          key: '/components/search',
          label: '智能搜索',
        },
        {
          key: '/components/compare',
          label: '器件比对',
        },
        {
          key: '/components/suppliers',
          label: '供应商检索',
        },
        {
          key: '/components/selection',
          label: '在线选用',
        },
      ],
    },
    {
      key: '/procurement',
      icon: <ShoppingCartOutlined />,
      label: '采购服务',
      children: [
        {
          key: '/procurement/sourcing',
          label: '货源开发',
        },
        {
          key: '/procurement/online',
          label: '在线采购',
        },
        {
          key: '/procurement/inventory',
          label: '库存追踪',
        },
        {
          key: '/procurement/supply-chain',
          label: '供应链监控',
        },
      ],
    },
    {
      key: '/application',
      icon: <ToolOutlined />,
      label: '应用支持',
      children: [
        {
          key: '/application/units',
          label: '功能单元',
        },
        {
          key: '/application/models',
          label: '数字模型',
        },
        {
          key: '/application/simulation',
          label: '应用仿真',
        },
        {
          key: '/application/qpl',
          label: '合格产品目录',
        },
        {
          key: '/application/counterfeit',
          label: '假冒伪劣库',
        },
      ],
    },
    {
      key: '/quality',
      icon: <SafetyOutlined />,
      label: '质量管理',
      children: [
        {
          key: '/quality/zero-defect',
          label: '质量归零',
        },
        {
          key: '/quality/notification',
          label: '质量通报',
        },
        {
          key: '/quality/warning',
          label: '预警发布',
        },
        {
          key: '/quality/traceability',
          label: '追溯查询',
        },
      ],
    },
    {
      key: '/testing',
      icon: <ExperimentOutlined />,
      label: '试验检测',
      children: [
        {
          key: '/testing/routine',
          label: '常规检测',
        },
        {
          key: '/testing/qualification',
          label: '器件鉴定',
        },
        {
          key: '/testing/radiation',
          label: '辐照评估',
        },
        {
          key: '/testing/supply-security',
          label: '供应安全评价',
        },
      ],
    },
    {
      key: '/documents',
      icon: <CloudServerOutlined />,
      label: '资料及培训',
      children: [
        {
          key: '/documents/technical',
          label: '技术文档',
        },
        {
          key: '/documents/test-data',
          label: '测试数据',
        },
        {
          key: '/documents/news',
          label: '技术动态',
        },
        {
          key: '/documents/training',
          label: '技术培训',
        },
        {
          key: '/documents/policy',
          label: '政策法规',
        },
      ],
    },
  ];

  // 根据用户角色过滤菜单
  const filteredMenuItems = menuItems.filter(item => {
    if (!('roles' in item) || !item.roles) return true;
    return item.roles.includes(user?.role || '');
  });

  const handleMenuClick = ({ key }: { key: string }) => {
    navigate(key);
  };

  const handleLogout = () => {
    logout();
  };

  const userMenuItems = [
    {
      key: 'profile',
      icon: <UserOutlined />,
      label: '个人资料',
    },
    {
      key: 'settings',
      icon: <SettingOutlined />,
      label: '设置',
    },
    {
      type: 'divider' as const,
    },
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: '退出登录',
      onClick: handleLogout,
    },
  ];

  return (
    <AntLayout style={{ minHeight: '100vh' }}>
      <Header className="top-navigation" style={{ 
        background: '#001529',
        padding: '0 24px',
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1000,
      }}>
        <Row justify="space-between" align="middle" style={{ height: '100%' }}>
          <Col flex="auto">
            <div 
              className="platform-logo"
              onClick={() => navigate('/')}
              style={{ cursor: 'pointer' }}
            >
              <span style={{ 
                color: '#ffffff', 
                fontSize: '24px', 
                fontWeight: 'bold',
                letterSpacing: '2px'
              }}>
                CASI
              </span>
            </div>
            <Menu
              theme="dark"
              mode="horizontal"
              selectedKeys={[location.pathname]}
              items={filteredMenuItems}
              onClick={handleMenuClick}
              style={{ 
                background: 'transparent',
                border: 'none',
                display: 'inline-block',
                lineHeight: '64px',
              }}
              className="desktop-menu"
            />
            <Button
              type="text"
              icon={<MenuOutlined />}
              onClick={() => setMobileMenuVisible(true)}
              className="mobile-menu-trigger"
              style={{ color: 'white', display: 'none' }}
            />
          </Col>
          <Col>
            <Space>
              <span className="user-info">
                欢迎，{user?.username}
              </span>
              <Dropdown
                menu={{ items: userMenuItems }}
                placement="bottomRight"
                arrow
              >
                <Avatar 
                  style={{ backgroundColor: '#1890ff', cursor: 'pointer' }}
                  icon={<UserOutlined />}
                />
              </Dropdown>
            </Space>
          </Col>
        </Row>
      </Header>

      {/* 移动端抽屉菜单 */}
      <Drawer
        title="导航菜单"
        placement="left"
        onClose={() => setMobileMenuVisible(false)}
        open={mobileMenuVisible}
        styles={{ body: { padding: 0 } }}
      >
        <Menu
          mode="inline"
          selectedKeys={[location.pathname]}
          items={filteredMenuItems}
          onClick={(info) => {
            handleMenuClick(info);
            setMobileMenuVisible(false);
          }}
        />
      </Drawer>

      <Content
        className="main-content"
        style={{
          marginTop: '64px',
          padding: location.pathname === '/' ? '0' : '24px',
          minHeight: 'calc(100vh - 64px)',
          background: location.pathname === '/' ? 'transparent' : colorBgContainer,
        }}
      >
        <Outlet />
      </Content>
    </AntLayout>
  );
};

export default Layout;

```

修复 ComponentSearch.tsx 中的类型错误：


```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  radiationLevel?: string;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
                <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
                    <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
                    <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
                    <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                      {selectedComponent.qualityLevel}
                    </Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
                </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
                      {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
                      ))}
                    </Space>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                      </div>
                    </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
                    <Table
                      size="small"
                      columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                        { title: '库存', dataIndex: 'stock', key: 'stock' },
                        { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                      ]}
                      dataSource={selectedComponent.suppliers}
                      pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

查看 ComponentCompare.tsx 的类型定义：


修复 ComponentCompare.tsx 中的类型问题：


```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  Spin,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  PlusOutlined,
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)} size="small">
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                  style={{
                    '.group-row': {
                      background: '#fafafa',
                      fontWeight: 600
                    }
                  }}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

继续修复 ComponentCompare.tsx 中的其他问题：


```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  Spin,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  PlusOutlined,
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)}>
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                  style={{
                    '.group-row': {
                      background: '#fafafa',
                      fontWeight: 600
                    }
                  }}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  Spin,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  PlusOutlined,
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)}>
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  PlusOutlined,
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)}>
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)}>
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Card, 
  Table, 
  Button, 
  Select, 
  Space, 
  Tooltip,
  Tag,
  Divider,
  Row,
  Col,
  Statistic,
  Alert,
  Empty,
  message,
  Modal,
  Input,
  Typography,
  Progress
} from 'antd';
import {
  DeleteOutlined,
  ExportOutlined,
  BarChartOutlined,
  InfoCircleOutlined,
  SwapOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Text, Title } = Typography;
const { Search } = Input;

// 器件数据接口
interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  category: string;
  subcategory: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  package: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  price: number;
  availability: 'in_stock' | 'limited' | 'out_of_stock';
  datasheet?: string;
  supplier: string;
  leadTime: number; // 交货时间（天）
  moq: number; // 最小起订量
}

// 比对结果评分
interface ComparisonScore {
  overall: number;
  performance: number;
  reliability: number;
  cost: number;
  availability: number;
}

// 关键参数配置
const CRITICAL_PARAMETERS = [
  { key: 'voltage.min', label: '最小工作电压', unit: 'V', type: 'numeric' },
  { key: 'voltage.max', label: '最大工作电压', unit: 'V', type: 'numeric' },
  { key: 'operatingTemp.min', label: '最低工作温度', unit: '°C', type: 'numeric' },
  { key: 'operatingTemp.max', label: '最高工作温度', unit: '°C', type: 'numeric' },
  { key: 'specifications.power', label: '功耗', unit: 'W', type: 'numeric' },
  { key: 'specifications.frequency', label: '工作频率', unit: 'MHz', type: 'numeric' },
  { key: 'specifications.accuracy', label: '精度', unit: '%', type: 'numeric' },
  { key: 'price', label: '单价', unit: '¥', type: 'currency' }
];

const ComponentCompare: React.FC = () => {
  const [selectedComponents, setSelectedComponents] = useState<Component[]>([]);
  const [availableComponents, setAvailableComponents] = useState<Component[]>([]);
  const [loading, setLoading] = useState(false);
  const [searchLoading, setSearchLoading] = useState(false);
  const [comparisonScores, setComparisonScores] = useState<Record<string, ComparisonScore>>({});
  const [showAdvanced, setShowAdvanced] = useState(false);
  const [exportModalVisible, setExportModalVisible] = useState(false);

  // 模拟器件数据
  const mockComponents: Component[] = [
    {
      id: '1',
      partNumber: 'TMS320F28377D',
      manufacturer: 'Texas Instruments',
      category: 'Microcontrollers',
      subcategory: 'DSP Controllers',
      description: '32位双核实时控制单元',
      specifications: {
        cores: 2,
        clockSpeed: 200,
        flash: 1024,
        ram: 204,
        adc: 16,
        power: 1.2,
        frequency: 200,
        accuracy: 0.1
      },
      qualityLevel: 'aerospace',
      package: 'LQFP-176',
      operatingTemp: { min: -40, max: 125 },
      voltage: { min: 3.0, max: 3.6 },
      price: 28.50,
      availability: 'in_stock',
      supplier: 'TI官方',
      leadTime: 7,
      moq: 100
    },
    {
      id: '2',
      partNumber: 'STM32F767ZI',
      manufacturer: 'STMicroelectronics',
      category: 'Microcontrollers',
      subcategory: 'ARM Cortex-M7',
      description: '高性能ARM Cortex-M7 MCU',
      specifications: {
        cores: 1,
        clockSpeed: 216,
        flash: 2048,
        ram: 512,
        adc: 24,
        power: 2.1,
        frequency: 216,
        accuracy: 0.15
      },
      qualityLevel: 'industrial',
      package: 'LQFP-144',
      operatingTemp: { min: -40, max: 85 },
      voltage: { min: 1.7, max: 3.6 },
      price: 15.20,
      availability: 'limited',
      supplier: 'ST官方',
      leadTime: 14,
      moq: 50
    },
    {
      id: '3',
      partNumber: 'ADSP-BF607',
      manufacturer: 'Analog Devices',
      category: 'Microcontrollers',
      subcategory: 'Blackfin DSP',
      description: '双核Blackfin DSP处理器',
      specifications: {
        cores: 2,
        clockSpeed: 500,
        flash: 0,
        ram: 512,
        adc: 0,
        power: 3.5,
        frequency: 500,
        accuracy: 0.05
      },
      qualityLevel: 'military',
      package: 'LQFP-176',
      operatingTemp: { min: -55, max: 125 },
      voltage: { min: 1.2, max: 1.32 },
      price: 45.80,
      availability: 'in_stock',
      supplier: 'ADI官方',
      leadTime: 21,
      moq: 25
    }
  ];

  useEffect(() => {
    setAvailableComponents(mockComponents);
  }, []);

  // 计算比对评分
  const calculateScore = (component: Component): ComparisonScore => {
    // 简化的评分算法
    const performanceScore = Math.min(100, (component.specifications.clockSpeed || 0) / 5);
    const reliabilityScore = component.qualityLevel === 'aerospace' ? 95 : 
                           component.qualityLevel === 'military' ? 85 :
                           component.qualityLevel === 'industrial' ? 75 : 65;
    const costScore = Math.max(0, 100 - component.price * 2);
    const availabilityScore = component.availability === 'in_stock' ? 90 : 
                             component.availability === 'limited' ? 60 : 30;
    
    const overallScore = (performanceScore + reliabilityScore + costScore + availabilityScore) / 4;
    
    return {
      overall: Math.round(overallScore),
      performance: Math.round(performanceScore),
      reliability: Math.round(reliabilityScore),
      cost: Math.round(costScore),
      availability: Math.round(availabilityScore)
    };
  };

  // 搜索器件
  const handleSearch = async (searchTerm: string) => {
    if (!searchTerm.trim()) return;
    
    setSearchLoading(true);
    try {
      // 模拟API调用
      await new Promise(resolve => setTimeout(resolve, 500));
      
      const filteredComponents = mockComponents.filter(comp => 
        comp.partNumber.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.manufacturer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        comp.description.toLowerCase().includes(searchTerm.toLowerCase())
      );
      
      setAvailableComponents(filteredComponents);
    } catch (error) {
      message.error('搜索失败，请稍后重试');
    } finally {
      setSearchLoading(false);
    }
  };

  // 添加器件到比对列表
  const addToComparison = (component: Component) => {
    if (selectedComponents.length >= 5) {
      message.warning('最多只能同时比对5个器件');
      return;
    }
    
    if (selectedComponents.find(c => c.id === component.id)) {
      message.warning('该器件已在比对列表中');
      return;
    }
    
    const newComponents = [...selectedComponents, component];
    setSelectedComponents(newComponents);
    
    // 计算评分
    const scores = { ...comparisonScores };
    scores[component.id] = calculateScore(component);
    setComparisonScores(scores);
    
    message.success(`已添加 ${component.partNumber} 到比对列表`);
  };

  // 从比对列表移除器件
  const removeFromComparison = (componentId: string) => {
    setSelectedComponents(prev => prev.filter(c => c.id !== componentId));
    const newScores = { ...comparisonScores };
    delete newScores[componentId];
    setComparisonScores(newScores);
  };

  // 导出比对结果
  const exportComparison = (format: 'excel' | 'pdf' | 'csv') => {
    setLoading(true);
    setTimeout(() => {
      setLoading(false);
      setExportModalVisible(false);
      message.success(`比对结果已导出为 ${format.toUpperCase()} 格式`);
    }, 2000);
  };

  // 获取参数值
  const getParameterValue = (component: Component, paramKey: string) => {
    const keys = paramKey.split('.');
    let value = component as any;
    for (const key of keys) {
      value = value?.[key];
    }
    return value;
  };

  // 格式化参数值
  const formatValue = (value: any, type: string, unit: string) => {
    if (value === undefined || value === null) return '-';
    
    if (type === 'currency') {
      return `¥${value.toFixed(2)}`;
    }
    
    if (typeof value === 'number') {
      return `${value}${unit}`;
    }
    
    return String(value);
  };

  // 获取质量等级颜色
  const getQualityColor = (level: string) => {
    switch (level) {
      case 'aerospace': return 'gold';
      case 'military': return 'red';
      case 'industrial': return 'blue';
      case 'commercial': return 'green';
      default: return 'default';
    }
  };

  // 获取库存状态
  const getAvailabilityStatus = (availability: string) => {
    switch (availability) {
      case 'in_stock':
        return <Tag color="green" icon={<CheckCircleOutlined />}>现货</Tag>;
      case 'limited':
        return <Tag color="orange" icon={<InfoCircleOutlined />}>库存紧张</Tag>;
      case 'out_of_stock':
        return <Tag color="red" icon={<CloseCircleOutlined />}>缺货</Tag>;
      default:
        return <Tag>未知</Tag>;
    }
  };

  // 比对表格列定义
  const compareColumns: ColumnsType<any> = [
    {
      title: '参数',
      dataIndex: 'parameter',
      key: 'parameter',
      width: 200,
      fixed: 'left',
      render: (text: string, record: any) => (
        <Space>
          <Text strong>{text}</Text>
          {record.critical && (
            <Tooltip title="关键参数">
              <InfoCircleOutlined style={{ color: '#ff7875' }} />
            </Tooltip>
          )}
        </Space>
      )
    },
    ...selectedComponents.map(component => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div>{component.partNumber}</div>
          <Text type="secondary" style={{ fontSize: '12px' }}>
            {component.manufacturer}
          </Text>
          <div style={{ marginTop: 4 }}>
            <Progress
              percent={comparisonScores[component.id]?.overall || 0}
              size="small"
              format={(percent: number | undefined) => `${percent}分`}
            />
          </div>
        </div>
      ),
      dataIndex: component.id,
      key: component.id,
      width: 200,
      align: 'center' as const,
      render: (value: any, record: any) => {
        if (record.key === 'actions') {
          return (
            <Button
              type="text"
              danger
              icon={<DeleteOutlined />}
              onClick={() => removeFromComparison(component.id)}
            >
              移除
            </Button>
          );
        }
        
        if (record.key === 'score') {
          const score = comparisonScores[component.id];
          return score ? (
            <Space direction="vertical" size={2}>
              <Text>综合: {score.overall}</Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                性能:{score.performance} 可靠:{score.reliability}
              </Text>
              <Text type="secondary" style={{ fontSize: '10px' }}>
                成本:{score.cost} 供货:{score.availability}
              </Text>
            </Space>
          ) : '-';
        }
        
        return value || '-';
      }
    }))
  ];

  // 构建比对数据
  const buildCompareData = () => {
    const baseRows = [
      { key: 'basic', parameter: '基本信息', isGroup: true },
      { key: 'category', parameter: '器件分类' },
      { key: 'subcategory', parameter: '子分类' },
      { key: 'description', parameter: '描述' },
      { key: 'package', parameter: '封装' },
      { key: 'qualityLevel', parameter: '质量等级' },
      
      { key: 'performance', parameter: '性能参数', isGroup: true },
      ...CRITICAL_PARAMETERS.map(param => ({
        key: param.key,
        parameter: param.label,
        unit: param.unit,
        critical: true
      })),
      
      { key: 'supply', parameter: '供应信息', isGroup: true },
      { key: 'supplier', parameter: '供应商' },
      { key: 'availability', parameter: '库存状态' },
      { key: 'leadTime', parameter: '交货时间' },
      { key: 'moq', parameter: '最小起订量' },
      
      { key: 'score', parameter: '评分', isGroup: true },
      { key: 'actions', parameter: '操作' }
    ];

    return baseRows.map(row => {
      const dataRow: any = {
        key: row.key,
        parameter: row.parameter,
        isGroup: 'isGroup' in row ? row.isGroup : false
      };

      if ('isGroup' in row && row.isGroup) {
        return dataRow;
      }

      selectedComponents.forEach(component => {
        let value = getParameterValue(component, row.key);
        
        // 特殊处理
        if (row.key === 'qualityLevel') {
          value = (
            <Tag color={getQualityColor(value)}>
              {value === 'aerospace' ? '宇航级' :
               value === 'military' ? '军用级' :
               value === 'industrial' ? '工业级' : '商业级'}
            </Tag>
          );
        } else if (row.key === 'availability') {
          value = getAvailabilityStatus(value);
        } else if (row.key === 'leadTime') {
          value = `${value}天`;
        } else if (row.key === 'moq') {
          value = `${value}pcs`;
        } else if ('unit' in row && row.unit) {
          value = formatValue(value, row.key.includes('price') ? 'currency' : 'numeric', row.unit);
        }
        
        dataRow[component.id] = value;
      });

      return dataRow;
    });
  };

  return (
    <div style={{ padding: '24px', background: '#f0f2f5', minHeight: '100vh' }}>
      {/* 页面标题 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col span={24}>
          <Card>
            <Space align="start" style={{ width: '100%', justifyContent: 'space-between' }}>
              <div>
                <Title level={2} style={{ margin: 0 }}>
                  <BarChartOutlined /> 器件参数比对
                </Title>
                <Text type="secondary">
                  多维度器件参数对比分析，支持最多5个器件同时比较
                </Text>
              </div>
              <Space>
                <Button
                  type="primary"
                  icon={<ExportOutlined />}
                  onClick={() => setExportModalVisible(true)}
                  disabled={selectedComponents.length === 0}
                >
                  导出比对结果
                </Button>
                <Button
                  icon={<SwapOutlined />}
                  onClick={() => setShowAdvanced(!showAdvanced)}
                >
                  {showAdvanced ? '简化视图' : '高级视图'}
                </Button>
              </Space>
            </Space>
          </Card>
        </Col>
      </Row>

      <Row gutter={[16, 16]}>
        {/* 器件搜索区域 */}
        <Col span={8}>
          <Card title="器件搜索" style={{ height: 'fit-content' }}>
            <Space direction="vertical" style={{ width: '100%' }} size="middle">
              <Search
                placeholder="输入型号、厂商或描述关键词"
                allowClear
                enterButton="搜索"
                size="large"
                onSearch={handleSearch}
                loading={searchLoading}
              />
              
              <div style={{ maxHeight: '400px', overflowY: 'auto' }}>
                {availableComponents.length > 0 ? (
                  <Space direction="vertical" style={{ width: '100%' }} size="small">
                    {availableComponents.map(component => (
                      <Card
                        key={component.id}
                        size="small"
                        hoverable
                        style={{ 
                          cursor: 'pointer',
                          border: selectedComponents.find(c => c.id === component.id) 
                            ? '2px solid #1890ff' : '1px solid #d9d9d9'
                        }}
                        onClick={() => addToComparison(component)}
                      >
                        <Space direction="vertical" size={2} style={{ width: '100%' }}>
                          <Text strong>{component.partNumber}</Text>
                          <Text type="secondary" style={{ fontSize: '12px' }}>
                            {component.manufacturer}
                          </Text>
                          <Text style={{ fontSize: '12px' }}>
                            {component.description}
                          </Text>
                          <Space size={4}>
                            <Tag color={getQualityColor(component.qualityLevel)}>
                              {component.qualityLevel === 'aerospace' ? '宇航级' :
                               component.qualityLevel === 'military' ? '军用级' :
                               component.qualityLevel === 'industrial' ? '工业级' : '商业级'}
                            </Tag>
                            {getAvailabilityStatus(component.availability)}
                          </Space>
                        </Space>
                      </Card>
                    ))}
                  </Space>
                ) : (
                  <Empty description="暂无匹配的器件" />
                )}
              </div>
            </Space>
          </Card>
        </Col>

        {/* 比对结果区域 */}
        <Col span={16}>
          <Card title={`器件比对 (${selectedComponents.length}/5)`}>
            {selectedComponents.length === 0 ? (
              <Empty
                description="请在左侧搜索并选择要比对的器件"
                image={Empty.PRESENTED_IMAGE_SIMPLE}
              />
            ) : selectedComponents.length === 1 ? (
              <Alert
                message="建议添加更多器件进行比较"
                description="至少选择2个器件才能进行有效比对分析"
                type="info"
                showIcon
              />
            ) : (
              <div>
                {/* 快速统计 */}
                <Row gutter={16} style={{ marginBottom: 16 }}>
                  <Col span={6}>
                    <Statistic
                      title="比对器件数"
                      value={selectedComponents.length}
                      suffix="/ 5"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="平均评分"
                      value={Object.values(comparisonScores).reduce((acc, score) => acc + score.overall, 0) / selectedComponents.length || 0}
                      precision={1}
                      suffix="分"
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="现货器件"
                      value={selectedComponents.filter(c => c.availability === 'in_stock').length}
                      suffix={`/ ${selectedComponents.length}`}
                    />
                  </Col>
                  <Col span={6}>
                    <Statistic
                      title="价格范围"
                      value={`¥${Math.min(...selectedComponents.map(c => c.price)).toFixed(2)} - ¥${Math.max(...selectedComponents.map(c => c.price)).toFixed(2)}`}
                    />
                  </Col>
                </Row>

                <Divider />

                {/* 比对表格 */}
                <Table
                  columns={compareColumns}
                  dataSource={buildCompareData()}
                  pagination={false}
                  scroll={{ x: 'max-content' }}
                  size="small"
                  rowClassName={(record) => record.isGroup ? 'group-row' : ''}
                />
              </div>
            )}
          </Card>
        </Col>
      </Row>

      {/* 导出对话框 */}
      <Modal
        title="导出比对结果"
        open={exportModalVisible}
        onCancel={() => setExportModalVisible(false)}
        footer={null}
        width={400}
      >
        <Space direction="vertical" style={{ width: '100%' }} size="middle">
          <Text>选择导出格式：</Text>
          <Space direction="vertical" style={{ width: '100%' }}>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('excel')}
            >
              Excel 格式 (.xlsx)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('pdf')}
            >
              PDF 格式 (.pdf)
            </Button>
            <Button
              block
              loading={loading}
              onClick={() => exportComparison('csv')}
            >
              CSV 格式 (.csv)
            </Button>
          </Space>
        </Space>
      </Modal>

      <style>{`
        .group-row {
          background: #fafafa !important;
          font-weight: 600;
        }
        .group-row td {
          border-bottom: 2px solid #e8e8e8 !important;
        }
      `}</style>
    </div>
  );
};

export default ComponentCompare;

```

继续修复其他文件中的错误。先处理未使用的导入，再处理类型错误：


```typescriptreact
import React, { useState, useEffect, useMemo } from 'react';
import { Modal, Table, Tag, Spin, message, Button, Space, Typography } from 'antd';
import { SwapOutlined } from '@ant-design/icons';
import httpClient from '@/utils/httpClient';

const { Text } = Typography;

interface ComponentCompareModalProps {
  visible: boolean;
  componentIds: string[];
  onClose: () => void;
}

interface ComponentInfo {
  component_id: string;
  part_number: string;
  manufacturer_name: string;
  part_type: string;
  quality_name: string;
  obsolescence_type: string;
  has_stock: string;
  family_path: string;
}

interface ParameterValue {
  name: string;
  value: string;
  numericValue?: number;
}

interface ComparisonData {
  components: ComponentInfo[];
  parameters: Array<{
    key: string;
    [key: string]: any; // component_0, component_1, etc.
  }>;
}

const ComponentCompareModal: React.FC<ComponentCompareModalProps> = ({
  visible,
  componentIds,
  onClose,
}) => {
  const [loading, setLoading] = useState(false);
  const [comparisonData, setComparisonData] = useState<ComparisonData | null>(null);

  useEffect(() => {
    if (visible && componentIds.length >= 2) {
      fetchComparisonData();
    }
  }, [visible, componentIds]);

  const fetchComparisonData = async () => {
    setLoading(true);
    try {
      const data = await httpClient.post<ComparisonData, { componentIds: string[] }>(
        '/api/doeeet/components/compare',
        { componentIds },
        { timeoutMs: 15000, retries: 2, retryDelayMs: 400, suppressErrorMessage: true }
      );
      if (data) {
        setComparisonData(data);
      } else {
        message.error('获取对比数据失败');
      }
    } catch (error: any) {
      console.error('对比组件失败:', error);
      message.error(error?.message || '对比组件失败，请稍后重试');
    } finally {
      setLoading(false);
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'Active':
        return 'green';
      case 'Obsolete':
        return 'red';
      case 'Last Time Buy':
        return 'orange';
      case 'Risk':
        return 'volcano';
      default:
        return 'default';
    }
  };

  // 基本信息列定义
  const basicInfoColumns = [
    {
      title: '属性',
      dataIndex: 'label',
      key: 'label',
      width: 150,
      fixed: 'left' as const,
      render: (text: string) => <Text strong>{text}</Text>,
    },
    ...( comparisonData?.components.map((comp, index) => ({
      title: (
        <div style={{ textAlign: 'center' }}>
          <div style={{ fontWeight: 'bold', color: '#1890ff' }}>
            {comp.part_number}
          </div>
          <div style={{ fontSize: '12px', color: '#666' }}>
            {comp.manufacturer_name}
          </div>
        </div>
      ),
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 200,
    })) || []),
  ];

  const basicInfoData = comparisonData ? [
    {
      key: 'part_type',
      label: '产品类型',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          comp.part_type || '-',
        ])
      ),
    },
    {
      key: 'family_path',
      label: '分类',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => {
          try {
            const familyPath = JSON.parse(comp.family_path.replace(/'/g, '"'));
            return [`component_${idx}`, Array.isArray(familyPath) ? familyPath.join(' > ') : comp.family_path];
          } catch (e) {
            return [`component_${idx}`, comp.family_path];
          }
        })
      ),
    },
    {
      key: 'quality_name',
      label: '质量等级',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color="blue">{comp.quality_name || '-'}</Tag>,
        ])
      ),
    },
    {
      key: 'obsolescence_type',
      label: '淘汰状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={getStatusColor(comp.obsolescence_type)}>
            {comp.obsolescence_type}
          </Tag>,
        ])
      ),
    },
    {
      key: 'has_stock',
      label: '库存状态',
      ...Object.fromEntries(
        comparisonData.components.map((comp, idx) => [
          `component_${idx}`,
          <Tag key={idx} color={comp.has_stock === 'Yes' ? 'green' : 'default'}>
            {comp.has_stock === 'Yes' ? '有库存' : '无库存'}
          </Tag>,
        ])
      ),
    },
  ] : [];

  const getParameterDisplayName = (record: any) => {
    const componentCount = comparisonData?.components.length ?? 0;
    for (let i = 0; i < componentCount; i += 1) {
      const param = record[`component_${i}`] as ParameterValue | undefined;
      const candidate = param?.name?.trim();
      if (candidate && candidate.toLowerCase() !== 'unknown') {
        return candidate;
      }
    }

    const fallback = record?.name?.trim();
    if (fallback && fallback.toLowerCase() !== 'unknown') {
      return fallback;
    }

    return '未命名参数';
  };

  // 参数对比列定义
  const parameterColumns = [
    {
      title: '参数名称',
      dataIndex: 'name',
      key: 'name',
      width: 200,
      fixed: 'left' as const,
      render: (_text: string, record: any) => (
        <div>
          <Text strong>{getParameterDisplayName(record)}</Text>
        </div>
      ),
    },
    ...(comparisonData?.components.map((comp, index) => ({
      title: comp.part_number,
      dataIndex: `component_${index}`,
      key: `component_${index}`,
      width: 180,
      render: (paramValue: ParameterValue) => {
        if (!paramValue || paramValue.value === '-') {
          return <Text type="secondary">-</Text>;
        }
        
        // 尝试解析数组值
        try {
          const parsed = JSON.parse(paramValue.value.replace(/'/g, '"'));
          if (Array.isArray(parsed)) {
            return parsed.join(', ');
          }
        } catch (e) {
          // 不是JSON数组，直接显示
        }
        
        return paramValue.value;
      },
    })) || []),
  ];

  const filteredParameters = useMemo(() => {
    if (!comparisonData?.parameters || comparisonData.parameters.length === 0) {
      return [];
    }

    const componentCount = comparisonData.components.length;

    return comparisonData.parameters.filter(param => {
      if (!param) {
        return false;
      }

      const hasMeaningfulName = Array.from({ length: componentCount }).some((_, idx) => {
        const value = param[`component_${idx}`] as ParameterValue | undefined;
        const candidate = value?.name?.trim();
        return !!candidate && candidate.toLowerCase() !== 'unknown';
      });

      const fallback = (param as any)?.name?.trim();

      if (!hasMeaningfulName) {
        if (!fallback) {
          return false;
        }
        return fallback.toLowerCase() !== 'unknown';
      }

      return true;
    });
  }, [comparisonData]);

  return (
    <Modal
      title={
        <Space>
          <SwapOutlined style={{ color: '#1890ff' }} />
          <span>组件对比</span>
          <Text type="secondary">({componentIds.length}个组件)</Text>
        </Space>
      }
      open={visible}
      onCancel={onClose}
      footer={[
        <Button key="close" onClick={onClose}>
          关闭
        </Button>,
      ]}
      width="90%"
      style={{ top: 20 }}
      bodyStyle={{ maxHeight: 'calc(100vh - 200px)', overflowY: 'auto' }}
    >
      {loading ? (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Spin size="large" tip="加载对比数据中..." />
        </div>
      ) : comparisonData ? (
        <Space direction="vertical" style={{ width: '100%' }} size="large">
          {/* 基本信息对比 */}
          <div>
            <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              基本信息对比
            </Text>
            <Table
              columns={basicInfoColumns}
              dataSource={basicInfoData}
              pagination={false}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
            />
          </div>

          {/* 参数对比 */}
          <div>
                <Text strong style={{ fontSize: '16px', marginBottom: '12px', display: 'block' }}>
              参数对比 ({filteredParameters.length}个参数)
            </Text>
            <Table
              columns={parameterColumns}
              dataSource={filteredParameters}
              pagination={{ pageSize: 20 }}
              size="small"
              bordered
              scroll={{ x: 'max-content' }}
              rowKey="key"
            />
          </div>
        </Space>
      ) : (
        <div style={{ textAlign: 'center', padding: '50px 0' }}>
          <Text type="secondary">暂无对比数据</Text>
        </div>
      )}
    </Modal>
  );
};

export default ComponentCompareModal;


```

修复 CounterfeitDetection.tsx 中的问题：


```typescriptreact
import React, { useState, useEffect } from 'react';
import { 
  Card, 
  Table, 
  Input, 
  Button, 
  Space, 
  Select, 
  Tag, 
  Modal,
  Form,
  message,
  Row,
  Col,
  Descriptions,
  Upload,
  Image,
  Alert,
  Statistic,
  Progress,
  Timeline
} from 'antd';
import { 
  SearchOutlined, 
  EyeOutlined, 
  WarningOutlined,
  CameraOutlined,
  SafetyOutlined,
  ExclamationCircleOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  FileImageOutlined,
  FileTextOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { TextArea } = Input;

interface CounterfeitRecord {
  id: string;
  partNumber: string;
  manufacturer: string;
  reportDate: string;
  reportedBy: string;
  riskLevel: 'high' | 'medium' | 'low';
  status: 'confirmed' | 'investigating' | 'resolved';
  category: string;
  description: string;
  identificationMethod: string;
  affectedBatches: string[];
  images: string[];
  countermeasures: string;
}

interface DetectionResult {
  confidence: number;
  riskFactors: string[];
  recommendations: string[];
}

const CounterfeitDetection: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<CounterfeitRecord[]>([]);
  const [searchText, setSearchText] = useState('');
  const [selectedRiskLevel, setSelectedRiskLevel] = useState<string>('all');
  const [selectedStatus, setSelectedStatus] = useState<string>('all');
  const [detailVisible, setDetailVisible] = useState(false);
  const [reportVisible, setReportVisible] = useState(false);
  const [detectVisible, setDetectVisible] = useState(false);
  const [selectedRecord, setSelectedRecord] = useState<CounterfeitRecord | null>(null);
  const [detectionResult, setDetectionResult] = useState<DetectionResult | null>(null);
  const [form] = Form.useForm();
  const [detectForm] = Form.useForm();

  // 模拟数据
  const mockData: CounterfeitRecord[] = [
    {
      id: '1',
      partNumber: 'LM358N',
      manufacturer: '德州仪器',
      reportDate: '2023-11-15',
      reportedBy: '航天某院',
      riskLevel: 'high',
      status: 'confirmed',
      category: '模拟集成电路',
      description: '发现批次标识异常，芯片表面处理不一致，电气特性偏差较大',
      identificationMethod: '外观检查 + 电气测试 + X射线检查',
      affectedBatches: ['2023001', '2023002', '2023005'],
      images: ['/images/counterfeit1.jpg', '/images/counterfeit1_xray.jpg'],
      countermeasures: '已通知相关单位停止使用，联系正规渠道重新采购'
    },
    {
      id: '2',
      partNumber: 'MAX232CPE',
      manufacturer: '美信',
      reportDate: '2023-10-28',
      reportedBy: '质检中心',
      riskLevel: 'medium',
      status: 'investigating',
      category: '接口电路',
      description: '包装标识字体异常，但电气性能暂未发现明显问题',
      identificationMethod: '包装分析 + 标识对比',
      affectedBatches: ['2023M10'],
      images: ['/images/counterfeit2.jpg'],
      countermeasures: '正在进行详细检测，暂时隔离相关批次'
    },
    {
      id: '3',
      partNumber: 'AD8066ARZ',
      manufacturer: '亚德诺',
      reportDate: '2023-09-20',
      reportedBy: '供应商',
      riskLevel: 'low',
      status: 'resolved',
      category: '模拟集成电路',
      description: '供应商主动上报疑似假冒产品，经检测确认为正品',
      identificationMethod: '全面检测',
      affectedBatches: ['2023AD08'],
      images: ['/images/counterfeit3.jpg'],
      countermeasures: '确认为正品，已解除隔离'
    }
  ];

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      setData(mockData);
    } catch (error) {
      message.error('获取数据失败');
    } finally {
      setLoading(false);
    }
  };

  const getRiskLevelColor = (level: string) => {
    switch (level) {
      case 'high': return 'red';
      case 'medium': return 'orange';
      case 'low': return 'green';
      default: return 'default';
    }
  };

  const getRiskLevelText = (level: string) => {
    switch (level) {
      case 'high': return '高风险';
      case 'medium': return '中风险';
      case 'low': return '低风险';
      default: return level;
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'confirmed': return 'red';
      case 'investigating': return 'orange';
      case 'resolved': return 'green';
      default: return 'default';
    }
  };

  const getStatusText = (status: string) => {
    switch (status) {
      case 'confirmed': return '已确认';
      case 'investigating': return '调查中';
      case 'resolved': return '已解决';
      default: return status;
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'confirmed': return <CloseCircleOutlined />;
      case 'investigating': return <ExclamationCircleOutlined />;
      case 'resolved': return <CheckCircleOutlined />;
      default: return null;
    }
  };

  const handleViewDetail = (record: CounterfeitRecord) => {
    setSelectedRecord(record);
    setDetailVisible(true);
  };

  const handleReport = () => {
    form.resetFields();
    setReportVisible(true);
  };

  const handleDetect = () => {
    detectForm.resetFields();
    setDetectionResult(null);
    setDetectVisible(true);
  };

  const handleSubmitReport = async (values: any) => {
    try {
      console.log('提交举报:', values);
      message.success('举报提交成功，我们将尽快处理');
      setReportVisible(false);
      fetchData();
    } catch (error) {
      message.error('提交失败');
    }
  };

  const handleAIDetection = async () => {
    try {
      setLoading(true);
      // 模拟AI检测
      await new Promise(resolve => setTimeout(resolve, 3000));
      
      const mockResult: DetectionResult = {
        confidence: 85,
        riskFactors: [
          '包装字体与正品存在差异',
          '芯片表面处理工艺不一致',
          '引脚镀层颜色异常',
          '标识位置偏移'
        ],
        recommendations: [
          '建议进行X射线检查',
          '进行电气性能详细测试',
          '对比正品样本',
          '联系制造商验证'
        ]
      };
      
      setDetectionResult(mockResult);
      message.success('AI检测完成');
    } catch (error) {
      message.error('检测失败');
    } finally {
      setLoading(false);
    }
  };

  const columns: ColumnsType<CounterfeitRecord> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text) => <span style={{ fontWeight: 'bold', color: '#1890ff' }}>{text}</span>
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '报告日期',
      dataIndex: 'reportDate',
      key: 'reportDate',
      width: 120,
    },
    {
      title: '报告单位',
      dataIndex: 'reportedBy',
      key: 'reportedBy',
      width: 120,
    },
    {
      title: '风险等级',
      dataIndex: 'riskLevel',
      key: 'riskLevel',
      width: 100,
      render: (level) => (
        <Tag color={getRiskLevelColor(level)} icon={<WarningOutlined />}>
          {getRiskLevelText(level)}
        </Tag>
      )
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      width: 100,
      render: (status) => (
        <Tag color={getStatusColor(status)} icon={getStatusIcon(status)}>
          {getStatusText(status)}
        </Tag>
      )
    },
    {
      title: '识别方法',
      dataIndex: 'identificationMethod',
      key: 'identificationMethod',
      ellipsis: true,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      render: (_, record) => (
        <Space size="small">
          <Button 
            type="link" 
            icon={<EyeOutlined />} 
            onClick={() => handleViewDetail(record)}
            size="small"
          >
            详情
          </Button>
        </Space>
      ),
    },
  ];

  const filteredData = data.filter(item => {
    const matchesSearch = 
      item.partNumber.toLowerCase().includes(searchText.toLowerCase()) ||
      item.manufacturer.toLowerCase().includes(searchText.toLowerCase());
    const matchesRiskLevel = selectedRiskLevel === 'all' || item.riskLevel === selectedRiskLevel;
    const matchesStatus = selectedStatus === 'all' || item.status === selectedStatus;
    
    return matchesSearch && matchesRiskLevel && matchesStatus;
  });

  // 统计数据
  const stats = {
    total: data.length,
    confirmed: data.filter(item => item.status === 'confirmed').length,
    investigating: data.filter(item => item.status === 'investigating').length,
    resolved: data.filter(item => item.status === 'resolved').length,
    highRisk: data.filter(item => item.riskLevel === 'high').length,
  };

  return (
    <div style={{ padding: 24 }}>
      {/* 警告提示 */}
      <Alert
        message="假冒伪劣器件预警"
        description="发现疑似假冒伪劣器件时，请立即停止使用并及时举报。使用假冒器件可能导致系统故障和安全隐患。"
        type="warning"
        icon={<SafetyOutlined />}
        showIcon
        style={{ marginBottom: 24 }}
      />

      {/* 统计卡片 */}
      <Row gutter={16} style={{ marginBottom: 24 }}>
        <Col span={6}>
          <Card>
            <Statistic title="总记录数" value={stats.total} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="已确认假冒" value={stats.confirmed} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="调查中" value={stats.investigating} valueStyle={{ color: '#fa8c16' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="高风险" value={stats.highRisk} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
      </Row>

      <Card>
        <div style={{ marginBottom: 16 }}>
          <Row gutter={16}>
            <Col span={8}>
              <Input
                placeholder="搜索型号或制造商"
                prefix={<SearchOutlined />}
                value={searchText}
                onChange={(e) => setSearchText(e.target.value)}
              />
            </Col>
            <Col span={4}>
              <Select
                placeholder="风险等级"
                style={{ width: '100%' }}
                value={selectedRiskLevel}
                onChange={setSelectedRiskLevel}
              >
                <Option value="all">全部等级</Option>
                <Option value="high">高风险</Option>
                <Option value="medium">中风险</Option>
                <Option value="low">低风险</Option>
              </Select>
            </Col>
            <Col span={4}>
              <Select
                placeholder="状态"
                style={{ width: '100%' }}
                value={selectedStatus}
                onChange={setSelectedStatus}
              >
                <Option value="all">全部状态</Option>
                <Option value="confirmed">已确认</Option>
                <Option value="investigating">调查中</Option>
                <Option value="resolved">已解决</Option>
              </Select>
            </Col>
            <Col span={8}>
              <Space>
                <Button type="primary" danger icon={<FileTextOutlined />} onClick={handleReport}>
                  举报假冒
                </Button>
                <Button type="primary" icon={<CameraOutlined />} onClick={handleDetect}>
                  AI检测
                </Button>
                <Button onClick={fetchData}>
                  刷新
                </Button>
              </Space>
            </Col>
          </Row>
        </div>

        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          pagination={{
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total) => `共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="假冒伪劣记录详情"
        open={detailVisible}
        onCancel={() => setDetailVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetailVisible(false)}>
            关闭
          </Button>
        ]}
        width={900}
      >
        {selectedRecord && (
          <>
            <Descriptions column={2} bordered>
              <Descriptions.Item label="器件型号">{selectedRecord.partNumber}</Descriptions.Item>
              <Descriptions.Item label="制造商">{selectedRecord.manufacturer}</Descriptions.Item>
              <Descriptions.Item label="报告日期">{selectedRecord.reportDate}</Descriptions.Item>
              <Descriptions.Item label="报告单位">{selectedRecord.reportedBy}</Descriptions.Item>
              <Descriptions.Item label="风险等级">
                <Tag color={getRiskLevelColor(selectedRecord.riskLevel)} icon={<WarningOutlined />}>
                  {getRiskLevelText(selectedRecord.riskLevel)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="处理状态">
                <Tag color={getStatusColor(selectedRecord.status)} icon={getStatusIcon(selectedRecord.status)}>
                  {getStatusText(selectedRecord.status)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="产品类别">{selectedRecord.category}</Descriptions.Item>
              <Descriptions.Item label="识别方法">{selectedRecord.identificationMethod}</Descriptions.Item>
              <Descriptions.Item label="涉及批次" span={2}>
                {selectedRecord.affectedBatches.map(batch => (
                  <Tag key={batch} color="red">{batch}</Tag>
                ))}
              </Descriptions.Item>
              <Descriptions.Item label="问题描述" span={2}>
                {selectedRecord.description}
              </Descriptions.Item>
              <Descriptions.Item label="应对措施" span={2}>
                {selectedRecord.countermeasures}
              </Descriptions.Item>
            </Descriptions>

            {selectedRecord.images.length > 0 && (
              <>
                <h4 style={{ marginTop: 24, marginBottom: 16 }}>相关图片</h4>
                <Image.PreviewGroup>
                  <Row gutter={16}>
                    {selectedRecord.images.map((img, index) => (
                      <Col span={8} key={index}>
                        <Image
                          width="100%"
                          height={200}
                          src={img}
                          fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"
                        />
                      </Col>
                    ))}
                  </Row>
                </Image.PreviewGroup>
              </>
            )}
          </>
        )}
      </Modal>

      {/* 举报模态框 */}
      <Modal
        title="举报假冒伪劣器件"
        open={reportVisible}
        onCancel={() => setReportVisible(false)}
        onOk={() => form.submit()}
        width={600}
      >
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSubmitReport}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="partNumber"
                label="器件型号"
                rules={[{ required: true, message: '请输入器件型号' }]}
              >
                <Input placeholder="请输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="manufacturer"
                label="标称制造商"
                rules={[{ required: true, message: '请输入制造商' }]}
              >
                <Input placeholder="请输入制造商" />
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="riskLevel"
                label="风险等级评估"
                rules={[{ required: true, message: '请选择风险等级' }]}
              >
                <Select placeholder="请选择风险等级">
                  <Option value="high">高风险</Option>
                  <Option value="medium">中风险</Option>
                  <Option value="low">低风险</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="category"
                label="产品类别"
                rules={[{ required: true, message: '请选择产品类别' }]}
              >
                <Select placeholder="请选择产品类别">
                  <Option value="模拟集成电路">模拟集成电路</Option>
                  <Option value="数字集成电路">数字集成电路</Option>
                  <Option value="接口电路">接口电路</Option>
                  <Option value="电源管理">电源管理</Option>
                  <Option value="存储器">存储器</Option>
                  <Option value="分立器件">分立器件</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="identificationMethod"
            label="识别方法"
            rules={[{ required: true, message: '请输入识别方法' }]}
          >
            <Input placeholder="如：外观检查、电气测试、X射线检查等" />
          </Form.Item>

          <Form.Item
            name="description"
            label="问题描述"
            rules={[{ required: true, message: '请描述发现的问题' }]}
          >
            <TextArea rows={4} placeholder="请详细描述发现的异常情况" />
          </Form.Item>

          <Form.Item
            name="images"
            label="相关图片"
          >
            <Upload
              listType="picture-card"
              multiple
              beforeUpload={() => false}
            >
              <div>
                <FileImageOutlined />
                <div style={{ marginTop: 8 }}>上传图片</div>
              </div>
            </Upload>
          </Form.Item>
        </Form>
      </Modal>

      {/* AI检测模态框 */}
      <Modal
        title="AI智能检测"
        open={detectVisible}
        onCancel={() => setDetectVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetectVisible(false)}>
            关闭
          </Button>,
          <Button key="detect" type="primary" loading={loading} onClick={handleAIDetection}>
            开始检测
          </Button>
        ]}
        width={700}
      >
        <Form
          form={detectForm}
          layout="vertical"
        >
          <Form.Item
            name="images"
            label="上传器件图片"
            extra="请上传清晰的器件正面、背面及包装图片，支持多张图片同时上传"
          >
            <Upload.Dragger
              multiple
              listType="picture"
              beforeUpload={() => false}
              accept="image/*"
            >
              <p className="ant-upload-drag-icon">
                <CameraOutlined style={{ fontSize: 48, color: '#1890ff' }} />
              </p>
              <p className="ant-upload-text">点击或拖拽图片到此区域上传</p>
              <p className="ant-upload-hint">
                支持 JPG、PNG 格式，建议图片清晰度不低于 1024x768
              </p>
            </Upload.Dragger>
          </Form.Item>
        </Form>

        {detectionResult && (
          <div style={{ marginTop: 24 }}>
            <h4>检测结果</h4>
            <Card>
              <Row gutter={16}>
                <Col span={12}>
                  <Statistic
                    title="可信度评分"
                    value={detectionResult.confidence}
                    suffix="%"
                    valueStyle={{ 
                      color: detectionResult.confidence > 80 ? '#cf1322' : 
                             detectionResult.confidence > 60 ? '#fa8c16' : '#3f8600' 
                    }}
                  />
                </Col>
                <Col span={12}>
                  <Progress
                    type="circle"
                    percent={detectionResult.confidence}
                    status={detectionResult.confidence > 80 ? 'exception' : 'normal'}
                    width={80}
                  />
                </Col>
              </Row>
              
              <div style={{ marginTop: 16 }}>
                <h5>风险因素：</h5>
                <Timeline size="small">
                  {detectionResult.riskFactors.map((factor, index) => (
                    <Timeline.Item key={index} color="red">
                      {factor}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>

              <div style={{ marginTop: 16 }}>
                <h5>建议措施：</h5>
                <Timeline size="small">
                  {detectionResult.recommendations.map((rec, index) => (
                    <Timeline.Item key={index} color="blue">
                      {rec}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>
            </Card>
          </div>
        )}
      </Modal>
    </div>
  );
};

export default CounterfeitDetection;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import { 
  Card, 
  Table, 
  Input, 
  Button, 
  Space, 
  Select, 
  Tag, 
  Modal,
  Form,
  message,
  Row,
  Col,
  Descriptions,
  Upload,
  Image,
  Alert,
  Statistic,
  Progress,
  Timeline
} from 'antd';
import { 
  SearchOutlined, 
  EyeOutlined, 
  WarningOutlined,
  CameraOutlined,
  SafetyOutlined,
  ExclamationCircleOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  FileImageOutlined,
  FileTextOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { TextArea } = Input;

interface CounterfeitRecord {
  id: string;
  partNumber: string;
  manufacturer: string;
  reportDate: string;
  reportedBy: string;
  riskLevel: 'high' | 'medium' | 'low';
  status: 'confirmed' | 'investigating' | 'resolved';
  category: string;
  description: string;
  identificationMethod: string;
  affectedBatches: string[];
  images: string[];
  countermeasures: string;
}

interface DetectionResult {
  confidence: number;
  riskFactors: string[];
  recommendations: string[];
}

const CounterfeitDetection: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<CounterfeitRecord[]>([]);
  const [searchText, setSearchText] = useState('');
  const [selectedRiskLevel, setSelectedRiskLevel] = useState<string>('all');
  const [selectedStatus, setSelectedStatus] = useState<string>('all');
  const [detailVisible, setDetailVisible] = useState(false);
  const [reportVisible, setReportVisible] = useState(false);
  const [detectVisible, setDetectVisible] = useState(false);
  const [selectedRecord, setSelectedRecord] = useState<CounterfeitRecord | null>(null);
  const [detectionResult, setDetectionResult] = useState<DetectionResult | null>(null);
  const [form] = Form.useForm();
  const [detectForm] = Form.useForm();

  // 模拟数据
  const mockData: CounterfeitRecord[] = [
    {
      id: '1',
      partNumber: 'LM358N',
      manufacturer: '德州仪器',
      reportDate: '2023-11-15',
      reportedBy: '航天某院',
      riskLevel: 'high',
      status: 'confirmed',
      category: '模拟集成电路',
      description: '发现批次标识异常，芯片表面处理不一致，电气特性偏差较大',
      identificationMethod: '外观检查 + 电气测试 + X射线检查',
      affectedBatches: ['2023001', '2023002', '2023005'],
      images: ['/images/counterfeit1.jpg', '/images/counterfeit1_xray.jpg'],
      countermeasures: '已通知相关单位停止使用，联系正规渠道重新采购'
    },
    {
      id: '2',
      partNumber: 'MAX232CPE',
      manufacturer: '美信',
      reportDate: '2023-10-28',
      reportedBy: '质检中心',
      riskLevel: 'medium',
      status: 'investigating',
      category: '接口电路',
      description: '包装标识字体异常，但电气性能暂未发现明显问题',
      identificationMethod: '包装分析 + 标识对比',
      affectedBatches: ['2023M10'],
      images: ['/images/counterfeit2.jpg'],
      countermeasures: '正在进行详细检测，暂时隔离相关批次'
    },
    {
      id: '3',
      partNumber: 'AD8066ARZ',
      manufacturer: '亚德诺',
      reportDate: '2023-09-20',
      reportedBy: '供应商',
      riskLevel: 'low',
      status: 'resolved',
      category: '模拟集成电路',
      description: '供应商主动上报疑似假冒产品，经检测确认为正品',
      identificationMethod: '全面检测',
      affectedBatches: ['2023AD08'],
      images: ['/images/counterfeit3.jpg'],
      countermeasures: '确认为正品，已解除隔离'
    }
  ];

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      setData(mockData);
    } catch (error) {
      message.error('获取数据失败');
    } finally {
      setLoading(false);
    }
  };

  const getRiskLevelColor = (level: string) => {
    switch (level) {
      case 'high': return 'red';
      case 'medium': return 'orange';
      case 'low': return 'green';
      default: return 'default';
    }
  };

  const getRiskLevelText = (level: string) => {
    switch (level) {
      case 'high': return '高风险';
      case 'medium': return '中风险';
      case 'low': return '低风险';
      default: return level;
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'confirmed': return 'red';
      case 'investigating': return 'orange';
      case 'resolved': return 'green';
      default: return 'default';
    }
  };

  const getStatusText = (status: string) => {
    switch (status) {
      case 'confirmed': return '已确认';
      case 'investigating': return '调查中';
      case 'resolved': return '已解决';
      default: return status;
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'confirmed': return <CloseCircleOutlined />;
      case 'investigating': return <ExclamationCircleOutlined />;
      case 'resolved': return <CheckCircleOutlined />;
      default: return null;
    }
  };

  const handleViewDetail = (record: CounterfeitRecord) => {
    setSelectedRecord(record);
    setDetailVisible(true);
  };

  const handleReport = () => {
    form.resetFields();
    setReportVisible(true);
  };

  const handleDetect = () => {
    detectForm.resetFields();
    setDetectionResult(null);
    setDetectVisible(true);
  };

  const handleSubmitReport = async (values: any) => {
    try {
      console.log('提交举报:', values);
      message.success('举报提交成功，我们将尽快处理');
      setReportVisible(false);
      fetchData();
    } catch (error) {
      message.error('提交失败');
    }
  };

  const handleAIDetection = async () => {
    try {
      setLoading(true);
      // 模拟AI检测
      await new Promise(resolve => setTimeout(resolve, 3000));
      
      const mockResult: DetectionResult = {
        confidence: 85,
        riskFactors: [
          '包装字体与正品存在差异',
          '芯片表面处理工艺不一致',
          '引脚镀层颜色异常',
          '标识位置偏移'
        ],
        recommendations: [
          '建议进行X射线检查',
          '进行电气性能详细测试',
          '对比正品样本',
          '联系制造商验证'
        ]
      };
      
      setDetectionResult(mockResult);
      message.success('AI检测完成');
    } catch (error) {
      message.error('检测失败');
    } finally {
      setLoading(false);
    }
  };

  const columns: ColumnsType<CounterfeitRecord> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text) => <span style={{ fontWeight: 'bold', color: '#1890ff' }}>{text}</span>
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '报告日期',
      dataIndex: 'reportDate',
      key: 'reportDate',
      width: 120,
    },
    {
      title: '报告单位',
      dataIndex: 'reportedBy',
      key: 'reportedBy',
      width: 120,
    },
    {
      title: '风险等级',
      dataIndex: 'riskLevel',
      key: 'riskLevel',
      width: 100,
      render: (level) => (
        <Tag color={getRiskLevelColor(level)} icon={<WarningOutlined />}>
          {getRiskLevelText(level)}
        </Tag>
      )
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      width: 100,
      render: (status) => (
        <Tag color={getStatusColor(status)} icon={getStatusIcon(status)}>
          {getStatusText(status)}
        </Tag>
      )
    },
    {
      title: '识别方法',
      dataIndex: 'identificationMethod',
      key: 'identificationMethod',
      ellipsis: true,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      render: (_, record) => (
        <Space size="small">
          <Button 
            type="link" 
            icon={<EyeOutlined />} 
            onClick={() => handleViewDetail(record)}
            size="small"
          >
            详情
          </Button>
        </Space>
      ),
    },
  ];

  const filteredData = data.filter(item => {
    const matchesSearch = 
      item.partNumber.toLowerCase().includes(searchText.toLowerCase()) ||
      item.manufacturer.toLowerCase().includes(searchText.toLowerCase());
    const matchesRiskLevel = selectedRiskLevel === 'all' || item.riskLevel === selectedRiskLevel;
    const matchesStatus = selectedStatus === 'all' || item.status === selectedStatus;
    
    return matchesSearch && matchesRiskLevel && matchesStatus;
  });

  // 统计数据
  const stats = {
    total: data.length,
    confirmed: data.filter(item => item.status === 'confirmed').length,
    investigating: data.filter(item => item.status === 'investigating').length,
    resolved: data.filter(item => item.status === 'resolved').length,
    highRisk: data.filter(item => item.riskLevel === 'high').length,
  };

  return (
    <div style={{ padding: 24 }}>
      {/* 警告提示 */}
      <Alert
        message="假冒伪劣器件预警"
        description="发现疑似假冒伪劣器件时，请立即停止使用并及时举报。使用假冒器件可能导致系统故障和安全隐患。"
        type="warning"
        icon={<SafetyOutlined />}
        showIcon
        style={{ marginBottom: 24 }}
      />

      {/* 统计卡片 */}
      <Row gutter={16} style={{ marginBottom: 24 }}>
        <Col span={6}>
          <Card>
            <Statistic title="总记录数" value={stats.total} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="已确认假冒" value={stats.confirmed} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="调查中" value={stats.investigating} valueStyle={{ color: '#fa8c16' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="高风险" value={stats.highRisk} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
      </Row>

      <Card>
        <div style={{ marginBottom: 16 }}>
          <Row gutter={16}>
            <Col span={8}>
              <Input
                placeholder="搜索型号或制造商"
                prefix={<SearchOutlined />}
                value={searchText}
                onChange={(e) => setSearchText(e.target.value)}
              />
            </Col>
            <Col span={4}>
              <Select
                placeholder="风险等级"
                style={{ width: '100%' }}
                value={selectedRiskLevel}
                onChange={setSelectedRiskLevel}
              >
                <Option value="all">全部等级</Option>
                <Option value="high">高风险</Option>
                <Option value="medium">中风险</Option>
                <Option value="low">低风险</Option>
              </Select>
            </Col>
            <Col span={4}>
              <Select
                placeholder="状态"
                style={{ width: '100%' }}
                value={selectedStatus}
                onChange={setSelectedStatus}
              >
                <Option value="all">全部状态</Option>
                <Option value="confirmed">已确认</Option>
                <Option value="investigating">调查中</Option>
                <Option value="resolved">已解决</Option>
              </Select>
            </Col>
            <Col span={8}>
              <Space>
                <Button type="primary" danger icon={<FileTextOutlined />} onClick={handleReport}>
                  举报假冒
                </Button>
                <Button type="primary" icon={<CameraOutlined />} onClick={handleDetect}>
                  AI检测
                </Button>
                <Button onClick={fetchData}>
                  刷新
                </Button>
              </Space>
            </Col>
          </Row>
        </div>

        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          pagination={{
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total) => `共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="假冒伪劣记录详情"
        open={detailVisible}
        onCancel={() => setDetailVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetailVisible(false)}>
            关闭
          </Button>
        ]}
        width={900}
      >
        {selectedRecord && (
          <>
            <Descriptions column={2} bordered>
              <Descriptions.Item label="器件型号">{selectedRecord.partNumber}</Descriptions.Item>
              <Descriptions.Item label="制造商">{selectedRecord.manufacturer}</Descriptions.Item>
              <Descriptions.Item label="报告日期">{selectedRecord.reportDate}</Descriptions.Item>
              <Descriptions.Item label="报告单位">{selectedRecord.reportedBy}</Descriptions.Item>
              <Descriptions.Item label="风险等级">
                <Tag color={getRiskLevelColor(selectedRecord.riskLevel)} icon={<WarningOutlined />}>
                  {getRiskLevelText(selectedRecord.riskLevel)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="处理状态">
                <Tag color={getStatusColor(selectedRecord.status)} icon={getStatusIcon(selectedRecord.status)}>
                  {getStatusText(selectedRecord.status)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="产品类别">{selectedRecord.category}</Descriptions.Item>
              <Descriptions.Item label="识别方法">{selectedRecord.identificationMethod}</Descriptions.Item>
              <Descriptions.Item label="涉及批次" span={2}>
                {selectedRecord.affectedBatches.map(batch => (
                  <Tag key={batch} color="red">{batch}</Tag>
                ))}
              </Descriptions.Item>
              <Descriptions.Item label="问题描述" span={2}>
                {selectedRecord.description}
              </Descriptions.Item>
              <Descriptions.Item label="应对措施" span={2}>
                {selectedRecord.countermeasures}
              </Descriptions.Item>
            </Descriptions>

            {selectedRecord.images.length > 0 && (
              <>
                <h4 style={{ marginTop: 24, marginBottom: 16 }}>相关图片</h4>
                <Image.PreviewGroup>
                  <Row gutter={16}>
                    {selectedRecord.images.map((img, index) => (
                      <Col span={8} key={index}>
                        <Image
                          width="100%"
                          height={200}
                          src={img}
                          fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"
                        />
                      </Col>
                    ))}
                  </Row>
                </Image.PreviewGroup>
              </>
            )}
          </>
        )}
      </Modal>

      {/* 举报模态框 */}
      <Modal
        title="举报假冒伪劣器件"
        open={reportVisible}
        onCancel={() => setReportVisible(false)}
        onOk={() => form.submit()}
        width={600}
      >
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSubmitReport}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="partNumber"
                label="器件型号"
                rules={[{ required: true, message: '请输入器件型号' }]}
              >
                <Input placeholder="请输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="manufacturer"
                label="标称制造商"
                rules={[{ required: true, message: '请输入制造商' }]}
              >
                <Input placeholder="请输入制造商" />
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="riskLevel"
                label="风险等级评估"
                rules={[{ required: true, message: '请选择风险等级' }]}
              >
                <Select placeholder="请选择风险等级">
                  <Option value="high">高风险</Option>
                  <Option value="medium">中风险</Option>
                  <Option value="low">低风险</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="category"
                label="产品类别"
                rules={[{ required: true, message: '请选择产品类别' }]}
              >
                <Select placeholder="请选择产品类别">
                  <Option value="模拟集成电路">模拟集成电路</Option>
                  <Option value="数字集成电路">数字集成电路</Option>
                  <Option value="接口电路">接口电路</Option>
                  <Option value="电源管理">电源管理</Option>
                  <Option value="存储器">存储器</Option>
                  <Option value="分立器件">分立器件</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="identificationMethod"
            label="识别方法"
            rules={[{ required: true, message: '请输入识别方法' }]}
          >
            <Input placeholder="如：外观检查、电气测试、X射线检查等" />
          </Form.Item>

          <Form.Item
            name="description"
            label="问题描述"
            rules={[{ required: true, message: '请描述发现的问题' }]}
          >
            <TextArea rows={4} placeholder="请详细描述发现的异常情况" />
          </Form.Item>

          <Form.Item
            name="images"
            label="相关图片"
          >
            <Upload
              listType="picture-card"
              multiple
              beforeUpload={() => false}
            >
              <div>
                <FileImageOutlined />
                <div style={{ marginTop: 8 }}>上传图片</div>
              </div>
            </Upload>
          </Form.Item>
        </Form>
      </Modal>

      {/* AI检测模态框 */}
      <Modal
        title="AI智能检测"
        open={detectVisible}
        onCancel={() => setDetectVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetectVisible(false)}>
            关闭
          </Button>,
          <Button key="detect" type="primary" loading={loading} onClick={handleAIDetection}>
            开始检测
          </Button>
        ]}
        width={700}
      >
        <Form
          form={detectForm}
          layout="vertical"
        >
          <Form.Item
            name="images"
            label="上传器件图片"
            extra="请上传清晰的器件正面、背面及包装图片，支持多张图片同时上传"
          >
            <Upload.Dragger
              multiple
              listType="picture"
              beforeUpload={() => false}
              accept="image/*"
            >
              <p className="ant-upload-drag-icon">
                <CameraOutlined style={{ fontSize: 48, color: '#1890ff' }} />
              </p>
              <p className="ant-upload-text">点击或拖拽图片到此区域上传</p>
              <p className="ant-upload-hint">
                支持 JPG、PNG 格式，建议图片清晰度不低于 1024x768
              </p>
            </Upload.Dragger>
          </Form.Item>
        </Form>

        {detectionResult && (
          <div style={{ marginTop: 24 }}>
            <h4>检测结果</h4>
            <Card>
              <Row gutter={16}>
                <Col span={12}>
                  <Statistic
                    title="可信度评分"
                    value={detectionResult.confidence}
                    suffix="%"
                    valueStyle={{ 
                      color: detectionResult.confidence > 80 ? '#cf1322' : 
                             detectionResult.confidence > 60 ? '#fa8c16' : '#3f8600' 
                    }}
                  />
                </Col>
                <Col span={12}>
                  <Progress
                    type="circle"
                    percent={detectionResult.confidence}
                    status={detectionResult.confidence > 80 ? 'exception' : 'normal'}
                    width={80}
                  />
                </Col>
              </Row>
              
              <div style={{ marginTop: 16 }}>
                <h5>风险因素：</h5>
                <Timeline>
                  {detectionResult.riskFactors.map((factor, index) => (
                    <Timeline.Item key={index} color="red">
                      {factor}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>

              <div style={{ marginTop: 16 }}>
                <h5>建议措施：</h5>
                <Timeline size="small">
                  {detectionResult.recommendations.map((rec, index) => (
                    <Timeline.Item key={index} color="blue">
                      {rec}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>
            </Card>
          </div>
        )}
      </Modal>
    </div>
  );
};

export default CounterfeitDetection;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import { 
  Card, 
  Table, 
  Input, 
  Button, 
  Space, 
  Select, 
  Tag, 
  Modal,
  Form,
  message,
  Row,
  Col,
  Descriptions,
  Upload,
  Image,
  Alert,
  Statistic,
  Progress,
  Timeline
} from 'antd';
import { 
  SearchOutlined, 
  EyeOutlined, 
  WarningOutlined,
  CameraOutlined,
  SafetyOutlined,
  ExclamationCircleOutlined,
  CheckCircleOutlined,
  CloseCircleOutlined,
  FileImageOutlined,
  FileTextOutlined
} from '@ant-design/icons';
import type { ColumnsType } from 'antd/es/table';

const { Option } = Select;
const { TextArea } = Input;

interface CounterfeitRecord {
  id: string;
  partNumber: string;
  manufacturer: string;
  reportDate: string;
  reportedBy: string;
  riskLevel: 'high' | 'medium' | 'low';
  status: 'confirmed' | 'investigating' | 'resolved';
  category: string;
  description: string;
  identificationMethod: string;
  affectedBatches: string[];
  images: string[];
  countermeasures: string;
}

interface DetectionResult {
  confidence: number;
  riskFactors: string[];
  recommendations: string[];
}

const CounterfeitDetection: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<CounterfeitRecord[]>([]);
  const [searchText, setSearchText] = useState('');
  const [selectedRiskLevel, setSelectedRiskLevel] = useState<string>('all');
  const [selectedStatus, setSelectedStatus] = useState<string>('all');
  const [detailVisible, setDetailVisible] = useState(false);
  const [reportVisible, setReportVisible] = useState(false);
  const [detectVisible, setDetectVisible] = useState(false);
  const [selectedRecord, setSelectedRecord] = useState<CounterfeitRecord | null>(null);
  const [detectionResult, setDetectionResult] = useState<DetectionResult | null>(null);
  const [form] = Form.useForm();
  const [detectForm] = Form.useForm();

  // 模拟数据
  const mockData: CounterfeitRecord[] = [
    {
      id: '1',
      partNumber: 'LM358N',
      manufacturer: '德州仪器',
      reportDate: '2023-11-15',
      reportedBy: '航天某院',
      riskLevel: 'high',
      status: 'confirmed',
      category: '模拟集成电路',
      description: '发现批次标识异常，芯片表面处理不一致，电气特性偏差较大',
      identificationMethod: '外观检查 + 电气测试 + X射线检查',
      affectedBatches: ['2023001', '2023002', '2023005'],
      images: ['/images/counterfeit1.jpg', '/images/counterfeit1_xray.jpg'],
      countermeasures: '已通知相关单位停止使用，联系正规渠道重新采购'
    },
    {
      id: '2',
      partNumber: 'MAX232CPE',
      manufacturer: '美信',
      reportDate: '2023-10-28',
      reportedBy: '质检中心',
      riskLevel: 'medium',
      status: 'investigating',
      category: '接口电路',
      description: '包装标识字体异常，但电气性能暂未发现明显问题',
      identificationMethod: '包装分析 + 标识对比',
      affectedBatches: ['2023M10'],
      images: ['/images/counterfeit2.jpg'],
      countermeasures: '正在进行详细检测，暂时隔离相关批次'
    },
    {
      id: '3',
      partNumber: 'AD8066ARZ',
      manufacturer: '亚德诺',
      reportDate: '2023-09-20',
      reportedBy: '供应商',
      riskLevel: 'low',
      status: 'resolved',
      category: '模拟集成电路',
      description: '供应商主动上报疑似假冒产品，经检测确认为正品',
      identificationMethod: '全面检测',
      affectedBatches: ['2023AD08'],
      images: ['/images/counterfeit3.jpg'],
      countermeasures: '确认为正品，已解除隔离'
    }
  ];

  useEffect(() => {
    fetchData();
  }, []);

  const fetchData = async () => {
    setLoading(true);
    try {
      await new Promise(resolve => setTimeout(resolve, 1000));
      setData(mockData);
    } catch (error) {
      message.error('获取数据失败');
    } finally {
      setLoading(false);
    }
  };

  const getRiskLevelColor = (level: string) => {
    switch (level) {
      case 'high': return 'red';
      case 'medium': return 'orange';
      case 'low': return 'green';
      default: return 'default';
    }
  };

  const getRiskLevelText = (level: string) => {
    switch (level) {
      case 'high': return '高风险';
      case 'medium': return '中风险';
      case 'low': return '低风险';
      default: return level;
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'confirmed': return 'red';
      case 'investigating': return 'orange';
      case 'resolved': return 'green';
      default: return 'default';
    }
  };

  const getStatusText = (status: string) => {
    switch (status) {
      case 'confirmed': return '已确认';
      case 'investigating': return '调查中';
      case 'resolved': return '已解决';
      default: return status;
    }
  };

  const getStatusIcon = (status: string) => {
    switch (status) {
      case 'confirmed': return <CloseCircleOutlined />;
      case 'investigating': return <ExclamationCircleOutlined />;
      case 'resolved': return <CheckCircleOutlined />;
      default: return null;
    }
  };

  const handleViewDetail = (record: CounterfeitRecord) => {
    setSelectedRecord(record);
    setDetailVisible(true);
  };

  const handleReport = () => {
    form.resetFields();
    setReportVisible(true);
  };

  const handleDetect = () => {
    detectForm.resetFields();
    setDetectionResult(null);
    setDetectVisible(true);
  };

  const handleSubmitReport = async (values: any) => {
    try {
      console.log('提交举报:', values);
      message.success('举报提交成功，我们将尽快处理');
      setReportVisible(false);
      fetchData();
    } catch (error) {
      message.error('提交失败');
    }
  };

  const handleAIDetection = async () => {
    try {
      setLoading(true);
      // 模拟AI检测
      await new Promise(resolve => setTimeout(resolve, 3000));
      
      const mockResult: DetectionResult = {
        confidence: 85,
        riskFactors: [
          '包装字体与正品存在差异',
          '芯片表面处理工艺不一致',
          '引脚镀层颜色异常',
          '标识位置偏移'
        ],
        recommendations: [
          '建议进行X射线检查',
          '进行电气性能详细测试',
          '对比正品样本',
          '联系制造商验证'
        ]
      };
      
      setDetectionResult(mockResult);
      message.success('AI检测完成');
    } catch (error) {
      message.error('检测失败');
    } finally {
      setLoading(false);
    }
  };

  const columns: ColumnsType<CounterfeitRecord> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text) => <span style={{ fontWeight: 'bold', color: '#1890ff' }}>{text}</span>
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '报告日期',
      dataIndex: 'reportDate',
      key: 'reportDate',
      width: 120,
    },
    {
      title: '报告单位',
      dataIndex: 'reportedBy',
      key: 'reportedBy',
      width: 120,
    },
    {
      title: '风险等级',
      dataIndex: 'riskLevel',
      key: 'riskLevel',
      width: 100,
      render: (level) => (
        <Tag color={getRiskLevelColor(level)} icon={<WarningOutlined />}>
          {getRiskLevelText(level)}
        </Tag>
      )
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      width: 100,
      render: (status) => (
        <Tag color={getStatusColor(status)} icon={getStatusIcon(status)}>
          {getStatusText(status)}
        </Tag>
      )
    },
    {
      title: '识别方法',
      dataIndex: 'identificationMethod',
      key: 'identificationMethod',
      ellipsis: true,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      render: (_, record) => (
        <Space size="small">
          <Button 
            type="link" 
            icon={<EyeOutlined />} 
            onClick={() => handleViewDetail(record)}
            size="small"
          >
            详情
          </Button>
        </Space>
      ),
    },
  ];

  const filteredData = data.filter(item => {
    const matchesSearch = 
      item.partNumber.toLowerCase().includes(searchText.toLowerCase()) ||
      item.manufacturer.toLowerCase().includes(searchText.toLowerCase());
    const matchesRiskLevel = selectedRiskLevel === 'all' || item.riskLevel === selectedRiskLevel;
    const matchesStatus = selectedStatus === 'all' || item.status === selectedStatus;
    
    return matchesSearch && matchesRiskLevel && matchesStatus;
  });

  // 统计数据
  const stats = {
    total: data.length,
    confirmed: data.filter(item => item.status === 'confirmed').length,
    investigating: data.filter(item => item.status === 'investigating').length,
    resolved: data.filter(item => item.status === 'resolved').length,
    highRisk: data.filter(item => item.riskLevel === 'high').length,
  };

  return (
    <div style={{ padding: 24 }}>
      {/* 警告提示 */}
      <Alert
        message="假冒伪劣器件预警"
        description="发现疑似假冒伪劣器件时，请立即停止使用并及时举报。使用假冒器件可能导致系统故障和安全隐患。"
        type="warning"
        icon={<SafetyOutlined />}
        showIcon
        style={{ marginBottom: 24 }}
      />

      {/* 统计卡片 */}
      <Row gutter={16} style={{ marginBottom: 24 }}>
        <Col span={6}>
          <Card>
            <Statistic title="总记录数" value={stats.total} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="已确认假冒" value={stats.confirmed} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="调查中" value={stats.investigating} valueStyle={{ color: '#fa8c16' }} />
          </Card>
        </Col>
        <Col span={6}>
          <Card>
            <Statistic title="高风险" value={stats.highRisk} valueStyle={{ color: '#cf1322' }} />
          </Card>
        </Col>
      </Row>

      <Card>
        <div style={{ marginBottom: 16 }}>
          <Row gutter={16}>
            <Col span={8}>
              <Input
                placeholder="搜索型号或制造商"
                prefix={<SearchOutlined />}
                value={searchText}
                onChange={(e) => setSearchText(e.target.value)}
              />
            </Col>
            <Col span={4}>
              <Select
                placeholder="风险等级"
                style={{ width: '100%' }}
                value={selectedRiskLevel}
                onChange={setSelectedRiskLevel}
              >
                <Option value="all">全部等级</Option>
                <Option value="high">高风险</Option>
                <Option value="medium">中风险</Option>
                <Option value="low">低风险</Option>
              </Select>
            </Col>
            <Col span={4}>
              <Select
                placeholder="状态"
                style={{ width: '100%' }}
                value={selectedStatus}
                onChange={setSelectedStatus}
              >
                <Option value="all">全部状态</Option>
                <Option value="confirmed">已确认</Option>
                <Option value="investigating">调查中</Option>
                <Option value="resolved">已解决</Option>
              </Select>
            </Col>
            <Col span={8}>
              <Space>
                <Button type="primary" danger icon={<FileTextOutlined />} onClick={handleReport}>
                  举报假冒
                </Button>
                <Button type="primary" icon={<CameraOutlined />} onClick={handleDetect}>
                  AI检测
                </Button>
                <Button onClick={fetchData}>
                  刷新
                </Button>
              </Space>
            </Col>
          </Row>
        </div>

        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          pagination={{
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total) => `共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="假冒伪劣记录详情"
        open={detailVisible}
        onCancel={() => setDetailVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetailVisible(false)}>
            关闭
          </Button>
        ]}
        width={900}
      >
        {selectedRecord && (
          <>
            <Descriptions column={2} bordered>
              <Descriptions.Item label="器件型号">{selectedRecord.partNumber}</Descriptions.Item>
              <Descriptions.Item label="制造商">{selectedRecord.manufacturer}</Descriptions.Item>
              <Descriptions.Item label="报告日期">{selectedRecord.reportDate}</Descriptions.Item>
              <Descriptions.Item label="报告单位">{selectedRecord.reportedBy}</Descriptions.Item>
              <Descriptions.Item label="风险等级">
                <Tag color={getRiskLevelColor(selectedRecord.riskLevel)} icon={<WarningOutlined />}>
                  {getRiskLevelText(selectedRecord.riskLevel)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="处理状态">
                <Tag color={getStatusColor(selectedRecord.status)} icon={getStatusIcon(selectedRecord.status)}>
                  {getStatusText(selectedRecord.status)}
                </Tag>
              </Descriptions.Item>
              <Descriptions.Item label="产品类别">{selectedRecord.category}</Descriptions.Item>
              <Descriptions.Item label="识别方法">{selectedRecord.identificationMethod}</Descriptions.Item>
              <Descriptions.Item label="涉及批次" span={2}>
                {selectedRecord.affectedBatches.map(batch => (
                  <Tag key={batch} color="red">{batch}</Tag>
                ))}
              </Descriptions.Item>
              <Descriptions.Item label="问题描述" span={2}>
                {selectedRecord.description}
              </Descriptions.Item>
              <Descriptions.Item label="应对措施" span={2}>
                {selectedRecord.countermeasures}
              </Descriptions.Item>
            </Descriptions>

            {selectedRecord.images.length > 0 && (
              <>
                <h4 style={{ marginTop: 24, marginBottom: 16 }}>相关图片</h4>
                <Image.PreviewGroup>
                  <Row gutter={16}>
                    {selectedRecord.images.map((img, index) => (
                      <Col span={8} key={index}>
                        <Image
                          width="100%"
                          height={200}
                          src={img}
                          fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"
                        />
                      </Col>
                    ))}
                  </Row>
                </Image.PreviewGroup>
              </>
            )}
          </>
        )}
      </Modal>

      {/* 举报模态框 */}
      <Modal
        title="举报假冒伪劣器件"
        open={reportVisible}
        onCancel={() => setReportVisible(false)}
        onOk={() => form.submit()}
        width={600}
      >
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSubmitReport}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="partNumber"
                label="器件型号"
                rules={[{ required: true, message: '请输入器件型号' }]}
              >
                <Input placeholder="请输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="manufacturer"
                label="标称制造商"
                rules={[{ required: true, message: '请输入制造商' }]}
              >
                <Input placeholder="请输入制造商" />
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="riskLevel"
                label="风险等级评估"
                rules={[{ required: true, message: '请选择风险等级' }]}
              >
                <Select placeholder="请选择风险等级">
                  <Option value="high">高风险</Option>
                  <Option value="medium">中风险</Option>
                  <Option value="low">低风险</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="category"
                label="产品类别"
                rules={[{ required: true, message: '请选择产品类别' }]}
              >
                <Select placeholder="请选择产品类别">
                  <Option value="模拟集成电路">模拟集成电路</Option>
                  <Option value="数字集成电路">数字集成电路</Option>
                  <Option value="接口电路">接口电路</Option>
                  <Option value="电源管理">电源管理</Option>
                  <Option value="存储器">存储器</Option>
                  <Option value="分立器件">分立器件</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="identificationMethod"
            label="识别方法"
            rules={[{ required: true, message: '请输入识别方法' }]}
          >
            <Input placeholder="如：外观检查、电气测试、X射线检查等" />
          </Form.Item>

          <Form.Item
            name="description"
            label="问题描述"
            rules={[{ required: true, message: '请描述发现的问题' }]}
          >
            <TextArea rows={4} placeholder="请详细描述发现的异常情况" />
          </Form.Item>

          <Form.Item
            name="images"
            label="相关图片"
          >
            <Upload
              listType="picture-card"
              multiple
              beforeUpload={() => false}
            >
              <div>
                <FileImageOutlined />
                <div style={{ marginTop: 8 }}>上传图片</div>
              </div>
            </Upload>
          </Form.Item>
        </Form>
      </Modal>

      {/* AI检测模态框 */}
      <Modal
        title="AI智能检测"
        open={detectVisible}
        onCancel={() => setDetectVisible(false)}
        footer={[
          <Button key="close" onClick={() => setDetectVisible(false)}>
            关闭
          </Button>,
          <Button key="detect" type="primary" loading={loading} onClick={handleAIDetection}>
            开始检测
          </Button>
        ]}
        width={700}
      >
        <Form
          form={detectForm}
          layout="vertical"
        >
          <Form.Item
            name="images"
            label="上传器件图片"
            extra="请上传清晰的器件正面、背面及包装图片，支持多张图片同时上传"
          >
            <Upload.Dragger
              multiple
              listType="picture"
              beforeUpload={() => false}
              accept="image/*"
            >
              <p className="ant-upload-drag-icon">
                <CameraOutlined style={{ fontSize: 48, color: '#1890ff' }} />
              </p>
              <p className="ant-upload-text">点击或拖拽图片到此区域上传</p>
              <p className="ant-upload-hint">
                支持 JPG、PNG 格式，建议图片清晰度不低于 1024x768
              </p>
            </Upload.Dragger>
          </Form.Item>
        </Form>

        {detectionResult && (
          <div style={{ marginTop: 24 }}>
            <h4>检测结果</h4>
            <Card>
              <Row gutter={16}>
                <Col span={12}>
                  <Statistic
                    title="可信度评分"
                    value={detectionResult.confidence}
                    suffix="%"
                    valueStyle={{ 
                      color: detectionResult.confidence > 80 ? '#cf1322' : 
                             detectionResult.confidence > 60 ? '#fa8c16' : '#3f8600' 
                    }}
                  />
                </Col>
                <Col span={12}>
                  <Progress
                    type="circle"
                    percent={detectionResult.confidence}
                    status={detectionResult.confidence > 80 ? 'exception' : 'normal'}
                    width={80}
                  />
                </Col>
              </Row>
              
              <div style={{ marginTop: 16 }}>
                <h5>风险因素：</h5>
                <Timeline>
                  {detectionResult.riskFactors.map((factor, index) => (
                    <Timeline.Item key={index} color="red">
                      {factor}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>

              <div style={{ marginTop: 16 }}>
                <h5>建议措施：</h5>
                <Timeline>
                  {detectionResult.recommendations.map((rec, index) => (
                    <Timeline.Item key={index} color="blue">
                      {rec}
                    </Timeline.Item>
                  ))}
                </Timeline>
              </div>
            </Card>
          </div>
        )}
      </Modal>
    </div>
  );
};

export default CounterfeitDetection;

```

批量修复剩余错误。先处理未使用的导入和变量：


批量修复未使用的导入和变量：


```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 模拟单片集成电路数据类型定义
interface AnalogComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    accuracy?: string;
  };
}

// 国产模拟单片集成电路测试数据
const mockAnalogData: AnalogComponent[] = [
  {
    id: 'A001',
    partNumber: 'CA3140E',
    manufacturer: '华润微电子',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高输入阻抗运算放大器，CMOS输入级',
    functionalPerformance: '4.5MHz增益带宽积，低失调电压',
    referencePrice: 8.50,
    parameters: {
      voltage: '±4V~±22V',
      current: '2mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '4.5MHz',
      gain: '100dB',
      bandwidth: '4.5MHz',
      accuracy: '±2mV'
    }
  },
  {
    id: 'A002',
    partNumber: 'LM358N',
    manufacturer: '士兰微',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747', 'JESD30'],
    description: '双路低功耗运算放大器',
    functionalPerformance: '单电源供电，宽共模输入范围',
    referencePrice: 3.20,
    parameters: {
      voltage: '3V~32V',
      current: '0.7mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±3mV'
    }
  },
  {
    id: 'A003',
    partNumber: 'ADC0804',
    manufacturer: '中芯国际',
    primaryCategory: '数据转换器',
    secondaryCategory: '模数转换器(ADC)',
    package: 'DIP-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60748', 'JESD22'],
    description: '8位逐次逼近型ADC，内置时钟',
    functionalPerformance: '100μs转换时间，±1/2LSB线性度',
    referencePrice: 12.80,
    parameters: {
      voltage: '5V±5%',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '640kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A004',
    partNumber: 'DAC0832',
    manufacturer: '华大半导体',
    primaryCategory: '数据转换器',
    secondaryCategory: '数模转换器(DAC)',
    package: 'DIP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位乘法型DAC，快速建立时间',
    functionalPerformance: '1μs建立时间，±1/2LSB线性度',
    referencePrice: 18.60,
    parameters: {
      voltage: '5V~15V',
      current: '2.3mA@15V',
      temperature: '-55°C~+125°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A005',
    partNumber: 'NE555P',
    manufacturer: '韦尔股份',
    primaryCategory: '时序电路',
    secondaryCategory: '定时器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '精密定时器，多种工作模式',
    functionalPerformance: '单稳态、双稳态、无稳态工作模式',
    referencePrice: 2.50,
    parameters: {
      voltage: '4.5V~16V',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '500kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±50ppm/°C'
    }
  },
  {
    id: 'A006',
    partNumber: 'LM317T',
    manufacturer: '圣邦微电子',
    primaryCategory: '电源管理',
    secondaryCategory: '线性稳压器',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '可调正电压稳压器',
    functionalPerformance: '1.25V~37V输出，1.5A输出电流',
    referencePrice: 4.80,
    parameters: {
      voltage: '3V~40V',
      current: '1.5A',
      temperature: '-55°C~+150°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1%'
    }
  },
  {
    id: 'A007',
    partNumber: 'CD4017BE',
    manufacturer: '中科银河芯',
    primaryCategory: '时序电路',
    secondaryCategory: '计数器',
    package: 'DIP-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '十进制计数器/分频器',
    functionalPerformance: 'CMOS工艺，低功耗设计',
    referencePrice: 1.80,
    parameters: {
      voltage: '3V~18V',
      current: '0.01mA@5V',
      temperature: '-55°C~+125°C',
      frequency: '5MHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1计数'
    }
  },
  {
    id: 'A008',
    partNumber: 'TL072CP',
    manufacturer: '芯海科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '双路JFET输入运算放大器',
    functionalPerformance: '低噪声，高输入阻抗',
    referencePrice: 6.20,
    parameters: {
      voltage: '±6V~±18V',
      current: '2.5mA@±15V',
      temperature: '-40°C~+85°C',
      frequency: '3MHz',
      gain: '106dB',
      bandwidth: '3MHz',
      accuracy: '±6mV'
    }
  },
  {
    id: 'A009',
    partNumber: 'LM324N',
    manufacturer: '新洁能',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '四路运算放大器，单电源供电',
    functionalPerformance: '低功耗，宽电源电压范围',
    referencePrice: 2.80,
    parameters: {
      voltage: '3V~32V',
      current: '0.8mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±7mV'
    }
  },
  {
    id: 'A010',
    partNumber: 'MC1458P',
    manufacturer: '长电科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '双路运算放大器，高可靠性',
    functionalPerformance: '内部频率补偿，短路保护',
    referencePrice: 15.50,
    parameters: {
      voltage: '±3V~±18V',
      current: '2.8mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '1MHz',
      gain: '94dB',
      bandwidth: '1MHz',
      accuracy: '±5mV'
    }
  }
];

const AnalogICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
  const [filteredData, setFilteredData] = useState<AnalogComponent[]>(mockAnalogData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<AnalogComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockAnalogData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockAnalogData);
  };

  // 查看详情
  const handleViewDetail = (record: AnalogComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: AnalogComponent, b: AnalogComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: AnalogComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            模拟单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Analog Integrated Circuits - 运算放大器、数据转换器、电源管理、时序电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华大半导体">华大半导体</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="中科银河芯">中科银河芯</Option>
                  <Option value="芯海科技">芯海科技</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="长电科技">长电科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="放大器类">放大器类</Option>
                  <Option value="数据转换器">数据转换器</Option>
                  <Option value="时序电路">时序电路</Option>
                  <Option value="电源管理">电源管理</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="仪表放大器">仪表放大器</Option>
                  <Option value="比较器">比较器</Option>
                  <Option value="模数转换器(ADC)">模数转换器(ADC)</Option>
                  <Option value="数模转换器(DAC)">数模转换器(DAC)</Option>
                  <Option value="定时器">定时器</Option>
                  <Option value="计数器">计数器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="开关稳压器">开关稳压器</Option>
                  <Option value="电压基准">电压基准</Option>
                  <Option value="电源监控">电源监控</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="purple">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default AnalogICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 模拟单片集成电路数据类型定义
interface AnalogComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    accuracy?: string;
  };
}

// 国产模拟单片集成电路测试数据
const mockAnalogData: AnalogComponent[] = [
  {
    id: 'A001',
    partNumber: 'CA3140E',
    manufacturer: '华润微电子',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高输入阻抗运算放大器，CMOS输入级',
    functionalPerformance: '4.5MHz增益带宽积，低失调电压',
    referencePrice: 8.50,
    parameters: {
      voltage: '±4V~±22V',
      current: '2mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '4.5MHz',
      gain: '100dB',
      bandwidth: '4.5MHz',
      accuracy: '±2mV'
    }
  },
  {
    id: 'A002',
    partNumber: 'LM358N',
    manufacturer: '士兰微',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747', 'JESD30'],
    description: '双路低功耗运算放大器',
    functionalPerformance: '单电源供电，宽共模输入范围',
    referencePrice: 3.20,
    parameters: {
      voltage: '3V~32V',
      current: '0.7mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±3mV'
    }
  },
  {
    id: 'A003',
    partNumber: 'ADC0804',
    manufacturer: '中芯国际',
    primaryCategory: '数据转换器',
    secondaryCategory: '模数转换器(ADC)',
    package: 'DIP-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60748', 'JESD22'],
    description: '8位逐次逼近型ADC，内置时钟',
    functionalPerformance: '100μs转换时间，±1/2LSB线性度',
    referencePrice: 12.80,
    parameters: {
      voltage: '5V±5%',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '640kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A004',
    partNumber: 'DAC0832',
    manufacturer: '华大半导体',
    primaryCategory: '数据转换器',
    secondaryCategory: '数模转换器(DAC)',
    package: 'DIP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位乘法型DAC，快速建立时间',
    functionalPerformance: '1μs建立时间，±1/2LSB线性度',
    referencePrice: 18.60,
    parameters: {
      voltage: '5V~15V',
      current: '2.3mA@15V',
      temperature: '-55°C~+125°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A005',
    partNumber: 'NE555P',
    manufacturer: '韦尔股份',
    primaryCategory: '时序电路',
    secondaryCategory: '定时器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '精密定时器，多种工作模式',
    functionalPerformance: '单稳态、双稳态、无稳态工作模式',
    referencePrice: 2.50,
    parameters: {
      voltage: '4.5V~16V',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '500kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±50ppm/°C'
    }
  },
  {
    id: 'A006',
    partNumber: 'LM317T',
    manufacturer: '圣邦微电子',
    primaryCategory: '电源管理',
    secondaryCategory: '线性稳压器',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '可调正电压稳压器',
    functionalPerformance: '1.25V~37V输出，1.5A输出电流',
    referencePrice: 4.80,
    parameters: {
      voltage: '3V~40V',
      current: '1.5A',
      temperature: '-55°C~+150°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1%'
    }
  },
  {
    id: 'A007',
    partNumber: 'CD4017BE',
    manufacturer: '中科银河芯',
    primaryCategory: '时序电路',
    secondaryCategory: '计数器',
    package: 'DIP-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '十进制计数器/分频器',
    functionalPerformance: 'CMOS工艺，低功耗设计',
    referencePrice: 1.80,
    parameters: {
      voltage: '3V~18V',
      current: '0.01mA@5V',
      temperature: '-55°C~+125°C',
      frequency: '5MHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1计数'
    }
  },
  {
    id: 'A008',
    partNumber: 'TL072CP',
    manufacturer: '芯海科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '双路JFET输入运算放大器',
    functionalPerformance: '低噪声，高输入阻抗',
    referencePrice: 6.20,
    parameters: {
      voltage: '±6V~±18V',
      current: '2.5mA@±15V',
      temperature: '-40°C~+85°C',
      frequency: '3MHz',
      gain: '106dB',
      bandwidth: '3MHz',
      accuracy: '±6mV'
    }
  },
  {
    id: 'A009',
    partNumber: 'LM324N',
    manufacturer: '新洁能',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '四路运算放大器，单电源供电',
    functionalPerformance: '低功耗，宽电源电压范围',
    referencePrice: 2.80,
    parameters: {
      voltage: '3V~32V',
      current: '0.8mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±7mV'
    }
  },
  {
    id: 'A010',
    partNumber: 'MC1458P',
    manufacturer: '长电科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '双路运算放大器，高可靠性',
    functionalPerformance: '内部频率补偿，短路保护',
    referencePrice: 15.50,
    parameters: {
      voltage: '±3V~±18V',
      current: '2.8mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '1MHz',
      gain: '94dB',
      bandwidth: '1MHz',
      accuracy: '±5mV'
    }
  }
];

const AnalogICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<AnalogComponent[]>(mockAnalogData);
  const [filteredData, setFilteredData] = useState<AnalogComponent[]>(mockAnalogData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<AnalogComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockAnalogData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockAnalogData);
  };

  // 查看详情
  const handleViewDetail = (record: AnalogComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: AnalogComponent, b: AnalogComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: AnalogComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            模拟单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Analog Integrated Circuits - 运算放大器、数据转换器、电源管理、时序电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华大半导体">华大半导体</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="中科银河芯">中科银河芯</Option>
                  <Option value="芯海科技">芯海科技</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="长电科技">长电科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="放大器类">放大器类</Option>
                  <Option value="数据转换器">数据转换器</Option>
                  <Option value="时序电路">时序电路</Option>
                  <Option value="电源管理">电源管理</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="仪表放大器">仪表放大器</Option>
                  <Option value="比较器">比较器</Option>
                  <Option value="模数转换器(ADC)">模数转换器(ADC)</Option>
                  <Option value="数模转换器(DAC)">数模转换器(DAC)</Option>
                  <Option value="定时器">定时器</Option>
                  <Option value="计数器">计数器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="开关稳压器">开关稳压器</Option>
                  <Option value="电压基准">电压基准</Option>
                  <Option value="电源监控">电源监控</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="purple">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default AnalogICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 模拟单片集成电路数据类型定义
interface AnalogComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    accuracy?: string;
  };
}

// 国产模拟单片集成电路测试数据
const mockAnalogData: AnalogComponent[] = [
  {
    id: 'A001',
    partNumber: 'CA3140E',
    manufacturer: '华润微电子',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高输入阻抗运算放大器，CMOS输入级',
    functionalPerformance: '4.5MHz增益带宽积，低失调电压',
    referencePrice: 8.50,
    parameters: {
      voltage: '±4V~±22V',
      current: '2mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '4.5MHz',
      gain: '100dB',
      bandwidth: '4.5MHz',
      accuracy: '±2mV'
    }
  },
  {
    id: 'A002',
    partNumber: 'LM358N',
    manufacturer: '士兰微',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747', 'JESD30'],
    description: '双路低功耗运算放大器',
    functionalPerformance: '单电源供电，宽共模输入范围',
    referencePrice: 3.20,
    parameters: {
      voltage: '3V~32V',
      current: '0.7mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±3mV'
    }
  },
  {
    id: 'A003',
    partNumber: 'ADC0804',
    manufacturer: '中芯国际',
    primaryCategory: '数据转换器',
    secondaryCategory: '模数转换器(ADC)',
    package: 'DIP-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60748', 'JESD22'],
    description: '8位逐次逼近型ADC，内置时钟',
    functionalPerformance: '100μs转换时间，±1/2LSB线性度',
    referencePrice: 12.80,
    parameters: {
      voltage: '5V±5%',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '640kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A004',
    partNumber: 'DAC0832',
    manufacturer: '华大半导体',
    primaryCategory: '数据转换器',
    secondaryCategory: '数模转换器(DAC)',
    package: 'DIP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位乘法型DAC，快速建立时间',
    functionalPerformance: '1μs建立时间，±1/2LSB线性度',
    referencePrice: 18.60,
    parameters: {
      voltage: '5V~15V',
      current: '2.3mA@15V',
      temperature: '-55°C~+125°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A005',
    partNumber: 'NE555P',
    manufacturer: '韦尔股份',
    primaryCategory: '时序电路',
    secondaryCategory: '定时器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '精密定时器，多种工作模式',
    functionalPerformance: '单稳态、双稳态、无稳态工作模式',
    referencePrice: 2.50,
    parameters: {
      voltage: '4.5V~16V',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '500kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±50ppm/°C'
    }
  },
  {
    id: 'A006',
    partNumber: 'LM317T',
    manufacturer: '圣邦微电子',
    primaryCategory: '电源管理',
    secondaryCategory: '线性稳压器',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '可调正电压稳压器',
    functionalPerformance: '1.25V~37V输出，1.5A输出电流',
    referencePrice: 4.80,
    parameters: {
      voltage: '3V~40V',
      current: '1.5A',
      temperature: '-55°C~+150°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1%'
    }
  },
  {
    id: 'A007',
    partNumber: 'CD4017BE',
    manufacturer: '中科银河芯',
    primaryCategory: '时序电路',
    secondaryCategory: '计数器',
    package: 'DIP-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '十进制计数器/分频器',
    functionalPerformance: 'CMOS工艺，低功耗设计',
    referencePrice: 1.80,
    parameters: {
      voltage: '3V~18V',
      current: '0.01mA@5V',
      temperature: '-55°C~+125°C',
      frequency: '5MHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1计数'
    }
  },
  {
    id: 'A008',
    partNumber: 'TL072CP',
    manufacturer: '芯海科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '双路JFET输入运算放大器',
    functionalPerformance: '低噪声，高输入阻抗',
    referencePrice: 6.20,
    parameters: {
      voltage: '±6V~±18V',
      current: '2.5mA@±15V',
      temperature: '-40°C~+85°C',
      frequency: '3MHz',
      gain: '106dB',
      bandwidth: '3MHz',
      accuracy: '±6mV'
    }
  },
  {
    id: 'A009',
    partNumber: 'LM324N',
    manufacturer: '新洁能',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '四路运算放大器，单电源供电',
    functionalPerformance: '低功耗，宽电源电压范围',
    referencePrice: 2.80,
    parameters: {
      voltage: '3V~32V',
      current: '0.8mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±7mV'
    }
  },
  {
    id: 'A010',
    partNumber: 'MC1458P',
    manufacturer: '长电科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '双路运算放大器，高可靠性',
    functionalPerformance: '内部频率补偿，短路保护',
    referencePrice: 15.50,
    parameters: {
      voltage: '±3V~±18V',
      current: '2.8mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '1MHz',
      gain: '94dB',
      bandwidth: '1MHz',
      accuracy: '±5mV'
    }
  }
];

const AnalogICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<AnalogComponent[]>(mockAnalogData);
  const [filteredData, setFilteredData] = useState<AnalogComponent[]>(mockAnalogData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<AnalogComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockAnalogData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockAnalogData);
  };

  // 查看详情
  const handleViewDetail = (record: AnalogComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: AnalogComponent, b: AnalogComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: AnalogComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            模拟单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Analog Integrated Circuits - 运算放大器、数据转换器、电源管理、时序电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华大半导体">华大半导体</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="中科银河芯">中科银河芯</Option>
                  <Option value="芯海科技">芯海科技</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="长电科技">长电科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="放大器类">放大器类</Option>
                  <Option value="数据转换器">数据转换器</Option>
                  <Option value="时序电路">时序电路</Option>
                  <Option value="电源管理">电源管理</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="仪表放大器">仪表放大器</Option>
                  <Option value="比较器">比较器</Option>
                  <Option value="模数转换器(ADC)">模数转换器(ADC)</Option>
                  <Option value="数模转换器(DAC)">数模转换器(DAC)</Option>
                  <Option value="定时器">定时器</Option>
                  <Option value="计数器">计数器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="开关稳压器">开关稳压器</Option>
                  <Option value="电压基准">电压基准</Option>
                  <Option value="电源监控">电源监控</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="purple">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default AnalogICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 数字单片集成电路数据类型定义
interface DigitalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    memory?: string;
    speed?: string;
  };
}

// 国产数字单片集成电路测试数据
const mockDigitalData: DigitalComponent[] = [
  {
    id: 'D001',
    partNumber: 'GD32F407VET6',
    manufacturer: '兆易创新',
    primaryCategory: '处理器类',
    secondaryCategory: '微控制器(MCU)',
    package: 'LQFP-100',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60749', 'AEC-Q100'],
    description: '32位ARM Cortex-M4内核微控制器',
    functionalPerformance: '168MHz主频，512KB Flash，192KB SRAM',
    referencePrice: 15.80,
    parameters: {
      voltage: '2.6V~3.6V',
      current: '50mA@168MHz',
      temperature: '-40°C~+85°C',
      frequency: '168MHz',
      memory: '512KB Flash + 192KB SRAM'
    }
  },
  {
    id: 'D002',
    partNumber: 'AC7015',
    manufacturer: '复旦微电子',
    primaryCategory: '处理器类',
    secondaryCategory: '现场可编程门阵列(FPGA)',
    package: 'FBGA-484',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '低功耗FPGA芯片，适用于航天应用',
    functionalPerformance: '15K逻辑单元，36个DSP模块，抗辐照设计',
    referencePrice: 850.00,
    parameters: {
      voltage: '1.0V~1.05V',
      current: '150mA@1.0V',
      temperature: '-55°C~+125°C',
      frequency: '300MHz',
      memory: '540Kb块RAM'
    }
  },
  {
    id: 'D003',
    partNumber: 'EM636165TS',
    manufacturer: '上海华虹',
    primaryCategory: '存储器类',
    secondaryCategory: '静态随机存储器(SRAM)',
    package: 'TSOP-44',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD21-C', 'JESD79'],
    description: '16Mb高速SRAM，低功耗设计',
    functionalPerformance: '2M×8位组织，存取时间10ns',
    referencePrice: 28.50,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '90mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '16Mb'
    }
  },
  {
    id: 'D004',
    partNumber: 'BF533SBBC600',
    manufacturer: '中科昊芯',
    primaryCategory: '处理器类',
    secondaryCategory: '数字信号处理器(DSP)',
    package: 'PBGA-88',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'QJ3234'],
    description: '高性能16位定点DSP处理器',
    functionalPerformance: '600MHz主频，单周期MAC运算',
    referencePrice: 320.00,
    parameters: {
      voltage: '1.2V~1.32V',
      current: '300mA@600MHz',
      temperature: '-55°C~+125°C',
      frequency: '600MHz',
      memory: '148KB内置存储器'
    }
  },
  {
    id: 'D005',
    partNumber: 'HC574A',
    manufacturer: '华润微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '计数器/定时器',
    package: 'SOP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位D型触发器，三态输出',
    functionalPerformance: '高速CMOS工艺，低功耗设计',
    referencePrice: 3.20,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '8mA@6V',
      temperature: '-55°C~+125°C',
      frequency: '125MHz',
      memory: '8位寄存器'
    }
  },
  {
    id: 'D006',
    partNumber: 'CSM610A',
    manufacturer: '晶晨半导体',
    primaryCategory: '时钟管理类',
    secondaryCategory: '时钟发生器',
    package: 'QFN-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '多路输出时钟发生器，低抖动',
    functionalPerformance: '4路输出，频率范围1MHz~200MHz',
    referencePrice: 12.50,
    parameters: {
      voltage: '2.5V~3.3V',
      current: '45mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz~200MHz',
      memory: '内置配置寄存器'
    }
  },
  {
    id: 'D007',
    partNumber: 'FM25V02A',
    manufacturer: '富满电子',
    primaryCategory: '存储器类',
    secondaryCategory: '闪存(Flash)',
    package: 'SOP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD216', 'IEC-60749'],
    description: '2Mb串行Flash存储器，SPI接口',
    functionalPerformance: '高速读写，100K次擦写循环',
    referencePrice: 4.80,
    parameters: {
      voltage: '2.7V~3.6V',
      current: '15mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '104MHz SPI',
      memory: '2Mb'
    }
  },
  {
    id: 'D008',
    partNumber: 'AiP8548',
    manufacturer: '爱普特微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '编解码器',
    package: 'TSSOP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '8位二进制译码器，低功耗CMOS',
    functionalPerformance: '3线到8线译码，使能控制功能',
    referencePrice: 1.50,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '2mA@6V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '无'
    }
  },
  {
    id: 'D009',
    partNumber: 'PT2262',
    manufacturer: '普冉半导体',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '多路复用器',
    package: 'DIP-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '遥控编码专用电路',
    functionalPerformance: 'CMOS工艺，12位三态地址/数据编码',
    referencePrice: 2.80,
    parameters: {
      voltage: '4V~15V',
      current: '5mA@12V',
      temperature: '-40°C~+85°C',
      frequency: '10kHz',
      memory: '12位编码'
    }
  },
  {
    id: 'D010',
    partNumber: 'SW3518S',
    manufacturer: '矽力杰',
    primaryCategory: '时钟管理类',
    secondaryCategory: '锁相环(PLL)',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高性能时钟发生器PLL芯片',
    functionalPerformance: '低抖动，多种输出频率可选',
    referencePrice: 18.20,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '35mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~800MHz',
      memory: '内置锁相环'
    }
  }
];

const DigitalICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
  const [filteredData, setFilteredData] = useState<DigitalComponent[]>(mockDigitalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DigitalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDigitalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDigitalData);
  };

  // 查看详情
  const handleViewDetail = (record: DigitalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DigitalComponent, b: DigitalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '量产': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DigitalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            数字单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Digital Integrated Circuits - 微处理器、存储器、逻辑器件、信号处理等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="兆易创新">兆易创新</Option>
                  <Option value="复旦微电子">复旦微电子</Option>
                  <Option value="上海华虹">上海华虹</Option>
                  <Option value="中科昊芯">中科昊芯</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="晶晨半导体">晶晨半导体</Option>
                  <Option value="富满电子">富满电子</Option>
                  <Option value="爱普特微电子">爱普特微电子</Option>
                  <Option value="普冉半导体">普冉半导体</Option>
                  <Option value="矽力杰">矽力杰</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="处理器类">处理器类</Option>
                  <Option value="存储器类">存储器类</Option>
                  <Option value="逻辑器件类">逻辑器件类</Option>
                  <Option value="时钟管理类">时钟管理类</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="微处理器(CPU)">微处理器(CPU)</Option>
                  <Option value="微控制器(MCU)">微控制器(MCU)</Option>
                  <Option value="数字信号处理器(DSP)">数字信号处理器(DSP)</Option>
                  <Option value="现场可编程门阵列(FPGA)">现场可编程门阵列(FPGA)</Option>
                  <Option value="静态随机存储器(SRAM)">静态随机存储器(SRAM)</Option>
                  <Option value="动态随机存储器(DRAM)">动态随机存储器(DRAM)</Option>
                  <Option value="闪存(Flash)">闪存(Flash)</Option>
                  <Option value="只读存储器(ROM)">只读存储器(ROM)</Option>
                  <Option value="门电路">门电路</Option>
                  <Option value="计数器/定时器">计数器/定时器</Option>
                  <Option value="编解码器">编解码器</Option>
                  <Option value="多路复用器">多路复用器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="时钟发生器">时钟发生器</Option>
                  <Option value="锁相环(PLL)">锁相环(PLL)</Option>
                  <Option value="时钟分配器">时钟分配器</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="量产">量产</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="blue">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="存储容量">{selectedComponent.parameters.memory}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DigitalICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 数字单片集成电路数据类型定义
interface DigitalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    memory?: string;
    speed?: string;
  };
}

// 国产数字单片集成电路测试数据
const mockDigitalData: DigitalComponent[] = [
  {
    id: 'D001',
    partNumber: 'GD32F407VET6',
    manufacturer: '兆易创新',
    primaryCategory: '处理器类',
    secondaryCategory: '微控制器(MCU)',
    package: 'LQFP-100',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60749', 'AEC-Q100'],
    description: '32位ARM Cortex-M4内核微控制器',
    functionalPerformance: '168MHz主频，512KB Flash，192KB SRAM',
    referencePrice: 15.80,
    parameters: {
      voltage: '2.6V~3.6V',
      current: '50mA@168MHz',
      temperature: '-40°C~+85°C',
      frequency: '168MHz',
      memory: '512KB Flash + 192KB SRAM'
    }
  },
  {
    id: 'D002',
    partNumber: 'AC7015',
    manufacturer: '复旦微电子',
    primaryCategory: '处理器类',
    secondaryCategory: '现场可编程门阵列(FPGA)',
    package: 'FBGA-484',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '低功耗FPGA芯片，适用于航天应用',
    functionalPerformance: '15K逻辑单元，36个DSP模块，抗辐照设计',
    referencePrice: 850.00,
    parameters: {
      voltage: '1.0V~1.05V',
      current: '150mA@1.0V',
      temperature: '-55°C~+125°C',
      frequency: '300MHz',
      memory: '540Kb块RAM'
    }
  },
  {
    id: 'D003',
    partNumber: 'EM636165TS',
    manufacturer: '上海华虹',
    primaryCategory: '存储器类',
    secondaryCategory: '静态随机存储器(SRAM)',
    package: 'TSOP-44',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD21-C', 'JESD79'],
    description: '16Mb高速SRAM，低功耗设计',
    functionalPerformance: '2M×8位组织，存取时间10ns',
    referencePrice: 28.50,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '90mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '16Mb'
    }
  },
  {
    id: 'D004',
    partNumber: 'BF533SBBC600',
    manufacturer: '中科昊芯',
    primaryCategory: '处理器类',
    secondaryCategory: '数字信号处理器(DSP)',
    package: 'PBGA-88',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'QJ3234'],
    description: '高性能16位定点DSP处理器',
    functionalPerformance: '600MHz主频，单周期MAC运算',
    referencePrice: 320.00,
    parameters: {
      voltage: '1.2V~1.32V',
      current: '300mA@600MHz',
      temperature: '-55°C~+125°C',
      frequency: '600MHz',
      memory: '148KB内置存储器'
    }
  },
  {
    id: 'D005',
    partNumber: 'HC574A',
    manufacturer: '华润微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '计数器/定时器',
    package: 'SOP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位D型触发器，三态输出',
    functionalPerformance: '高速CMOS工艺，低功耗设计',
    referencePrice: 3.20,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '8mA@6V',
      temperature: '-55°C~+125°C',
      frequency: '125MHz',
      memory: '8位寄存器'
    }
  },
  {
    id: 'D006',
    partNumber: 'CSM610A',
    manufacturer: '晶晨半导体',
    primaryCategory: '时钟管理类',
    secondaryCategory: '时钟发生器',
    package: 'QFN-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '多路输出时钟发生器，低抖动',
    functionalPerformance: '4路输出，频率范围1MHz~200MHz',
    referencePrice: 12.50,
    parameters: {
      voltage: '2.5V~3.3V',
      current: '45mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz~200MHz',
      memory: '内置配置寄存器'
    }
  },
  {
    id: 'D007',
    partNumber: 'FM25V02A',
    manufacturer: '富满电子',
    primaryCategory: '存储器类',
    secondaryCategory: '闪存(Flash)',
    package: 'SOP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD216', 'IEC-60749'],
    description: '2Mb串行Flash存储器，SPI接口',
    functionalPerformance: '高速读写，100K次擦写循环',
    referencePrice: 4.80,
    parameters: {
      voltage: '2.7V~3.6V',
      current: '15mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '104MHz SPI',
      memory: '2Mb'
    }
  },
  {
    id: 'D008',
    partNumber: 'AiP8548',
    manufacturer: '爱普特微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '编解码器',
    package: 'TSSOP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '8位二进制译码器，低功耗CMOS',
    functionalPerformance: '3线到8线译码，使能控制功能',
    referencePrice: 1.50,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '2mA@6V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '无'
    }
  },
  {
    id: 'D009',
    partNumber: 'PT2262',
    manufacturer: '普冉半导体',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '多路复用器',
    package: 'DIP-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '遥控编码专用电路',
    functionalPerformance: 'CMOS工艺，12位三态地址/数据编码',
    referencePrice: 2.80,
    parameters: {
      voltage: '4V~15V',
      current: '5mA@12V',
      temperature: '-40°C~+85°C',
      frequency: '10kHz',
      memory: '12位编码'
    }
  },
  {
    id: 'D010',
    partNumber: 'SW3518S',
    manufacturer: '矽力杰',
    primaryCategory: '时钟管理类',
    secondaryCategory: '锁相环(PLL)',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高性能时钟发生器PLL芯片',
    functionalPerformance: '低抖动，多种输出频率可选',
    referencePrice: 18.20,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '35mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~800MHz',
      memory: '内置锁相环'
    }
  }
];

const DigitalICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<DigitalComponent[]>(mockDigitalData);
  const [filteredData, setFilteredData] = useState<DigitalComponent[]>(mockDigitalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DigitalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDigitalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDigitalData);
  };

  // 查看详情
  const handleViewDetail = (record: DigitalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DigitalComponent, b: DigitalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '量产': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DigitalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            数字单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Digital Integrated Circuits - 微处理器、存储器、逻辑器件、信号处理等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="兆易创新">兆易创新</Option>
                  <Option value="复旦微电子">复旦微电子</Option>
                  <Option value="上海华虹">上海华虹</Option>
                  <Option value="中科昊芯">中科昊芯</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="晶晨半导体">晶晨半导体</Option>
                  <Option value="富满电子">富满电子</Option>
                  <Option value="爱普特微电子">爱普特微电子</Option>
                  <Option value="普冉半导体">普冉半导体</Option>
                  <Option value="矽力杰">矽力杰</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="处理器类">处理器类</Option>
                  <Option value="存储器类">存储器类</Option>
                  <Option value="逻辑器件类">逻辑器件类</Option>
                  <Option value="时钟管理类">时钟管理类</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="微处理器(CPU)">微处理器(CPU)</Option>
                  <Option value="微控制器(MCU)">微控制器(MCU)</Option>
                  <Option value="数字信号处理器(DSP)">数字信号处理器(DSP)</Option>
                  <Option value="现场可编程门阵列(FPGA)">现场可编程门阵列(FPGA)</Option>
                  <Option value="静态随机存储器(SRAM)">静态随机存储器(SRAM)</Option>
                  <Option value="动态随机存储器(DRAM)">动态随机存储器(DRAM)</Option>
                  <Option value="闪存(Flash)">闪存(Flash)</Option>
                  <Option value="只读存储器(ROM)">只读存储器(ROM)</Option>
                  <Option value="门电路">门电路</Option>
                  <Option value="计数器/定时器">计数器/定时器</Option>
                  <Option value="编解码器">编解码器</Option>
                  <Option value="多路复用器">多路复用器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="时钟发生器">时钟发生器</Option>
                  <Option value="锁相环(PLL)">锁相环(PLL)</Option>
                  <Option value="时钟分配器">时钟分配器</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="量产">量产</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="blue">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="存储容量">{selectedComponent.parameters.memory}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DigitalICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 数字单片集成电路数据类型定义
interface DigitalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    memory?: string;
    speed?: string;
  };
}

// 国产数字单片集成电路测试数据
const mockDigitalData: DigitalComponent[] = [
  {
    id: 'D001',
    partNumber: 'GD32F407VET6',
    manufacturer: '兆易创新',
    primaryCategory: '处理器类',
    secondaryCategory: '微控制器(MCU)',
    package: 'LQFP-100',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60749', 'AEC-Q100'],
    description: '32位ARM Cortex-M4内核微控制器',
    functionalPerformance: '168MHz主频，512KB Flash，192KB SRAM',
    referencePrice: 15.80,
    parameters: {
      voltage: '2.6V~3.6V',
      current: '50mA@168MHz',
      temperature: '-40°C~+85°C',
      frequency: '168MHz',
      memory: '512KB Flash + 192KB SRAM'
    }
  },
  {
    id: 'D002',
    partNumber: 'AC7015',
    manufacturer: '复旦微电子',
    primaryCategory: '处理器类',
    secondaryCategory: '现场可编程门阵列(FPGA)',
    package: 'FBGA-484',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '低功耗FPGA芯片，适用于航天应用',
    functionalPerformance: '15K逻辑单元，36个DSP模块，抗辐照设计',
    referencePrice: 850.00,
    parameters: {
      voltage: '1.0V~1.05V',
      current: '150mA@1.0V',
      temperature: '-55°C~+125°C',
      frequency: '300MHz',
      memory: '540Kb块RAM'
    }
  },
  {
    id: 'D003',
    partNumber: 'EM636165TS',
    manufacturer: '上海华虹',
    primaryCategory: '存储器类',
    secondaryCategory: '静态随机存储器(SRAM)',
    package: 'TSOP-44',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD21-C', 'JESD79'],
    description: '16Mb高速SRAM，低功耗设计',
    functionalPerformance: '2M×8位组织，存取时间10ns',
    referencePrice: 28.50,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '90mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '16Mb'
    }
  },
  {
    id: 'D004',
    partNumber: 'BF533SBBC600',
    manufacturer: '中科昊芯',
    primaryCategory: '处理器类',
    secondaryCategory: '数字信号处理器(DSP)',
    package: 'PBGA-88',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'QJ3234'],
    description: '高性能16位定点DSP处理器',
    functionalPerformance: '600MHz主频，单周期MAC运算',
    referencePrice: 320.00,
    parameters: {
      voltage: '1.2V~1.32V',
      current: '300mA@600MHz',
      temperature: '-55°C~+125°C',
      frequency: '600MHz',
      memory: '148KB内置存储器'
    }
  },
  {
    id: 'D005',
    partNumber: 'HC574A',
    manufacturer: '华润微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '计数器/定时器',
    package: 'SOP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位D型触发器，三态输出',
    functionalPerformance: '高速CMOS工艺，低功耗设计',
    referencePrice: 3.20,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '8mA@6V',
      temperature: '-55°C~+125°C',
      frequency: '125MHz',
      memory: '8位寄存器'
    }
  },
  {
    id: 'D006',
    partNumber: 'CSM610A',
    manufacturer: '晶晨半导体',
    primaryCategory: '时钟管理类',
    secondaryCategory: '时钟发生器',
    package: 'QFN-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '多路输出时钟发生器，低抖动',
    functionalPerformance: '4路输出，频率范围1MHz~200MHz',
    referencePrice: 12.50,
    parameters: {
      voltage: '2.5V~3.3V',
      current: '45mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz~200MHz',
      memory: '内置配置寄存器'
    }
  },
  {
    id: 'D007',
    partNumber: 'FM25V02A',
    manufacturer: '富满电子',
    primaryCategory: '存储器类',
    secondaryCategory: '闪存(Flash)',
    package: 'SOP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD216', 'IEC-60749'],
    description: '2Mb串行Flash存储器，SPI接口',
    functionalPerformance: '高速读写，100K次擦写循环',
    referencePrice: 4.80,
    parameters: {
      voltage: '2.7V~3.6V',
      current: '15mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '104MHz SPI',
      memory: '2Mb'
    }
  },
  {
    id: 'D008',
    partNumber: 'AiP8548',
    manufacturer: '爱普特微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '编解码器',
    package: 'TSSOP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '8位二进制译码器，低功耗CMOS',
    functionalPerformance: '3线到8线译码，使能控制功能',
    referencePrice: 1.50,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '2mA@6V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '无'
    }
  },
  {
    id: 'D009',
    partNumber: 'PT2262',
    manufacturer: '普冉半导体',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '多路复用器',
    package: 'DIP-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '遥控编码专用电路',
    functionalPerformance: 'CMOS工艺，12位三态地址/数据编码',
    referencePrice: 2.80,
    parameters: {
      voltage: '4V~15V',
      current: '5mA@12V',
      temperature: '-40°C~+85°C',
      frequency: '10kHz',
      memory: '12位编码'
    }
  },
  {
    id: 'D010',
    partNumber: 'SW3518S',
    manufacturer: '矽力杰',
    primaryCategory: '时钟管理类',
    secondaryCategory: '锁相环(PLL)',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高性能时钟发生器PLL芯片',
    functionalPerformance: '低抖动，多种输出频率可选',
    referencePrice: 18.20,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '35mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~800MHz',
      memory: '内置锁相环'
    }
  }
];

const DigitalICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<DigitalComponent[]>(mockDigitalData);
  const [filteredData, setFilteredData] = useState<DigitalComponent[]>(mockDigitalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DigitalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDigitalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDigitalData);
  };

  // 查看详情
  const handleViewDetail = (record: DigitalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DigitalComponent, b: DigitalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '量产': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DigitalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            数字单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Digital Integrated Circuits - 微处理器、存储器、逻辑器件、信号处理等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="兆易创新">兆易创新</Option>
                  <Option value="复旦微电子">复旦微电子</Option>
                  <Option value="上海华虹">上海华虹</Option>
                  <Option value="中科昊芯">中科昊芯</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="晶晨半导体">晶晨半导体</Option>
                  <Option value="富满电子">富满电子</Option>
                  <Option value="爱普特微电子">爱普特微电子</Option>
                  <Option value="普冉半导体">普冉半导体</Option>
                  <Option value="矽力杰">矽力杰</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="处理器类">处理器类</Option>
                  <Option value="存储器类">存储器类</Option>
                  <Option value="逻辑器件类">逻辑器件类</Option>
                  <Option value="时钟管理类">时钟管理类</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="微处理器(CPU)">微处理器(CPU)</Option>
                  <Option value="微控制器(MCU)">微控制器(MCU)</Option>
                  <Option value="数字信号处理器(DSP)">数字信号处理器(DSP)</Option>
                  <Option value="现场可编程门阵列(FPGA)">现场可编程门阵列(FPGA)</Option>
                  <Option value="静态随机存储器(SRAM)">静态随机存储器(SRAM)</Option>
                  <Option value="动态随机存储器(DRAM)">动态随机存储器(DRAM)</Option>
                  <Option value="闪存(Flash)">闪存(Flash)</Option>
                  <Option value="只读存储器(ROM)">只读存储器(ROM)</Option>
                  <Option value="门电路">门电路</Option>
                  <Option value="计数器/定时器">计数器/定时器</Option>
                  <Option value="编解码器">编解码器</Option>
                  <Option value="多路复用器">多路复用器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="时钟发生器">时钟发生器</Option>
                  <Option value="锁相环(PLL)">锁相环(PLL)</Option>
                  <Option value="时钟分配器">时钟分配器</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="量产">量产</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="blue">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="存储容量">{selectedComponent.parameters.memory}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DigitalICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 半导体分立器件数据类型定义
interface DiscreteComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    resistance?: string;
    capacitance?: string;
    inductance?: string;
  };
}

// 半导体分立器件测试数据
const mockDiscreteData: DiscreteComponent[] = [
  {
    id: 'DS001',
    partNumber: '1N4148W',
    manufacturer: '长电科技',
    primaryCategory: '二极管',
    secondaryCategory: '开关二极管',
    package: 'SOD-123',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: '高速开关二极管，低正向压降',
    functionalPerformance: '快速恢复时间4ns，低漏电流',
    referencePrice: 0.80,
    parameters: {
      voltage: '100V',
      current: '300mA',
      power: '500mW',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '25Ω@100mA',
      capacitance: '4pF@0V',
      inductance: '无'
    }
  },
  {
    id: 'DS002',
    partNumber: 'MMBT2222A',
    manufacturer: '华润微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN通用放大三极管',
    functionalPerformance: '高增益，低噪声，快速开关',
    referencePrice: 1.20,
    parameters: {
      voltage: '40V',
      current: '600mA',
      power: '1W',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '8pF',
      inductance: '无'
    }
  },
  {
    id: 'DS003',
    partNumber: 'IRFZ44N',
    manufacturer: '士兰微',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET，低导通阻抗',
    functionalPerformance: '55V/49A，低Rds(on)=17.5mΩ',
    referencePrice: 8.50,
    parameters: {
      voltage: '55V',
      current: '49A',
      power: '94W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '17.5mΩ',
      capacitance: '1700pF',
      inductance: '无'
    }
  },
  {
    id: 'DS004',
    partNumber: 'BZX84C5V1',
    manufacturer: '韦尔股份',
    primaryCategory: '二极管',
    secondaryCategory: '稳压二极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '5.1V稳压二极管，低动态阻抗',
    functionalPerformance: '精密稳压，温度系数低',
    referencePrice: 0.45,
    parameters: {
      voltage: '5.1V',
      current: '300mA',
      power: '1.3W',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '2Ω@5mA',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS005',
    partNumber: 'SS34',
    manufacturer: '捷捷微电',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'SMA',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基整流二极管，低正向压降',
    functionalPerformance: '快速恢复，低功耗',
    referencePrice: 0.25,
    parameters: {
      voltage: '40V',
      current: '3A',
      power: '无',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS006',
    partNumber: 'AO3401A',
    manufacturer: '新洁能',
    primaryCategory: '场效应管',
    secondaryCategory: 'P沟道MOSFET',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'P沟道小信号MOSFET',
    functionalPerformance: '-30V/-4A，低Rds(on)=44mΩ',
    referencePrice: 0.95,
    parameters: {
      voltage: '-30V',
      current: '-4A',
      power: '1.4W',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1050pF',
      inductance: '无'
    }
  },
  {
    id: 'DS007',
    partNumber: 'MMBT5551',
    manufacturer: '华微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN高压三极管',
    functionalPerformance: '160V耐压，高增益hFE',
    referencePrice: 1.80,
    parameters: {
      voltage: '160V',
      current: '600mA',
      power: '625mW',
      temperature: '-55°C~+150°C',
      frequency: '100MHz',
      resistance: '无',
      capacitance: '4pF',
      inductance: '无'
    }
  },
  {
    id: 'DS008',
    partNumber: '1N5819',
    manufacturer: '扬杰科技',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'DO-41',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基功率二极管',
    functionalPerformance: '40V/1A，低压降0.45V',
    referencePrice: 0.15,
    parameters: {
      voltage: '40V',
      current: '1A',
      power: '无',
      temperature: '-65°C~+125°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS009',
    partNumber: 'BC847C',
    manufacturer: '中芯国际',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'NPN小信号三极管，高增益',
    functionalPerformance: '45V/100mA，hFE=420-800',
    referencePrice: 0.35,
    parameters: {
      voltage: '45V',
      current: '100mA',
      power: '250mW',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '6pF',
      inductance: '无'
    }
  },
  {
    id: 'DS010',
    partNumber: 'IRF540N',
    manufacturer: '华虹半导体',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET',
    functionalPerformance: '100V/33A，Rds(on)=44mΩ',
    referencePrice: 12.50,
    parameters: {
      voltage: '100V',
      current: '33A',
      power: '130W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1900pF',
      inductance: '无'
    }
  }
];

const DiscreteSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [filteredData, setFilteredData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DiscreteComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDiscreteData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDiscreteData);
  };

  // 查看详情
  const handleViewDetail = (record: DiscreteComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="volcano">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="magenta">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DiscreteComponent, b: DiscreteComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DiscreteComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #f5222d 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            半导体分立器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Semiconductor Discrete Devices - 二极管、三极管、场效应管、晶闸管等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="长电科技">长电科技</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="捷捷微电">捷捷微电</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="华微电子">华微电子</Option>
                  <Option value="扬杰科技">扬杰科技</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华虹半导体">华虹半导体</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="二极管">二极管</Option>
                  <Option value="三极管">三极管</Option>
                  <Option value="场效应管">场效应管</Option>
                  <Option value="晶闸管">晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="开关二极管">开关二极管</Option>
                  <Option value="稳压二极管">稳压二极管</Option>
                  <Option value="肖特基二极管">肖特基二极管</Option>
                  <Option value="整流二极管">整流二极管</Option>
                  <Option value="NPN三极管">NPN三极管</Option>
                  <Option value="PNP三极管">PNP三极管</Option>
                  <Option value="达林顿管">达林顿管</Option>
                  <Option value="N沟道MOSFET">N沟道MOSFET</Option>
                  <Option value="P沟道MOSFET">P沟道MOSFET</Option>
                  <Option value="N沟道JFET">N沟道JFET</Option>
                  <Option value="P沟道JFET">P沟道JFET</Option>
                  <Option value="单向晶闸管">单向晶闸管</Option>
                  <Option value="双向晶闸管">双向晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="电阻">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="电容">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DiscreteSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 半导体分立器件数据类型定义
interface DiscreteComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    resistance?: string;
    capacitance?: string;
    inductance?: string;
  };
}

// 半导体分立器件测试数据
const mockDiscreteData: DiscreteComponent[] = [
  {
    id: 'DS001',
    partNumber: '1N4148W',
    manufacturer: '长电科技',
    primaryCategory: '二极管',
    secondaryCategory: '开关二极管',
    package: 'SOD-123',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: '高速开关二极管，低正向压降',
    functionalPerformance: '快速恢复时间4ns，低漏电流',
    referencePrice: 0.80,
    parameters: {
      voltage: '100V',
      current: '300mA',
      power: '500mW',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '25Ω@100mA',
      capacitance: '4pF@0V',
      inductance: '无'
    }
  },
  {
    id: 'DS002',
    partNumber: 'MMBT2222A',
    manufacturer: '华润微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN通用放大三极管',
    functionalPerformance: '高增益，低噪声，快速开关',
    referencePrice: 1.20,
    parameters: {
      voltage: '40V',
      current: '600mA',
      power: '1W',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '8pF',
      inductance: '无'
    }
  },
  {
    id: 'DS003',
    partNumber: 'IRFZ44N',
    manufacturer: '士兰微',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET，低导通阻抗',
    functionalPerformance: '55V/49A，低Rds(on)=17.5mΩ',
    referencePrice: 8.50,
    parameters: {
      voltage: '55V',
      current: '49A',
      power: '94W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '17.5mΩ',
      capacitance: '1700pF',
      inductance: '无'
    }
  },
  {
    id: 'DS004',
    partNumber: 'BZX84C5V1',
    manufacturer: '韦尔股份',
    primaryCategory: '二极管',
    secondaryCategory: '稳压二极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '5.1V稳压二极管，低动态阻抗',
    functionalPerformance: '精密稳压，温度系数低',
    referencePrice: 0.45,
    parameters: {
      voltage: '5.1V',
      current: '300mA',
      power: '1.3W',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '2Ω@5mA',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS005',
    partNumber: 'SS34',
    manufacturer: '捷捷微电',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'SMA',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基整流二极管，低正向压降',
    functionalPerformance: '快速恢复，低功耗',
    referencePrice: 0.25,
    parameters: {
      voltage: '40V',
      current: '3A',
      power: '无',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS006',
    partNumber: 'AO3401A',
    manufacturer: '新洁能',
    primaryCategory: '场效应管',
    secondaryCategory: 'P沟道MOSFET',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'P沟道小信号MOSFET',
    functionalPerformance: '-30V/-4A，低Rds(on)=44mΩ',
    referencePrice: 0.95,
    parameters: {
      voltage: '-30V',
      current: '-4A',
      power: '1.4W',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1050pF',
      inductance: '无'
    }
  },
  {
    id: 'DS007',
    partNumber: 'MMBT5551',
    manufacturer: '华微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN高压三极管',
    functionalPerformance: '160V耐压，高增益hFE',
    referencePrice: 1.80,
    parameters: {
      voltage: '160V',
      current: '600mA',
      power: '625mW',
      temperature: '-55°C~+150°C',
      frequency: '100MHz',
      resistance: '无',
      capacitance: '4pF',
      inductance: '无'
    }
  },
  {
    id: 'DS008',
    partNumber: '1N5819',
    manufacturer: '扬杰科技',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'DO-41',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基功率二极管',
    functionalPerformance: '40V/1A，低压降0.45V',
    referencePrice: 0.15,
    parameters: {
      voltage: '40V',
      current: '1A',
      power: '无',
      temperature: '-65°C~+125°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS009',
    partNumber: 'BC847C',
    manufacturer: '中芯国际',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'NPN小信号三极管，高增益',
    functionalPerformance: '45V/100mA，hFE=420-800',
    referencePrice: 0.35,
    parameters: {
      voltage: '45V',
      current: '100mA',
      power: '250mW',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '6pF',
      inductance: '无'
    }
  },
  {
    id: 'DS010',
    partNumber: 'IRF540N',
    manufacturer: '华虹半导体',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET',
    functionalPerformance: '100V/33A，Rds(on)=44mΩ',
    referencePrice: 12.50,
    parameters: {
      voltage: '100V',
      current: '33A',
      power: '130W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1900pF',
      inductance: '无'
    }
  }
];

const DiscreteSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [filteredData, setFilteredData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DiscreteComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDiscreteData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDiscreteData);
  };

  // 查看详情
  const handleViewDetail = (record: DiscreteComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="volcano">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="magenta">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DiscreteComponent, b: DiscreteComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DiscreteComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #f5222d 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            半导体分立器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Semiconductor Discrete Devices - 二极管、三极管、场效应管、晶闸管等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="长电科技">长电科技</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="捷捷微电">捷捷微电</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="华微电子">华微电子</Option>
                  <Option value="扬杰科技">扬杰科技</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华虹半导体">华虹半导体</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="二极管">二极管</Option>
                  <Option value="三极管">三极管</Option>
                  <Option value="场效应管">场效应管</Option>
                  <Option value="晶闸管">晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="开关二极管">开关二极管</Option>
                  <Option value="稳压二极管">稳压二极管</Option>
                  <Option value="肖特基二极管">肖特基二极管</Option>
                  <Option value="整流二极管">整流二极管</Option>
                  <Option value="NPN三极管">NPN三极管</Option>
                  <Option value="PNP三极管">PNP三极管</Option>
                  <Option value="达林顿管">达林顿管</Option>
                  <Option value="N沟道MOSFET">N沟道MOSFET</Option>
                  <Option value="P沟道MOSFET">P沟道MOSFET</Option>
                  <Option value="N沟道JFET">N沟道JFET</Option>
                  <Option value="P沟道JFET">P沟道JFET</Option>
                  <Option value="单向晶闸管">单向晶闸管</Option>
                  <Option value="双向晶闸管">双向晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="电阻">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="电容">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DiscreteSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 半导体分立器件数据类型定义
interface DiscreteComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    resistance?: string;
    capacitance?: string;
    inductance?: string;
  };
}

// 半导体分立器件测试数据
const mockDiscreteData: DiscreteComponent[] = [
  {
    id: 'DS001',
    partNumber: '1N4148W',
    manufacturer: '长电科技',
    primaryCategory: '二极管',
    secondaryCategory: '开关二极管',
    package: 'SOD-123',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: '高速开关二极管，低正向压降',
    functionalPerformance: '快速恢复时间4ns，低漏电流',
    referencePrice: 0.80,
    parameters: {
      voltage: '100V',
      current: '300mA',
      power: '500mW',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '25Ω@100mA',
      capacitance: '4pF@0V',
      inductance: '无'
    }
  },
  {
    id: 'DS002',
    partNumber: 'MMBT2222A',
    manufacturer: '华润微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN通用放大三极管',
    functionalPerformance: '高增益，低噪声，快速开关',
    referencePrice: 1.20,
    parameters: {
      voltage: '40V',
      current: '600mA',
      power: '1W',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '8pF',
      inductance: '无'
    }
  },
  {
    id: 'DS003',
    partNumber: 'IRFZ44N',
    manufacturer: '士兰微',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET，低导通阻抗',
    functionalPerformance: '55V/49A，低Rds(on)=17.5mΩ',
    referencePrice: 8.50,
    parameters: {
      voltage: '55V',
      current: '49A',
      power: '94W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '17.5mΩ',
      capacitance: '1700pF',
      inductance: '无'
    }
  },
  {
    id: 'DS004',
    partNumber: 'BZX84C5V1',
    manufacturer: '韦尔股份',
    primaryCategory: '二极管',
    secondaryCategory: '稳压二极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '5.1V稳压二极管，低动态阻抗',
    functionalPerformance: '精密稳压，温度系数低',
    referencePrice: 0.45,
    parameters: {
      voltage: '5.1V',
      current: '300mA',
      power: '1.3W',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '2Ω@5mA',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS005',
    partNumber: 'SS34',
    manufacturer: '捷捷微电',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'SMA',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基整流二极管，低正向压降',
    functionalPerformance: '快速恢复，低功耗',
    referencePrice: 0.25,
    parameters: {
      voltage: '40V',
      current: '3A',
      power: '无',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS006',
    partNumber: 'AO3401A',
    manufacturer: '新洁能',
    primaryCategory: '场效应管',
    secondaryCategory: 'P沟道MOSFET',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'P沟道小信号MOSFET',
    functionalPerformance: '-30V/-4A，低Rds(on)=44mΩ',
    referencePrice: 0.95,
    parameters: {
      voltage: '-30V',
      current: '-4A',
      power: '1.4W',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1050pF',
      inductance: '无'
    }
  },
  {
    id: 'DS007',
    partNumber: 'MMBT5551',
    manufacturer: '华微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN高压三极管',
    functionalPerformance: '160V耐压，高增益hFE',
    referencePrice: 1.80,
    parameters: {
      voltage: '160V',
      current: '600mA',
      power: '625mW',
      temperature: '-55°C~+150°C',
      frequency: '100MHz',
      resistance: '无',
      capacitance: '4pF',
      inductance: '无'
    }
  },
  {
    id: 'DS008',
    partNumber: '1N5819',
    manufacturer: '扬杰科技',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'DO-41',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基功率二极管',
    functionalPerformance: '40V/1A，低压降0.45V',
    referencePrice: 0.15,
    parameters: {
      voltage: '40V',
      current: '1A',
      power: '无',
      temperature: '-65°C~+125°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS009',
    partNumber: 'BC847C',
    manufacturer: '中芯国际',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'NPN小信号三极管，高增益',
    functionalPerformance: '45V/100mA，hFE=420-800',
    referencePrice: 0.35,
    parameters: {
      voltage: '45V',
      current: '100mA',
      power: '250mW',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '6pF',
      inductance: '无'
    }
  },
  {
    id: 'DS010',
    partNumber: 'IRF540N',
    manufacturer: '华虹半导体',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET',
    functionalPerformance: '100V/33A，Rds(on)=44mΩ',
    referencePrice: 12.50,
    parameters: {
      voltage: '100V',
      current: '33A',
      power: '130W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1900pF',
      inductance: '无'
    }
  }
];

const DiscreteSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [filteredData, setFilteredData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DiscreteComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDiscreteData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDiscreteData);
  };

  // 查看详情
  const handleViewDetail = (record: DiscreteComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="volcano">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="magenta">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DiscreteComponent, b: DiscreteComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DiscreteComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #f5222d 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            半导体分立器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Semiconductor Discrete Devices - 二极管、三极管、场效应管、晶闸管等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="长电科技">长电科技</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="捷捷微电">捷捷微电</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="华微电子">华微电子</Option>
                  <Option value="扬杰科技">扬杰科技</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华虹半导体">华虹半导体</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="二极管">二极管</Option>
                  <Option value="三极管">三极管</Option>
                  <Option value="场效应管">场效应管</Option>
                  <Option value="晶闸管">晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="开关二极管">开关二极管</Option>
                  <Option value="稳压二极管">稳压二极管</Option>
                  <Option value="肖特基二极管">肖特基二极管</Option>
                  <Option value="整流二极管">整流二极管</Option>
                  <Option value="NPN三极管">NPN三极管</Option>
                  <Option value="PNP三极管">PNP三极管</Option>
                  <Option value="达林顿管">达林顿管</Option>
                  <Option value="N沟道MOSFET">N沟道MOSFET</Option>
                  <Option value="P沟道MOSFET">P沟道MOSFET</Option>
                  <Option value="N沟道JFET">N沟道JFET</Option>
                  <Option value="P沟道JFET">P沟道JFET</Option>
                  <Option value="单向晶闸管">单向晶闸管</Option>
                  <Option value="双向晶闸管">双向晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="电阻">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="电容">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DiscreteSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 机电组件数据类型定义
interface ElectromechanicalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    torque?: string;
    speed?: string;
    force?: string;
    temperature?: string;
  };
}

// 机电组件测试数据
const mockElectromechanicalData: ElectromechanicalComponent[] = [
  {
    id: 'EM001',
    partNumber: 'RLY-24V-DPDT',
    manufacturer: '宏发继电器',
    primaryCategory: '继电器',
    secondaryCategory: '电磁继电器',
    package: 'PCB插件',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB597A', 'MIL-PRF-39016'],
    description: '24V双刀双掷电磁继电器',
    functionalPerformance: '24VDC线圈，触点容量10A/250VAC',
    referencePrice: 35.00,
    parameters: {
      voltage: '24VDC',
      current: '10A',
      power: '2.4W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '10ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM002',
    partNumber: 'SW-Toggle-MS',
    manufacturer: '得捷电子',
    primaryCategory: '开关',
    secondaryCategory: '拨动开关',
    package: '面板安装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['MIL-PRF-8805'],
    description: '军标拨动开关，单刀双掷',
    functionalPerformance: 'SPDT，5A/125VAC，寿命100万次',
    referencePrice: 28.00,
    parameters: {
      voltage: '125VAC',
      current: '5A',
      power: '625W',
      frequency: '无',
      torque: '无',
      speed: '无',
      force: '3N',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM003',
    partNumber: 'CONN-D25-M',
    manufacturer: '航天电器',
    primaryCategory: '连接器',
    secondaryCategory: 'D-SUB连接器',
    package: '金属壳体',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB101A'],
    description: '25针D-SUB公头连接器',
    functionalPerformance: '25针，镀金触点，插拔寿命>5000次',
    referencePrice: 85.00,
    parameters: {
      voltage: '500VDC',
      current: '5A',
      power: '无',
      frequency: '1GHz',
      torque: '无',
      speed: '无',
      force: '20N',
      temperature: '-65°C~+175°C'
    }
  },
  {
    id: 'EM004',
    partNumber: 'FAN-12V-40mm',
    manufacturer: '台达电子',
    primaryCategory: '风扇',
    secondaryCategory: '轴流风扇',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['UL507'],
    description: '12V直流轴流风扇，40mm',
    functionalPerformance: '12VDC，转速7000RPM，风量12CFM',
    referencePrice: 15.00,
    parameters: {
      voltage: '12VDC',
      current: '150mA',
      power: '1.8W',
      frequency: '无',
      torque: '无',
      speed: '7000RPM',
      force: '无',
      temperature: '-10°C~+70°C'
    }
  },
  {
    id: 'EM005',
    partNumber: 'BUZZ-5V-Piezo',
    manufacturer: '福星晓程',
    primaryCategory: '蜂鸣器',
    secondaryCategory: '压电蜂鸣器',
    package: 'PCB安装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60065'],
    description: '5V压电蜂鸣器，2700Hz',
    functionalPerformance: '5VDC，声压级85dB@10cm',
    referencePrice: 3.50,
    parameters: {
      voltage: '5VDC',
      current: '30mA',
      power: '150mW',
      frequency: '2700Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'EM006',
    partNumber: 'FUSE-5A-Fast',
    manufacturer: '力特奥维斯',
    primaryCategory: '熔断器',
    secondaryCategory: '快熔保险丝',
    package: '5×20mm',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60127'],
    description: '5A快熔保险丝，250V',
    functionalPerformance: '5A/250V，分断能力35A',
    referencePrice: 0.80,
    parameters: {
      voltage: '250VAC',
      current: '5A',
      power: '1250W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '<1ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM007',
    partNumber: 'XFMR-230/12V',
    manufacturer: '顺络电子',
    primaryCategory: '变压器',
    secondaryCategory: '电源变压器',
    package: 'EI型铁芯',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61558'],
    description: '230V转12V电源变压器，10VA',
    functionalPerformance: '230VAC输入，12VAC输出，10VA',
    referencePrice: 25.00,
    parameters: {
      voltage: '230/12VAC',
      current: '833mA',
      power: '10VA',
      frequency: '50/60Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'EM008',
    partNumber: 'MOTOR-12V-Gear',
    manufacturer: '兆威机电',
    primaryCategory: '电机',
    secondaryCategory: '直流减速电机',
    package: '金属齿轮箱',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '12V直流减速电机，1:100减速比',
    functionalPerformance: '12VDC，转速30RPM，扭矩2Nm',
    referencePrice: 120.00,
    parameters: {
      voltage: '12VDC',
      current: '500mA',
      power: '6W',
      frequency: '无',
      torque: '2Nm',
      speed: '30RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'EM009',
    partNumber: 'SERVO-180deg',
    manufacturer: '汇川技术',
    primaryCategory: '伺服电机',
    secondaryCategory: '舵机',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '180度舵机，PWM控制',
    functionalPerformance: '6V供电，扭矩1.8kg·cm，180°转角',
    referencePrice: 45.00,
    parameters: {
      voltage: '6VDC',
      current: '200mA',
      power: '1.2W',
      frequency: '50Hz',
      torque: '1.8kg·cm',
      speed: '0.16s/60°',
      force: '无',
      temperature: '-10°C~+60°C'
    }
  },
  {
    id: 'EM010',
    partNumber: 'STEP-200-Bipolar',
    manufacturer: '雷赛智能',
    primaryCategory: '步进电机',
    secondaryCategory: '双极步进电机',
    package: 'NEMA17',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: 'NEMA17双极步进电机，200步/转',
    functionalPerformance: '12V，1.8°步距角，保持扭矩4kg·cm',
    referencePrice: 85.00,
    parameters: {
      voltage: '12VDC',
      current: '1.2A',
      power: '14.4W',
      frequency: '无',
      torque: '4kg·cm',
      speed: '1000RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  }
];

const ElectromechanicalSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [filteredData, setFilteredData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ElectromechanicalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockElectromechanicalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockElectromechanicalData);
  };

  // 查看详情
  const handleViewDetail = (record: ElectromechanicalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="processing">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="default">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: ElectromechanicalComponent, b: ElectromechanicalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: ElectromechanicalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #1890ff 0%, #096dd9 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            机电组件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Electromechanical Components - 继电器、开关、连接器、电机等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="宏发继电器">宏发继电器</Option>
                  <Option value="得捷电子">得捷电子</Option>
                  <Option value="航天电器">航天电器</Option>
                  <Option value="台达电子">台达电子</Option>
                  <Option value="福星晓程">福星晓程</Option>
                  <Option value="力特奥维斯">力特奥维斯</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="兆威机电">兆威机电</Option>
                  <Option value="汇川技术">汇川技术</Option>
                  <Option value="雷赛智能">雷赛智能</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="继电器">继电器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="连接器">连接器</Option>
                  <Option value="风扇">风扇</Option>
                  <Option value="蜂鸣器">蜂鸣器</Option>
                  <Option value="熔断器">熔断器</Option>
                  <Option value="变压器">变压器</Option>
                  <Option value="电机">电机</Option>
                  <Option value="伺服电机">伺服电机</Option>
                  <Option value="步进电机">步进电机</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="扭矩">{selectedComponent.parameters.torque}</Descriptions.Item>
            <Descriptions.Item label="转速">{selectedComponent.parameters.speed}</Descriptions.Item>
            <Descriptions.Item label="作用力">{selectedComponent.parameters.force}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default ElectromechanicalSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 机电组件数据类型定义
interface ElectromechanicalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    torque?: string;
    speed?: string;
    force?: string;
    temperature?: string;
  };
}

// 机电组件测试数据
const mockElectromechanicalData: ElectromechanicalComponent[] = [
  {
    id: 'EM001',
    partNumber: 'RLY-24V-DPDT',
    manufacturer: '宏发继电器',
    primaryCategory: '继电器',
    secondaryCategory: '电磁继电器',
    package: 'PCB插件',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB597A', 'MIL-PRF-39016'],
    description: '24V双刀双掷电磁继电器',
    functionalPerformance: '24VDC线圈，触点容量10A/250VAC',
    referencePrice: 35.00,
    parameters: {
      voltage: '24VDC',
      current: '10A',
      power: '2.4W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '10ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM002',
    partNumber: 'SW-Toggle-MS',
    manufacturer: '得捷电子',
    primaryCategory: '开关',
    secondaryCategory: '拨动开关',
    package: '面板安装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['MIL-PRF-8805'],
    description: '军标拨动开关，单刀双掷',
    functionalPerformance: 'SPDT，5A/125VAC，寿命100万次',
    referencePrice: 28.00,
    parameters: {
      voltage: '125VAC',
      current: '5A',
      power: '625W',
      frequency: '无',
      torque: '无',
      speed: '无',
      force: '3N',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM003',
    partNumber: 'CONN-D25-M',
    manufacturer: '航天电器',
    primaryCategory: '连接器',
    secondaryCategory: 'D-SUB连接器',
    package: '金属壳体',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB101A'],
    description: '25针D-SUB公头连接器',
    functionalPerformance: '25针，镀金触点，插拔寿命>5000次',
    referencePrice: 85.00,
    parameters: {
      voltage: '500VDC',
      current: '5A',
      power: '无',
      frequency: '1GHz',
      torque: '无',
      speed: '无',
      force: '20N',
      temperature: '-65°C~+175°C'
    }
  },
  {
    id: 'EM004',
    partNumber: 'FAN-12V-40mm',
    manufacturer: '台达电子',
    primaryCategory: '风扇',
    secondaryCategory: '轴流风扇',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['UL507'],
    description: '12V直流轴流风扇，40mm',
    functionalPerformance: '12VDC，转速7000RPM，风量12CFM',
    referencePrice: 15.00,
    parameters: {
      voltage: '12VDC',
      current: '150mA',
      power: '1.8W',
      frequency: '无',
      torque: '无',
      speed: '7000RPM',
      force: '无',
      temperature: '-10°C~+70°C'
    }
  },
  {
    id: 'EM005',
    partNumber: 'BUZZ-5V-Piezo',
    manufacturer: '福星晓程',
    primaryCategory: '蜂鸣器',
    secondaryCategory: '压电蜂鸣器',
    package: 'PCB安装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60065'],
    description: '5V压电蜂鸣器，2700Hz',
    functionalPerformance: '5VDC，声压级85dB@10cm',
    referencePrice: 3.50,
    parameters: {
      voltage: '5VDC',
      current: '30mA',
      power: '150mW',
      frequency: '2700Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'EM006',
    partNumber: 'FUSE-5A-Fast',
    manufacturer: '力特奥维斯',
    primaryCategory: '熔断器',
    secondaryCategory: '快熔保险丝',
    package: '5×20mm',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60127'],
    description: '5A快熔保险丝，250V',
    functionalPerformance: '5A/250V，分断能力35A',
    referencePrice: 0.80,
    parameters: {
      voltage: '250VAC',
      current: '5A',
      power: '1250W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '<1ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM007',
    partNumber: 'XFMR-230/12V',
    manufacturer: '顺络电子',
    primaryCategory: '变压器',
    secondaryCategory: '电源变压器',
    package: 'EI型铁芯',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61558'],
    description: '230V转12V电源变压器，10VA',
    functionalPerformance: '230VAC输入，12VAC输出，10VA',
    referencePrice: 25.00,
    parameters: {
      voltage: '230/12VAC',
      current: '833mA',
      power: '10VA',
      frequency: '50/60Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'EM008',
    partNumber: 'MOTOR-12V-Gear',
    manufacturer: '兆威机电',
    primaryCategory: '电机',
    secondaryCategory: '直流减速电机',
    package: '金属齿轮箱',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '12V直流减速电机，1:100减速比',
    functionalPerformance: '12VDC，转速30RPM，扭矩2Nm',
    referencePrice: 120.00,
    parameters: {
      voltage: '12VDC',
      current: '500mA',
      power: '6W',
      frequency: '无',
      torque: '2Nm',
      speed: '30RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'EM009',
    partNumber: 'SERVO-180deg',
    manufacturer: '汇川技术',
    primaryCategory: '伺服电机',
    secondaryCategory: '舵机',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '180度舵机，PWM控制',
    functionalPerformance: '6V供电，扭矩1.8kg·cm，180°转角',
    referencePrice: 45.00,
    parameters: {
      voltage: '6VDC',
      current: '200mA',
      power: '1.2W',
      frequency: '50Hz',
      torque: '1.8kg·cm',
      speed: '0.16s/60°',
      force: '无',
      temperature: '-10°C~+60°C'
    }
  },
  {
    id: 'EM010',
    partNumber: 'STEP-200-Bipolar',
    manufacturer: '雷赛智能',
    primaryCategory: '步进电机',
    secondaryCategory: '双极步进电机',
    package: 'NEMA17',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: 'NEMA17双极步进电机，200步/转',
    functionalPerformance: '12V，1.8°步距角，保持扭矩4kg·cm',
    referencePrice: 85.00,
    parameters: {
      voltage: '12VDC',
      current: '1.2A',
      power: '14.4W',
      frequency: '无',
      torque: '4kg·cm',
      speed: '1000RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  }
];

const ElectromechanicalSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [filteredData, setFilteredData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ElectromechanicalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockElectromechanicalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockElectromechanicalData);
  };

  // 查看详情
  const handleViewDetail = (record: ElectromechanicalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="processing">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="default">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: ElectromechanicalComponent, b: ElectromechanicalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: ElectromechanicalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #1890ff 0%, #096dd9 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            机电组件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Electromechanical Components - 继电器、开关、连接器、电机等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="宏发继电器">宏发继电器</Option>
                  <Option value="得捷电子">得捷电子</Option>
                  <Option value="航天电器">航天电器</Option>
                  <Option value="台达电子">台达电子</Option>
                  <Option value="福星晓程">福星晓程</Option>
                  <Option value="力特奥维斯">力特奥维斯</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="兆威机电">兆威机电</Option>
                  <Option value="汇川技术">汇川技术</Option>
                  <Option value="雷赛智能">雷赛智能</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="继电器">继电器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="连接器">连接器</Option>
                  <Option value="风扇">风扇</Option>
                  <Option value="蜂鸣器">蜂鸣器</Option>
                  <Option value="熔断器">熔断器</Option>
                  <Option value="变压器">变压器</Option>
                  <Option value="电机">电机</Option>
                  <Option value="伺服电机">伺服电机</Option>
                  <Option value="步进电机">步进电机</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="扭矩">{selectedComponent.parameters.torque}</Descriptions.Item>
            <Descriptions.Item label="转速">{selectedComponent.parameters.speed}</Descriptions.Item>
            <Descriptions.Item label="作用力">{selectedComponent.parameters.force}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default ElectromechanicalSearch;

```

---

**User**

还是报错了

(space_env) F:\Business_plat\frontend>npm run build

> business-platform-frontend@0.0.0 build F:\Business_plat\frontend
> tsc && vite build

src/components/Layout.tsx:225:23 - error TS2339: Property 'includes' does not exist on type '{}'.

225     return item.roles.includes(user?.role || '');
                          ~~~~~~~~

src/examples/DynamicParameterTableExample.tsx:197:19 - error TS6133: 'setLoading' is declared but its value is never read.

197   const [loading, setLoading] = useState(false);
                      ~~~~~~~~~~

src/pages/application/FunctionalUnits.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/application/QPLManagement.tsx:16:3 - error TS6133: 'Upload' is declared but its value is never read.

16   Upload,
     ~~~~~~

src/pages/application/QPLManagement.tsx:17:3 - error TS6133: 'Progress' is declared but its value is never read.

17   Progress,
     ~~~~~~~~

src/pages/components/AnalogICSearch.tsx:293:10 - error TS6133: 'data' is declared but its value is never read.

293   const [data] = useState<AnalogComponent[]>(mockAnalogData);
             ~~~~

src/pages/components/ComponentCompare.tsx:6:3 - error TS6133: 'Select' is declared but its value is never read.

6   Select,
    ~~~~~~

src/pages/components/DigitalICSearch.tsx:272:10 - error TS6133: 'data' is declared but its value is never read.

272   const [data] = useState<DigitalComponent[]>(mockDigitalData);
             ~~~~

src/pages/components/DiscreteSearch.tsx:303:10 - error TS6133: 'data' is declared but its value is never read.

303   const [data] = useState<DiscreteComponent[]>(mockDiscreteData);
             ~~~~

src/pages/components/ElectromechanicalSearch.tsx:303:10 - error TS6133: 'data' is declared but its value is never read.

303   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
             ~~~~

src/pages/components/ElectromechanicalSearch.tsx:303:16 - error TS6133: 'setData' is declared but its value is never read.

303   const [data, setData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
                   ~~~~~~~

src/pages/components/GeneralSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/GeneralSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/GeneralSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
             ~~~~

src/pages/components/GeneralSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
                   ~~~~~~~

src/pages/components/HybridICSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/HybridICSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/HybridICSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
             ~~~~

src/pages/components/HybridICSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<HybridComponent[]>(mockHybridData);
                   ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrosystemsSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
             ~~~~

src/pages/components/MicrosystemsSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
                   ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/MicrowaveSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/MicrowaveSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
             ~~~~

src/pages/components/MicrowaveSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
                   ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/OptoelectronicSearch.tsx:304:10 - error TS6133: 'data' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
             ~~~~

src/pages/components/OptoelectronicSearch.tsx:304:16 - error TS6133: 'setData' is declared but its value is never read.

304   const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
                   ~~~~~~~

src/pages/components/PowerSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/PowerSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/PowerSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
             ~~~~

src/pages/components/PowerSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<PowerComponent[]>(mockPowerData);
                   ~~~~~~~

src/pages/components/VacuumSearch.tsx:1:27 - error TS6133: 'useEffect' is declared but its value is never read.

1 import React, { useState, useEffect } from 'react';
                            ~~~~~~~~~

src/pages/components/VacuumSearch.tsx:12:3 - error TS6133: 'Divider' is declared but its value is never read.

12   Divider,
     ~~~~~~~

src/pages/components/VacuumSearch.tsx:256:10 - error TS6133: 'data' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
             ~~~~

src/pages/components/VacuumSearch.tsx:256:16 - error TS6133: 'setData' is declared but its value is never read.

256   const [data, setData] = useState<VacuumComponent[]>(mockVacuumData);
                   ~~~~~~~

src/pages/ContractList.tsx:55:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

55         setContracts(response.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:58:32 - error TS2339: Property 'total' does not exist on type 'Contract[]'.

58           total: response.data.total,
                                  ~~~~~

src/pages/ContractList.tsx:59:34 - error TS2339: Property 'page' does not exist on type 'Contract[]'.

59           current: response.data.page,
                                    ~~~~

src/pages/ContractList.tsx:78:36 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

78         setTenants(tenantsRes.data.items);
                                      ~~~~~

src/pages/ContractList.tsx:81:36 - error TS2339: Property 'items' does not exist on type 'Office[]'.

81         setOffices(officesRes.data.items);
                                      ~~~~~

src/pages/documents/PolicyRegulation.tsx:25:3 - error TS6133: 'SearchOutlined' is declared but its value is never read.

25   SearchOutlined,
     ~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:27:3 - error TS6133: 'CalendarOutlined' is declared but its value is never read.

27   CalendarOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:141:20 - error TS6133: 'setPolicies' is declared but its value is never read.

141   const [policies, setPolicies] = useState<PolicyRegulation[]>(mockPolicyData);
                       ~~~~~~~~~~~

src/pages/documents/PolicyRegulation.tsx:552:21 - error TS2322: Type 'Dispatch<SetStateAction<[Dayjs, Dayjs] | null>>' is not assignable to type '(dates: NoUndefinedRangeValueType<Dayjs> | null, dateStrings: [string, string]) => void'.
  Types of parameters 'value' and 'dates' are incompatible.
    Type 'NoUndefinedRangeValueType<Dayjs> | null' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
      Type 'NoUndefinedRangeValueType<Dayjs>' is not assignable to type 'SetStateAction<[Dayjs, Dayjs] | null>'.
        Type '[start: Dayjs | null, end: Dayjs | null]' is not assignable to type '[Dayjs, Dayjs]'.
          Type at position 0 in source is not compatible with type at position 0 in target.
            Type 'Dayjs | null' is not assignable to type 'Dayjs'.
              Type 'null' is not assignable to type 'Dayjs'.

552                     onChange={setDateRange}
                        ~~~~~~~~

  node_modules/rc-picker/lib/PickerInput/RangePicker.d.ts:15:5
    15     onChange?: (dates: NoUndefinedRangeValueType<DateType> | null, dateStrings: [string, string]) => void;
           ~~~~~~~~
    The expected type comes from property 'onChange' which is declared here on type 'IntrinsicAttributes & Omit<RangePickerProps<Dayjs>, "classNames" | "styles" | "locale" | "generateConfig" | "hideHeader"> & { ...; } & RefAttributes<...>'

src/pages/documents/PolicyRegulation.tsx:599:78 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

599                               <Tag color={getCategoryColor(policy.category)} size="small">
                                                                                 ~~~~

src/pages/documents/PolicyRegulation.tsx:602:70 - error TS2322: Type '{ children: string | undefined; color: string; size: string; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

602                               <Tag color={getTypeColor(policy.type)} size="small">
                                                                         ~~~~

src/pages/documents/TechnicalDocuments.tsx:24:19 - error TS6133: 'setLoading' is declared but its value is never read.

24   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalDocuments.tsx:164:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

164       render: (_, record: TechnicalDocument) => (
                   ~

src/pages/documents/TechnicalNews.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TechnicalNews.tsx:191:9 - error TS6133: 'getImportanceColor' is declared but its value is never read.

191   const getImportanceColor = (importance: string) => {
            ~~~~~~~~~~~~~~~~~~

src/pages/documents/TechnicalTraining.tsx:32:19 - error TS6133: 'setLoading' is declared but its value is never read.

32   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/documents/TestData.tsx:35:19 - error TS6133: 'setLoading' is declared but its value is never read.

35   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/DesignSimulation.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:2:84 - error TS6133: 'Progress' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, InputNumber, Progress, Descriptions, Alert, Tabs, Row, Col, Statistic } from 'antd';
                                                                                     ~~~~~~~~

src/pages/engineering/RadiationAssessment.tsx:38:19 - error TS6133: 'setLoading' is declared but its value is never read.

38   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/SecurityCertification.tsx:27:19 - error TS6133: 'setLoading' is declared but its value is never read.

27   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Sourcing.tsx:173:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

173       render: (_, record: SourcingProject) => (
                   ~

src/pages/engineering/Testing.tsx:22:19 - error TS6133: 'setLoading' is declared but its value is never read.

22   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/engineering/Testing.tsx:75:16 - error TS6133: 'setData' is declared but its value is never read.

75   const [data, setData] = useState<TestingProject[]>(mockData);
                  ~~~~~~~

src/pages/engineering/Testing.tsx:150:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

150       render: (_, record: TestingProject) => (
                   ~

src/pages/FinancialList.tsx:60:34 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

60         setRecords(response.data.items);
                                    ~~~~~

src/pages/FinancialList.tsx:63:32 - error TS2339: Property 'total' does not exist on type 'FinancialRecord[]'.

63           total: response.data.total,
                                  ~~~~~

src/pages/FinancialList.tsx:64:34 - error TS2339: Property 'page' does not exist on type 'FinancialRecord[]'.

64           current: response.data.page,
                                    ~~~~

src/pages/FinancialList.tsx:68:43 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                             ~~~~~

src/pages/FinancialList.tsx:68:57 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                           ~~~

src/pages/FinancialList.tsx:68:62 - error TS7006: Parameter 'record' implicitly has an 'any' type.

68         const totalAmount = response.data.items.reduce((sum, record) => sum + record.amount, 0);
                                                                ~~~~~~

src/pages/FinancialList.tsx:69:42 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

69         const paidAmount = response.data.items
                                            ~~~~~

src/pages/FinancialList.tsx:70:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

70           .filter(record => record.status === 'paid')
                     ~~~~~~

src/pages/FinancialList.tsx:71:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:71:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

71           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:72:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

72         const pendingAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:73:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

73           .filter(record => record.status === 'pending')
                     ~~~~~~

src/pages/FinancialList.tsx:74:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:74:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

74           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:75:45 - error TS2339: Property 'items' does not exist on type 'FinancialRecord[]'.

75         const overdueAmount = response.data.items
                                               ~~~~~

src/pages/FinancialList.tsx:76:19 - error TS7006: Parameter 'record' implicitly has an 'any' type.

76           .filter(record => record.status === 'overdue')
                     ~~~~~~

src/pages/FinancialList.tsx:77:20 - error TS7006: Parameter 'sum' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                      ~~~

src/pages/FinancialList.tsx:77:25 - error TS7006: Parameter 'record' implicitly has an 'any' type.

77           .reduce((sum, record) => sum + record.amount, 0);
                           ~~~~~~

src/pages/FinancialList.tsx:93:36 - error TS2339: Property 'items' does not exist on type 'Contract[]'.

93         setContracts(response.data.items);
                                      ~~~~~

src/pages/HomePage.tsx:14:3 - error TS6133: 'Statistic' is declared but its value is never read.

14   Statistic,
     ~~~~~~~~~

src/pages/HomePage.tsx:15:3 - error TS6133: 'List' is declared but its value is never read.

15   List,
     ~~~~

src/pages/HomePage.tsx:16:3 - error TS6133: 'Avatar' is declared but its value is never read.

16   Avatar,
     ~~~~~~

src/pages/HomePage.tsx:18:3 - error TS6133: 'Tabs' is declared but its value is never read.

18   Tabs,
     ~~~~

src/pages/HomePage.tsx:33:3 - error TS6133: 'DatabaseOutlined' is declared but its value is never read.

33   DatabaseOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:36:3 - error TS6133: 'SettingOutlined' is declared but its value is never read.

36   SettingOutlined,
     ~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:37:3 - error TS6133: 'BugOutlined' is declared but its value is never read.

37   BugOutlined,
     ~~~~~~~~~~~

src/pages/HomePage.tsx:38:3 - error TS6133: 'AppstoreOutlined' is declared but its value is never read.

38   AppstoreOutlined,
     ~~~~~~~~~~~~~~~~

src/pages/HomePage.tsx:51:3 - error TS6133: 'BulbOutlined' is declared but its value is never read.

51   BulbOutlined,
     ~~~~~~~~~~~~

src/pages/HomePage.tsx:52:3 - error TS6133: 'BuildOutlined' is declared but its value is never read.

52   BuildOutlined,
     ~~~~~~~~~~~~~

src/pages/HomePage.tsx:57:7 - error TS6133: 'Option' is declared but its value is never read.

57 const { Option } = Select;
         ~~~~~~~~~~

src/pages/HomePage.tsx:199:7 - error TS6133: 'serviceModules' is declared but its value is never read.

199 const serviceModules = [
          ~~~~~~~~~~~~~~

src/pages/HomePage.tsx:273:7 - error TS6133: 'latestNews' is declared but its value is never read.

273 const latestNews = [
          ~~~~~~~~~~

src/pages/HomePage.tsx:304:10 - error TS6133: 'statsLoading' is declared but its value is never read.

304   const [statsLoading, setStatsLoading] = useState(true);
             ~~~~~~~~~~~~

src/pages/OfficeList.tsx:50:34 - error TS2339: Property 'items' does not exist on type 'Office[]'.

50         setOffices(response.data.items);
                                    ~~~~~

src/pages/OfficeList.tsx:53:32 - error TS2339: Property 'total' does not exist on type 'Office[]'.

53           total: response.data.total,
                                  ~~~~~

src/pages/OfficeList.tsx:54:34 - error TS2339: Property 'page' does not exist on type 'Office[]'.

54           current: response.data.page,
                                    ~~~~

src/pages/procurement/InventoryManagement.tsx:36:19 - error TS6133: 'setLoading' is declared but its value is never read.

36   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/InventoryManagement.tsx:39:10 - error TS6133: 'selectedItem' is declared but its value is never read.

39   const [selectedItem, setSelectedItem] = useState<InventoryItem | null>(null);
            ~~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, DatePicker, Space, Tag, Modal, Form, InputNumber, message } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/procurement/OnlineProcurement.tsx:25:19 - error TS6133: 'setLoading' is declared but its value is never read.

25   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:18:3 - error TS6133: 'Descriptions' is declared but its value is never read.

18   Descriptions,
     ~~~~~~~~~~~~

src/pages/procurement/SupplyChainMonitoring.tsx:32:7 - error TS6133: 'RangePicker' is declared but its value is never read.

32 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:20:19 - error TS6133: 'setLoading' is declared but its value is never read.

20   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityNotifications.tsx:67:16 - error TS6133: 'setData' is declared but its value is never read.

67   const [data, setData] = useState<QualityNotification[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityNotifications.tsx:156:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

156       render: (_, record: QualityNotification) => (
                   ~

src/pages/quality/QualityTraceability.tsx:11:3 - error TS6133: 'Form' is declared but its value is never read.

11   Form,
     ~~~~

src/pages/quality/QualityTraceability.tsx:593:42 - error TS2322: Type '{ children: string; key: string; size: string; color: "blue"; }' is not assignable to type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & TagProps & RefAttributes<HTMLSpanElement>'.

593                           <Tag key={doc} size="small" color="blue">{doc}</Tag>
                                             ~~~~

src/pages/quality/QualityWarnings.tsx:26:19 - error TS6133: 'setLoading' is declared but its value is never read.

26   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/quality/QualityWarnings.tsx:94:16 - error TS6133: 'setData' is declared but its value is never read.

94   const [data, setData] = useState<QualityWarning[]>(mockData);
                  ~~~~~~~

src/pages/quality/QualityWarnings.tsx:203:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

203       render: (_, record: QualityWarning) => (
                   ~

src/pages/quality/QualityZeroDefect.tsx:30:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

30   CloseCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:31:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

31   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/quality/QualityZeroDefect.tsx:65:11 - error TS6196: 'ActionItem' is declared but never used.

65 interface ActionItem {
             ~~~~~~~~~~

src/pages/SelectionManagement.tsx:16:3 - error TS6133: 'InputNumber' is declared but its value is never read.

16   InputNumber,
     ~~~~~~~~~~~

src/pages/SelectionManagement.tsx:24:3 - error TS6133: 'Divider' is declared but its value is never read.

24   Divider
     ~~~~~~~

src/pages/SelectionManagement.tsx:36:3 - error TS6133: 'DollarCircleOutlined' is declared but its value is never read.

36   DollarCircleOutlined
     ~~~~~~~~~~~~~~~~~~~~

src/pages/SelectionManagement.tsx:43:7 - error TS6133: 'RangePicker' is declared but its value is never read.

43 const { RangePicker } = DatePicker;
         ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:22:3 - error TS6133: 'Tree' is declared but its value is never read.

22   Tree,
     ~~~~

src/pages/standards/StandardComparison.tsx:23:3 - error TS6133: 'Timeline' is declared but its value is never read.

23   Timeline
     ~~~~~~~~

src/pages/standards/StandardComparison.tsx:30:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

30   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS2724: '"@ant-design/icons"' has no exported member named 'CompareOutlined'. Did you mean 'CompressOutlined'?

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:31:3 - error TS6133: 'CompareOutlined' is declared but its value is never read.

31   CompareOutlined,
     ~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:33:3 - error TS6133: 'CheckCircleOutlined' is declared but its value is never read.

33   CheckCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:34:3 - error TS6133: 'ExclamationCircleOutlined' is declared but its value is never read.

34   ExclamationCircleOutlined,
     ~~~~~~~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardComparison.tsx:35:3 - error TS6133: 'CloseCircleOutlined' is declared but its value is never read.

35   CloseCircleOutlined
     ~~~~~~~~~~~~~~~~~~~

src/pages/standards/StandardDocuments.tsx:125:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

125       render: (_, record: StandardDocument) => (
                   ~

src/pages/standards/VersionManagement.tsx:31:7 - error TS6133: 'TextArea' is declared but its value is never read.

31 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/standards/VersionManagement.tsx:65:10 - error TS6133: 'form' is declared but its value is never read.

65   const [form] = Form.useForm();
            ~~~~

src/pages/SupplierSearch.tsx:21:3 - error TS6133: 'Divider' is declared but its value is never read.

21   Divider,
     ~~~~~~~

src/pages/SupplierSearch.tsx:24:3 - error TS6133: 'Timeline' is declared but its value is never read.

24   Timeline,
     ~~~~~~~~

src/pages/SupplierSearch.tsx:32:3 - error TS6133: 'HistoryOutlined' is declared but its value is never read.

32   HistoryOutlined,
     ~~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:38:3 - error TS6133: 'DollarOutlined' is declared but its value is never read.

38   DollarOutlined,
     ~~~~~~~~~~~~~~

src/pages/SupplierSearch.tsx:46:9 - error TS6133: 'Title' is declared but its value is never read.

46 const { Title, Text } = Typography;
           ~~~~~

src/pages/SupplierSearch.tsx:258:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

258       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:280:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

280       render: (_, supplier: Supplier) => {
                   ~

src/pages/SupplierSearch.tsx:300:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

300       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:323:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

323       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:327:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

327             <Rate disabled size="small" value={supplier.performance?.qualityRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:331:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

331             <Rate disabled size="small" value={supplier.performance?.deliveryRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:335:28 - error TS2322: Type '{ disabled: true; size: string; value: any; }' is not assignable to type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.
  Property 'size' does not exist on type 'IntrinsicAttributes & RateProps & RefAttributes<RateRef>'.

335             <Rate disabled size="small" value={supplier.performance?.serviceRating || 0} />
                               ~~~~

src/pages/SupplierSearch.tsx:344:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

344       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:377:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

377       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:395:16 - error TS7006: Parameter '_' implicitly has an 'any' type.

395       render: (_, supplier: Supplier) => (
                   ~

src/pages/SupplierSearch.tsx:750:88 - error TS6133: 'index' is declared but its value is never read.

750               {suppliers.filter(s => selectedForCompare.includes(s.id)).map((supplier, index) => (
                                                                                           ~~~~~

src/pages/SupplierSearch.tsx:772:53 - error TS2339: Property 'type' does not exist on type 'Supplier'.

772                         <Tag color="blue">{supplier.type}</Tag>
                                                        ~~~~

src/pages/SupplierSearch.tsx:775:46 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                 ~~~~~

src/pages/SupplierSearch.tsx:775:82 - error TS2339: Property 'level' does not exist on type 'Supplier'.

775                         <Tag color={supplier.level === '一级' ? 'green' : supplier.level === '二级' ? 'orange' : 'red'}>
                                                                                     ~~~~~

src/pages/SupplierSearch.tsx:776:37 - error TS2339: Property 'level' does not exist on type 'Supplier'.

776                           {supplier.level}
                                        ~~~~~

src/pages/SupplierSearch.tsx:785:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

785                         {supplier.products.slice(0, 3).join(', ')}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:786:35 - error TS2339: Property 'products' does not exist on type 'Supplier'.

786                         {supplier.products.length > 3 && '...'}
                                      ~~~~~~~~

src/pages/SupplierSearch.tsx:789:35 - error TS2339: Property 'contact' does not exist on type 'Supplier'.

789                         {supplier.contact}
                                      ~~~~~~~

src/pages/SupplierSearch.tsx:792:63 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

792                         <Rate disabled defaultValue={supplier.rating} style={{ fontSize: 14 }} />
                                                                  ~~~~~~

src/pages/SupplierSearch.tsx:793:67 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

793                         <span style={{ marginLeft: 8 }}>{supplier.rating}/5</span>
                                                                      ~~~~~~

src/pages/SupplierSearch.tsx:846:60 - error TS2339: Property 'rating' does not exist on type 'Supplier'.

846                         <span style={{ marginLeft: 4 }}>{s.rating}</span>
                                                               ~~~~~~

src/pages/TenantList.tsx:49:34 - error TS2339: Property 'items' does not exist on type 'Tenant[]'.

49         setTenants(response.data.items);
                                    ~~~~~

src/pages/TenantList.tsx:52:32 - error TS2339: Property 'total' does not exist on type 'Tenant[]'.

52           total: response.data.total,
                                  ~~~~~

src/pages/TenantList.tsx:53:34 - error TS2339: Property 'page' does not exist on type 'Tenant[]'.

53           current: response.data.page,
                                    ~~~~

src/pages/test/ComponentIdentification.tsx:13:3 - error TS6133: 'InputNumber' is declared but its value is never read.

13   InputNumber,
     ~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:29:3 - error TS6133: 'DeleteOutlined' is declared but its value is never read.

29   DeleteOutlined,
     ~~~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:39:7 - error TS6133: 'TextArea' is declared but its value is never read.

39 const { TextArea } = Input;
         ~~~~~~~~~~~~

src/pages/test/ComponentIdentification.tsx:151:23 - error TS2322: Type 'string' is not assignable to type '"default" | "success" | "warning" | "error" | "processing" | undefined'.

151         return <Badge status={color} icon={icon} text={text} />;
                          ~~~~~~

  node_modules/antd/es/badge/index.d.ts:21:5
    21     status?: PresetStatusColorType;
           ~~~~~~
    The expected type comes from property 'status' which is declared here on type 'IntrinsicAttributes & BadgeProps & RefAttributes<HTMLSpanElement>'

src/pages/testing/RadiationTesting.tsx:2:83 - error TS6133: 'InputNumber' is declared but its value is never read.

2 import { Card, Table, Button, Input, Select, Space, Tag, Modal, Form, DatePicker, InputNumber } from 'antd';
                                                                                    ~~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:23:19 - error TS6133: 'setLoading' is declared but its value is never read.

23   const [loading, setLoading] = useState(false);
                     ~~~~~~~~~~

src/pages/testing/RadiationTesting.tsx:118:19 - error TS6133: 'record' is declared but its value is never read.

118       render: (_, record) => (
                      ~~~~~~

src/pages/UserList.tsx:48:32 - error TS2339: Property 'items' does not exist on type 'User[]'.

48         setUsers(response.data.items);
                                  ~~~~~

src/pages/UserList.tsx:51:32 - error TS2339: Property 'total' does not exist on type 'User[]'.

51           total: response.data.total,
                                  ~~~~~

src/pages/UserList.tsx:52:34 - error TS2339: Property 'page' does not exist on type 'User[]'.

52           current: response.data.page,
                                    ~~~~

src/utils/parameterUtils.tsx:244:3 - error TS6133: 'param' is declared but its value is never read.

244   param?: ParameterDefinition
      ~~~~~


Found 172 errors in 47 files.

Errors  Files
     1  src/components/Layout.tsx:225
     1  src/examples/DynamicParameterTableExample.tsx:197
     1  src/pages/application/FunctionalUnits.tsx:23
     2  src/pages/application/QPLManagement.tsx:16
     1  src/pages/components/AnalogICSearch.tsx:293
     1  src/pages/components/ComponentCompare.tsx:6
     1  src/pages/components/DigitalICSearch.tsx:272
     1  src/pages/components/DiscreteSearch.tsx:303
     2  src/pages/components/ElectromechanicalSearch.tsx:303
     4  src/pages/components/GeneralSearch.tsx:1
     4  src/pages/components/HybridICSearch.tsx:1
     4  src/pages/components/MicrosystemsSearch.tsx:1
     4  src/pages/components/MicrowaveSearch.tsx:1
     4  src/pages/components/OptoelectronicSearch.tsx:1
     4  src/pages/components/PowerSearch.tsx:1
     4  src/pages/components/VacuumSearch.tsx:1
     5  src/pages/ContractList.tsx:55
     6  src/pages/documents/PolicyRegulation.tsx:25
     2  src/pages/documents/TechnicalDocuments.tsx:24
     2  src/pages/documents/TechnicalNews.tsx:27
     1  src/pages/documents/TechnicalTraining.tsx:32
     1  src/pages/documents/TestData.tsx:35
     1  src/pages/engineering/DesignSimulation.tsx:36
     2  src/pages/engineering/RadiationAssessment.tsx:2
     1  src/pages/engineering/SecurityCertification.tsx:27
     1  src/pages/engineering/Sourcing.tsx:173
     3  src/pages/engineering/Testing.tsx:22
    19  src/pages/FinancialList.tsx:60
    14  src/pages/HomePage.tsx:14
     3  src/pages/OfficeList.tsx:50
     2  src/pages/procurement/InventoryManagement.tsx:36
     2  src/pages/procurement/OnlineProcurement.tsx:2
     2  src/pages/procurement/SupplyChainMonitoring.tsx:18
     3  src/pages/quality/QualityNotifications.tsx:20
     2  src/pages/quality/QualityTraceability.tsx:11
     3  src/pages/quality/QualityWarnings.tsx:26
     3  src/pages/quality/QualityZeroDefect.tsx:30
     4  src/pages/SelectionManagement.tsx:16
     8  src/pages/standards/StandardComparison.tsx:22
     1  src/pages/standards/StandardDocuments.tsx:125
     2  src/pages/standards/VersionManagement.tsx:31
    26  src/pages/SupplierSearch.tsx:21
     3  src/pages/TenantList.tsx:49
     4  src/pages/test/ComponentIdentification.tsx:13
     3  src/pages/testing/RadiationTesting.tsx:2
     3  src/pages/UserList.tsx:48
     1  src/utils/parameterUtils.tsx:244
npm ERR! code ELIFECYCLE
npm ERR! errno 2
npm ERR! business-platform-frontend@0.0.0 build: `tsc && vite build`
npm ERR! Exit status 2
npm ERR!
npm ERR! Failed at the business-platform-frontend@0.0.0 build script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     C:\Users\46482\AppData\Roaming\npm-cache\_logs\2025-11-16T03_06_50_532Z-debug.log

(space_env) F:\Business_plat\frontend>

---

**Cursor**

创建修复计划，开始修复这些错误：


修复这些错误，从最关键的开始：


```typescriptreact
import React, { useState } from 'react';
import { Outlet, useNavigate, useLocation } from 'react-router-dom';
import {
  Layout as AntLayout,
  Menu,
  Dropdown,
  Avatar,
  theme,
  Space,
  Row,
  Col,
  Button,
  Drawer,
} from 'antd';

import {
  DashboardOutlined,
  SearchOutlined,
  ShoppingCartOutlined,
  ExperimentOutlined,
  SafetyOutlined,
  ToolOutlined,
  BookOutlined,
  CloudServerOutlined,
  UserOutlined,
  LogoutOutlined,
  SettingOutlined,
  MenuOutlined,
} from '@ant-design/icons';
import { useAuth } from '@/hooks/useAuth';
import './layout.css';

const { Header, Content } = AntLayout;

const Layout: React.FC = () => {
  const [mobileMenuVisible, setMobileMenuVisible] = useState(false);
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  const {
    token: { colorBgContainer },
  } = theme.useToken();

  // 菜单项配置 - 基于7大核心模块
  const menuItems = [
    {
      key: '/',
      icon: <DashboardOutlined />,
      label: '首页',
    },
    {
      key: '/standards',
      icon: <BookOutlined />,
      label: '标准服务',
      children: [
        {
          key: '/standards/search',
          label: '标准查询',
        },
        {
          key: '/standards/compare',
          label: '标准对比',
        },
        {
          key: '/standards/versions',
          label: '版本管理',
        },
        {
          key: '/standards/analysis',
          label: '标准解析',
        },
      ],
    },
    {
      key: '/components',
      icon: <SearchOutlined />,
      label: '器件查询',
      children: [
        {
          key: '/components/search',
          label: '智能搜索',
        },
        {
          key: '/components/compare',
          label: '器件比对',
        },
        {
          key: '/components/suppliers',
          label: '供应商检索',
        },
        {
          key: '/components/selection',
          label: '在线选用',
        },
      ],
    },
    {
      key: '/procurement',
      icon: <ShoppingCartOutlined />,
      label: '采购服务',
      children: [
        {
          key: '/procurement/sourcing',
          label: '货源开发',
        },
        {
          key: '/procurement/online',
          label: '在线采购',
        },
        {
          key: '/procurement/inventory',
          label: '库存追踪',
        },
        {
          key: '/procurement/supply-chain',
          label: '供应链监控',
        },
      ],
    },
    {
      key: '/application',
      icon: <ToolOutlined />,
      label: '应用支持',
      children: [
        {
          key: '/application/units',
          label: '功能单元',
        },
        {
          key: '/application/models',
          label: '数字模型',
        },
        {
          key: '/application/simulation',
          label: '应用仿真',
        },
        {
          key: '/application/qpl',
          label: '合格产品目录',
        },
        {
          key: '/application/counterfeit',
          label: '假冒伪劣库',
        },
      ],
    },
    {
      key: '/quality',
      icon: <SafetyOutlined />,
      label: '质量管理',
      children: [
        {
          key: '/quality/zero-defect',
          label: '质量归零',
        },
        {
          key: '/quality/notification',
          label: '质量通报',
        },
        {
          key: '/quality/warning',
          label: '预警发布',
        },
        {
          key: '/quality/traceability',
          label: '追溯查询',
        },
      ],
    },
    {
      key: '/testing',
      icon: <ExperimentOutlined />,
      label: '试验检测',
      children: [
        {
          key: '/testing/routine',
          label: '常规检测',
        },
        {
          key: '/testing/qualification',
          label: '器件鉴定',
        },
        {
          key: '/testing/radiation',
          label: '辐照评估',
        },
        {
          key: '/testing/supply-security',
          label: '供应安全评价',
        },
      ],
    },
    {
      key: '/documents',
      icon: <CloudServerOutlined />,
      label: '资料及培训',
      children: [
        {
          key: '/documents/technical',
          label: '技术文档',
        },
        {
          key: '/documents/test-data',
          label: '测试数据',
        },
        {
          key: '/documents/news',
          label: '技术动态',
        },
        {
          key: '/documents/training',
          label: '技术培训',
        },
        {
          key: '/documents/policy',
          label: '政策法规',
        },
      ],
    },
  ];

  // 根据用户角色过滤菜单
  const filteredMenuItems = menuItems.filter(item => {
    if (!('roles' in item) || !item.roles) return true;
    const roles = item.roles as string[];
    return Array.isArray(roles) && roles.includes(user?.role || '');
  });

  const handleMenuClick = ({ key }: { key: string }) => {
    navigate(key);
  };

  const handleLogout = () => {
    logout();
  };

  const userMenuItems = [
    {
      key: 'profile',
      icon: <UserOutlined />,
      label: '个人资料',
    },
    {
      key: 'settings',
      icon: <SettingOutlined />,
      label: '设置',
    },
    {
      type: 'divider' as const,
    },
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: '退出登录',
      onClick: handleLogout,
    },
  ];

  return (
    <AntLayout style={{ minHeight: '100vh' }}>
      <Header className="top-navigation" style={{ 
        background: '#001529',
        padding: '0 24px',
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1000,
      }}>
        <Row justify="space-between" align="middle" style={{ height: '100%' }}>
          <Col flex="auto">
            <div 
              className="platform-logo"
              onClick={() => navigate('/')}
              style={{ cursor: 'pointer' }}
            >
              <span style={{ 
                color: '#ffffff', 
                fontSize: '24px', 
                fontWeight: 'bold',
                letterSpacing: '2px'
              }}>
                CASI
              </span>
            </div>
            <Menu
              theme="dark"
              mode="horizontal"
              selectedKeys={[location.pathname]}
              items={filteredMenuItems}
              onClick={handleMenuClick}
              style={{ 
                background: 'transparent',
                border: 'none',
                display: 'inline-block',
                lineHeight: '64px',
              }}
              className="desktop-menu"
            />
            <Button
              type="text"
              icon={<MenuOutlined />}
              onClick={() => setMobileMenuVisible(true)}
              className="mobile-menu-trigger"
              style={{ color: 'white', display: 'none' }}
            />
          </Col>
          <Col>
            <Space>
              <span className="user-info">
                欢迎，{user?.username}
              </span>
              <Dropdown
                menu={{ items: userMenuItems }}
                placement="bottomRight"
                arrow
              >
                <Avatar 
                  style={{ backgroundColor: '#1890ff', cursor: 'pointer' }}
                  icon={<UserOutlined />}
                />
              </Dropdown>
            </Space>
          </Col>
        </Row>
      </Header>

      {/* 移动端抽屉菜单 */}
      <Drawer
        title="导航菜单"
        placement="left"
        onClose={() => setMobileMenuVisible(false)}
        open={mobileMenuVisible}
        styles={{ body: { padding: 0 } }}
      >
        <Menu
          mode="inline"
          selectedKeys={[location.pathname]}
          items={filteredMenuItems}
          onClick={(info) => {
            handleMenuClick(info);
            setMobileMenuVisible(false);
          }}
        />
      </Drawer>

      <Content
        className="main-content"
        style={{
          marginTop: '64px',
          padding: location.pathname === '/' ? '0' : '24px',
          minHeight: 'calc(100vh - 64px)',
          background: location.pathname === '/' ? 'transparent' : colorBgContainer,
        }}
      >
        <Outlet />
      </Content>
    </AntLayout>
  );
};

export default Layout;

```

检查 API 响应类型定义：


检查 API 服务的实际返回类型：


修复类型定义，使其匹配实际 API 响应结构。先更新类型定义，然后修复所有使用处：


```typescript
// 用户相关类型
export interface User {
  id: number;
  username: string;
  email: string;
  role: 'admin' | 'tenant' | 'staff';
  created_at: string;
  updated_at: string;
}

// 租户相关类型
export interface Tenant {
  id: number;
  name: string;
  contact_person: string;
  phone: string;
  email: string;
  address: string;
  status: 'active' | 'inactive';
  created_at: string;
  updated_at: string;
}

// 办公空间相关类型
export interface Office {
  id: number;
  name: string;
  description: string;
  area: number;
  capacity: number;
  price_per_month: number;
  status: 'available' | 'occupied' | 'maintenance';
  amenities: string[];
  images: string[];
  floor: number;
  created_at: string;
  updated_at: string;
}

// 租赁合同相关类型
export interface Contract {
  id: number;
  tenant_id: number;
  office_id: number;
  start_date: string;
  end_date: string;
  monthly_rent: number;
  deposit: number;
  status: 'active' | 'expired' | 'terminated';
  terms: string;
  created_at: string;
  updated_at: string;
  tenant?: Tenant;
  office?: Office;
}

// 财务记录相关类型
export interface FinancialRecord {
  id: number;
  contract_id: number;
  type: 'rent' | 'deposit' | 'utility' | 'service';
  amount: number;
  description: string;
  date: string;
  status: 'paid' | 'pending' | 'overdue';
  created_at: string;
  updated_at: string;
  contract?: Contract;
}

// API响应类型
export interface ApiResponse<T> {
  success: boolean;
  data: T;
  message?: string;
  errors?: Record<string, string[]>;
}

// 分页响应类型
export interface PaginatedResponse<T> {
  success: boolean;
  data: T[] | {
    items: T[];
    total: number;
    page: number;
  };
  pagination?: {
    currentPage: number;
    totalPages: number;
    totalItems: number;
    itemsPerPage: number;
    hasNextPage: boolean;
    hasPrevPage: boolean;
  };
  message?: string;
  timestamp?: string;
}

// 登录请求类型
export interface LoginRequest {
  username: string;
  password: string;
}

// 登录响应类型
export interface LoginResponse {
  access_token: string;
  token_type: string;
  user: User;
}

// 器件相关类型
export interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  category: string;
  subcategory?: string;
  // 三级分类系统
  category1?: string;
  category2?: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  packageType: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  pricing?: {
    price: number;
    currency: string;
    supplier: string;
    quantity: number;
  }[];
  availability?: {
    supplier: string;
    stockQuantity: number;
    leadTime: number;
    minimumOrder: number;
  }[];
  certifications: string[];
  datasheet?: string;
  lifecycle: 'active' | 'discontinued' | 'not_recommended';
  inStock?: boolean;
  stock?: number;
  createdAt?: string | Date;
  updatedAt?: string | Date;
}

// 器件搜索参数
export interface ComponentSearchParams {
  partNumber?: string;
  manufacturer?: string;
  category?: string;
  specifications?: Record<string, any>;
  priceRange?: {
    min: number;
    max: number;
  };
  availability?: boolean;
  certifications?: string[];
  packageType?: string;
  operatingTemp?: {
    min: number;
    max: number;
  };
  page?: number;
  pageSize?: number;
  sortBy?: 'price' | 'availability' | 'rating' | 'partNumber';
  sortOrder?: 'asc' | 'desc';
}

// 器件对比结果
export interface ComponentComparisonResult {
  components: Component[];
  comparisonMatrix: {
    [componentId: string]: {
      [attribute: string]: any;
    };
  };
  recommendations: {
    componentId: string;
    reason: string;
    score: number;
  }[];
}
```

修复所有使用这些 API 的地方，添加类型检查：


```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  InputNumber,
  DatePicker,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined } from '@ant-design/icons';
import { contractAPI, tenantAPI, officeAPI } from '@/services/api';
import type { Contract, PaginatedResponse, Tenant, Office } from '@/types';
import dayjs from 'dayjs';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;


const ContractList: React.FC = () => {
  const [contracts, setContracts] = useState<Contract[]>([]);
  const [tenants, setTenants] = useState<Tenant[]>([]);
  const [offices, setOffices] = useState<Office[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingContract, setEditingContract] = useState<Contract | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [searchForm] = Form.useForm();
  const [contractForm] = Form.useForm();

  // 获取合同列表
  const fetchContracts = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<Contract> = await contractAPI.getContracts({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setContracts(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
      }
    } catch (error) {
      message.error('获取合同列表失败');
    } finally {
      setLoading(false);
    }
  };

  // 获取租户和办公空间列表
  const fetchSelectOptions = async () => {
    try {
      const [tenantsRes, officesRes] = await Promise.all([
        tenantAPI.getTenants({ per_page: 1000 }),
        officeAPI.getOffices({ per_page: 1000 }),
      ]);
      
      if (tenantsRes.success) {
        setTenants(tenantsRes.data.items);
      }
      if (officesRes.success) {
        setOffices(officesRes.data.items);
      }
    } catch (error) {
      message.error('获取选项数据失败');
    }
  };

  useEffect(() => {
    fetchContracts();
    fetchSelectOptions();
  }, [pagination.current, pagination.pageSize]);

  // 搜索合同
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchContracts(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchContracts();
  };

  // 打开新增/编辑模态框
  const showModal = (contract?: Contract) => {
    setEditingContract(contract || null);
    setModalVisible(true);
    if (contract) {
      contractForm.setFieldsValue({
        ...contract,
        start_date: contract.start_date ? dayjs(contract.start_date) : null,
        end_date: contract.end_date ? dayjs(contract.end_date) : null,
      });
    } else {
      contractForm.resetFields();
    }
  };

  // 保存合同
  const handleSave = async (values: any) => {
    try {
      const submitData = {
        ...values,
        start_date: values.start_date ? values.start_date.format('YYYY-MM-DD') : null,
        end_date: values.end_date ? values.end_date.format('YYYY-MM-DD') : null,
      };
      
      if (editingContract) {
        await contractAPI.updateContract(editingContract.id, submitData);
        message.success('更新合同成功');
      } else {
        await contractAPI.createContract(submitData);
        message.success('创建合同成功');
      }
      setModalVisible(false);
      fetchContracts();
    } catch (error) {
      message.error(editingContract ? '更新合同失败' : '创建合同失败');
    }
  };

  // 删除合同
  const handleDelete = async (id: number) => {
    try {
      await contractAPI.deleteContract(id);
      message.success('删除合同成功');
      fetchContracts();
    } catch (error) {
      message.error('删除合同失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '租户',
      dataIndex: 'tenant',
      key: 'tenant',
      render: (tenant: Tenant) => tenant?.name || '-',
    },
    {
      title: '办公空间',
      dataIndex: 'office',
      key: 'office',
      render: (office: Office) => office?.name || '-',
    },
    {
      title: '开始日期',
      dataIndex: 'start_date',
      key: 'start_date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '结束日期',
      dataIndex: 'end_date',
      key: 'end_date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '月租金',
      dataIndex: 'monthly_rent',
      key: 'monthly_rent',
      render: (price: number) => `¥${price.toLocaleString()}`,
    },
    {
      title: '押金',
      dataIndex: 'deposit',
      key: 'deposit',
      render: (price: number) => `¥${price.toLocaleString()}`,
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          active: 'green',
          expired: 'red',
          terminated: 'orange',
        };
        const labels = {
          active: '生效中',
          expired: '已过期',
          terminated: '已终止',
        };
        return (
          <Tag color={colors[status as keyof typeof colors]}>
            {labels[status as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: Contract) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这个合同吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>租赁合同管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增合同
        </Button>
      </div>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="tenant_id" label="租户">
                <Select placeholder="请选择租户" allowClear>
                  {tenants.map(tenant => (
                    <Option key={tenant.id} value={tenant.id}>
                      {tenant.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="office_id" label="办公空间">
                <Select placeholder="请选择办公空间" allowClear>
                  {offices.map(office => (
                    <Option key={office.id} value={office.id}>
                      {office.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="active">生效中</Option>
                  <Option value="expired">已过期</Option>
                  <Option value="terminated">已终止</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 合同表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={contracts}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingContract ? '编辑合同' : '新增合同'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={800}
      >
        <Form
          form={contractForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="tenant_id"
                label="租户"
                rules={[{ required: true, message: '请选择租户' }]}
              >
                <Select placeholder="请选择租户">
                  {tenants.map(tenant => (
                    <Option key={tenant.id} value={tenant.id}>
                      {tenant.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="office_id"
                label="办公空间"
                rules={[{ required: true, message: '请选择办公空间' }]}
              >
                <Select placeholder="请选择办公空间">
                  {offices.filter(office => office.status === 'available').map(office => (
                    <Option key={office.id} value={office.id}>
                      {office.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="start_date"
                label="开始日期"
                rules={[{ required: true, message: '请选择开始日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="end_date"
                label="结束日期"
                rules={[{ required: true, message: '请选择结束日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="monthly_rent"
                label="月租金(元)"
                rules={[{ required: true, message: '请输入月租金' }]}
              >
                <InputNumber placeholder="请输入月租金" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="deposit"
                label="押金(元)"
                rules={[{ required: true, message: '请输入押金' }]}
              >
                <InputNumber placeholder="请输入押金" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="terms"
            label="合同条款"
          >
            <TextArea rows={4} placeholder="请输入合同条款" />
          </Form.Item>

          <Form.Item
            name="status"
            label="状态"
            rules={[{ required: true, message: '请选择状态' }]}
          >
            <Select placeholder="请选择状态">
              <Option value="active">生效中</Option>
              <Option value="expired">已过期</Option>
              <Option value="terminated">已终止</Option>
            </Select>
          </Form.Item>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default ContractList;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  InputNumber,
  DatePicker,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined } from '@ant-design/icons';
import { contractAPI, tenantAPI, officeAPI } from '@/services/api';
import type { Contract, PaginatedResponse, Tenant, Office } from '@/types';
import dayjs from 'dayjs';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;


const ContractList: React.FC = () => {
  const [contracts, setContracts] = useState<Contract[]>([]);
  const [tenants, setTenants] = useState<Tenant[]>([]);
  const [offices, setOffices] = useState<Office[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingContract, setEditingContract] = useState<Contract | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [searchForm] = Form.useForm();
  const [contractForm] = Form.useForm();

  // 获取合同列表
  const fetchContracts = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<Contract> = await contractAPI.getContracts({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setContracts(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
      }
    } catch (error) {
      message.error('获取合同列表失败');
    } finally {
      setLoading(false);
    }
  };

  // 获取租户和办公空间列表
  const fetchSelectOptions = async () => {
    try {
      const [tenantsRes, officesRes] = await Promise.all([
        tenantAPI.getTenants({ per_page: 1000 }),
        officeAPI.getOffices({ per_page: 1000 }),
      ]);
      
      if (tenantsRes.success) {
        const tenantsData = Array.isArray(tenantsRes.data) ? tenantsRes.data : tenantsRes.data.items;
        setTenants(tenantsData);
      }
      if (officesRes.success) {
        const officesData = Array.isArray(officesRes.data) ? officesRes.data : officesRes.data.items;
        setOffices(officesData);
      }
    } catch (error) {
      message.error('获取选项数据失败');
    }
  };

  useEffect(() => {
    fetchContracts();
    fetchSelectOptions();
  }, [pagination.current, pagination.pageSize]);

  // 搜索合同
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchContracts(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchContracts();
  };

  // 打开新增/编辑模态框
  const showModal = (contract?: Contract) => {
    setEditingContract(contract || null);
    setModalVisible(true);
    if (contract) {
      contractForm.setFieldsValue({
        ...contract,
        start_date: contract.start_date ? dayjs(contract.start_date) : null,
        end_date: contract.end_date ? dayjs(contract.end_date) : null,
      });
    } else {
      contractForm.resetFields();
    }
  };

  // 保存合同
  const handleSave = async (values: any) => {
    try {
      const submitData = {
        ...values,
        start_date: values.start_date ? values.start_date.format('YYYY-MM-DD') : null,
        end_date: values.end_date ? values.end_date.format('YYYY-MM-DD') : null,
      };
      
      if (editingContract) {
        await contractAPI.updateContract(editingContract.id, submitData);
        message.success('更新合同成功');
      } else {
        await contractAPI.createContract(submitData);
        message.success('创建合同成功');
      }
      setModalVisible(false);
      fetchContracts();
    } catch (error) {
      message.error(editingContract ? '更新合同失败' : '创建合同失败');
    }
  };

  // 删除合同
  const handleDelete = async (id: number) => {
    try {
      await contractAPI.deleteContract(id);
      message.success('删除合同成功');
      fetchContracts();
    } catch (error) {
      message.error('删除合同失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '租户',
      dataIndex: 'tenant',
      key: 'tenant',
      render: (tenant: Tenant) => tenant?.name || '-',
    },
    {
      title: '办公空间',
      dataIndex: 'office',
      key: 'office',
      render: (office: Office) => office?.name || '-',
    },
    {
      title: '开始日期',
      dataIndex: 'start_date',
      key: 'start_date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '结束日期',
      dataIndex: 'end_date',
      key: 'end_date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '月租金',
      dataIndex: 'monthly_rent',
      key: 'monthly_rent',
      render: (price: number) => `¥${price.toLocaleString()}`,
    },
    {
      title: '押金',
      dataIndex: 'deposit',
      key: 'deposit',
      render: (price: number) => `¥${price.toLocaleString()}`,
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          active: 'green',
          expired: 'red',
          terminated: 'orange',
        };
        const labels = {
          active: '生效中',
          expired: '已过期',
          terminated: '已终止',
        };
        return (
          <Tag color={colors[status as keyof typeof colors]}>
            {labels[status as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: Contract) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这个合同吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>租赁合同管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增合同
        </Button>
      </div>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="tenant_id" label="租户">
                <Select placeholder="请选择租户" allowClear>
                  {tenants.map(tenant => (
                    <Option key={tenant.id} value={tenant.id}>
                      {tenant.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="office_id" label="办公空间">
                <Select placeholder="请选择办公空间" allowClear>
                  {offices.map(office => (
                    <Option key={office.id} value={office.id}>
                      {office.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="active">生效中</Option>
                  <Option value="expired">已过期</Option>
                  <Option value="terminated">已终止</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 合同表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={contracts}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingContract ? '编辑合同' : '新增合同'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={800}
      >
        <Form
          form={contractForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="tenant_id"
                label="租户"
                rules={[{ required: true, message: '请选择租户' }]}
              >
                <Select placeholder="请选择租户">
                  {tenants.map(tenant => (
                    <Option key={tenant.id} value={tenant.id}>
                      {tenant.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="office_id"
                label="办公空间"
                rules={[{ required: true, message: '请选择办公空间' }]}
              >
                <Select placeholder="请选择办公空间">
                  {offices.filter(office => office.status === 'available').map(office => (
                    <Option key={office.id} value={office.id}>
                      {office.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="start_date"
                label="开始日期"
                rules={[{ required: true, message: '请选择开始日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="end_date"
                label="结束日期"
                rules={[{ required: true, message: '请选择结束日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="monthly_rent"
                label="月租金(元)"
                rules={[{ required: true, message: '请输入月租金' }]}
              >
                <InputNumber placeholder="请输入月租金" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="deposit"
                label="押金(元)"
                rules={[{ required: true, message: '请输入押金' }]}
              >
                <InputNumber placeholder="请输入押金" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="terms"
            label="合同条款"
          >
            <TextArea rows={4} placeholder="请输入合同条款" />
          </Form.Item>

          <Form.Item
            name="status"
            label="状态"
            rules={[{ required: true, message: '请选择状态' }]}
          >
            <Select placeholder="请选择状态">
              <Option value="active">生效中</Option>
              <Option value="expired">已过期</Option>
              <Option value="terminated">已终止</Option>
            </Select>
          </Form.Item>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default ContractList;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  InputNumber,
  DatePicker,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
  Statistic,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined, DollarOutlined } from '@ant-design/icons';
import { financialAPI, contractAPI } from '@/services/api';
import type { FinancialRecord, PaginatedResponse, Contract } from '@/types';
import dayjs from 'dayjs';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;

const FinancialList: React.FC = () => {
  const [records, setRecords] = useState<FinancialRecord[]>([]);
  const [contracts, setContracts] = useState<Contract[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingRecord, setEditingRecord] = useState<FinancialRecord | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [stats, setStats] = useState({
    totalAmount: 0,
    paidAmount: 0,
    pendingAmount: 0,
    overdueAmount: 0,
  });
  const [searchForm] = Form.useForm();
  const [recordForm] = Form.useForm();

  // 获取财务记录列表
  const fetchRecords = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<FinancialRecord> = await financialAPI.getFinancialRecords({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setRecords(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
        
        // 计算统计数据
        const totalAmount = data.reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const paidAmount = data
          .filter((record: FinancialRecord) => record.status === 'paid')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const pendingAmount = data
          .filter((record: FinancialRecord) => record.status === 'pending')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const overdueAmount = data
          .filter((record: FinancialRecord) => record.status === 'overdue')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        
        setStats({ totalAmount, paidAmount, pendingAmount, overdueAmount });
      }
    } catch (error) {
      message.error('获取财务记录列表失败');
    } finally {
      setLoading(false);
    }
  };

  // 获取合同列表
  const fetchContracts = async () => {
    try {
      const response: PaginatedResponse<Contract> = await contractAPI.getContracts({ per_page: 1000 });
      if (response.success) {
        setContracts(response.data.items);
      }
    } catch (error) {
      message.error('获取合同列表失败');
    }
  };

  useEffect(() => {
    fetchRecords();
    fetchContracts();
  }, [pagination.current, pagination.pageSize]);

  // 搜索财务记录
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchRecords(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchRecords();
  };

  // 打开新增/编辑模态框
  const showModal = (record?: FinancialRecord) => {
    setEditingRecord(record || null);
    setModalVisible(true);
    if (record) {
      recordForm.setFieldsValue({
        ...record,
        date: record.date ? dayjs(record.date) : null,
      });
    } else {
      recordForm.resetFields();
    }
  };

  // 保存财务记录
  const handleSave = async (values: any) => {
    try {
      const submitData = {
        ...values,
        date: values.date ? values.date.format('YYYY-MM-DD') : null,
      };
      
      if (editingRecord) {
        await financialAPI.updateFinancialRecord(editingRecord.id, submitData);
        message.success('更新财务记录成功');
      } else {
        await financialAPI.createFinancialRecord(submitData);
        message.success('创建财务记录成功');
      }
      setModalVisible(false);
      fetchRecords();
    } catch (error) {
      message.error(editingRecord ? '更新财务记录失败' : '创建财务记录失败');
    }
  };

  // 删除财务记录
  const handleDelete = async (id: number) => {
    try {
      await financialAPI.deleteFinancialRecord(id);
      message.success('删除财务记录成功');
      fetchRecords();
    } catch (error) {
      message.error('删除财务记录失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '合同',
      dataIndex: 'contract',
      key: 'contract',
      render: (contract: Contract) => {
        if (!contract) return '-';
        return `${contract.tenant?.name} - ${contract.office?.name}`;
      },
    },
    {
      title: '类型',
      dataIndex: 'type',
      key: 'type',
      render: (type: string) => {
        const labels = {
          rent: '租金',
          deposit: '押金',
          utility: '水电费',
          service: '服务费',
        };
        return labels[type as keyof typeof labels] || type;
      },
    },
    {
      title: '金额',
      dataIndex: 'amount',
      key: 'amount',
      render: (amount: number) => `¥${amount.toLocaleString()}`,
    },
    {
      title: '描述',
      dataIndex: 'description',
      key: 'description',
    },
    {
      title: '日期',
      dataIndex: 'date',
      key: 'date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          paid: 'green',
          pending: 'orange',
          overdue: 'red',
        };
        const labels = {
          paid: '已支付',
          pending: '待支付',
          overdue: '逾期',
        };
        return (
          <Tag color={colors[status as keyof typeof colors]}>
            {labels[status as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: FinancialRecord) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这条财务记录吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>财务管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增财务记录
        </Button>
      </div>

      {/* 统计卡片 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="总金额"
              value={stats.totalAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#1890ff' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="已支付"
              value={stats.paidAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#52c41a' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="待支付"
              value={stats.pendingAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#faad14' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="逾期金额"
              value={stats.overdueAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#ff4d4f' }}
            />
          </Card>
        </Col>
      </Row>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="contract_id" label="合同">
                <Select placeholder="请选择合同" allowClear>
                  {contracts.map(contract => (
                    <Option key={contract.id} value={contract.id}>
                      {contract.tenant?.name} - {contract.office?.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="type" label="类型">
                <Select placeholder="请选择类型" allowClear>
                  <Option value="rent">租金</Option>
                  <Option value="deposit">押金</Option>
                  <Option value="utility">水电费</Option>
                  <Option value="service">服务费</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="paid">已支付</Option>
                  <Option value="pending">待支付</Option>
                  <Option value="overdue">逾期</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 财务记录表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={records}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingRecord ? '编辑财务记录' : '新增财务记录'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={600}
      >
        <Form
          form={recordForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Form.Item
            name="contract_id"
            label="合同"
            rules={[{ required: true, message: '请选择合同' }]}
          >
            <Select placeholder="请选择合同">
              {contracts.map(contract => (
                <Option key={contract.id} value={contract.id}>
                  {contract.tenant?.name} - {contract.office?.name}
                </Option>
              ))}
            </Select>
          </Form.Item>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="type"
                label="类型"
                rules={[{ required: true, message: '请选择类型' }]}
              >
                <Select placeholder="请选择类型">
                  <Option value="rent">租金</Option>
                  <Option value="deposit">押金</Option>
                  <Option value="utility">水电费</Option>
                  <Option value="service">服务费</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="amount"
                label="金额(元)"
                rules={[{ required: true, message: '请输入金额' }]}
              >
                <InputNumber placeholder="请输入金额" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="description"
            label="描述"
            rules={[{ required: true, message: '请输入描述' }]}
          >
            <TextArea rows={3} placeholder="请输入描述" />
          </Form.Item>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="date"
                label="日期"
                rules={[{ required: true, message: '请选择日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="status"
                label="状态"
                rules={[{ required: true, message: '请选择状态' }]}
              >
                <Select placeholder="请选择状态">
                  <Option value="paid">已支付</Option>
                  <Option value="pending">待支付</Option>
                  <Option value="overdue">逾期</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default FinancialList;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  InputNumber,
  DatePicker,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
  Statistic,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined, DollarOutlined } from '@ant-design/icons';
import { financialAPI, contractAPI } from '@/services/api';
import type { FinancialRecord, PaginatedResponse, Contract } from '@/types';
import dayjs from 'dayjs';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;

const FinancialList: React.FC = () => {
  const [records, setRecords] = useState<FinancialRecord[]>([]);
  const [contracts, setContracts] = useState<Contract[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingRecord, setEditingRecord] = useState<FinancialRecord | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [stats, setStats] = useState({
    totalAmount: 0,
    paidAmount: 0,
    pendingAmount: 0,
    overdueAmount: 0,
  });
  const [searchForm] = Form.useForm();
  const [recordForm] = Form.useForm();

  // 获取财务记录列表
  const fetchRecords = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<FinancialRecord> = await financialAPI.getFinancialRecords({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setRecords(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
        
        // 计算统计数据
        const totalAmount = data.reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const paidAmount = data
          .filter((record: FinancialRecord) => record.status === 'paid')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const pendingAmount = data
          .filter((record: FinancialRecord) => record.status === 'pending')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        const overdueAmount = data
          .filter((record: FinancialRecord) => record.status === 'overdue')
          .reduce((sum: number, record: FinancialRecord) => sum + record.amount, 0);
        
        setStats({ totalAmount, paidAmount, pendingAmount, overdueAmount });
      }
    } catch (error) {
      message.error('获取财务记录列表失败');
    } finally {
      setLoading(false);
    }
  };

  // 获取合同列表
  const fetchContracts = async () => {
    try {
      const response: PaginatedResponse<Contract> = await contractAPI.getContracts({ per_page: 1000 });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        setContracts(data);
      }
    } catch (error) {
      message.error('获取合同列表失败');
    }
  };

  useEffect(() => {
    fetchRecords();
    fetchContracts();
  }, [pagination.current, pagination.pageSize]);

  // 搜索财务记录
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchRecords(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchRecords();
  };

  // 打开新增/编辑模态框
  const showModal = (record?: FinancialRecord) => {
    setEditingRecord(record || null);
    setModalVisible(true);
    if (record) {
      recordForm.setFieldsValue({
        ...record,
        date: record.date ? dayjs(record.date) : null,
      });
    } else {
      recordForm.resetFields();
    }
  };

  // 保存财务记录
  const handleSave = async (values: any) => {
    try {
      const submitData = {
        ...values,
        date: values.date ? values.date.format('YYYY-MM-DD') : null,
      };
      
      if (editingRecord) {
        await financialAPI.updateFinancialRecord(editingRecord.id, submitData);
        message.success('更新财务记录成功');
      } else {
        await financialAPI.createFinancialRecord(submitData);
        message.success('创建财务记录成功');
      }
      setModalVisible(false);
      fetchRecords();
    } catch (error) {
      message.error(editingRecord ? '更新财务记录失败' : '创建财务记录失败');
    }
  };

  // 删除财务记录
  const handleDelete = async (id: number) => {
    try {
      await financialAPI.deleteFinancialRecord(id);
      message.success('删除财务记录成功');
      fetchRecords();
    } catch (error) {
      message.error('删除财务记录失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '合同',
      dataIndex: 'contract',
      key: 'contract',
      render: (contract: Contract) => {
        if (!contract) return '-';
        return `${contract.tenant?.name} - ${contract.office?.name}`;
      },
    },
    {
      title: '类型',
      dataIndex: 'type',
      key: 'type',
      render: (type: string) => {
        const labels = {
          rent: '租金',
          deposit: '押金',
          utility: '水电费',
          service: '服务费',
        };
        return labels[type as keyof typeof labels] || type;
      },
    },
    {
      title: '金额',
      dataIndex: 'amount',
      key: 'amount',
      render: (amount: number) => `¥${amount.toLocaleString()}`,
    },
    {
      title: '描述',
      dataIndex: 'description',
      key: 'description',
    },
    {
      title: '日期',
      dataIndex: 'date',
      key: 'date',
      render: (text: string) => dayjs(text).format('YYYY-MM-DD'),
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          paid: 'green',
          pending: 'orange',
          overdue: 'red',
        };
        const labels = {
          paid: '已支付',
          pending: '待支付',
          overdue: '逾期',
        };
        return (
          <Tag color={colors[status as keyof typeof colors]}>
            {labels[status as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: FinancialRecord) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这条财务记录吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>财务管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增财务记录
        </Button>
      </div>

      {/* 统计卡片 */}
      <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="总金额"
              value={stats.totalAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#1890ff' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="已支付"
              value={stats.paidAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#52c41a' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="待支付"
              value={stats.pendingAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#faad14' }}
            />
          </Card>
        </Col>
        <Col xs={24} sm={12} lg={6}>
          <Card>
            <Statistic
              title="逾期金额"
              value={stats.overdueAmount}
              prefix={<DollarOutlined />}
              suffix="元"
              precision={0}
              valueStyle={{ color: '#ff4d4f' }}
            />
          </Card>
        </Col>
      </Row>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="contract_id" label="合同">
                <Select placeholder="请选择合同" allowClear>
                  {contracts.map(contract => (
                    <Option key={contract.id} value={contract.id}>
                      {contract.tenant?.name} - {contract.office?.name}
                    </Option>
                  ))}
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="type" label="类型">
                <Select placeholder="请选择类型" allowClear>
                  <Option value="rent">租金</Option>
                  <Option value="deposit">押金</Option>
                  <Option value="utility">水电费</Option>
                  <Option value="service">服务费</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="paid">已支付</Option>
                  <Option value="pending">待支付</Option>
                  <Option value="overdue">逾期</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 财务记录表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={records}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingRecord ? '编辑财务记录' : '新增财务记录'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={600}
      >
        <Form
          form={recordForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Form.Item
            name="contract_id"
            label="合同"
            rules={[{ required: true, message: '请选择合同' }]}
          >
            <Select placeholder="请选择合同">
              {contracts.map(contract => (
                <Option key={contract.id} value={contract.id}>
                  {contract.tenant?.name} - {contract.office?.name}
                </Option>
              ))}
            </Select>
          </Form.Item>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="type"
                label="类型"
                rules={[{ required: true, message: '请选择类型' }]}
              >
                <Select placeholder="请选择类型">
                  <Option value="rent">租金</Option>
                  <Option value="deposit">押金</Option>
                  <Option value="utility">水电费</Option>
                  <Option value="service">服务费</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="amount"
                label="金额(元)"
                rules={[{ required: true, message: '请输入金额' }]}
              >
                <InputNumber placeholder="请输入金额" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="description"
            label="描述"
            rules={[{ required: true, message: '请输入描述' }]}
          >
            <TextArea rows={3} placeholder="请输入描述" />
          </Form.Item>

          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="date"
                label="日期"
                rules={[{ required: true, message: '请选择日期' }]}
              >
                <DatePicker style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="status"
                label="状态"
                rules={[{ required: true, message: '请选择状态' }]}
              >
                <Select placeholder="请选择状态">
                  <Option value="paid">已支付</Option>
                  <Option value="pending">待支付</Option>
                  <Option value="overdue">逾期</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default FinancialList;

```

继续修复其他文件：


```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined } from '@ant-design/icons';
import { userAPI } from '@/services/api';
import type { User, PaginatedResponse } from '@/types';

const { Title } = Typography;
const { Option } = Select;

const UserList: React.FC = () => {
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingUser, setEditingUser] = useState<User | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [searchForm] = Form.useForm();
  const [userForm] = Form.useForm();

  // 获取用户列表
  const fetchUsers = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<User> = await userAPI.getUsers({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setUsers(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
      }
    } catch (error) {
      message.error('获取用户列表失败');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchUsers();
  }, [pagination.current, pagination.pageSize]);

  // 搜索用户
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchUsers(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchUsers();
  };

  // 打开新增/编辑模态框
  const showModal = (user?: User) => {
    setEditingUser(user || null);
    setModalVisible(true);
    if (user) {
      userForm.setFieldsValue(user);
    } else {
      userForm.resetFields();
    }
  };

  // 保存用户
  const handleSave = async (values: any) => {
    try {
      if (editingUser) {
        await userAPI.updateUser(editingUser.id, values);
        message.success('更新用户成功');
      } else {
        await userAPI.createUser(values);
        message.success('创建用户成功');
      }
      setModalVisible(false);
      fetchUsers();
    } catch (error) {
      message.error(editingUser ? '更新用户失败' : '创建用户失败');
    }
  };

  // 删除用户
  const handleDelete = async (id: number) => {
    try {
      await userAPI.deleteUser(id);
      message.success('删除用户成功');
      fetchUsers();
    } catch (error) {
      message.error('删除用户失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '用户名',
      dataIndex: 'username',
      key: 'username',
    },
    {
      title: '邮箱',
      dataIndex: 'email',
      key: 'email',
    },
    {
      title: '角色',
      dataIndex: 'role',
      key: 'role',
      render: (role: string) => {
        const colors = {
          admin: 'red',
          staff: 'blue',
          tenant: 'green',
        };
        const labels = {
          admin: '管理员',
          staff: '员工',
          tenant: '租户',
        };
        return (
          <Tag color={colors[role as keyof typeof colors]}>
            {labels[role as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: User) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这个用户吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>用户管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增用户
        </Button>
      </div>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="username" label="用户名">
                <Input placeholder="请输入用户名" />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="email" label="邮箱">
                <Input placeholder="请输入邮箱" />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="role" label="角色">
                <Select placeholder="请选择角色" allowClear>
                  <Option value="admin">管理员</Option>
                  <Option value="staff">员工</Option>
                  <Option value="tenant">租户</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 用户表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={users}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingUser ? '编辑用户' : '新增用户'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={600}
      >
        <Form
          form={userForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Form.Item
            name="username"
            label="用户名"
            rules={[{ required: true, message: '请输入用户名' }]}
          >
            <Input placeholder="请输入用户名" />
          </Form.Item>

          <Form.Item
            name="email"
            label="邮箱"
            rules={[
              { required: true, message: '请输入邮箱' },
              { type: 'email', message: '请输入有效的邮箱地址' },
            ]}
          >
            <Input placeholder="请输入邮箱" />
          </Form.Item>

          <Form.Item
            name="role"
            label="角色"
            rules={[{ required: true, message: '请选择角色' }]}
          >
            <Select placeholder="请选择角色">
              <Option value="admin">管理员</Option>
              <Option value="staff">员工</Option>
              <Option value="tenant">租户</Option>
            </Select>
          </Form.Item>

          {!editingUser && (
            <Form.Item
              name="password"
              label="密码"
              rules={[{ required: true, message: '请输入密码' }]}
            >
              <Input.Password placeholder="请输入密码" />
            </Form.Item>
          )}

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default UserList;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined } from '@ant-design/icons';
import { tenantAPI } from '@/services/api';
import type { Tenant, PaginatedResponse } from '@/types';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;

const TenantList: React.FC = () => {
  const [tenants, setTenants] = useState<Tenant[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingTenant, setEditingTenant] = useState<Tenant | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [searchForm] = Form.useForm();
  const [tenantForm] = Form.useForm();

  // 获取租户列表
  const fetchTenants = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<Tenant> = await tenantAPI.getTenants({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setTenants(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
      }
    } catch (error) {
      message.error('获取租户列表失败');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchTenants();
  }, [pagination.current, pagination.pageSize]);

  // 搜索租户
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchTenants(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchTenants();
  };

  // 打开新增/编辑模态框
  const showModal = (tenant?: Tenant) => {
    setEditingTenant(tenant || null);
    setModalVisible(true);
    if (tenant) {
      tenantForm.setFieldsValue(tenant);
    } else {
      tenantForm.resetFields();
    }
  };

  // 保存租户
  const handleSave = async (values: any) => {
    try {
      if (editingTenant) {
        await tenantAPI.updateTenant(editingTenant.id, values);
        message.success('更新租户成功');
      } else {
        await tenantAPI.createTenant(values);
        message.success('创建租户成功');
      }
      setModalVisible(false);
      fetchTenants();
    } catch (error) {
      message.error(editingTenant ? '更新租户失败' : '创建租户失败');
    }
  };

  // 删除租户
  const handleDelete = async (id: number) => {
    try {
      await tenantAPI.deleteTenant(id);
      message.success('删除租户成功');
      fetchTenants();
    } catch (error) {
      message.error('删除租户失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '租户名称',
      dataIndex: 'name',
      key: 'name',
    },
    {
      title: '联系人',
      dataIndex: 'contact_person',
      key: 'contact_person',
    },
    {
      title: '联系电话',
      dataIndex: 'phone',
      key: 'phone',
    },
    {
      title: '邮箱',
      dataIndex: 'email',
      key: 'email',
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => (
        <Tag color={status === 'active' ? 'green' : 'red'}>
          {status === 'active' ? '活跃' : '非活跃'}
        </Tag>
      ),
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: Tenant) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这个租户吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>租户管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增租户
        </Button>
      </div>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="name" label="租户名称">
                <Input placeholder="请输入租户名称" />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="contact_person" label="联系人">
                <Input placeholder="请输入联系人" />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="active">活跃</Option>
                  <Option value="inactive">非活跃</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 租户表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={tenants}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingTenant ? '编辑租户' : '新增租户'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={600}
      >
        <Form
          form={tenantForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Form.Item
            name="name"
            label="租户名称"
            rules={[{ required: true, message: '请输入租户名称' }]}
          >
            <Input placeholder="请输入租户名称" />
          </Form.Item>

          <Form.Item
            name="contact_person"
            label="联系人"
            rules={[{ required: true, message: '请输入联系人' }]}
          >
            <Input placeholder="请输入联系人" />
          </Form.Item>

          <Form.Item
            name="phone"
            label="联系电话"
            rules={[{ required: true, message: '请输入联系电话' }]}
          >
            <Input placeholder="请输入联系电话" />
          </Form.Item>

          <Form.Item
            name="email"
            label="邮箱"
            rules={[
              { required: true, message: '请输入邮箱' },
              { type: 'email', message: '请输入有效的邮箱地址' },
            ]}
          >
            <Input placeholder="请输入邮箱" />
          </Form.Item>

          <Form.Item
            name="address"
            label="地址"
            rules={[{ required: true, message: '请输入地址' }]}
          >
            <TextArea rows={3} placeholder="请输入地址" />
          </Form.Item>

          <Form.Item
            name="status"
            label="状态"
            rules={[{ required: true, message: '请选择状态' }]}
          >
            <Select placeholder="请选择状态">
              <Option value="active">活跃</Option>
              <Option value="inactive">非活跃</Option>
            </Select>
          </Form.Item>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default TenantList;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import {
  Table,
  Button,
  Space,
  Modal,
  Form,
  Input,
  Select,
  InputNumber,
  message,
  Popconfirm,
  Tag,
  Typography,
  Row,
  Col,
  Card,
} from 'antd';
import { PlusOutlined, EditOutlined, DeleteOutlined, SearchOutlined } from '@ant-design/icons';
import { officeAPI } from '@/services/api';
import type { Office, PaginatedResponse } from '@/types';

const { Title } = Typography;
const { Option } = Select;
const { TextArea } = Input;

const OfficeList: React.FC = () => {
  const [offices, setOffices] = useState<Office[]>([]);
  const [loading, setLoading] = useState(false);
  const [modalVisible, setModalVisible] = useState(false);
  const [editingOffice, setEditingOffice] = useState<Office | null>(null);
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  const [searchForm] = Form.useForm();
  const [officeForm] = Form.useForm();

  // 获取办公空间列表
  const fetchOffices = async (params?: any) => {
    setLoading(true);
    try {
      const response: PaginatedResponse<Office> = await officeAPI.getOffices({
        page: pagination.current,
        per_page: pagination.pageSize,
        ...params,
      });
      if (response.success) {
        const data = Array.isArray(response.data) ? response.data : response.data.items;
        const total = Array.isArray(response.data) ? response.data.length : response.data.total;
        const page = Array.isArray(response.data) ? 1 : response.data.page;
        setOffices(data);
        setPagination(prev => ({
          ...prev,
          total,
          current: page,
        }));
      }
    } catch (error) {
      message.error('获取办公空间列表失败');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchOffices();
  }, [pagination.current, pagination.pageSize]);

  // 搜索办公空间
  const handleSearch = (values: any) => {
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchOffices(values);
  };

  // 重置搜索
  const handleReset = () => {
    searchForm.resetFields();
    setPagination(prev => ({ ...prev, current: 1 }));
    fetchOffices();
  };

  // 打开新增/编辑模态框
  const showModal = (office?: Office) => {
    setEditingOffice(office || null);
    setModalVisible(true);
    if (office) {
      officeForm.setFieldsValue({
        ...office,
        amenities: office.amenities?.join(', '),
      });
    } else {
      officeForm.resetFields();
    }
  };

  // 保存办公空间
  const handleSave = async (values: any) => {
    try {
      const submitData = {
        ...values,
        amenities: values.amenities ? values.amenities.split(',').map((item: string) => item.trim()) : [],
      };
      
      if (editingOffice) {
        await officeAPI.updateOffice(editingOffice.id, submitData);
        message.success('更新办公空间成功');
      } else {
        await officeAPI.createOffice(submitData);
        message.success('创建办公空间成功');
      }
      setModalVisible(false);
      fetchOffices();
    } catch (error) {
      message.error(editingOffice ? '更新办公空间失败' : '创建办公空间失败');
    }
  };

  // 删除办公空间
  const handleDelete = async (id: number) => {
    try {
      await officeAPI.deleteOffice(id);
      message.success('删除办公空间成功');
      fetchOffices();
    } catch (error) {
      message.error('删除办公空间失败');
    }
  };

  // 表格列配置
  const columns = [
    {
      title: 'ID',
      dataIndex: 'id',
      key: 'id',
      width: 80,
    },
    {
      title: '名称',
      dataIndex: 'name',
      key: 'name',
    },
    {
      title: '面积(㎡)',
      dataIndex: 'area',
      key: 'area',
      render: (area: number) => `${area}㎡`,
    },
    {
      title: '容量(人)',
      dataIndex: 'capacity',
      key: 'capacity',
      render: (capacity: number) => `${capacity}人`,
    },
    {
      title: '月租金',
      dataIndex: 'price_per_month',
      key: 'price_per_month',
      render: (price: number) => `¥${price.toLocaleString()}`,
    },
    {
      title: '楼层',
      dataIndex: 'floor',
      key: 'floor',
      render: (floor: number) => `${floor}楼`,
    },
    {
      title: '状态',
      dataIndex: 'status',
      key: 'status',
      render: (status: string) => {
        const colors = {
          available: 'green',
          occupied: 'blue',
          maintenance: 'orange',
        };
        const labels = {
          available: '可用',
          occupied: '已出租',
          maintenance: '维护中',
        };
        return (
          <Tag color={colors[status as keyof typeof colors]}>
            {labels[status as keyof typeof labels]}
          </Tag>
        );
      },
    },
    {
      title: '创建时间',
      dataIndex: 'created_at',
      key: 'created_at',
      render: (text: string) => new Date(text).toLocaleString(),
    },
    {
      title: '操作',
      key: 'action',
      render: (_: any, record: Office) => (
        <Space size="middle">
          <Button
            type="link"
            icon={<EditOutlined />}
            onClick={() => showModal(record)}
          >
            编辑
          </Button>
          <Popconfirm
            title="确定要删除这个办公空间吗？"
            onConfirm={() => handleDelete(record.id)}
            okText="确定"
            cancelText="取消"
          >
            <Button type="link" danger icon={<DeleteOutlined />}>
              删除
            </Button>
          </Popconfirm>
        </Space>
      ),
    },
  ];

  return (
    <div>
      <div className="page-header">
        <Title level={2}>办公空间管理</Title>
        <Button
          type="primary"
          icon={<PlusOutlined />}
          onClick={() => showModal()}
        >
          新增办公空间
        </Button>
      </div>

      {/* 搜索表单 */}
      <Card className="search-form" style={{ marginBottom: 16 }}>
        <Form
          form={searchForm}
          layout="inline"
          onFinish={handleSearch}
        >
          <Row gutter={16} style={{ width: '100%' }}>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="name" label="办公空间名称">
                <Input placeholder="请输入办公空间名称" />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="floor" label="楼层">
                <InputNumber placeholder="请输入楼层" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col xs={24} sm={8} md={6}>
              <Form.Item name="status" label="状态">
                <Select placeholder="请选择状态" allowClear>
                  <Option value="available">可用</Option>
                  <Option value="occupied">已出租</Option>
                  <Option value="maintenance">维护中</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col xs={24} sm={24} md={6}>
              <Form.Item>
                <Space>
                  <Button type="primary" htmlType="submit" icon={<SearchOutlined />}>
                    搜索
                  </Button>
                  <Button onClick={handleReset}>
                    重置
                  </Button>
                </Space>
              </Form.Item>
            </Col>
          </Row>
        </Form>
      </Card>

      {/* 办公空间表格 */}
      <Card>
        <Table
          columns={columns}
          dataSource={offices}
          rowKey="id"
          loading={loading}
          pagination={{
            ...pagination,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) =>
              `第 ${range[0]}-${range[1]} 条，共 ${total} 条`,
            onChange: (page, pageSize) => {
              setPagination(prev => ({ ...prev, current: page, pageSize }));
            },
          }}
        />
      </Card>

      {/* 新增/编辑模态框 */}
      <Modal
        title={editingOffice ? '编辑办公空间' : '新增办公空间'}
        open={modalVisible}
        onCancel={() => setModalVisible(false)}
        footer={null}
        width={800}
      >
        <Form
          form={officeForm}
          layout="vertical"
          onFinish={handleSave}
        >
          <Row gutter={16}>
            <Col span={12}>
              <Form.Item
                name="name"
                label="办公空间名称"
                rules={[{ required: true, message: '请输入办公空间名称' }]}
              >
                <Input placeholder="请输入办公空间名称" />
              </Form.Item>
            </Col>
            <Col span={12}>
              <Form.Item
                name="floor"
                label="楼层"
                rules={[{ required: true, message: '请输入楼层' }]}
              >
                <InputNumber placeholder="请输入楼层" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Row gutter={16}>
            <Col span={8}>
              <Form.Item
                name="area"
                label="面积(㎡)"
                rules={[{ required: true, message: '请输入面积' }]}
              >
                <InputNumber placeholder="请输入面积" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={8}>
              <Form.Item
                name="capacity"
                label="容量(人)"
                rules={[{ required: true, message: '请输入容量' }]}
              >
                <InputNumber placeholder="请输入容量" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
            <Col span={8}>
              <Form.Item
                name="price_per_month"
                label="月租金(元)"
                rules={[{ required: true, message: '请输入月租金' }]}
              >
                <InputNumber placeholder="请输入月租金" style={{ width: '100%' }} />
              </Form.Item>
            </Col>
          </Row>

          <Form.Item
            name="description"
            label="描述"
          >
            <TextArea rows={3} placeholder="请输入办公空间描述" />
          </Form.Item>

          <Form.Item
            name="amenities"
            label="设施配套"
            extra="多个设施请用逗号分隔，例如：空调,WiFi,投影仪"
          >
            <Input placeholder="请输入设施配套" />
          </Form.Item>

          <Form.Item
            name="status"
            label="状态"
            rules={[{ required: true, message: '请选择状态' }]}
          >
            <Select placeholder="请选择状态">
              <Option value="available">可用</Option>
              <Option value="occupied">已出租</Option>
              <Option value="maintenance">维护中</Option>
            </Select>
          </Form.Item>

          <Form.Item>
            <Space>
              <Button type="primary" htmlType="submit">
                保存
              </Button>
              <Button onClick={() => setModalVisible(false)}>
                取消
              </Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>
    </div>
  );
};

export default OfficeList;

```

批量修复未使用的导入和变量，以及 Ant Design 的 prop 问题。先处理最关键的：


批量修复未使用的导入和变量：


```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 机电组件数据类型定义
interface ElectromechanicalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    torque?: string;
    speed?: string;
    force?: string;
    temperature?: string;
  };
}

// 机电组件测试数据
const mockElectromechanicalData: ElectromechanicalComponent[] = [
  {
    id: 'EM001',
    partNumber: 'RLY-24V-DPDT',
    manufacturer: '宏发继电器',
    primaryCategory: '继电器',
    secondaryCategory: '电磁继电器',
    package: 'PCB插件',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB597A', 'MIL-PRF-39016'],
    description: '24V双刀双掷电磁继电器',
    functionalPerformance: '24VDC线圈，触点容量10A/250VAC',
    referencePrice: 35.00,
    parameters: {
      voltage: '24VDC',
      current: '10A',
      power: '2.4W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '10ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM002',
    partNumber: 'SW-Toggle-MS',
    manufacturer: '得捷电子',
    primaryCategory: '开关',
    secondaryCategory: '拨动开关',
    package: '面板安装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['MIL-PRF-8805'],
    description: '军标拨动开关，单刀双掷',
    functionalPerformance: 'SPDT，5A/125VAC，寿命100万次',
    referencePrice: 28.00,
    parameters: {
      voltage: '125VAC',
      current: '5A',
      power: '625W',
      frequency: '无',
      torque: '无',
      speed: '无',
      force: '3N',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM003',
    partNumber: 'CONN-D25-M',
    manufacturer: '航天电器',
    primaryCategory: '连接器',
    secondaryCategory: 'D-SUB连接器',
    package: '金属壳体',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB101A'],
    description: '25针D-SUB公头连接器',
    functionalPerformance: '25针，镀金触点，插拔寿命>5000次',
    referencePrice: 85.00,
    parameters: {
      voltage: '500VDC',
      current: '5A',
      power: '无',
      frequency: '1GHz',
      torque: '无',
      speed: '无',
      force: '20N',
      temperature: '-65°C~+175°C'
    }
  },
  {
    id: 'EM004',
    partNumber: 'FAN-12V-40mm',
    manufacturer: '台达电子',
    primaryCategory: '风扇',
    secondaryCategory: '轴流风扇',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['UL507'],
    description: '12V直流轴流风扇，40mm',
    functionalPerformance: '12VDC，转速7000RPM，风量12CFM',
    referencePrice: 15.00,
    parameters: {
      voltage: '12VDC',
      current: '150mA',
      power: '1.8W',
      frequency: '无',
      torque: '无',
      speed: '7000RPM',
      force: '无',
      temperature: '-10°C~+70°C'
    }
  },
  {
    id: 'EM005',
    partNumber: 'BUZZ-5V-Piezo',
    manufacturer: '福星晓程',
    primaryCategory: '蜂鸣器',
    secondaryCategory: '压电蜂鸣器',
    package: 'PCB安装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60065'],
    description: '5V压电蜂鸣器，2700Hz',
    functionalPerformance: '5VDC，声压级85dB@10cm',
    referencePrice: 3.50,
    parameters: {
      voltage: '5VDC',
      current: '30mA',
      power: '150mW',
      frequency: '2700Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'EM006',
    partNumber: 'FUSE-5A-Fast',
    manufacturer: '力特奥维斯',
    primaryCategory: '熔断器',
    secondaryCategory: '快熔保险丝',
    package: '5×20mm',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60127'],
    description: '5A快熔保险丝，250V',
    functionalPerformance: '5A/250V，分断能力35A',
    referencePrice: 0.80,
    parameters: {
      voltage: '250VAC',
      current: '5A',
      power: '1250W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '<1ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM007',
    partNumber: 'XFMR-230/12V',
    manufacturer: '顺络电子',
    primaryCategory: '变压器',
    secondaryCategory: '电源变压器',
    package: 'EI型铁芯',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61558'],
    description: '230V转12V电源变压器，10VA',
    functionalPerformance: '230VAC输入，12VAC输出，10VA',
    referencePrice: 25.00,
    parameters: {
      voltage: '230/12VAC',
      current: '833mA',
      power: '10VA',
      frequency: '50/60Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'EM008',
    partNumber: 'MOTOR-12V-Gear',
    manufacturer: '兆威机电',
    primaryCategory: '电机',
    secondaryCategory: '直流减速电机',
    package: '金属齿轮箱',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '12V直流减速电机，1:100减速比',
    functionalPerformance: '12VDC，转速30RPM，扭矩2Nm',
    referencePrice: 120.00,
    parameters: {
      voltage: '12VDC',
      current: '500mA',
      power: '6W',
      frequency: '无',
      torque: '2Nm',
      speed: '30RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'EM009',
    partNumber: 'SERVO-180deg',
    manufacturer: '汇川技术',
    primaryCategory: '伺服电机',
    secondaryCategory: '舵机',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '180度舵机，PWM控制',
    functionalPerformance: '6V供电，扭矩1.8kg·cm，180°转角',
    referencePrice: 45.00,
    parameters: {
      voltage: '6VDC',
      current: '200mA',
      power: '1.2W',
      frequency: '50Hz',
      torque: '1.8kg·cm',
      speed: '0.16s/60°',
      force: '无',
      temperature: '-10°C~+60°C'
    }
  },
  {
    id: 'EM010',
    partNumber: 'STEP-200-Bipolar',
    manufacturer: '雷赛智能',
    primaryCategory: '步进电机',
    secondaryCategory: '双极步进电机',
    package: 'NEMA17',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: 'NEMA17双极步进电机，200步/转',
    functionalPerformance: '12V，1.8°步距角，保持扭矩4kg·cm',
    referencePrice: 85.00,
    parameters: {
      voltage: '12VDC',
      current: '1.2A',
      power: '14.4W',
      frequency: '无',
      torque: '4kg·cm',
      speed: '1000RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  }
];

const ElectromechanicalSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [filteredData, setFilteredData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ElectromechanicalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockElectromechanicalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockElectromechanicalData);
  };

  // 查看详情
  const handleViewDetail = (record: ElectromechanicalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="processing">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="default">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: ElectromechanicalComponent, b: ElectromechanicalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: ElectromechanicalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #1890ff 0%, #096dd9 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            机电组件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Electromechanical Components - 继电器、开关、连接器、电机等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="宏发继电器">宏发继电器</Option>
                  <Option value="得捷电子">得捷电子</Option>
                  <Option value="航天电器">航天电器</Option>
                  <Option value="台达电子">台达电子</Option>
                  <Option value="福星晓程">福星晓程</Option>
                  <Option value="力特奥维斯">力特奥维斯</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="兆威机电">兆威机电</Option>
                  <Option value="汇川技术">汇川技术</Option>
                  <Option value="雷赛智能">雷赛智能</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="继电器">继电器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="连接器">连接器</Option>
                  <Option value="风扇">风扇</Option>
                  <Option value="蜂鸣器">蜂鸣器</Option>
                  <Option value="熔断器">熔断器</Option>
                  <Option value="变压器">变压器</Option>
                  <Option value="电机">电机</Option>
                  <Option value="伺服电机">伺服电机</Option>
                  <Option value="步进电机">步进电机</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="扭矩">{selectedComponent.parameters.torque}</Descriptions.Item>
            <Descriptions.Item label="转速">{selectedComponent.parameters.speed}</Descriptions.Item>
            <Descriptions.Item label="作用力">{selectedComponent.parameters.force}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default ElectromechanicalSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 通用与特种元件数据类型定义
interface GeneralComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    capacitance?: string;
    voltage?: string;
    tolerance?: string;
    resistance?: string;
    power?: string;
    inductance?: string;
    frequency?: string;
    temperature?: string;
  };
}

// 通用与特种元件测试数据
const mockGeneralData: GeneralComponent[] = [
  {
    id: 'GC001',
    partNumber: 'CAP-100uF-25V',
    manufacturer: '风华高科',
    primaryCategory: '电容器',
    secondaryCategory: '铝电解电容',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60384', 'JIS-C5101'],
    description: '100μF/25V铝电解电容器',
    functionalPerformance: '低ESR，高纹波电流，长寿命',
    referencePrice: 0.35,
    parameters: {
      capacitance: '100μF',
      voltage: '25V',
      tolerance: '±20%',
      resistance: '无',
      power: '无',
      inductance: '无',
      frequency: '120Hz',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC002',
    partNumber: 'RES-1K-1/4W',
    manufacturer: '厚声电子',
    primaryCategory: '电阻器',
    secondaryCategory: '碳膜电阻',
    package: '轴向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60115', 'JIS-C5201'],
    description: '1kΩ/1/4W碳膜电阻器',
    functionalPerformance: '低噪声，稳定性好，成本低',
    referencePrice: 0.02,
    parameters: {
      capacitance: '无',
      voltage: '250V',
      tolerance: '±5%',
      resistance: '1kΩ',
      power: '1/4W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+155°C'
    }
  },
  {
    id: 'GC003',
    partNumber: 'IND-10uH-1A',
    manufacturer: '顺络电子',
    primaryCategory: '电感器',
    secondaryCategory: '功率电感',
    package: 'SMD-1210',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '10μH功率电感，1A饱和电流',
    functionalPerformance: '低DCR，高饱和电流，屏蔽结构',
    referencePrice: 0.25,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '0.15Ω',
      power: '无',
      inductance: '10μH',
      frequency: '1MHz',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC004',
    partNumber: 'XTAL-32.768K',
    manufacturer: '泰晶科技',
    primaryCategory: '晶振',
    secondaryCategory: '石英晶振',
    package: '圆柱形',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '32.768kHz石英晶振',
    functionalPerformance: '高精度，低功耗，RTC专用',
    referencePrice: 0.45,
    parameters: {
      capacitance: '12.5pF',
      voltage: '无',
      tolerance: '±20ppm',
      resistance: '70kΩ',
      power: '1μW',
      inductance: '无',
      frequency: '32.768kHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC005',
    partNumber: 'FILT-LC-1mH',
    manufacturer: '麦捷科技',
    primaryCategory: '滤波器',
    secondaryCategory: 'LC滤波器',
    package: 'SMD封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '1mH LC低通滤波器',
    functionalPerformance: '截止频率1MHz，插损<1dB',
    referencePrice: 1.20,
    parameters: {
      capacitance: '100pF',
      voltage: '50V',
      tolerance: '±10%',
      resistance: '1Ω',
      power: '1W',
      inductance: '1mH',
      frequency: '1MHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC006',
    partNumber: 'TERM-Screw-5mm',
    manufacturer: '韦德万能',
    primaryCategory: '接线端子',
    secondaryCategory: '螺钉式端子',
    package: '5mm间距',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60947'],
    description: '5mm间距螺钉式接线端子',
    functionalPerformance: '10A/300V，镀锡铜材质',
    referencePrice: 0.80,
    parameters: {
      capacitance: '无',
      voltage: '300V',
      tolerance: '无',
      resistance: '<1mΩ',
      power: '3kW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC007',
    partNumber: 'HEAT-TO220-Alu',
    manufacturer: '信越化学',
    primaryCategory: '散热器',
    secondaryCategory: 'TO-220散热器',
    package: '铝合金',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'TO-220封装铝合金散热器',
    functionalPerformance: '热阻3°C/W，自然对流',
    referencePrice: 2.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '无',
      resistance: '3°C/W',
      power: '10W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+150°C'
    }
  },
  {
    id: 'GC008',
    partNumber: 'TEMP-NTC-10K',
    manufacturer: '华工科技',
    primaryCategory: '传感器',
    secondaryCategory: '温度传感器',
    package: '玻璃封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60539'],
    description: '10kΩ@25°C NTC热敏电阻',
    functionalPerformance: 'B值3950K，精度±1%',
    referencePrice: 1.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±1%',
      resistance: '10kΩ@25°C',
      power: '250mW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC009',
    partNumber: 'POT-10K-Linear',
    manufacturer: '松下电器',
    primaryCategory: '可变电阻',
    secondaryCategory: '电位器',
    package: '旋转式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60393'],
    description: '10kΩ线性电位器',
    functionalPerformance: '旋转寿命10万次，线性度±5%',
    referencePrice: 3.20,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '10kΩ',
      power: '0.5W',
      inductance: '无',
      frequency: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'GC010',
    partNumber: 'VARISTOR-14V',
    manufacturer: '硕凯电子',
    primaryCategory: '压敏电阻',
    secondaryCategory: 'MOV压敏电阻',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60738'],
    description: '14V氧化锌压敏电阻',
    functionalPerformance: '浪涌保护，响应时间<25ns',
    referencePrice: 0.65,
    parameters: {
      capacitance: '无',
      voltage: '14V',
      tolerance: '±10%',
      resistance: '>1GΩ',
      power: '0.6W',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+85°C'
    }
  }
];

const GeneralSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
  const [filteredData, setFilteredData] = useState<GeneralComponent[]>(mockGeneralData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<GeneralComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockGeneralData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockGeneralData);
  };

  // 查看详情
  const handleViewDetail = (record: GeneralComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: GeneralComponent, b: GeneralComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: GeneralComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            通用与特种元件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            General & Special Components - 电阻、电容、电感、晶振、传感器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="风华高科">风华高科</Option>
                  <Option value="厚声电子">厚声电子</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="麦捷科技">麦捷科技</Option>
                  <Option value="韦德万能">韦德万能</Option>
                  <Option value="信越化学">信越化学</Option>
                  <Option value="华工科技">华工科技</Option>
                  <Option value="松下电器">松下电器</Option>
                  <Option value="硕凯电子">硕凯电子</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="电容器">电容器</Option>
                  <Option value="电阻器">电阻器</Option>
                  <Option value="电感器">电感器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="滤波器">滤波器</Option>
                  <Option value="接线端子">接线端子</Option>
                  <Option value="散热器">散热器</Option>
                  <Option value="传感器">传感器</Option>
                  <Option value="可变电阻">可变电阻</Option>
                  <Option value="压敏电阻">压敏电阻</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="容值">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="额定电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.tolerance}</Descriptions.Item>
            <Descriptions.Item label="阻值">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="额定功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="电感值">{selectedComponent.parameters.inductance}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default GeneralSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 通用与特种元件数据类型定义
interface GeneralComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    capacitance?: string;
    voltage?: string;
    tolerance?: string;
    resistance?: string;
    power?: string;
    inductance?: string;
    frequency?: string;
    temperature?: string;
  };
}

// 通用与特种元件测试数据
const mockGeneralData: GeneralComponent[] = [
  {
    id: 'GC001',
    partNumber: 'CAP-100uF-25V',
    manufacturer: '风华高科',
    primaryCategory: '电容器',
    secondaryCategory: '铝电解电容',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60384', 'JIS-C5101'],
    description: '100μF/25V铝电解电容器',
    functionalPerformance: '低ESR，高纹波电流，长寿命',
    referencePrice: 0.35,
    parameters: {
      capacitance: '100μF',
      voltage: '25V',
      tolerance: '±20%',
      resistance: '无',
      power: '无',
      inductance: '无',
      frequency: '120Hz',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC002',
    partNumber: 'RES-1K-1/4W',
    manufacturer: '厚声电子',
    primaryCategory: '电阻器',
    secondaryCategory: '碳膜电阻',
    package: '轴向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60115', 'JIS-C5201'],
    description: '1kΩ/1/4W碳膜电阻器',
    functionalPerformance: '低噪声，稳定性好，成本低',
    referencePrice: 0.02,
    parameters: {
      capacitance: '无',
      voltage: '250V',
      tolerance: '±5%',
      resistance: '1kΩ',
      power: '1/4W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+155°C'
    }
  },
  {
    id: 'GC003',
    partNumber: 'IND-10uH-1A',
    manufacturer: '顺络电子',
    primaryCategory: '电感器',
    secondaryCategory: '功率电感',
    package: 'SMD-1210',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '10μH功率电感，1A饱和电流',
    functionalPerformance: '低DCR，高饱和电流，屏蔽结构',
    referencePrice: 0.25,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '0.15Ω',
      power: '无',
      inductance: '10μH',
      frequency: '1MHz',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC004',
    partNumber: 'XTAL-32.768K',
    manufacturer: '泰晶科技',
    primaryCategory: '晶振',
    secondaryCategory: '石英晶振',
    package: '圆柱形',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '32.768kHz石英晶振',
    functionalPerformance: '高精度，低功耗，RTC专用',
    referencePrice: 0.45,
    parameters: {
      capacitance: '12.5pF',
      voltage: '无',
      tolerance: '±20ppm',
      resistance: '70kΩ',
      power: '1μW',
      inductance: '无',
      frequency: '32.768kHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC005',
    partNumber: 'FILT-LC-1mH',
    manufacturer: '麦捷科技',
    primaryCategory: '滤波器',
    secondaryCategory: 'LC滤波器',
    package: 'SMD封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '1mH LC低通滤波器',
    functionalPerformance: '截止频率1MHz，插损<1dB',
    referencePrice: 1.20,
    parameters: {
      capacitance: '100pF',
      voltage: '50V',
      tolerance: '±10%',
      resistance: '1Ω',
      power: '1W',
      inductance: '1mH',
      frequency: '1MHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC006',
    partNumber: 'TERM-Screw-5mm',
    manufacturer: '韦德万能',
    primaryCategory: '接线端子',
    secondaryCategory: '螺钉式端子',
    package: '5mm间距',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60947'],
    description: '5mm间距螺钉式接线端子',
    functionalPerformance: '10A/300V，镀锡铜材质',
    referencePrice: 0.80,
    parameters: {
      capacitance: '无',
      voltage: '300V',
      tolerance: '无',
      resistance: '<1mΩ',
      power: '3kW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC007',
    partNumber: 'HEAT-TO220-Alu',
    manufacturer: '信越化学',
    primaryCategory: '散热器',
    secondaryCategory: 'TO-220散热器',
    package: '铝合金',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'TO-220封装铝合金散热器',
    functionalPerformance: '热阻3°C/W，自然对流',
    referencePrice: 2.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '无',
      resistance: '3°C/W',
      power: '10W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+150°C'
    }
  },
  {
    id: 'GC008',
    partNumber: 'TEMP-NTC-10K',
    manufacturer: '华工科技',
    primaryCategory: '传感器',
    secondaryCategory: '温度传感器',
    package: '玻璃封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60539'],
    description: '10kΩ@25°C NTC热敏电阻',
    functionalPerformance: 'B值3950K，精度±1%',
    referencePrice: 1.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±1%',
      resistance: '10kΩ@25°C',
      power: '250mW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC009',
    partNumber: 'POT-10K-Linear',
    manufacturer: '松下电器',
    primaryCategory: '可变电阻',
    secondaryCategory: '电位器',
    package: '旋转式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60393'],
    description: '10kΩ线性电位器',
    functionalPerformance: '旋转寿命10万次，线性度±5%',
    referencePrice: 3.20,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '10kΩ',
      power: '0.5W',
      inductance: '无',
      frequency: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'GC010',
    partNumber: 'VARISTOR-14V',
    manufacturer: '硕凯电子',
    primaryCategory: '压敏电阻',
    secondaryCategory: 'MOV压敏电阻',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60738'],
    description: '14V氧化锌压敏电阻',
    functionalPerformance: '浪涌保护，响应时间<25ns',
    referencePrice: 0.65,
    parameters: {
      capacitance: '无',
      voltage: '14V',
      tolerance: '±10%',
      resistance: '>1GΩ',
      power: '0.6W',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+85°C'
    }
  }
];

const GeneralSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<GeneralComponent[]>(mockGeneralData);
  const [filteredData, setFilteredData] = useState<GeneralComponent[]>(mockGeneralData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<GeneralComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockGeneralData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockGeneralData);
  };

  // 查看详情
  const handleViewDetail = (record: GeneralComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: GeneralComponent, b: GeneralComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: GeneralComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            通用与特种元件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            General & Special Components - 电阻、电容、电感、晶振、传感器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="风华高科">风华高科</Option>
                  <Option value="厚声电子">厚声电子</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="麦捷科技">麦捷科技</Option>
                  <Option value="韦德万能">韦德万能</Option>
                  <Option value="信越化学">信越化学</Option>
                  <Option value="华工科技">华工科技</Option>
                  <Option value="松下电器">松下电器</Option>
                  <Option value="硕凯电子">硕凯电子</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="电容器">电容器</Option>
                  <Option value="电阻器">电阻器</Option>
                  <Option value="电感器">电感器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="滤波器">滤波器</Option>
                  <Option value="接线端子">接线端子</Option>
                  <Option value="散热器">散热器</Option>
                  <Option value="传感器">传感器</Option>
                  <Option value="可变电阻">可变电阻</Option>
                  <Option value="压敏电阻">压敏电阻</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="容值">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="额定电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.tolerance}</Descriptions.Item>
            <Descriptions.Item label="阻值">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="额定功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="电感值">{selectedComponent.parameters.inductance}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default GeneralSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 通用与特种元件数据类型定义
interface GeneralComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    capacitance?: string;
    voltage?: string;
    tolerance?: string;
    resistance?: string;
    power?: string;
    inductance?: string;
    frequency?: string;
    temperature?: string;
  };
}

// 通用与特种元件测试数据
const mockGeneralData: GeneralComponent[] = [
  {
    id: 'GC001',
    partNumber: 'CAP-100uF-25V',
    manufacturer: '风华高科',
    primaryCategory: '电容器',
    secondaryCategory: '铝电解电容',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60384', 'JIS-C5101'],
    description: '100μF/25V铝电解电容器',
    functionalPerformance: '低ESR，高纹波电流，长寿命',
    referencePrice: 0.35,
    parameters: {
      capacitance: '100μF',
      voltage: '25V',
      tolerance: '±20%',
      resistance: '无',
      power: '无',
      inductance: '无',
      frequency: '120Hz',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC002',
    partNumber: 'RES-1K-1/4W',
    manufacturer: '厚声电子',
    primaryCategory: '电阻器',
    secondaryCategory: '碳膜电阻',
    package: '轴向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60115', 'JIS-C5201'],
    description: '1kΩ/1/4W碳膜电阻器',
    functionalPerformance: '低噪声，稳定性好，成本低',
    referencePrice: 0.02,
    parameters: {
      capacitance: '无',
      voltage: '250V',
      tolerance: '±5%',
      resistance: '1kΩ',
      power: '1/4W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+155°C'
    }
  },
  {
    id: 'GC003',
    partNumber: 'IND-10uH-1A',
    manufacturer: '顺络电子',
    primaryCategory: '电感器',
    secondaryCategory: '功率电感',
    package: 'SMD-1210',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '10μH功率电感，1A饱和电流',
    functionalPerformance: '低DCR，高饱和电流，屏蔽结构',
    referencePrice: 0.25,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '0.15Ω',
      power: '无',
      inductance: '10μH',
      frequency: '1MHz',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC004',
    partNumber: 'XTAL-32.768K',
    manufacturer: '泰晶科技',
    primaryCategory: '晶振',
    secondaryCategory: '石英晶振',
    package: '圆柱形',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '32.768kHz石英晶振',
    functionalPerformance: '高精度，低功耗，RTC专用',
    referencePrice: 0.45,
    parameters: {
      capacitance: '12.5pF',
      voltage: '无',
      tolerance: '±20ppm',
      resistance: '70kΩ',
      power: '1μW',
      inductance: '无',
      frequency: '32.768kHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC005',
    partNumber: 'FILT-LC-1mH',
    manufacturer: '麦捷科技',
    primaryCategory: '滤波器',
    secondaryCategory: 'LC滤波器',
    package: 'SMD封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '1mH LC低通滤波器',
    functionalPerformance: '截止频率1MHz，插损<1dB',
    referencePrice: 1.20,
    parameters: {
      capacitance: '100pF',
      voltage: '50V',
      tolerance: '±10%',
      resistance: '1Ω',
      power: '1W',
      inductance: '1mH',
      frequency: '1MHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC006',
    partNumber: 'TERM-Screw-5mm',
    manufacturer: '韦德万能',
    primaryCategory: '接线端子',
    secondaryCategory: '螺钉式端子',
    package: '5mm间距',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60947'],
    description: '5mm间距螺钉式接线端子',
    functionalPerformance: '10A/300V，镀锡铜材质',
    referencePrice: 0.80,
    parameters: {
      capacitance: '无',
      voltage: '300V',
      tolerance: '无',
      resistance: '<1mΩ',
      power: '3kW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC007',
    partNumber: 'HEAT-TO220-Alu',
    manufacturer: '信越化学',
    primaryCategory: '散热器',
    secondaryCategory: 'TO-220散热器',
    package: '铝合金',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'TO-220封装铝合金散热器',
    functionalPerformance: '热阻3°C/W，自然对流',
    referencePrice: 2.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '无',
      resistance: '3°C/W',
      power: '10W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+150°C'
    }
  },
  {
    id: 'GC008',
    partNumber: 'TEMP-NTC-10K',
    manufacturer: '华工科技',
    primaryCategory: '传感器',
    secondaryCategory: '温度传感器',
    package: '玻璃封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60539'],
    description: '10kΩ@25°C NTC热敏电阻',
    functionalPerformance: 'B值3950K，精度±1%',
    referencePrice: 1.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±1%',
      resistance: '10kΩ@25°C',
      power: '250mW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC009',
    partNumber: 'POT-10K-Linear',
    manufacturer: '松下电器',
    primaryCategory: '可变电阻',
    secondaryCategory: '电位器',
    package: '旋转式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60393'],
    description: '10kΩ线性电位器',
    functionalPerformance: '旋转寿命10万次，线性度±5%',
    referencePrice: 3.20,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '10kΩ',
      power: '0.5W',
      inductance: '无',
      frequency: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'GC010',
    partNumber: 'VARISTOR-14V',
    manufacturer: '硕凯电子',
    primaryCategory: '压敏电阻',
    secondaryCategory: 'MOV压敏电阻',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60738'],
    description: '14V氧化锌压敏电阻',
    functionalPerformance: '浪涌保护，响应时间<25ns',
    referencePrice: 0.65,
    parameters: {
      capacitance: '无',
      voltage: '14V',
      tolerance: '±10%',
      resistance: '>1GΩ',
      power: '0.6W',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+85°C'
    }
  }
];

const GeneralSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<GeneralComponent[]>(mockGeneralData);
  const [filteredData, setFilteredData] = useState<GeneralComponent[]>(mockGeneralData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<GeneralComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockGeneralData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockGeneralData);
  };

  // 查看详情
  const handleViewDetail = (record: GeneralComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: GeneralComponent, b: GeneralComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: GeneralComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            通用与特种元件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            General & Special Components - 电阻、电容、电感、晶振、传感器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="风华高科">风华高科</Option>
                  <Option value="厚声电子">厚声电子</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="麦捷科技">麦捷科技</Option>
                  <Option value="韦德万能">韦德万能</Option>
                  <Option value="信越化学">信越化学</Option>
                  <Option value="华工科技">华工科技</Option>
                  <Option value="松下电器">松下电器</Option>
                  <Option value="硕凯电子">硕凯电子</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="电容器">电容器</Option>
                  <Option value="电阻器">电阻器</Option>
                  <Option value="电感器">电感器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="滤波器">滤波器</Option>
                  <Option value="接线端子">接线端子</Option>
                  <Option value="散热器">散热器</Option>
                  <Option value="传感器">传感器</Option>
                  <Option value="可变电阻">可变电阻</Option>
                  <Option value="压敏电阻">压敏电阻</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="容值">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="额定电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.tolerance}</Descriptions.Item>
            <Descriptions.Item label="阻值">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="额定功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="电感值">{selectedComponent.parameters.inductance}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default GeneralSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 混合集成电路数据类型定义
interface HybridComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    isolation?: string;
  };
}

// 混合集成电路测试数据
const mockHybridData: HybridComponent[] = [
  {
    id: 'H001',
    partNumber: 'HMC1023LC4',
    manufacturer: '海光信息',
    primaryCategory: '射频混合电路',
    secondaryCategory: '低噪声放大器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '宽带低噪声放大器，0.1-20GHz',
    functionalPerformance: '低噪声系数，高增益，宽频带',
    referencePrice: 280.00,
    parameters: {
      voltage: '5V±5%',
      current: '85mA',
      power: '425mW',
      temperature: '-55°C~+85°C',
      frequency: '0.1GHz~20GHz',
      gain: '18dB',
      bandwidth: '19.9GHz',
      isolation: '25dB'
    }
  },
  {
    id: 'H002',
    partNumber: 'HMC544LC4',
    manufacturer: '中电科技',
    primaryCategory: '射频混合电路',
    secondaryCategory: '功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高功率射频放大器，2-18GHz',
    functionalPerformance: '高输出功率，宽频带响应',
    referencePrice: 450.00,
    parameters: {
      voltage: '8V±5%',
      current: '200mA',
      power: '1.6W',
      temperature: '-55°C~+85°C',
      frequency: '2GHz~18GHz',
      gain: '15dB',
      bandwidth: '16GHz',
      isolation: '20dB'
    }
  },
  {
    id: 'H003',
    partNumber: 'HMC213MS8',
    manufacturer: '航天科工',
    primaryCategory: '射频混合电路',
    secondaryCategory: '混频器',
    package: 'MSOP-8',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['QML-V', 'MIL-PRF-38534'],
    description: '双平衡混频器，DC-8GHz',
    functionalPerformance: '低转换损耗，高隔离度',
    referencePrice: 520.00,
    parameters: {
      voltage: '5V±10%',
      current: '25mA',
      power: '125mW',
      temperature: '-55°C~+125°C',
      frequency: 'DC~8GHz',
      gain: '8dB转换增益',
      bandwidth: '8GHz',
      isolation: '35dB'
    }
  },
  {
    id: 'H004',
    partNumber: 'HMC987LC5',
    manufacturer: '中科微至',
    primaryCategory: '射频混合电路',
    secondaryCategory: '衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '数字可控衰减器，DC-18GHz',
    functionalPerformance: '6位数字控制，0.5dB步进',
    referencePrice: 320.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '45mA',
      power: '150mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~18GHz',
      gain: '0~31.5dB衰减',
      bandwidth: '18GHz',
      isolation: '30dB'
    }
  },
  {
    id: 'H005',
    partNumber: 'HMC641LC4',
    manufacturer: '华进半导体',
    primaryCategory: '模拟混合电路',
    secondaryCategory: '运算放大器',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高速运算放大器，精密级',
    functionalPerformance: '低失调，高转换率',
    referencePrice: 85.00,
    parameters: {
      voltage: '±15V',
      current: '8mA',
      power: '240mW',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      gain: '120dB',
      bandwidth: '100MHz',
      isolation: '无'
    }
  },
  {
    id: 'H006',
    partNumber: 'HMC832LC3',
    manufacturer: '紫光同创',
    primaryCategory: '时钟混合电路',
    secondaryCategory: '锁相环',
    package: 'QFN-32',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '整数N分频PLL，25MHz-3GHz',
    functionalPerformance: '低相位噪声，快速锁定',
    referencePrice: 180.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '95mA',
      power: '315mW',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~3GHz',
      gain: '无',
      bandwidth: '2.975GHz',
      isolation: '无'
    }
  },
  {
    id: 'H007',
    partNumber: 'HMC754LC3',
    manufacturer: '安路科技',
    primaryCategory: '功率混合电路',
    secondaryCategory: '功率控制器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '射频功率检测器，DC-40GHz',
    functionalPerformance: '宽动态范围，线性响应',
    referencePrice: 220.00,
    parameters: {
      voltage: '5V±5%',
      current: '12mA',
      power: '60mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~40GHz',
      gain: '无',
      bandwidth: '40GHz',
      isolation: '无'
    }
  },
  {
    id: 'H008',
    partNumber: 'HMC892LC4',
    manufacturer: '全志科技',
    primaryCategory: '开关混合电路',
    secondaryCategory: '射频开关',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'SPDT射频开关，DC-26.5GHz',
    functionalPerformance: '低插入损耗，高隔离度',
    referencePrice: 120.00,
    parameters: {
      voltage: '3.3V/5V',
      current: '15mA',
      power: '75mW',
      temperature: '-40°C~+85°C',
      frequency: 'DC~26.5GHz',
      gain: '无',
      bandwidth: '26.5GHz',
      isolation: '50dB'
    }
  }
];

const HybridICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<HybridComponent[]>(mockHybridData);
  const [filteredData, setFilteredData] = useState<HybridComponent[]>(mockHybridData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<HybridComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockHybridData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockHybridData);
  };

  // 查看详情
  const handleViewDetail = (record: HybridComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: HybridComponent, b: HybridComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: HybridComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            混合集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Hybrid Integrated Circuits - 射频电路、模拟电路、功率电路、时钟电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海光信息">海光信息</Option>
                  <Option value="中电科技">中电科技</Option>
                  <Option value="航天科工">航天科工</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="华进半导体">华进半导体</Option>
                  <Option value="紫光同创">紫光同创</Option>
                  <Option value="安路科技">安路科技</Option>
                  <Option value="全志科技">全志科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="射频混合电路">射频混合电路</Option>
                  <Option value="模拟混合电路">模拟混合电路</Option>
                  <Option value="时钟混合电路">时钟混合电路</Option>
                  <Option value="功率混合电路">功率混合电路</Option>
                  <Option value="开关混合电路">开关混合电路</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="锁相环">锁相环</Option>
                  <Option value="功率控制器">功率控制器</Option>
                  <Option value="射频开关">射频开关</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="cyan">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default HybridICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 混合集成电路数据类型定义
interface HybridComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    isolation?: string;
  };
}

// 混合集成电路测试数据
const mockHybridData: HybridComponent[] = [
  {
    id: 'H001',
    partNumber: 'HMC1023LC4',
    manufacturer: '海光信息',
    primaryCategory: '射频混合电路',
    secondaryCategory: '低噪声放大器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '宽带低噪声放大器，0.1-20GHz',
    functionalPerformance: '低噪声系数，高增益，宽频带',
    referencePrice: 280.00,
    parameters: {
      voltage: '5V±5%',
      current: '85mA',
      power: '425mW',
      temperature: '-55°C~+85°C',
      frequency: '0.1GHz~20GHz',
      gain: '18dB',
      bandwidth: '19.9GHz',
      isolation: '25dB'
    }
  },
  {
    id: 'H002',
    partNumber: 'HMC544LC4',
    manufacturer: '中电科技',
    primaryCategory: '射频混合电路',
    secondaryCategory: '功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高功率射频放大器，2-18GHz',
    functionalPerformance: '高输出功率，宽频带响应',
    referencePrice: 450.00,
    parameters: {
      voltage: '8V±5%',
      current: '200mA',
      power: '1.6W',
      temperature: '-55°C~+85°C',
      frequency: '2GHz~18GHz',
      gain: '15dB',
      bandwidth: '16GHz',
      isolation: '20dB'
    }
  },
  {
    id: 'H003',
    partNumber: 'HMC213MS8',
    manufacturer: '航天科工',
    primaryCategory: '射频混合电路',
    secondaryCategory: '混频器',
    package: 'MSOP-8',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['QML-V', 'MIL-PRF-38534'],
    description: '双平衡混频器，DC-8GHz',
    functionalPerformance: '低转换损耗，高隔离度',
    referencePrice: 520.00,
    parameters: {
      voltage: '5V±10%',
      current: '25mA',
      power: '125mW',
      temperature: '-55°C~+125°C',
      frequency: 'DC~8GHz',
      gain: '8dB转换增益',
      bandwidth: '8GHz',
      isolation: '35dB'
    }
  },
  {
    id: 'H004',
    partNumber: 'HMC987LC5',
    manufacturer: '中科微至',
    primaryCategory: '射频混合电路',
    secondaryCategory: '衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '数字可控衰减器，DC-18GHz',
    functionalPerformance: '6位数字控制，0.5dB步进',
    referencePrice: 320.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '45mA',
      power: '150mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~18GHz',
      gain: '0~31.5dB衰减',
      bandwidth: '18GHz',
      isolation: '30dB'
    }
  },
  {
    id: 'H005',
    partNumber: 'HMC641LC4',
    manufacturer: '华进半导体',
    primaryCategory: '模拟混合电路',
    secondaryCategory: '运算放大器',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高速运算放大器，精密级',
    functionalPerformance: '低失调，高转换率',
    referencePrice: 85.00,
    parameters: {
      voltage: '±15V',
      current: '8mA',
      power: '240mW',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      gain: '120dB',
      bandwidth: '100MHz',
      isolation: '无'
    }
  },
  {
    id: 'H006',
    partNumber: 'HMC832LC3',
    manufacturer: '紫光同创',
    primaryCategory: '时钟混合电路',
    secondaryCategory: '锁相环',
    package: 'QFN-32',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '整数N分频PLL，25MHz-3GHz',
    functionalPerformance: '低相位噪声，快速锁定',
    referencePrice: 180.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '95mA',
      power: '315mW',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~3GHz',
      gain: '无',
      bandwidth: '2.975GHz',
      isolation: '无'
    }
  },
  {
    id: 'H007',
    partNumber: 'HMC754LC3',
    manufacturer: '安路科技',
    primaryCategory: '功率混合电路',
    secondaryCategory: '功率控制器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '射频功率检测器，DC-40GHz',
    functionalPerformance: '宽动态范围，线性响应',
    referencePrice: 220.00,
    parameters: {
      voltage: '5V±5%',
      current: '12mA',
      power: '60mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~40GHz',
      gain: '无',
      bandwidth: '40GHz',
      isolation: '无'
    }
  },
  {
    id: 'H008',
    partNumber: 'HMC892LC4',
    manufacturer: '全志科技',
    primaryCategory: '开关混合电路',
    secondaryCategory: '射频开关',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'SPDT射频开关，DC-26.5GHz',
    functionalPerformance: '低插入损耗，高隔离度',
    referencePrice: 120.00,
    parameters: {
      voltage: '3.3V/5V',
      current: '15mA',
      power: '75mW',
      temperature: '-40°C~+85°C',
      frequency: 'DC~26.5GHz',
      gain: '无',
      bandwidth: '26.5GHz',
      isolation: '50dB'
    }
  }
];

const HybridICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<HybridComponent[]>(mockHybridData);
  const [filteredData, setFilteredData] = useState<HybridComponent[]>(mockHybridData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<HybridComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockHybridData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockHybridData);
  };

  // 查看详情
  const handleViewDetail = (record: HybridComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: HybridComponent, b: HybridComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: HybridComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            混合集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Hybrid Integrated Circuits - 射频电路、模拟电路、功率电路、时钟电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海光信息">海光信息</Option>
                  <Option value="中电科技">中电科技</Option>
                  <Option value="航天科工">航天科工</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="华进半导体">华进半导体</Option>
                  <Option value="紫光同创">紫光同创</Option>
                  <Option value="安路科技">安路科技</Option>
                  <Option value="全志科技">全志科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="射频混合电路">射频混合电路</Option>
                  <Option value="模拟混合电路">模拟混合电路</Option>
                  <Option value="时钟混合电路">时钟混合电路</Option>
                  <Option value="功率混合电路">功率混合电路</Option>
                  <Option value="开关混合电路">开关混合电路</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="锁相环">锁相环</Option>
                  <Option value="功率控制器">功率控制器</Option>
                  <Option value="射频开关">射频开关</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="cyan">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default HybridICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 混合集成电路数据类型定义
interface HybridComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    isolation?: string;
  };
}

// 混合集成电路测试数据
const mockHybridData: HybridComponent[] = [
  {
    id: 'H001',
    partNumber: 'HMC1023LC4',
    manufacturer: '海光信息',
    primaryCategory: '射频混合电路',
    secondaryCategory: '低噪声放大器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '宽带低噪声放大器，0.1-20GHz',
    functionalPerformance: '低噪声系数，高增益，宽频带',
    referencePrice: 280.00,
    parameters: {
      voltage: '5V±5%',
      current: '85mA',
      power: '425mW',
      temperature: '-55°C~+85°C',
      frequency: '0.1GHz~20GHz',
      gain: '18dB',
      bandwidth: '19.9GHz',
      isolation: '25dB'
    }
  },
  {
    id: 'H002',
    partNumber: 'HMC544LC4',
    manufacturer: '中电科技',
    primaryCategory: '射频混合电路',
    secondaryCategory: '功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高功率射频放大器，2-18GHz',
    functionalPerformance: '高输出功率，宽频带响应',
    referencePrice: 450.00,
    parameters: {
      voltage: '8V±5%',
      current: '200mA',
      power: '1.6W',
      temperature: '-55°C~+85°C',
      frequency: '2GHz~18GHz',
      gain: '15dB',
      bandwidth: '16GHz',
      isolation: '20dB'
    }
  },
  {
    id: 'H003',
    partNumber: 'HMC213MS8',
    manufacturer: '航天科工',
    primaryCategory: '射频混合电路',
    secondaryCategory: '混频器',
    package: 'MSOP-8',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['QML-V', 'MIL-PRF-38534'],
    description: '双平衡混频器，DC-8GHz',
    functionalPerformance: '低转换损耗，高隔离度',
    referencePrice: 520.00,
    parameters: {
      voltage: '5V±10%',
      current: '25mA',
      power: '125mW',
      temperature: '-55°C~+125°C',
      frequency: 'DC~8GHz',
      gain: '8dB转换增益',
      bandwidth: '8GHz',
      isolation: '35dB'
    }
  },
  {
    id: 'H004',
    partNumber: 'HMC987LC5',
    manufacturer: '中科微至',
    primaryCategory: '射频混合电路',
    secondaryCategory: '衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '数字可控衰减器，DC-18GHz',
    functionalPerformance: '6位数字控制，0.5dB步进',
    referencePrice: 320.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '45mA',
      power: '150mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~18GHz',
      gain: '0~31.5dB衰减',
      bandwidth: '18GHz',
      isolation: '30dB'
    }
  },
  {
    id: 'H005',
    partNumber: 'HMC641LC4',
    manufacturer: '华进半导体',
    primaryCategory: '模拟混合电路',
    secondaryCategory: '运算放大器',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高速运算放大器，精密级',
    functionalPerformance: '低失调，高转换率',
    referencePrice: 85.00,
    parameters: {
      voltage: '±15V',
      current: '8mA',
      power: '240mW',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      gain: '120dB',
      bandwidth: '100MHz',
      isolation: '无'
    }
  },
  {
    id: 'H006',
    partNumber: 'HMC832LC3',
    manufacturer: '紫光同创',
    primaryCategory: '时钟混合电路',
    secondaryCategory: '锁相环',
    package: 'QFN-32',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '整数N分频PLL，25MHz-3GHz',
    functionalPerformance: '低相位噪声，快速锁定',
    referencePrice: 180.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '95mA',
      power: '315mW',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~3GHz',
      gain: '无',
      bandwidth: '2.975GHz',
      isolation: '无'
    }
  },
  {
    id: 'H007',
    partNumber: 'HMC754LC3',
    manufacturer: '安路科技',
    primaryCategory: '功率混合电路',
    secondaryCategory: '功率控制器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '射频功率检测器，DC-40GHz',
    functionalPerformance: '宽动态范围，线性响应',
    referencePrice: 220.00,
    parameters: {
      voltage: '5V±5%',
      current: '12mA',
      power: '60mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~40GHz',
      gain: '无',
      bandwidth: '40GHz',
      isolation: '无'
    }
  },
  {
    id: 'H008',
    partNumber: 'HMC892LC4',
    manufacturer: '全志科技',
    primaryCategory: '开关混合电路',
    secondaryCategory: '射频开关',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'SPDT射频开关，DC-26.5GHz',
    functionalPerformance: '低插入损耗，高隔离度',
    referencePrice: 120.00,
    parameters: {
      voltage: '3.3V/5V',
      current: '15mA',
      power: '75mW',
      temperature: '-40°C~+85°C',
      frequency: 'DC~26.5GHz',
      gain: '无',
      bandwidth: '26.5GHz',
      isolation: '50dB'
    }
  }
];

const HybridICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<HybridComponent[]>(mockHybridData);
  const [filteredData, setFilteredData] = useState<HybridComponent[]>(mockHybridData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<HybridComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockHybridData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockHybridData);
  };

  // 查看详情
  const handleViewDetail = (record: HybridComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: HybridComponent, b: HybridComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: HybridComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            混合集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Hybrid Integrated Circuits - 射频电路、模拟电路、功率电路、时钟电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海光信息">海光信息</Option>
                  <Option value="中电科技">中电科技</Option>
                  <Option value="航天科工">航天科工</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="华进半导体">华进半导体</Option>
                  <Option value="紫光同创">紫光同创</Option>
                  <Option value="安路科技">安路科技</Option>
                  <Option value="全志科技">全志科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="射频混合电路">射频混合电路</Option>
                  <Option value="模拟混合电路">模拟混合电路</Option>
                  <Option value="时钟混合电路">时钟混合电路</Option>
                  <Option value="功率混合电路">功率混合电路</Option>
                  <Option value="开关混合电路">开关混合电路</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="锁相环">锁相环</Option>
                  <Option value="功率控制器">功率控制器</Option>
                  <Option value="射频开关">射频开关</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="cyan">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default HybridICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 微系统数据类型定义
interface MicrosystemComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    sensitivity?: string;
    range?: string;
    accuracy?: string;
    temperature?: string;
  };
}

// 微系统测试数据
const mockMicrosystemsData: MicrosystemComponent[] = [
  {
    id: 'MS001',
    partNumber: 'MEMS-ACC-3Axis',
    manufacturer: '敏芯股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴加速度计',
    package: 'LGA-14',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q100', 'ISO-26262'],
    description: '三轴MEMS加速度传感器',
    functionalPerformance: '±16g量程，16位ADC，低功耗',
    referencePrice: 8.50,
    parameters: {
      voltage: '1.8-3.6V',
      current: '12μA',
      power: '36μW',
      frequency: '1.6kHz',
      sensitivity: '2048LSB/g',
      range: '±2/±4/±8/±16g',
      accuracy: '±40mg',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS002',
    partNumber: 'GYRO-3Axis-2000dps',
    manufacturer: '瑞声科技',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴陀螺仪',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: '三轴MEMS陀螺仪传感器',
    functionalPerformance: '±2000dps量程，16位分辨率',
    referencePrice: 12.00,
    parameters: {
      voltage: '2.4-3.6V',
      current: '3.6mA',
      power: '10.8mW',
      frequency: '8kHz',
      sensitivity: '16.4LSB/(dps)',
      range: '±250/±500/±1000/±2000dps',
      accuracy: '±1%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS003',
    partNumber: 'PRESS-1000mbar',
    manufacturer: '森思泰克',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '压力传感器',
    package: 'LGA-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS绝对压力传感器',
    functionalPerformance: '300-1100mbar，24位ADC',
    referencePrice: 15.00,
    parameters: {
      voltage: '1.8-3.6V',
      current: '3μA',
      power: '5.4μW',
      frequency: '157Hz',
      sensitivity: '4096Pa/LSB',
      range: '300-1100mbar',
      accuracy: '±0.12mbar',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS004',
    partNumber: 'MIC-MEMS-Omni',
    manufacturer: '歌尔股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: 'MEMS麦克风',
    package: 'SMD-3.76×2.95',
    qualityLevel: '消费级',
    lifecycle: '生产中',
    standards: ['IEC-61672'],
    description: '全向MEMS数字麦克风',
    functionalPerformance: '-26dBFS灵敏度，130dB SPL',
    referencePrice: 1.20,
    parameters: {
      voltage: '1.8-3.6V',
      current: '650μA',
      power: '2.3mW',
      frequency: '20Hz-20kHz',
      sensitivity: '-26dBFS',
      range: '130dB SPL',
      accuracy: '±1dB',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS005',
    partNumber: 'RF-MEMS-SW-6GHz',
    manufacturer: '中电科55所',
    primaryCategory: 'RF MEMS',
    secondaryCategory: 'RF MEMS开关',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '6GHz RF MEMS开关',
    functionalPerformance: 'DC-6GHz，插损<0.3dB，隔离>30dB',
    referencePrice: 280.00,
    parameters: {
      voltage: '0-80V',
      current: '1μA',
      power: '80μW',
      frequency: 'DC-6GHz',
      sensitivity: '无',
      range: '80V',
      accuracy: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MS006',
    partNumber: 'BIO-MEMS-Glucose',
    manufacturer: '奥普拓',
    primaryCategory: '生物MEMS',
    secondaryCategory: '葡萄糖传感器',
    package: '芯片级封装',
    qualityLevel: '医用级',
    lifecycle: '生产中',
    standards: ['ISO-13485', 'FDA-510K'],
    description: 'MEMS葡萄糖生物传感器',
    functionalPerformance: '0.5-30mmol/L检测范围，电化学检测',
    referencePrice: 45.00,
    parameters: {
      voltage: '3.0V',
      current: '10μA',
      power: '30μW',
      frequency: '1Hz',
      sensitivity: '20nA/(mmol/L)',
      range: '0.5-30mmol/L',
      accuracy: '±5%',
      temperature: '20°C~+40°C'
    }
  },
  {
    id: 'MS007',
    partNumber: 'OPTICAL-MEMS-DMD',
    manufacturer: '奥普光电',
    primaryCategory: '光学MEMS',
    secondaryCategory: '数字微镜器件',
    package: 'BGA封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62471'],
    description: '1024×768数字微镜阵列',
    functionalPerformance: '1024×768分辨率，20μs切换时间',
    referencePrice: 1200.00,
    parameters: {
      voltage: '12V',
      current: '500mA',
      power: '6W',
      frequency: '50kHz',
      sensitivity: '无',
      range: '±12°',
      accuracy: '±0.1°',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'MS008',
    partNumber: 'FLOW-MEMS-Thermal',
    manufacturer: '奥松电子',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '热式流量传感器',
    package: 'TO-39',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS热式气体流量传感器',
    functionalPerformance: '0-200SLPM，热式检测原理',
    referencePrice: 85.00,
    parameters: {
      voltage: '5V',
      current: '20mA',
      power: '100mW',
      frequency: '10Hz',
      sensitivity: '50mV/(m/s)',
      range: '0-200SLPM',
      accuracy: '±3%',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'MS009',
    partNumber: 'MEMS-OSC-100MHz',
    manufacturer: '泰晶科技',
    primaryCategory: 'MEMS振荡器',
    secondaryCategory: 'MEMS时钟发生器',
    package: 'SMD-3.2×2.5',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '100MHz MEMS振荡器',
    functionalPerformance: '100MHz±25ppm，LVDS输出',
    referencePrice: 6.50,
    parameters: {
      voltage: '3.3V',
      current: '45mA',
      power: '148.5mW',
      frequency: '100MHz',
      sensitivity: '无',
      range: '±25ppm',
      accuracy: '±25ppm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS010',
    partNumber: 'MEMS-MIRROR-2Axis',
    manufacturer: '中科院光电院',
    primaryCategory: '光学MEMS',
    secondaryCategory: '二维扫描镜',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '二维MEMS扫描微镜',
    functionalPerformance: '±15°扫描角，1kHz扫描频率',
    referencePrice: 2800.00,
    parameters: {
      voltage: '±150V',
      current: '1mA',
      power: '300mW',
      frequency: '1kHz',
      sensitivity: '0.1°/V',
      range: '±15°',
      accuracy: '±0.1°',
      temperature: '-40°C~+70°C'
    }
  }
];

const MicrosystemsSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [filteredData, setFilteredData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrosystemComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrosystemsData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrosystemsData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrosystemComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrosystemComponent, b: MicrosystemComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '医用级': 'magenta',
          '消费级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrosystemComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            微系统
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Microsystems - MEMS传感器、RF MEMS、生物MEMS、光学MEMS等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="敏芯股份">敏芯股份</Option>
                  <Option value="瑞声科技">瑞声科技</Option>
                  <Option value="森思泰克">森思泰克</Option>
                  <Option value="歌尔股份">歌尔股份</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="奥普拓">奥普拓</Option>
                  <Option value="奥普光电">奥普光电</Option>
                  <Option value="奥松电子">奥松电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="中科院光电院">中科院光电院</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="MEMS传感器">MEMS传感器</Option>
                  <Option value="RF MEMS">RF MEMS</Option>
                  <Option value="生物MEMS">生物MEMS</Option>
                  <Option value="光学MEMS">光学MEMS</Option>
                  <Option value="MEMS振荡器">MEMS振荡器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="医用级">医用级</Option>
                  <Option value="消费级">消费级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功耗">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="灵敏度">{selectedComponent.parameters.sensitivity}</Descriptions.Item>
            <Descriptions.Item label="测量范围">{selectedComponent.parameters.range}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrosystemsSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 微系统数据类型定义
interface MicrosystemComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    sensitivity?: string;
    range?: string;
    accuracy?: string;
    temperature?: string;
  };
}

// 微系统测试数据
const mockMicrosystemsData: MicrosystemComponent[] = [
  {
    id: 'MS001',
    partNumber: 'MEMS-ACC-3Axis',
    manufacturer: '敏芯股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴加速度计',
    package: 'LGA-14',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q100', 'ISO-26262'],
    description: '三轴MEMS加速度传感器',
    functionalPerformance: '±16g量程，16位ADC，低功耗',
    referencePrice: 8.50,
    parameters: {
      voltage: '1.8-3.6V',
      current: '12μA',
      power: '36μW',
      frequency: '1.6kHz',
      sensitivity: '2048LSB/g',
      range: '±2/±4/±8/±16g',
      accuracy: '±40mg',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS002',
    partNumber: 'GYRO-3Axis-2000dps',
    manufacturer: '瑞声科技',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴陀螺仪',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: '三轴MEMS陀螺仪传感器',
    functionalPerformance: '±2000dps量程，16位分辨率',
    referencePrice: 12.00,
    parameters: {
      voltage: '2.4-3.6V',
      current: '3.6mA',
      power: '10.8mW',
      frequency: '8kHz',
      sensitivity: '16.4LSB/(dps)',
      range: '±250/±500/±1000/±2000dps',
      accuracy: '±1%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS003',
    partNumber: 'PRESS-1000mbar',
    manufacturer: '森思泰克',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '压力传感器',
    package: 'LGA-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS绝对压力传感器',
    functionalPerformance: '300-1100mbar，24位ADC',
    referencePrice: 15.00,
    parameters: {
      voltage: '1.8-3.6V',
      current: '3μA',
      power: '5.4μW',
      frequency: '157Hz',
      sensitivity: '4096Pa/LSB',
      range: '300-1100mbar',
      accuracy: '±0.12mbar',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS004',
    partNumber: 'MIC-MEMS-Omni',
    manufacturer: '歌尔股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: 'MEMS麦克风',
    package: 'SMD-3.76×2.95',
    qualityLevel: '消费级',
    lifecycle: '生产中',
    standards: ['IEC-61672'],
    description: '全向MEMS数字麦克风',
    functionalPerformance: '-26dBFS灵敏度，130dB SPL',
    referencePrice: 1.20,
    parameters: {
      voltage: '1.8-3.6V',
      current: '650μA',
      power: '2.3mW',
      frequency: '20Hz-20kHz',
      sensitivity: '-26dBFS',
      range: '130dB SPL',
      accuracy: '±1dB',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS005',
    partNumber: 'RF-MEMS-SW-6GHz',
    manufacturer: '中电科55所',
    primaryCategory: 'RF MEMS',
    secondaryCategory: 'RF MEMS开关',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '6GHz RF MEMS开关',
    functionalPerformance: 'DC-6GHz，插损<0.3dB，隔离>30dB',
    referencePrice: 280.00,
    parameters: {
      voltage: '0-80V',
      current: '1μA',
      power: '80μW',
      frequency: 'DC-6GHz',
      sensitivity: '无',
      range: '80V',
      accuracy: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MS006',
    partNumber: 'BIO-MEMS-Glucose',
    manufacturer: '奥普拓',
    primaryCategory: '生物MEMS',
    secondaryCategory: '葡萄糖传感器',
    package: '芯片级封装',
    qualityLevel: '医用级',
    lifecycle: '生产中',
    standards: ['ISO-13485', 'FDA-510K'],
    description: 'MEMS葡萄糖生物传感器',
    functionalPerformance: '0.5-30mmol/L检测范围，电化学检测',
    referencePrice: 45.00,
    parameters: {
      voltage: '3.0V',
      current: '10μA',
      power: '30μW',
      frequency: '1Hz',
      sensitivity: '20nA/(mmol/L)',
      range: '0.5-30mmol/L',
      accuracy: '±5%',
      temperature: '20°C~+40°C'
    }
  },
  {
    id: 'MS007',
    partNumber: 'OPTICAL-MEMS-DMD',
    manufacturer: '奥普光电',
    primaryCategory: '光学MEMS',
    secondaryCategory: '数字微镜器件',
    package: 'BGA封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62471'],
    description: '1024×768数字微镜阵列',
    functionalPerformance: '1024×768分辨率，20μs切换时间',
    referencePrice: 1200.00,
    parameters: {
      voltage: '12V',
      current: '500mA',
      power: '6W',
      frequency: '50kHz',
      sensitivity: '无',
      range: '±12°',
      accuracy: '±0.1°',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'MS008',
    partNumber: 'FLOW-MEMS-Thermal',
    manufacturer: '奥松电子',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '热式流量传感器',
    package: 'TO-39',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS热式气体流量传感器',
    functionalPerformance: '0-200SLPM，热式检测原理',
    referencePrice: 85.00,
    parameters: {
      voltage: '5V',
      current: '20mA',
      power: '100mW',
      frequency: '10Hz',
      sensitivity: '50mV/(m/s)',
      range: '0-200SLPM',
      accuracy: '±3%',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'MS009',
    partNumber: 'MEMS-OSC-100MHz',
    manufacturer: '泰晶科技',
    primaryCategory: 'MEMS振荡器',
    secondaryCategory: 'MEMS时钟发生器',
    package: 'SMD-3.2×2.5',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '100MHz MEMS振荡器',
    functionalPerformance: '100MHz±25ppm，LVDS输出',
    referencePrice: 6.50,
    parameters: {
      voltage: '3.3V',
      current: '45mA',
      power: '148.5mW',
      frequency: '100MHz',
      sensitivity: '无',
      range: '±25ppm',
      accuracy: '±25ppm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS010',
    partNumber: 'MEMS-MIRROR-2Axis',
    manufacturer: '中科院光电院',
    primaryCategory: '光学MEMS',
    secondaryCategory: '二维扫描镜',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '二维MEMS扫描微镜',
    functionalPerformance: '±15°扫描角，1kHz扫描频率',
    referencePrice: 2800.00,
    parameters: {
      voltage: '±150V',
      current: '1mA',
      power: '300mW',
      frequency: '1kHz',
      sensitivity: '0.1°/V',
      range: '±15°',
      accuracy: '±0.1°',
      temperature: '-40°C~+70°C'
    }
  }
];

const MicrosystemsSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [filteredData, setFilteredData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrosystemComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrosystemsData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrosystemsData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrosystemComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrosystemComponent, b: MicrosystemComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '医用级': 'magenta',
          '消费级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrosystemComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            微系统
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Microsystems - MEMS传感器、RF MEMS、生物MEMS、光学MEMS等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="敏芯股份">敏芯股份</Option>
                  <Option value="瑞声科技">瑞声科技</Option>
                  <Option value="森思泰克">森思泰克</Option>
                  <Option value="歌尔股份">歌尔股份</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="奥普拓">奥普拓</Option>
                  <Option value="奥普光电">奥普光电</Option>
                  <Option value="奥松电子">奥松电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="中科院光电院">中科院光电院</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="MEMS传感器">MEMS传感器</Option>
                  <Option value="RF MEMS">RF MEMS</Option>
                  <Option value="生物MEMS">生物MEMS</Option>
                  <Option value="光学MEMS">光学MEMS</Option>
                  <Option value="MEMS振荡器">MEMS振荡器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="医用级">医用级</Option>
                  <Option value="消费级">消费级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功耗">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="灵敏度">{selectedComponent.parameters.sensitivity}</Descriptions.Item>
            <Descriptions.Item label="测量范围">{selectedComponent.parameters.range}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrosystemsSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 微系统数据类型定义
interface MicrosystemComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    sensitivity?: string;
    range?: string;
    accuracy?: string;
    temperature?: string;
  };
}

// 微系统测试数据
const mockMicrosystemsData: MicrosystemComponent[] = [
  {
    id: 'MS001',
    partNumber: 'MEMS-ACC-3Axis',
    manufacturer: '敏芯股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴加速度计',
    package: 'LGA-14',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q100', 'ISO-26262'],
    description: '三轴MEMS加速度传感器',
    functionalPerformance: '±16g量程，16位ADC，低功耗',
    referencePrice: 8.50,
    parameters: {
      voltage: '1.8-3.6V',
      current: '12μA',
      power: '36μW',
      frequency: '1.6kHz',
      sensitivity: '2048LSB/g',
      range: '±2/±4/±8/±16g',
      accuracy: '±40mg',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS002',
    partNumber: 'GYRO-3Axis-2000dps',
    manufacturer: '瑞声科技',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴陀螺仪',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: '三轴MEMS陀螺仪传感器',
    functionalPerformance: '±2000dps量程，16位分辨率',
    referencePrice: 12.00,
    parameters: {
      voltage: '2.4-3.6V',
      current: '3.6mA',
      power: '10.8mW',
      frequency: '8kHz',
      sensitivity: '16.4LSB/(dps)',
      range: '±250/±500/±1000/±2000dps',
      accuracy: '±1%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS003',
    partNumber: 'PRESS-1000mbar',
    manufacturer: '森思泰克',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '压力传感器',
    package: 'LGA-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS绝对压力传感器',
    functionalPerformance: '300-1100mbar，24位ADC',
    referencePrice: 15.00,
    parameters: {
      voltage: '1.8-3.6V',
      current: '3μA',
      power: '5.4μW',
      frequency: '157Hz',
      sensitivity: '4096Pa/LSB',
      range: '300-1100mbar',
      accuracy: '±0.12mbar',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS004',
    partNumber: 'MIC-MEMS-Omni',
    manufacturer: '歌尔股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: 'MEMS麦克风',
    package: 'SMD-3.76×2.95',
    qualityLevel: '消费级',
    lifecycle: '生产中',
    standards: ['IEC-61672'],
    description: '全向MEMS数字麦克风',
    functionalPerformance: '-26dBFS灵敏度，130dB SPL',
    referencePrice: 1.20,
    parameters: {
      voltage: '1.8-3.6V',
      current: '650μA',
      power: '2.3mW',
      frequency: '20Hz-20kHz',
      sensitivity: '-26dBFS',
      range: '130dB SPL',
      accuracy: '±1dB',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS005',
    partNumber: 'RF-MEMS-SW-6GHz',
    manufacturer: '中电科55所',
    primaryCategory: 'RF MEMS',
    secondaryCategory: 'RF MEMS开关',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '6GHz RF MEMS开关',
    functionalPerformance: 'DC-6GHz，插损<0.3dB，隔离>30dB',
    referencePrice: 280.00,
    parameters: {
      voltage: '0-80V',
      current: '1μA',
      power: '80μW',
      frequency: 'DC-6GHz',
      sensitivity: '无',
      range: '80V',
      accuracy: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MS006',
    partNumber: 'BIO-MEMS-Glucose',
    manufacturer: '奥普拓',
    primaryCategory: '生物MEMS',
    secondaryCategory: '葡萄糖传感器',
    package: '芯片级封装',
    qualityLevel: '医用级',
    lifecycle: '生产中',
    standards: ['ISO-13485', 'FDA-510K'],
    description: 'MEMS葡萄糖生物传感器',
    functionalPerformance: '0.5-30mmol/L检测范围，电化学检测',
    referencePrice: 45.00,
    parameters: {
      voltage: '3.0V',
      current: '10μA',
      power: '30μW',
      frequency: '1Hz',
      sensitivity: '20nA/(mmol/L)',
      range: '0.5-30mmol/L',
      accuracy: '±5%',
      temperature: '20°C~+40°C'
    }
  },
  {
    id: 'MS007',
    partNumber: 'OPTICAL-MEMS-DMD',
    manufacturer: '奥普光电',
    primaryCategory: '光学MEMS',
    secondaryCategory: '数字微镜器件',
    package: 'BGA封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62471'],
    description: '1024×768数字微镜阵列',
    functionalPerformance: '1024×768分辨率，20μs切换时间',
    referencePrice: 1200.00,
    parameters: {
      voltage: '12V',
      current: '500mA',
      power: '6W',
      frequency: '50kHz',
      sensitivity: '无',
      range: '±12°',
      accuracy: '±0.1°',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'MS008',
    partNumber: 'FLOW-MEMS-Thermal',
    manufacturer: '奥松电子',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '热式流量传感器',
    package: 'TO-39',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS热式气体流量传感器',
    functionalPerformance: '0-200SLPM，热式检测原理',
    referencePrice: 85.00,
    parameters: {
      voltage: '5V',
      current: '20mA',
      power: '100mW',
      frequency: '10Hz',
      sensitivity: '50mV/(m/s)',
      range: '0-200SLPM',
      accuracy: '±3%',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'MS009',
    partNumber: 'MEMS-OSC-100MHz',
    manufacturer: '泰晶科技',
    primaryCategory: 'MEMS振荡器',
    secondaryCategory: 'MEMS时钟发生器',
    package: 'SMD-3.2×2.5',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '100MHz MEMS振荡器',
    functionalPerformance: '100MHz±25ppm，LVDS输出',
    referencePrice: 6.50,
    parameters: {
      voltage: '3.3V',
      current: '45mA',
      power: '148.5mW',
      frequency: '100MHz',
      sensitivity: '无',
      range: '±25ppm',
      accuracy: '±25ppm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS010',
    partNumber: 'MEMS-MIRROR-2Axis',
    manufacturer: '中科院光电院',
    primaryCategory: '光学MEMS',
    secondaryCategory: '二维扫描镜',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '二维MEMS扫描微镜',
    functionalPerformance: '±15°扫描角，1kHz扫描频率',
    referencePrice: 2800.00,
    parameters: {
      voltage: '±150V',
      current: '1mA',
      power: '300mW',
      frequency: '1kHz',
      sensitivity: '0.1°/V',
      range: '±15°',
      accuracy: '±0.1°',
      temperature: '-40°C~+70°C'
    }
  }
];

const MicrosystemsSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [filteredData, setFilteredData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrosystemComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrosystemsData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrosystemsData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrosystemComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrosystemComponent, b: MicrosystemComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '医用级': 'magenta',
          '消费级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrosystemComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            微系统
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Microsystems - MEMS传感器、RF MEMS、生物MEMS、光学MEMS等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="敏芯股份">敏芯股份</Option>
                  <Option value="瑞声科技">瑞声科技</Option>
                  <Option value="森思泰克">森思泰克</Option>
                  <Option value="歌尔股份">歌尔股份</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="奥普拓">奥普拓</Option>
                  <Option value="奥普光电">奥普光电</Option>
                  <Option value="奥松电子">奥松电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="中科院光电院">中科院光电院</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="MEMS传感器">MEMS传感器</Option>
                  <Option value="RF MEMS">RF MEMS</Option>
                  <Option value="生物MEMS">生物MEMS</Option>
                  <Option value="光学MEMS">光学MEMS</Option>
                  <Option value="MEMS振荡器">MEMS振荡器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="医用级">医用级</Option>
                  <Option value="消费级">消费级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功耗">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="灵敏度">{selectedComponent.parameters.sensitivity}</Descriptions.Item>
            <Descriptions.Item label="测量范围">{selectedComponent.parameters.range}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrosystemsSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 固态微波器件数据类型定义
interface MicrowaveComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    frequency?: string;
    power?: string;
    gain?: string;
    noiseLevel?: string;
    vswr?: string;
    insertion?: string;
    isolation?: string;
    temperature?: string;
  };
}

// 固态微波器件测试数据
const mockMicrowaveData: MicrowaveComponent[] = [
  {
    id: 'MW001',
    partNumber: 'HMC-ALH382',
    manufacturer: '海特高新',
    primaryCategory: '功率放大器',
    secondaryCategory: 'GaN功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'Ku波段GaN功率放大器，高效率',
    functionalPerformance: '14-18GHz，输出功率10W，效率>45%',
    referencePrice: 2800.00,
    parameters: {
      frequency: '14-18GHz',
      power: '10W',
      gain: '35dB',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW002',
    partNumber: 'LNA-X2015',
    manufacturer: '中电科13所',
    primaryCategory: '低噪声放大器',
    secondaryCategory: 'X波段LNA',
    package: 'SMT-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'X波段低噪声放大器，超低噪声',
    functionalPerformance: '8-12GHz，噪声系数<1.2dB',
    referencePrice: 1500.00,
    parameters: {
      frequency: '8-12GHz',
      power: '20dBm',
      gain: '28dB',
      noiseLevel: '<1.2dB',
      vswr: '<1.8:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW003',
    partNumber: 'MIX-KU301',
    manufacturer: '中科微至',
    primaryCategory: '混频器',
    secondaryCategory: '上变频器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'Ku波段上变频器，低变频损耗',
    functionalPerformance: 'RF:12-18GHz，LO:10-16GHz',
    referencePrice: 980.00,
    parameters: {
      frequency: '12-18GHz',
      power: '15dBm',
      gain: '8dB',
      noiseLevel: '无',
      vswr: '<2.2:1',
      insertion: '<8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW004',
    partNumber: 'OSC-C1000',
    manufacturer: '航天772所',
    primaryCategory: '振荡器',
    secondaryCategory: '压控振荡器',
    package: 'SMT-6',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'C波段压控振荡器，低相噪',
    functionalPerformance: '4-8GHz，相噪<-110dBc/Hz@10kHz',
    referencePrice: 3200.00,
    parameters: {
      frequency: '4-8GHz',
      power: '10dBm',
      gain: '无',
      noiseLevel: '<-110dBc/Hz',
      vswr: '<1.5:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW005',
    partNumber: 'SW-SPDT24',
    manufacturer: '中电科29所',
    primaryCategory: '开关',
    secondaryCategory: 'SPDT开关',
    package: 'QFN-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '单刀双掷微波开关，快速切换',
    functionalPerformance: 'DC-24GHz，切换时间<50ns',
    referencePrice: 680.00,
    parameters: {
      frequency: 'DC-24GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<1.5dB',
      isolation: '>60dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW006',
    partNumber: 'ATT-K015',
    manufacturer: '中电科55所',
    primaryCategory: '衰减器',
    secondaryCategory: '数字衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'K波段数字衰减器，6位控制',
    functionalPerformance: '18-26GHz，衰减范围0-31.5dB',
    referencePrice: 1200.00,
    parameters: {
      frequency: '18-26GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '<3dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW007',
    partNumber: 'DET-S2000',
    manufacturer: '安徽博微',
    primaryCategory: '检波器',
    secondaryCategory: '对数检波器',
    package: 'SMT-10',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'S波段对数检波器，宽动态范围',
    functionalPerformance: '2-4GHz，动态范围>60dB',
    referencePrice: 850.00,
    parameters: {
      frequency: '2-4GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW008',
    partNumber: 'DIV-X204',
    manufacturer: '中电科38所',
    primaryCategory: '功分器',
    secondaryCategory: '四路功分器',
    package: 'SMT-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'X波段四路功分器，低插损',
    functionalPerformance: '8-12GHz，插损<1.5dB',
    referencePrice: 420.00,
    parameters: {
      frequency: '8-12GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.6:1',
      insertion: '<1.5dB',
      isolation: '>18dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW009',
    partNumber: 'CIR-KA180',
    manufacturer: '中电科14所',
    primaryCategory: '环行器',
    secondaryCategory: '三端口环行器',
    package: '金属封装',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'Ka波段环行器，高隔离度',
    functionalPerformance: '26-40GHz，隔离度>20dB',
    referencePrice: 1800.00,
    parameters: {
      frequency: '26-40GHz',
      power: '10W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.5:1',
      insertion: '<0.8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW010',
    partNumber: 'FIL-L1500',
    manufacturer: '成都亚光',
    primaryCategory: '滤波器',
    secondaryCategory: '带通滤波器',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'L波段带通滤波器，陡峭截止',
    functionalPerformance: '1-2GHz，带外抑制>60dB',
    referencePrice: 650.00,
    parameters: {
      frequency: '1-2GHz',
      power: '50W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<2dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  }
];

const MicrowaveSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [filteredData, setFilteredData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrowaveComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrowaveData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.frequency) {
        filtered = filtered.filter(item => 
          item.parameters.frequency?.includes(values.frequency)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrowaveData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrowaveComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '频率范围',
      dataIndex: ['parameters', 'frequency'],
      key: 'frequency',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrowaveComponent, b: MicrowaveComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrowaveComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            固态微波器件与电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Solid-State Microwave Devices & Circuits - 放大器、混频器、振荡器、开关等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海特高新">海特高新</Option>
                  <Option value="中电科13所">中电科13所</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="航天772所">航天772所</Option>
                  <Option value="中电科29所">中电科29所</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="安徽博微">安徽博微</Option>
                  <Option value="中电科38所">中电科38所</Option>
                  <Option value="中电科14所">中电科14所</Option>
                  <Option value="成都亚光">成都亚光</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="检波器">检波器</Option>
                  <Option value="功分器">功分器</Option>
                  <Option value="环行器">环行器</Option>
                  <Option value="滤波器">滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="频率范围" name="frequency">
                <Select placeholder="选择频率范围" allowClear>
                  <Option value="L">L波段(1-2GHz)</Option>
                  <Option value="S">S波段(2-4GHz)</Option>
                  <Option value="C">C波段(4-8GHz)</Option>
                  <Option value="X">X波段(8-12GHz)</Option>
                  <Option value="Ku">Ku波段(12-18GHz)</Option>
                  <Option value="K">K波段(18-26GHz)</Option>
                  <Option value="Ka">Ka波段(26-40GHz)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="频率范围">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="噪声系数">{selectedComponent.parameters.noiseLevel}</Descriptions.Item>
            <Descriptions.Item label="驻波比">{selectedComponent.parameters.vswr}</Descriptions.Item>
            <Descriptions.Item label="插入损耗">{selectedComponent.parameters.insertion}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrowaveSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 固态微波器件数据类型定义
interface MicrowaveComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    frequency?: string;
    power?: string;
    gain?: string;
    noiseLevel?: string;
    vswr?: string;
    insertion?: string;
    isolation?: string;
    temperature?: string;
  };
}

// 固态微波器件测试数据
const mockMicrowaveData: MicrowaveComponent[] = [
  {
    id: 'MW001',
    partNumber: 'HMC-ALH382',
    manufacturer: '海特高新',
    primaryCategory: '功率放大器',
    secondaryCategory: 'GaN功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'Ku波段GaN功率放大器，高效率',
    functionalPerformance: '14-18GHz，输出功率10W，效率>45%',
    referencePrice: 2800.00,
    parameters: {
      frequency: '14-18GHz',
      power: '10W',
      gain: '35dB',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW002',
    partNumber: 'LNA-X2015',
    manufacturer: '中电科13所',
    primaryCategory: '低噪声放大器',
    secondaryCategory: 'X波段LNA',
    package: 'SMT-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'X波段低噪声放大器，超低噪声',
    functionalPerformance: '8-12GHz，噪声系数<1.2dB',
    referencePrice: 1500.00,
    parameters: {
      frequency: '8-12GHz',
      power: '20dBm',
      gain: '28dB',
      noiseLevel: '<1.2dB',
      vswr: '<1.8:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW003',
    partNumber: 'MIX-KU301',
    manufacturer: '中科微至',
    primaryCategory: '混频器',
    secondaryCategory: '上变频器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'Ku波段上变频器，低变频损耗',
    functionalPerformance: 'RF:12-18GHz，LO:10-16GHz',
    referencePrice: 980.00,
    parameters: {
      frequency: '12-18GHz',
      power: '15dBm',
      gain: '8dB',
      noiseLevel: '无',
      vswr: '<2.2:1',
      insertion: '<8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW004',
    partNumber: 'OSC-C1000',
    manufacturer: '航天772所',
    primaryCategory: '振荡器',
    secondaryCategory: '压控振荡器',
    package: 'SMT-6',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'C波段压控振荡器，低相噪',
    functionalPerformance: '4-8GHz，相噪<-110dBc/Hz@10kHz',
    referencePrice: 3200.00,
    parameters: {
      frequency: '4-8GHz',
      power: '10dBm',
      gain: '无',
      noiseLevel: '<-110dBc/Hz',
      vswr: '<1.5:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW005',
    partNumber: 'SW-SPDT24',
    manufacturer: '中电科29所',
    primaryCategory: '开关',
    secondaryCategory: 'SPDT开关',
    package: 'QFN-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '单刀双掷微波开关，快速切换',
    functionalPerformance: 'DC-24GHz，切换时间<50ns',
    referencePrice: 680.00,
    parameters: {
      frequency: 'DC-24GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<1.5dB',
      isolation: '>60dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW006',
    partNumber: 'ATT-K015',
    manufacturer: '中电科55所',
    primaryCategory: '衰减器',
    secondaryCategory: '数字衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'K波段数字衰减器，6位控制',
    functionalPerformance: '18-26GHz，衰减范围0-31.5dB',
    referencePrice: 1200.00,
    parameters: {
      frequency: '18-26GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '<3dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW007',
    partNumber: 'DET-S2000',
    manufacturer: '安徽博微',
    primaryCategory: '检波器',
    secondaryCategory: '对数检波器',
    package: 'SMT-10',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'S波段对数检波器，宽动态范围',
    functionalPerformance: '2-4GHz，动态范围>60dB',
    referencePrice: 850.00,
    parameters: {
      frequency: '2-4GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW008',
    partNumber: 'DIV-X204',
    manufacturer: '中电科38所',
    primaryCategory: '功分器',
    secondaryCategory: '四路功分器',
    package: 'SMT-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'X波段四路功分器，低插损',
    functionalPerformance: '8-12GHz，插损<1.5dB',
    referencePrice: 420.00,
    parameters: {
      frequency: '8-12GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.6:1',
      insertion: '<1.5dB',
      isolation: '>18dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW009',
    partNumber: 'CIR-KA180',
    manufacturer: '中电科14所',
    primaryCategory: '环行器',
    secondaryCategory: '三端口环行器',
    package: '金属封装',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'Ka波段环行器，高隔离度',
    functionalPerformance: '26-40GHz，隔离度>20dB',
    referencePrice: 1800.00,
    parameters: {
      frequency: '26-40GHz',
      power: '10W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.5:1',
      insertion: '<0.8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW010',
    partNumber: 'FIL-L1500',
    manufacturer: '成都亚光',
    primaryCategory: '滤波器',
    secondaryCategory: '带通滤波器',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'L波段带通滤波器，陡峭截止',
    functionalPerformance: '1-2GHz，带外抑制>60dB',
    referencePrice: 650.00,
    parameters: {
      frequency: '1-2GHz',
      power: '50W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<2dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  }
];

const MicrowaveSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [filteredData, setFilteredData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrowaveComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrowaveData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.frequency) {
        filtered = filtered.filter(item => 
          item.parameters.frequency?.includes(values.frequency)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrowaveData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrowaveComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '频率范围',
      dataIndex: ['parameters', 'frequency'],
      key: 'frequency',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrowaveComponent, b: MicrowaveComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrowaveComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            固态微波器件与电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Solid-State Microwave Devices & Circuits - 放大器、混频器、振荡器、开关等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海特高新">海特高新</Option>
                  <Option value="中电科13所">中电科13所</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="航天772所">航天772所</Option>
                  <Option value="中电科29所">中电科29所</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="安徽博微">安徽博微</Option>
                  <Option value="中电科38所">中电科38所</Option>
                  <Option value="中电科14所">中电科14所</Option>
                  <Option value="成都亚光">成都亚光</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="检波器">检波器</Option>
                  <Option value="功分器">功分器</Option>
                  <Option value="环行器">环行器</Option>
                  <Option value="滤波器">滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="频率范围" name="frequency">
                <Select placeholder="选择频率范围" allowClear>
                  <Option value="L">L波段(1-2GHz)</Option>
                  <Option value="S">S波段(2-4GHz)</Option>
                  <Option value="C">C波段(4-8GHz)</Option>
                  <Option value="X">X波段(8-12GHz)</Option>
                  <Option value="Ku">Ku波段(12-18GHz)</Option>
                  <Option value="K">K波段(18-26GHz)</Option>
                  <Option value="Ka">Ka波段(26-40GHz)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="频率范围">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="噪声系数">{selectedComponent.parameters.noiseLevel}</Descriptions.Item>
            <Descriptions.Item label="驻波比">{selectedComponent.parameters.vswr}</Descriptions.Item>
            <Descriptions.Item label="插入损耗">{selectedComponent.parameters.insertion}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrowaveSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 固态微波器件数据类型定义
interface MicrowaveComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    frequency?: string;
    power?: string;
    gain?: string;
    noiseLevel?: string;
    vswr?: string;
    insertion?: string;
    isolation?: string;
    temperature?: string;
  };
}

// 固态微波器件测试数据
const mockMicrowaveData: MicrowaveComponent[] = [
  {
    id: 'MW001',
    partNumber: 'HMC-ALH382',
    manufacturer: '海特高新',
    primaryCategory: '功率放大器',
    secondaryCategory: 'GaN功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'Ku波段GaN功率放大器，高效率',
    functionalPerformance: '14-18GHz，输出功率10W，效率>45%',
    referencePrice: 2800.00,
    parameters: {
      frequency: '14-18GHz',
      power: '10W',
      gain: '35dB',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW002',
    partNumber: 'LNA-X2015',
    manufacturer: '中电科13所',
    primaryCategory: '低噪声放大器',
    secondaryCategory: 'X波段LNA',
    package: 'SMT-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'X波段低噪声放大器，超低噪声',
    functionalPerformance: '8-12GHz，噪声系数<1.2dB',
    referencePrice: 1500.00,
    parameters: {
      frequency: '8-12GHz',
      power: '20dBm',
      gain: '28dB',
      noiseLevel: '<1.2dB',
      vswr: '<1.8:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW003',
    partNumber: 'MIX-KU301',
    manufacturer: '中科微至',
    primaryCategory: '混频器',
    secondaryCategory: '上变频器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'Ku波段上变频器，低变频损耗',
    functionalPerformance: 'RF:12-18GHz，LO:10-16GHz',
    referencePrice: 980.00,
    parameters: {
      frequency: '12-18GHz',
      power: '15dBm',
      gain: '8dB',
      noiseLevel: '无',
      vswr: '<2.2:1',
      insertion: '<8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW004',
    partNumber: 'OSC-C1000',
    manufacturer: '航天772所',
    primaryCategory: '振荡器',
    secondaryCategory: '压控振荡器',
    package: 'SMT-6',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'C波段压控振荡器，低相噪',
    functionalPerformance: '4-8GHz，相噪<-110dBc/Hz@10kHz',
    referencePrice: 3200.00,
    parameters: {
      frequency: '4-8GHz',
      power: '10dBm',
      gain: '无',
      noiseLevel: '<-110dBc/Hz',
      vswr: '<1.5:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW005',
    partNumber: 'SW-SPDT24',
    manufacturer: '中电科29所',
    primaryCategory: '开关',
    secondaryCategory: 'SPDT开关',
    package: 'QFN-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '单刀双掷微波开关，快速切换',
    functionalPerformance: 'DC-24GHz，切换时间<50ns',
    referencePrice: 680.00,
    parameters: {
      frequency: 'DC-24GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<1.5dB',
      isolation: '>60dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW006',
    partNumber: 'ATT-K015',
    manufacturer: '中电科55所',
    primaryCategory: '衰减器',
    secondaryCategory: '数字衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'K波段数字衰减器，6位控制',
    functionalPerformance: '18-26GHz，衰减范围0-31.5dB',
    referencePrice: 1200.00,
    parameters: {
      frequency: '18-26GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '<3dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW007',
    partNumber: 'DET-S2000',
    manufacturer: '安徽博微',
    primaryCategory: '检波器',
    secondaryCategory: '对数检波器',
    package: 'SMT-10',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'S波段对数检波器，宽动态范围',
    functionalPerformance: '2-4GHz，动态范围>60dB',
    referencePrice: 850.00,
    parameters: {
      frequency: '2-4GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW008',
    partNumber: 'DIV-X204',
    manufacturer: '中电科38所',
    primaryCategory: '功分器',
    secondaryCategory: '四路功分器',
    package: 'SMT-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'X波段四路功分器，低插损',
    functionalPerformance: '8-12GHz，插损<1.5dB',
    referencePrice: 420.00,
    parameters: {
      frequency: '8-12GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.6:1',
      insertion: '<1.5dB',
      isolation: '>18dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW009',
    partNumber: 'CIR-KA180',
    manufacturer: '中电科14所',
    primaryCategory: '环行器',
    secondaryCategory: '三端口环行器',
    package: '金属封装',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'Ka波段环行器，高隔离度',
    functionalPerformance: '26-40GHz，隔离度>20dB',
    referencePrice: 1800.00,
    parameters: {
      frequency: '26-40GHz',
      power: '10W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.5:1',
      insertion: '<0.8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW010',
    partNumber: 'FIL-L1500',
    manufacturer: '成都亚光',
    primaryCategory: '滤波器',
    secondaryCategory: '带通滤波器',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'L波段带通滤波器，陡峭截止',
    functionalPerformance: '1-2GHz，带外抑制>60dB',
    referencePrice: 650.00,
    parameters: {
      frequency: '1-2GHz',
      power: '50W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<2dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  }
];

const MicrowaveSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [filteredData, setFilteredData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrowaveComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrowaveData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.frequency) {
        filtered = filtered.filter(item => 
          item.parameters.frequency?.includes(values.frequency)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrowaveData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrowaveComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '频率范围',
      dataIndex: ['parameters', 'frequency'],
      key: 'frequency',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrowaveComponent, b: MicrowaveComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrowaveComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            固态微波器件与电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Solid-State Microwave Devices & Circuits - 放大器、混频器、振荡器、开关等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海特高新">海特高新</Option>
                  <Option value="中电科13所">中电科13所</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="航天772所">航天772所</Option>
                  <Option value="中电科29所">中电科29所</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="安徽博微">安徽博微</Option>
                  <Option value="中电科38所">中电科38所</Option>
                  <Option value="中电科14所">中电科14所</Option>
                  <Option value="成都亚光">成都亚光</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="检波器">检波器</Option>
                  <Option value="功分器">功分器</Option>
                  <Option value="环行器">环行器</Option>
                  <Option value="滤波器">滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="频率范围" name="frequency">
                <Select placeholder="选择频率范围" allowClear>
                  <Option value="L">L波段(1-2GHz)</Option>
                  <Option value="S">S波段(2-4GHz)</Option>
                  <Option value="C">C波段(4-8GHz)</Option>
                  <Option value="X">X波段(8-12GHz)</Option>
                  <Option value="Ku">Ku波段(12-18GHz)</Option>
                  <Option value="K">K波段(18-26GHz)</Option>
                  <Option value="Ka">Ka波段(26-40GHz)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="频率范围">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="噪声系数">{selectedComponent.parameters.noiseLevel}</Descriptions.Item>
            <Descriptions.Item label="驻波比">{selectedComponent.parameters.vswr}</Descriptions.Item>
            <Descriptions.Item label="插入损耗">{selectedComponent.parameters.insertion}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrowaveSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 光电子器件数据类型定义
interface OptoelectronicComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    wavelength?: string;
    power?: string;
    current?: string;
    voltage?: string;
    efficiency?: string;
    response?: string;
    bandwidth?: string;
    temperature?: string;
  };
}

// 光电子器件测试数据
const mockOptoData: OptoelectronicComponent[] = [
  {
    id: 'OE001',
    partNumber: 'LD-1550-100',
    manufacturer: '光迅科技',
    primaryCategory: '激光器',
    secondaryCategory: 'DFB激光器',
    package: 'TO-56',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.692', 'Telcordia GR-468'],
    description: '1550nm DFB激光器，单模光纤通信',
    functionalPerformance: '1550nm，输出功率100mW，边模抑制比>40dB',
    referencePrice: 850.00,
    parameters: {
      wavelength: '1550nm',
      power: '100mW',
      current: '150mA',
      voltage: '1.8V',
      efficiency: '35%',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE002',
    partNumber: 'PD-InGaAs-10G',
    manufacturer: '海光芯创',
    primaryCategory: '光电探测器',
    secondaryCategory: 'InGaAs光电二极管',
    package: 'TO-46',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.957'],
    description: 'InGaAs PIN光电二极管，高速响应',
    functionalPerformance: '800-1700nm，响应度0.9A/W@1550nm',
    referencePrice: 320.00,
    parameters: {
      wavelength: '800-1700nm',
      power: '10mW',
      current: '10μA',
      voltage: '5V',
      efficiency: '90%',
      response: '10GHz',
      bandwidth: '900nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE003',
    partNumber: 'LED-850-SM',
    manufacturer: '三安光电',
    primaryCategory: '发光二极管',
    secondaryCategory: '850nm LED',
    package: 'TO-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '850nm LED，多模光纤通信',
    functionalPerformance: '850nm，输出功率-3dBm，数值孔径0.2',
    referencePrice: 45.00,
    parameters: {
      wavelength: '850nm',
      power: '1mW',
      current: '100mA',
      voltage: '1.8V',
      efficiency: '15%',
      response: '100MHz',
      bandwidth: '50nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE004',
    partNumber: 'VCSEL-940-Array',
    manufacturer: '纵慧芯光',
    primaryCategory: '垂直腔面发射激光器',
    secondaryCategory: '940nm VCSEL阵列',
    package: 'TO-39',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q102'],
    description: '940nm VCSEL阵列，激光雷达应用',
    functionalPerformance: '940nm，16×16阵列，总功率40W',
    referencePrice: 1200.00,
    parameters: {
      wavelength: '940nm',
      power: '40W',
      current: '20A',
      voltage: '32V',
      efficiency: '45%',
      response: '1GHz',
      bandwidth: '2nm',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'OE005',
    partNumber: 'APD-Si-100M',
    manufacturer: '奥普拓激光',
    primaryCategory: '雪崩光电二极管',
    secondaryCategory: '硅APD',
    package: 'TO-5',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '硅雪崩光电二极管，高灵敏度',
    functionalPerformance: '400-1000nm，增益100，暗电流<1nA',
    referencePrice: 680.00,
    parameters: {
      wavelength: '400-1000nm',
      power: '1μW',
      current: '1nA',
      voltage: '150V',
      efficiency: '80%',
      response: '100MHz',
      bandwidth: '600nm',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'OE006',
    partNumber: 'SOA-1550-30',
    manufacturer: '华为海思',
    primaryCategory: '光放大器',
    secondaryCategory: '半导体光放大器',
    package: '蝶形封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.662'],
    description: '1550nm半导体光放大器',
    functionalPerformance: '1530-1570nm，增益30dB，噪声系数<6dB',
    referencePrice: 2800.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '20dBm',
      current: '400mA',
      voltage: '2.5V',
      efficiency: '25%',
      response: '40GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE007',
    partNumber: 'MOD-LN-10G',
    manufacturer: '青岛海信',
    primaryCategory: '光调制器',
    secondaryCategory: '铌酸锂调制器',
    package: '金属封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.959.1'],
    description: '10Gbps铌酸锂马赫曾德尔调制器',
    functionalPerformance: '1550nm，消光比>20dB，插损<4dB',
    referencePrice: 5600.00,
    parameters: {
      wavelength: '1550nm',
      power: '20dBm',
      current: '无',
      voltage: '6V',
      efficiency: '无',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE008',
    partNumber: 'WDM-CWDM-8CH',
    manufacturer: '亿源通',
    primaryCategory: '波分复用器',
    secondaryCategory: 'CWDM复用器',
    package: 'ABS封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.694.2'],
    description: '8通道CWDM波分复用器',
    functionalPerformance: '1470-1610nm，插损<0.8dB，隔离度>30dB',
    referencePrice: 380.00,
    parameters: {
      wavelength: '1470-1610nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '140nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE009',
    partNumber: 'ISO-1550-30',
    manufacturer: '凯普林光电',
    primaryCategory: '光隔离器',
    secondaryCategory: '1550nm光隔离器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-910'],
    description: '1550nm光隔离器，高隔离度',
    functionalPerformance: '1550nm，隔离度>30dB，插损<0.8dB',
    referencePrice: 120.00,
    parameters: {
      wavelength: '1550nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE010',
    partNumber: 'CIR-1550-3P',
    manufacturer: '欧普特',
    primaryCategory: '光环形器',
    secondaryCategory: '三端口光环形器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-1221'],
    description: '1550nm三端口光环形器',
    functionalPerformance: '1530-1570nm，隔离度>40dB，插损<0.8dB',
    referencePrice: 280.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '300mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  }
];

const OptoelectronicSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [filteredData, setFilteredData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<OptoelectronicComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockOptoData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.wavelength) {
        filtered = filtered.filter(item => 
          item.parameters.wavelength?.includes(values.wavelength)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockOptoData);
  };

  // 查看详情
  const handleViewDetail = (record: OptoelectronicComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 130,
      render: (text: string) => <Tag color="red">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="pink">{text}</Tag>,
    },
    {
      title: '波长',
      dataIndex: ['parameters', 'wavelength'],
      key: 'wavelength',
      width: 120,
      render: (text: string) => <Tag color="lime">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: OptoelectronicComponent, b: OptoelectronicComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: OptoelectronicComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #ff4d4f 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            光电子器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Optoelectronic Devices - 激光器、LED、光电探测器、光调制器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="光迅科技">光迅科技</Option>
                  <Option value="海光芯创">海光芯创</Option>
                  <Option value="三安光电">三安光电</Option>
                  <Option value="纵慧芯光">纵慧芯光</Option>
                  <Option value="奥普拓激光">奥普拓激光</Option>
                  <Option value="华为海思">华为海思</Option>
                  <Option value="青岛海信">青岛海信</Option>
                  <Option value="亿源通">亿源通</Option>
                  <Option value="凯普林光电">凯普林光电</Option>
                  <Option value="欧普特">欧普特</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="激光器">激光器</Option>
                  <Option value="光电探测器">光电探测器</Option>
                  <Option value="发光二极管">发光二极管</Option>
                  <Option value="垂直腔面发射激光器">垂直腔面发射激光器</Option>
                  <Option value="雪崩光电二极管">雪崩光电二极管</Option>
                  <Option value="光放大器">光放大器</Option>
                  <Option value="光调制器">光调制器</Option>
                  <Option value="波分复用器">波分复用器</Option>
                  <Option value="光隔离器">光隔离器</Option>
                  <Option value="光环形器">光环形器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="波长范围" name="wavelength">
                <Select placeholder="选择波长范围" allowClear>
                  <Option value="850">850nm</Option>
                  <Option value="940">940nm</Option>
                  <Option value="1310">1310nm</Option>
                  <Option value="1550">1550nm</Option>
                  <Option value="可见光">可见光(400-700nm)</Option>
                  <Option value="近红外">近红外(700-1700nm)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作波长">{selectedComponent.parameters.wavelength}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="响应速度">{selectedComponent.parameters.response}</Descriptions.Item>
            <Descriptions.Item label="光谱带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default OptoelectronicSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 光电子器件数据类型定义
interface OptoelectronicComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    wavelength?: string;
    power?: string;
    current?: string;
    voltage?: string;
    efficiency?: string;
    response?: string;
    bandwidth?: string;
    temperature?: string;
  };
}

// 光电子器件测试数据
const mockOptoData: OptoelectronicComponent[] = [
  {
    id: 'OE001',
    partNumber: 'LD-1550-100',
    manufacturer: '光迅科技',
    primaryCategory: '激光器',
    secondaryCategory: 'DFB激光器',
    package: 'TO-56',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.692', 'Telcordia GR-468'],
    description: '1550nm DFB激光器，单模光纤通信',
    functionalPerformance: '1550nm，输出功率100mW，边模抑制比>40dB',
    referencePrice: 850.00,
    parameters: {
      wavelength: '1550nm',
      power: '100mW',
      current: '150mA',
      voltage: '1.8V',
      efficiency: '35%',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE002',
    partNumber: 'PD-InGaAs-10G',
    manufacturer: '海光芯创',
    primaryCategory: '光电探测器',
    secondaryCategory: 'InGaAs光电二极管',
    package: 'TO-46',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.957'],
    description: 'InGaAs PIN光电二极管，高速响应',
    functionalPerformance: '800-1700nm，响应度0.9A/W@1550nm',
    referencePrice: 320.00,
    parameters: {
      wavelength: '800-1700nm',
      power: '10mW',
      current: '10μA',
      voltage: '5V',
      efficiency: '90%',
      response: '10GHz',
      bandwidth: '900nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE003',
    partNumber: 'LED-850-SM',
    manufacturer: '三安光电',
    primaryCategory: '发光二极管',
    secondaryCategory: '850nm LED',
    package: 'TO-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '850nm LED，多模光纤通信',
    functionalPerformance: '850nm，输出功率-3dBm，数值孔径0.2',
    referencePrice: 45.00,
    parameters: {
      wavelength: '850nm',
      power: '1mW',
      current: '100mA',
      voltage: '1.8V',
      efficiency: '15%',
      response: '100MHz',
      bandwidth: '50nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE004',
    partNumber: 'VCSEL-940-Array',
    manufacturer: '纵慧芯光',
    primaryCategory: '垂直腔面发射激光器',
    secondaryCategory: '940nm VCSEL阵列',
    package: 'TO-39',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q102'],
    description: '940nm VCSEL阵列，激光雷达应用',
    functionalPerformance: '940nm，16×16阵列，总功率40W',
    referencePrice: 1200.00,
    parameters: {
      wavelength: '940nm',
      power: '40W',
      current: '20A',
      voltage: '32V',
      efficiency: '45%',
      response: '1GHz',
      bandwidth: '2nm',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'OE005',
    partNumber: 'APD-Si-100M',
    manufacturer: '奥普拓激光',
    primaryCategory: '雪崩光电二极管',
    secondaryCategory: '硅APD',
    package: 'TO-5',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '硅雪崩光电二极管，高灵敏度',
    functionalPerformance: '400-1000nm，增益100，暗电流<1nA',
    referencePrice: 680.00,
    parameters: {
      wavelength: '400-1000nm',
      power: '1μW',
      current: '1nA',
      voltage: '150V',
      efficiency: '80%',
      response: '100MHz',
      bandwidth: '600nm',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'OE006',
    partNumber: 'SOA-1550-30',
    manufacturer: '华为海思',
    primaryCategory: '光放大器',
    secondaryCategory: '半导体光放大器',
    package: '蝶形封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.662'],
    description: '1550nm半导体光放大器',
    functionalPerformance: '1530-1570nm，增益30dB，噪声系数<6dB',
    referencePrice: 2800.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '20dBm',
      current: '400mA',
      voltage: '2.5V',
      efficiency: '25%',
      response: '40GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE007',
    partNumber: 'MOD-LN-10G',
    manufacturer: '青岛海信',
    primaryCategory: '光调制器',
    secondaryCategory: '铌酸锂调制器',
    package: '金属封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.959.1'],
    description: '10Gbps铌酸锂马赫曾德尔调制器',
    functionalPerformance: '1550nm，消光比>20dB，插损<4dB',
    referencePrice: 5600.00,
    parameters: {
      wavelength: '1550nm',
      power: '20dBm',
      current: '无',
      voltage: '6V',
      efficiency: '无',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE008',
    partNumber: 'WDM-CWDM-8CH',
    manufacturer: '亿源通',
    primaryCategory: '波分复用器',
    secondaryCategory: 'CWDM复用器',
    package: 'ABS封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.694.2'],
    description: '8通道CWDM波分复用器',
    functionalPerformance: '1470-1610nm，插损<0.8dB，隔离度>30dB',
    referencePrice: 380.00,
    parameters: {
      wavelength: '1470-1610nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '140nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE009',
    partNumber: 'ISO-1550-30',
    manufacturer: '凯普林光电',
    primaryCategory: '光隔离器',
    secondaryCategory: '1550nm光隔离器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-910'],
    description: '1550nm光隔离器，高隔离度',
    functionalPerformance: '1550nm，隔离度>30dB，插损<0.8dB',
    referencePrice: 120.00,
    parameters: {
      wavelength: '1550nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE010',
    partNumber: 'CIR-1550-3P',
    manufacturer: '欧普特',
    primaryCategory: '光环形器',
    secondaryCategory: '三端口光环形器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-1221'],
    description: '1550nm三端口光环形器',
    functionalPerformance: '1530-1570nm，隔离度>40dB，插损<0.8dB',
    referencePrice: 280.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '300mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  }
];

const OptoelectronicSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [filteredData, setFilteredData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<OptoelectronicComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockOptoData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.wavelength) {
        filtered = filtered.filter(item => 
          item.parameters.wavelength?.includes(values.wavelength)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockOptoData);
  };

  // 查看详情
  const handleViewDetail = (record: OptoelectronicComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 130,
      render: (text: string) => <Tag color="red">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="pink">{text}</Tag>,
    },
    {
      title: '波长',
      dataIndex: ['parameters', 'wavelength'],
      key: 'wavelength',
      width: 120,
      render: (text: string) => <Tag color="lime">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: OptoelectronicComponent, b: OptoelectronicComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: OptoelectronicComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #ff4d4f 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            光电子器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Optoelectronic Devices - 激光器、LED、光电探测器、光调制器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="光迅科技">光迅科技</Option>
                  <Option value="海光芯创">海光芯创</Option>
                  <Option value="三安光电">三安光电</Option>
                  <Option value="纵慧芯光">纵慧芯光</Option>
                  <Option value="奥普拓激光">奥普拓激光</Option>
                  <Option value="华为海思">华为海思</Option>
                  <Option value="青岛海信">青岛海信</Option>
                  <Option value="亿源通">亿源通</Option>
                  <Option value="凯普林光电">凯普林光电</Option>
                  <Option value="欧普特">欧普特</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="激光器">激光器</Option>
                  <Option value="光电探测器">光电探测器</Option>
                  <Option value="发光二极管">发光二极管</Option>
                  <Option value="垂直腔面发射激光器">垂直腔面发射激光器</Option>
                  <Option value="雪崩光电二极管">雪崩光电二极管</Option>
                  <Option value="光放大器">光放大器</Option>
                  <Option value="光调制器">光调制器</Option>
                  <Option value="波分复用器">波分复用器</Option>
                  <Option value="光隔离器">光隔离器</Option>
                  <Option value="光环形器">光环形器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="波长范围" name="wavelength">
                <Select placeholder="选择波长范围" allowClear>
                  <Option value="850">850nm</Option>
                  <Option value="940">940nm</Option>
                  <Option value="1310">1310nm</Option>
                  <Option value="1550">1550nm</Option>
                  <Option value="可见光">可见光(400-700nm)</Option>
                  <Option value="近红外">近红外(700-1700nm)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作波长">{selectedComponent.parameters.wavelength}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="响应速度">{selectedComponent.parameters.response}</Descriptions.Item>
            <Descriptions.Item label="光谱带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default OptoelectronicSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 光电子器件数据类型定义
interface OptoelectronicComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    wavelength?: string;
    power?: string;
    current?: string;
    voltage?: string;
    efficiency?: string;
    response?: string;
    bandwidth?: string;
    temperature?: string;
  };
}

// 光电子器件测试数据
const mockOptoData: OptoelectronicComponent[] = [
  {
    id: 'OE001',
    partNumber: 'LD-1550-100',
    manufacturer: '光迅科技',
    primaryCategory: '激光器',
    secondaryCategory: 'DFB激光器',
    package: 'TO-56',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.692', 'Telcordia GR-468'],
    description: '1550nm DFB激光器，单模光纤通信',
    functionalPerformance: '1550nm，输出功率100mW，边模抑制比>40dB',
    referencePrice: 850.00,
    parameters: {
      wavelength: '1550nm',
      power: '100mW',
      current: '150mA',
      voltage: '1.8V',
      efficiency: '35%',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE002',
    partNumber: 'PD-InGaAs-10G',
    manufacturer: '海光芯创',
    primaryCategory: '光电探测器',
    secondaryCategory: 'InGaAs光电二极管',
    package: 'TO-46',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.957'],
    description: 'InGaAs PIN光电二极管，高速响应',
    functionalPerformance: '800-1700nm，响应度0.9A/W@1550nm',
    referencePrice: 320.00,
    parameters: {
      wavelength: '800-1700nm',
      power: '10mW',
      current: '10μA',
      voltage: '5V',
      efficiency: '90%',
      response: '10GHz',
      bandwidth: '900nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE003',
    partNumber: 'LED-850-SM',
    manufacturer: '三安光电',
    primaryCategory: '发光二极管',
    secondaryCategory: '850nm LED',
    package: 'TO-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '850nm LED，多模光纤通信',
    functionalPerformance: '850nm，输出功率-3dBm，数值孔径0.2',
    referencePrice: 45.00,
    parameters: {
      wavelength: '850nm',
      power: '1mW',
      current: '100mA',
      voltage: '1.8V',
      efficiency: '15%',
      response: '100MHz',
      bandwidth: '50nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE004',
    partNumber: 'VCSEL-940-Array',
    manufacturer: '纵慧芯光',
    primaryCategory: '垂直腔面发射激光器',
    secondaryCategory: '940nm VCSEL阵列',
    package: 'TO-39',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q102'],
    description: '940nm VCSEL阵列，激光雷达应用',
    functionalPerformance: '940nm，16×16阵列，总功率40W',
    referencePrice: 1200.00,
    parameters: {
      wavelength: '940nm',
      power: '40W',
      current: '20A',
      voltage: '32V',
      efficiency: '45%',
      response: '1GHz',
      bandwidth: '2nm',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'OE005',
    partNumber: 'APD-Si-100M',
    manufacturer: '奥普拓激光',
    primaryCategory: '雪崩光电二极管',
    secondaryCategory: '硅APD',
    package: 'TO-5',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '硅雪崩光电二极管，高灵敏度',
    functionalPerformance: '400-1000nm，增益100，暗电流<1nA',
    referencePrice: 680.00,
    parameters: {
      wavelength: '400-1000nm',
      power: '1μW',
      current: '1nA',
      voltage: '150V',
      efficiency: '80%',
      response: '100MHz',
      bandwidth: '600nm',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'OE006',
    partNumber: 'SOA-1550-30',
    manufacturer: '华为海思',
    primaryCategory: '光放大器',
    secondaryCategory: '半导体光放大器',
    package: '蝶形封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.662'],
    description: '1550nm半导体光放大器',
    functionalPerformance: '1530-1570nm，增益30dB，噪声系数<6dB',
    referencePrice: 2800.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '20dBm',
      current: '400mA',
      voltage: '2.5V',
      efficiency: '25%',
      response: '40GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE007',
    partNumber: 'MOD-LN-10G',
    manufacturer: '青岛海信',
    primaryCategory: '光调制器',
    secondaryCategory: '铌酸锂调制器',
    package: '金属封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.959.1'],
    description: '10Gbps铌酸锂马赫曾德尔调制器',
    functionalPerformance: '1550nm，消光比>20dB，插损<4dB',
    referencePrice: 5600.00,
    parameters: {
      wavelength: '1550nm',
      power: '20dBm',
      current: '无',
      voltage: '6V',
      efficiency: '无',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE008',
    partNumber: 'WDM-CWDM-8CH',
    manufacturer: '亿源通',
    primaryCategory: '波分复用器',
    secondaryCategory: 'CWDM复用器',
    package: 'ABS封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.694.2'],
    description: '8通道CWDM波分复用器',
    functionalPerformance: '1470-1610nm，插损<0.8dB，隔离度>30dB',
    referencePrice: 380.00,
    parameters: {
      wavelength: '1470-1610nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '140nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE009',
    partNumber: 'ISO-1550-30',
    manufacturer: '凯普林光电',
    primaryCategory: '光隔离器',
    secondaryCategory: '1550nm光隔离器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-910'],
    description: '1550nm光隔离器，高隔离度',
    functionalPerformance: '1550nm，隔离度>30dB，插损<0.8dB',
    referencePrice: 120.00,
    parameters: {
      wavelength: '1550nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE010',
    partNumber: 'CIR-1550-3P',
    manufacturer: '欧普特',
    primaryCategory: '光环形器',
    secondaryCategory: '三端口光环形器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-1221'],
    description: '1550nm三端口光环形器',
    functionalPerformance: '1530-1570nm，隔离度>40dB，插损<0.8dB',
    referencePrice: 280.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '300mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  }
];

const OptoelectronicSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [filteredData, setFilteredData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<OptoelectronicComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockOptoData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.wavelength) {
        filtered = filtered.filter(item => 
          item.parameters.wavelength?.includes(values.wavelength)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockOptoData);
  };

  // 查看详情
  const handleViewDetail = (record: OptoelectronicComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 130,
      render: (text: string) => <Tag color="red">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="pink">{text}</Tag>,
    },
    {
      title: '波长',
      dataIndex: ['parameters', 'wavelength'],
      key: 'wavelength',
      width: 120,
      render: (text: string) => <Tag color="lime">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: OptoelectronicComponent, b: OptoelectronicComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: OptoelectronicComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #ff4d4f 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            光电子器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Optoelectronic Devices - 激光器、LED、光电探测器、光调制器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="光迅科技">光迅科技</Option>
                  <Option value="海光芯创">海光芯创</Option>
                  <Option value="三安光电">三安光电</Option>
                  <Option value="纵慧芯光">纵慧芯光</Option>
                  <Option value="奥普拓激光">奥普拓激光</Option>
                  <Option value="华为海思">华为海思</Option>
                  <Option value="青岛海信">青岛海信</Option>
                  <Option value="亿源通">亿源通</Option>
                  <Option value="凯普林光电">凯普林光电</Option>
                  <Option value="欧普特">欧普特</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="激光器">激光器</Option>
                  <Option value="光电探测器">光电探测器</Option>
                  <Option value="发光二极管">发光二极管</Option>
                  <Option value="垂直腔面发射激光器">垂直腔面发射激光器</Option>
                  <Option value="雪崩光电二极管">雪崩光电二极管</Option>
                  <Option value="光放大器">光放大器</Option>
                  <Option value="光调制器">光调制器</Option>
                  <Option value="波分复用器">波分复用器</Option>
                  <Option value="光隔离器">光隔离器</Option>
                  <Option value="光环形器">光环形器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="波长范围" name="wavelength">
                <Select placeholder="选择波长范围" allowClear>
                  <Option value="850">850nm</Option>
                  <Option value="940">940nm</Option>
                  <Option value="1310">1310nm</Option>
                  <Option value="1550">1550nm</Option>
                  <Option value="可见光">可见光(400-700nm)</Option>
                  <Option value="近红外">近红外(700-1700nm)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作波长">{selectedComponent.parameters.wavelength}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="响应速度">{selectedComponent.parameters.response}</Descriptions.Item>
            <Descriptions.Item label="光谱带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default OptoelectronicSearch;

```

---

**User**

好像还没改完

---

**Cursor**

检查剩余的 linter 错误：


检查 `GeneralSearch.tsx` 中 `data` 的使用情况：


`data` 变量未使用，代码直接使用 `mockGeneralData`。检查所有搜索组件并修复：


检查这些组件是否实际使用 `data`，还是直接使用 mock 数据：


这些组件直接使用 mock 数据，未使用 `data`。删除所有搜索组件中未使用的 `data` 变量：


```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 通用与特种元件数据类型定义
interface GeneralComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    capacitance?: string;
    voltage?: string;
    tolerance?: string;
    resistance?: string;
    power?: string;
    inductance?: string;
    frequency?: string;
    temperature?: string;
  };
}

// 通用与特种元件测试数据
const mockGeneralData: GeneralComponent[] = [
  {
    id: 'GC001',
    partNumber: 'CAP-100uF-25V',
    manufacturer: '风华高科',
    primaryCategory: '电容器',
    secondaryCategory: '铝电解电容',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60384', 'JIS-C5101'],
    description: '100μF/25V铝电解电容器',
    functionalPerformance: '低ESR，高纹波电流，长寿命',
    referencePrice: 0.35,
    parameters: {
      capacitance: '100μF',
      voltage: '25V',
      tolerance: '±20%',
      resistance: '无',
      power: '无',
      inductance: '无',
      frequency: '120Hz',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC002',
    partNumber: 'RES-1K-1/4W',
    manufacturer: '厚声电子',
    primaryCategory: '电阻器',
    secondaryCategory: '碳膜电阻',
    package: '轴向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60115', 'JIS-C5201'],
    description: '1kΩ/1/4W碳膜电阻器',
    functionalPerformance: '低噪声，稳定性好，成本低',
    referencePrice: 0.02,
    parameters: {
      capacitance: '无',
      voltage: '250V',
      tolerance: '±5%',
      resistance: '1kΩ',
      power: '1/4W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+155°C'
    }
  },
  {
    id: 'GC003',
    partNumber: 'IND-10uH-1A',
    manufacturer: '顺络电子',
    primaryCategory: '电感器',
    secondaryCategory: '功率电感',
    package: 'SMD-1210',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '10μH功率电感，1A饱和电流',
    functionalPerformance: '低DCR，高饱和电流，屏蔽结构',
    referencePrice: 0.25,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '0.15Ω',
      power: '无',
      inductance: '10μH',
      frequency: '1MHz',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC004',
    partNumber: 'XTAL-32.768K',
    manufacturer: '泰晶科技',
    primaryCategory: '晶振',
    secondaryCategory: '石英晶振',
    package: '圆柱形',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '32.768kHz石英晶振',
    functionalPerformance: '高精度，低功耗，RTC专用',
    referencePrice: 0.45,
    parameters: {
      capacitance: '12.5pF',
      voltage: '无',
      tolerance: '±20ppm',
      resistance: '70kΩ',
      power: '1μW',
      inductance: '无',
      frequency: '32.768kHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC005',
    partNumber: 'FILT-LC-1mH',
    manufacturer: '麦捷科技',
    primaryCategory: '滤波器',
    secondaryCategory: 'LC滤波器',
    package: 'SMD封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60938'],
    description: '1mH LC低通滤波器',
    functionalPerformance: '截止频率1MHz，插损<1dB',
    referencePrice: 1.20,
    parameters: {
      capacitance: '100pF',
      voltage: '50V',
      tolerance: '±10%',
      resistance: '1Ω',
      power: '1W',
      inductance: '1mH',
      frequency: '1MHz',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'GC006',
    partNumber: 'TERM-Screw-5mm',
    manufacturer: '韦德万能',
    primaryCategory: '接线端子',
    secondaryCategory: '螺钉式端子',
    package: '5mm间距',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60947'],
    description: '5mm间距螺钉式接线端子',
    functionalPerformance: '10A/300V，镀锡铜材质',
    referencePrice: 0.80,
    parameters: {
      capacitance: '无',
      voltage: '300V',
      tolerance: '无',
      resistance: '<1mΩ',
      power: '3kW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'GC007',
    partNumber: 'HEAT-TO220-Alu',
    manufacturer: '信越化学',
    primaryCategory: '散热器',
    secondaryCategory: 'TO-220散热器',
    package: '铝合金',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'TO-220封装铝合金散热器',
    functionalPerformance: '热阻3°C/W，自然对流',
    referencePrice: 2.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '无',
      resistance: '3°C/W',
      power: '10W',
      inductance: '无',
      frequency: '无',
      temperature: '-55°C~+150°C'
    }
  },
  {
    id: 'GC008',
    partNumber: 'TEMP-NTC-10K',
    manufacturer: '华工科技',
    primaryCategory: '传感器',
    secondaryCategory: '温度传感器',
    package: '玻璃封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60539'],
    description: '10kΩ@25°C NTC热敏电阻',
    functionalPerformance: 'B值3950K，精度±1%',
    referencePrice: 1.50,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±1%',
      resistance: '10kΩ@25°C',
      power: '250mW',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+125°C'
    }
  },
  {
    id: 'GC009',
    partNumber: 'POT-10K-Linear',
    manufacturer: '松下电器',
    primaryCategory: '可变电阻',
    secondaryCategory: '电位器',
    package: '旋转式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60393'],
    description: '10kΩ线性电位器',
    functionalPerformance: '旋转寿命10万次，线性度±5%',
    referencePrice: 3.20,
    parameters: {
      capacitance: '无',
      voltage: '无',
      tolerance: '±20%',
      resistance: '10kΩ',
      power: '0.5W',
      inductance: '无',
      frequency: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'GC010',
    partNumber: 'VARISTOR-14V',
    manufacturer: '硕凯电子',
    primaryCategory: '压敏电阻',
    secondaryCategory: 'MOV压敏电阻',
    package: '径向引线',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60738'],
    description: '14V氧化锌压敏电阻',
    functionalPerformance: '浪涌保护，响应时间<25ns',
    referencePrice: 0.65,
    parameters: {
      capacitance: '无',
      voltage: '14V',
      tolerance: '±10%',
      resistance: '>1GΩ',
      power: '0.6W',
      inductance: '无',
      frequency: '无',
      temperature: '-40°C~+85°C'
    }
  }
];

const GeneralSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<GeneralComponent[]>(mockGeneralData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<GeneralComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockGeneralData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockGeneralData);
  };

  // 查看详情
  const handleViewDetail = (record: GeneralComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: GeneralComponent, b: GeneralComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: GeneralComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            通用与特种元件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            General & Special Components - 电阻、电容、电感、晶振、传感器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="风华高科">风华高科</Option>
                  <Option value="厚声电子">厚声电子</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="麦捷科技">麦捷科技</Option>
                  <Option value="韦德万能">韦德万能</Option>
                  <Option value="信越化学">信越化学</Option>
                  <Option value="华工科技">华工科技</Option>
                  <Option value="松下电器">松下电器</Option>
                  <Option value="硕凯电子">硕凯电子</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="电容器">电容器</Option>
                  <Option value="电阻器">电阻器</Option>
                  <Option value="电感器">电感器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="滤波器">滤波器</Option>
                  <Option value="接线端子">接线端子</Option>
                  <Option value="散热器">散热器</Option>
                  <Option value="传感器">传感器</Option>
                  <Option value="可变电阻">可变电阻</Option>
                  <Option value="压敏电阻">压敏电阻</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="容值">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="额定电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.tolerance}</Descriptions.Item>
            <Descriptions.Item label="阻值">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="额定功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="电感值">{selectedComponent.parameters.inductance}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default GeneralSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 机电组件数据类型定义
interface ElectromechanicalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    torque?: string;
    speed?: string;
    force?: string;
    temperature?: string;
  };
}

// 机电组件测试数据
const mockElectromechanicalData: ElectromechanicalComponent[] = [
  {
    id: 'EM001',
    partNumber: 'RLY-24V-DPDT',
    manufacturer: '宏发继电器',
    primaryCategory: '继电器',
    secondaryCategory: '电磁继电器',
    package: 'PCB插件',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB597A', 'MIL-PRF-39016'],
    description: '24V双刀双掷电磁继电器',
    functionalPerformance: '24VDC线圈，触点容量10A/250VAC',
    referencePrice: 35.00,
    parameters: {
      voltage: '24VDC',
      current: '10A',
      power: '2.4W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '10ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM002',
    partNumber: 'SW-Toggle-MS',
    manufacturer: '得捷电子',
    primaryCategory: '开关',
    secondaryCategory: '拨动开关',
    package: '面板安装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['MIL-PRF-8805'],
    description: '军标拨动开关，单刀双掷',
    functionalPerformance: 'SPDT，5A/125VAC，寿命100万次',
    referencePrice: 28.00,
    parameters: {
      voltage: '125VAC',
      current: '5A',
      power: '625W',
      frequency: '无',
      torque: '无',
      speed: '无',
      force: '3N',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM003',
    partNumber: 'CONN-D25-M',
    manufacturer: '航天电器',
    primaryCategory: '连接器',
    secondaryCategory: 'D-SUB连接器',
    package: '金属壳体',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB101A'],
    description: '25针D-SUB公头连接器',
    functionalPerformance: '25针，镀金触点，插拔寿命>5000次',
    referencePrice: 85.00,
    parameters: {
      voltage: '500VDC',
      current: '5A',
      power: '无',
      frequency: '1GHz',
      torque: '无',
      speed: '无',
      force: '20N',
      temperature: '-65°C~+175°C'
    }
  },
  {
    id: 'EM004',
    partNumber: 'FAN-12V-40mm',
    manufacturer: '台达电子',
    primaryCategory: '风扇',
    secondaryCategory: '轴流风扇',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['UL507'],
    description: '12V直流轴流风扇，40mm',
    functionalPerformance: '12VDC，转速7000RPM，风量12CFM',
    referencePrice: 15.00,
    parameters: {
      voltage: '12VDC',
      current: '150mA',
      power: '1.8W',
      frequency: '无',
      torque: '无',
      speed: '7000RPM',
      force: '无',
      temperature: '-10°C~+70°C'
    }
  },
  {
    id: 'EM005',
    partNumber: 'BUZZ-5V-Piezo',
    manufacturer: '福星晓程',
    primaryCategory: '蜂鸣器',
    secondaryCategory: '压电蜂鸣器',
    package: 'PCB安装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60065'],
    description: '5V压电蜂鸣器，2700Hz',
    functionalPerformance: '5VDC，声压级85dB@10cm',
    referencePrice: 3.50,
    parameters: {
      voltage: '5VDC',
      current: '30mA',
      power: '150mW',
      frequency: '2700Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'EM006',
    partNumber: 'FUSE-5A-Fast',
    manufacturer: '力特奥维斯',
    primaryCategory: '熔断器',
    secondaryCategory: '快熔保险丝',
    package: '5×20mm',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60127'],
    description: '5A快熔保险丝，250V',
    functionalPerformance: '5A/250V，分断能力35A',
    referencePrice: 0.80,
    parameters: {
      voltage: '250VAC',
      current: '5A',
      power: '1250W',
      frequency: '50/60Hz',
      torque: '无',
      speed: '<1ms',
      force: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'EM007',
    partNumber: 'XFMR-230/12V',
    manufacturer: '顺络电子',
    primaryCategory: '变压器',
    secondaryCategory: '电源变压器',
    package: 'EI型铁芯',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61558'],
    description: '230V转12V电源变压器，10VA',
    functionalPerformance: '230VAC输入，12VAC输出，10VA',
    referencePrice: 25.00,
    parameters: {
      voltage: '230/12VAC',
      current: '833mA',
      power: '10VA',
      frequency: '50/60Hz',
      torque: '无',
      speed: '无',
      force: '无',
      temperature: '-25°C~+85°C'
    }
  },
  {
    id: 'EM008',
    partNumber: 'MOTOR-12V-Gear',
    manufacturer: '兆威机电',
    primaryCategory: '电机',
    secondaryCategory: '直流减速电机',
    package: '金属齿轮箱',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '12V直流减速电机，1:100减速比',
    functionalPerformance: '12VDC，转速30RPM，扭矩2Nm',
    referencePrice: 120.00,
    parameters: {
      voltage: '12VDC',
      current: '500mA',
      power: '6W',
      frequency: '无',
      torque: '2Nm',
      speed: '30RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'EM009',
    partNumber: 'SERVO-180deg',
    manufacturer: '汇川技术',
    primaryCategory: '伺服电机',
    secondaryCategory: '舵机',
    package: '塑料外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: '180度舵机，PWM控制',
    functionalPerformance: '6V供电，扭矩1.8kg·cm，180°转角',
    referencePrice: 45.00,
    parameters: {
      voltage: '6VDC',
      current: '200mA',
      power: '1.2W',
      frequency: '50Hz',
      torque: '1.8kg·cm',
      speed: '0.16s/60°',
      force: '无',
      temperature: '-10°C~+60°C'
    }
  },
  {
    id: 'EM010',
    partNumber: 'STEP-200-Bipolar',
    manufacturer: '雷赛智能',
    primaryCategory: '步进电机',
    secondaryCategory: '双极步进电机',
    package: 'NEMA17',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['GB/T14711'],
    description: 'NEMA17双极步进电机，200步/转',
    functionalPerformance: '12V，1.8°步距角，保持扭矩4kg·cm',
    referencePrice: 85.00,
    parameters: {
      voltage: '12VDC',
      current: '1.2A',
      power: '14.4W',
      frequency: '无',
      torque: '4kg·cm',
      speed: '1000RPM',
      force: '无',
      temperature: '-20°C~+80°C'
    }
  }
];

const ElectromechanicalSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<ElectromechanicalComponent[]>(mockElectromechanicalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ElectromechanicalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockElectromechanicalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockElectromechanicalData);
  };

  // 查看详情
  const handleViewDetail = (record: ElectromechanicalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 100,
      render: (text: string) => <Tag color="processing">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="default">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: ElectromechanicalComponent, b: ElectromechanicalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: ElectromechanicalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #1890ff 0%, #096dd9 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            机电组件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Electromechanical Components - 继电器、开关、连接器、电机等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="宏发继电器">宏发继电器</Option>
                  <Option value="得捷电子">得捷电子</Option>
                  <Option value="航天电器">航天电器</Option>
                  <Option value="台达电子">台达电子</Option>
                  <Option value="福星晓程">福星晓程</Option>
                  <Option value="力特奥维斯">力特奥维斯</Option>
                  <Option value="顺络电子">顺络电子</Option>
                  <Option value="兆威机电">兆威机电</Option>
                  <Option value="汇川技术">汇川技术</Option>
                  <Option value="雷赛智能">雷赛智能</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="继电器">继电器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="连接器">连接器</Option>
                  <Option value="风扇">风扇</Option>
                  <Option value="蜂鸣器">蜂鸣器</Option>
                  <Option value="熔断器">熔断器</Option>
                  <Option value="变压器">变压器</Option>
                  <Option value="电机">电机</Option>
                  <Option value="伺服电机">伺服电机</Option>
                  <Option value="步进电机">步进电机</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="扭矩">{selectedComponent.parameters.torque}</Descriptions.Item>
            <Descriptions.Item label="转速">{selectedComponent.parameters.speed}</Descriptions.Item>
            <Descriptions.Item label="作用力">{selectedComponent.parameters.force}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default ElectromechanicalSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 混合集成电路数据类型定义
interface HybridComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    isolation?: string;
  };
}

// 混合集成电路测试数据
const mockHybridData: HybridComponent[] = [
  {
    id: 'H001',
    partNumber: 'HMC1023LC4',
    manufacturer: '海光信息',
    primaryCategory: '射频混合电路',
    secondaryCategory: '低噪声放大器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '宽带低噪声放大器，0.1-20GHz',
    functionalPerformance: '低噪声系数，高增益，宽频带',
    referencePrice: 280.00,
    parameters: {
      voltage: '5V±5%',
      current: '85mA',
      power: '425mW',
      temperature: '-55°C~+85°C',
      frequency: '0.1GHz~20GHz',
      gain: '18dB',
      bandwidth: '19.9GHz',
      isolation: '25dB'
    }
  },
  {
    id: 'H002',
    partNumber: 'HMC544LC4',
    manufacturer: '中电科技',
    primaryCategory: '射频混合电路',
    secondaryCategory: '功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高功率射频放大器，2-18GHz',
    functionalPerformance: '高输出功率，宽频带响应',
    referencePrice: 450.00,
    parameters: {
      voltage: '8V±5%',
      current: '200mA',
      power: '1.6W',
      temperature: '-55°C~+85°C',
      frequency: '2GHz~18GHz',
      gain: '15dB',
      bandwidth: '16GHz',
      isolation: '20dB'
    }
  },
  {
    id: 'H003',
    partNumber: 'HMC213MS8',
    manufacturer: '航天科工',
    primaryCategory: '射频混合电路',
    secondaryCategory: '混频器',
    package: 'MSOP-8',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['QML-V', 'MIL-PRF-38534'],
    description: '双平衡混频器，DC-8GHz',
    functionalPerformance: '低转换损耗，高隔离度',
    referencePrice: 520.00,
    parameters: {
      voltage: '5V±10%',
      current: '25mA',
      power: '125mW',
      temperature: '-55°C~+125°C',
      frequency: 'DC~8GHz',
      gain: '8dB转换增益',
      bandwidth: '8GHz',
      isolation: '35dB'
    }
  },
  {
    id: 'H004',
    partNumber: 'HMC987LC5',
    manufacturer: '中科微至',
    primaryCategory: '射频混合电路',
    secondaryCategory: '衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '数字可控衰减器，DC-18GHz',
    functionalPerformance: '6位数字控制，0.5dB步进',
    referencePrice: 320.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '45mA',
      power: '150mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~18GHz',
      gain: '0~31.5dB衰减',
      bandwidth: '18GHz',
      isolation: '30dB'
    }
  },
  {
    id: 'H005',
    partNumber: 'HMC641LC4',
    manufacturer: '华进半导体',
    primaryCategory: '模拟混合电路',
    secondaryCategory: '运算放大器',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高速运算放大器，精密级',
    functionalPerformance: '低失调，高转换率',
    referencePrice: 85.00,
    parameters: {
      voltage: '±15V',
      current: '8mA',
      power: '240mW',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      gain: '120dB',
      bandwidth: '100MHz',
      isolation: '无'
    }
  },
  {
    id: 'H006',
    partNumber: 'HMC832LC3',
    manufacturer: '紫光同创',
    primaryCategory: '时钟混合电路',
    secondaryCategory: '锁相环',
    package: 'QFN-32',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '整数N分频PLL，25MHz-3GHz',
    functionalPerformance: '低相位噪声，快速锁定',
    referencePrice: 180.00,
    parameters: {
      voltage: '3.3V±5%',
      current: '95mA',
      power: '315mW',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~3GHz',
      gain: '无',
      bandwidth: '2.975GHz',
      isolation: '无'
    }
  },
  {
    id: 'H007',
    partNumber: 'HMC754LC3',
    manufacturer: '安路科技',
    primaryCategory: '功率混合电路',
    secondaryCategory: '功率控制器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '射频功率检测器，DC-40GHz',
    functionalPerformance: '宽动态范围，线性响应',
    referencePrice: 220.00,
    parameters: {
      voltage: '5V±5%',
      current: '12mA',
      power: '60mW',
      temperature: '-55°C~+85°C',
      frequency: 'DC~40GHz',
      gain: '无',
      bandwidth: '40GHz',
      isolation: '无'
    }
  },
  {
    id: 'H008',
    partNumber: 'HMC892LC4',
    manufacturer: '全志科技',
    primaryCategory: '开关混合电路',
    secondaryCategory: '射频开关',
    package: 'QFN-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'SPDT射频开关，DC-26.5GHz',
    functionalPerformance: '低插入损耗，高隔离度',
    referencePrice: 120.00,
    parameters: {
      voltage: '3.3V/5V',
      current: '15mA',
      power: '75mW',
      temperature: '-40°C~+85°C',
      frequency: 'DC~26.5GHz',
      gain: '无',
      bandwidth: '26.5GHz',
      isolation: '50dB'
    }
  }
];

const HybridICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<HybridComponent[]>(mockHybridData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<HybridComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockHybridData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockHybridData);
  };

  // 查看详情
  const handleViewDetail = (record: HybridComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: HybridComponent, b: HybridComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: HybridComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            混合集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Hybrid Integrated Circuits - 射频电路、模拟电路、功率电路、时钟电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海光信息">海光信息</Option>
                  <Option value="中电科技">中电科技</Option>
                  <Option value="航天科工">航天科工</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="华进半导体">华进半导体</Option>
                  <Option value="紫光同创">紫光同创</Option>
                  <Option value="安路科技">安路科技</Option>
                  <Option value="全志科技">全志科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="射频混合电路">射频混合电路</Option>
                  <Option value="模拟混合电路">模拟混合电路</Option>
                  <Option value="时钟混合电路">时钟混合电路</Option>
                  <Option value="功率混合电路">功率混合电路</Option>
                  <Option value="开关混合电路">开关混合电路</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="锁相环">锁相环</Option>
                  <Option value="功率控制器">功率控制器</Option>
                  <Option value="射频开关">射频开关</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="cyan">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default HybridICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 微系统数据类型定义
interface MicrosystemComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    frequency?: string;
    sensitivity?: string;
    range?: string;
    accuracy?: string;
    temperature?: string;
  };
}

// 微系统测试数据
const mockMicrosystemsData: MicrosystemComponent[] = [
  {
    id: 'MS001',
    partNumber: 'MEMS-ACC-3Axis',
    manufacturer: '敏芯股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴加速度计',
    package: 'LGA-14',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q100', 'ISO-26262'],
    description: '三轴MEMS加速度传感器',
    functionalPerformance: '±16g量程，16位ADC，低功耗',
    referencePrice: 8.50,
    parameters: {
      voltage: '1.8-3.6V',
      current: '12μA',
      power: '36μW',
      frequency: '1.6kHz',
      sensitivity: '2048LSB/g',
      range: '±2/±4/±8/±16g',
      accuracy: '±40mg',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS002',
    partNumber: 'GYRO-3Axis-2000dps',
    manufacturer: '瑞声科技',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '三轴陀螺仪',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: '三轴MEMS陀螺仪传感器',
    functionalPerformance: '±2000dps量程，16位分辨率',
    referencePrice: 12.00,
    parameters: {
      voltage: '2.4-3.6V',
      current: '3.6mA',
      power: '10.8mW',
      frequency: '8kHz',
      sensitivity: '16.4LSB/(dps)',
      range: '±250/±500/±1000/±2000dps',
      accuracy: '±1%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS003',
    partNumber: 'PRESS-1000mbar',
    manufacturer: '森思泰克',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '压力传感器',
    package: 'LGA-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS绝对压力传感器',
    functionalPerformance: '300-1100mbar，24位ADC',
    referencePrice: 15.00,
    parameters: {
      voltage: '1.8-3.6V',
      current: '3μA',
      power: '5.4μW',
      frequency: '157Hz',
      sensitivity: '4096Pa/LSB',
      range: '300-1100mbar',
      accuracy: '±0.12mbar',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS004',
    partNumber: 'MIC-MEMS-Omni',
    manufacturer: '歌尔股份',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: 'MEMS麦克风',
    package: 'SMD-3.76×2.95',
    qualityLevel: '消费级',
    lifecycle: '生产中',
    standards: ['IEC-61672'],
    description: '全向MEMS数字麦克风',
    functionalPerformance: '-26dBFS灵敏度，130dB SPL',
    referencePrice: 1.20,
    parameters: {
      voltage: '1.8-3.6V',
      current: '650μA',
      power: '2.3mW',
      frequency: '20Hz-20kHz',
      sensitivity: '-26dBFS',
      range: '130dB SPL',
      accuracy: '±1dB',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS005',
    partNumber: 'RF-MEMS-SW-6GHz',
    manufacturer: '中电科55所',
    primaryCategory: 'RF MEMS',
    secondaryCategory: 'RF MEMS开关',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '6GHz RF MEMS开关',
    functionalPerformance: 'DC-6GHz，插损<0.3dB，隔离>30dB',
    referencePrice: 280.00,
    parameters: {
      voltage: '0-80V',
      current: '1μA',
      power: '80μW',
      frequency: 'DC-6GHz',
      sensitivity: '无',
      range: '80V',
      accuracy: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MS006',
    partNumber: 'BIO-MEMS-Glucose',
    manufacturer: '奥普拓',
    primaryCategory: '生物MEMS',
    secondaryCategory: '葡萄糖传感器',
    package: '芯片级封装',
    qualityLevel: '医用级',
    lifecycle: '生产中',
    standards: ['ISO-13485', 'FDA-510K'],
    description: 'MEMS葡萄糖生物传感器',
    functionalPerformance: '0.5-30mmol/L检测范围，电化学检测',
    referencePrice: 45.00,
    parameters: {
      voltage: '3.0V',
      current: '10μA',
      power: '30μW',
      frequency: '1Hz',
      sensitivity: '20nA/(mmol/L)',
      range: '0.5-30mmol/L',
      accuracy: '±5%',
      temperature: '20°C~+40°C'
    }
  },
  {
    id: 'MS007',
    partNumber: 'OPTICAL-MEMS-DMD',
    manufacturer: '奥普光电',
    primaryCategory: '光学MEMS',
    secondaryCategory: '数字微镜器件',
    package: 'BGA封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62471'],
    description: '1024×768数字微镜阵列',
    functionalPerformance: '1024×768分辨率，20μs切换时间',
    referencePrice: 1200.00,
    parameters: {
      voltage: '12V',
      current: '500mA',
      power: '6W',
      frequency: '50kHz',
      sensitivity: '无',
      range: '±12°',
      accuracy: '±0.1°',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'MS008',
    partNumber: 'FLOW-MEMS-Thermal',
    manufacturer: '奥松电子',
    primaryCategory: 'MEMS传感器',
    secondaryCategory: '热式流量传感器',
    package: 'TO-39',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60068'],
    description: 'MEMS热式气体流量传感器',
    functionalPerformance: '0-200SLPM，热式检测原理',
    referencePrice: 85.00,
    parameters: {
      voltage: '5V',
      current: '20mA',
      power: '100mW',
      frequency: '10Hz',
      sensitivity: '50mV/(m/s)',
      range: '0-200SLPM',
      accuracy: '±3%',
      temperature: '-20°C~+80°C'
    }
  },
  {
    id: 'MS009',
    partNumber: 'MEMS-OSC-100MHz',
    manufacturer: '泰晶科技',
    primaryCategory: 'MEMS振荡器',
    secondaryCategory: 'MEMS时钟发生器',
    package: 'SMD-3.2×2.5',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60444'],
    description: '100MHz MEMS振荡器',
    functionalPerformance: '100MHz±25ppm，LVDS输出',
    referencePrice: 6.50,
    parameters: {
      voltage: '3.3V',
      current: '45mA',
      power: '148.5mW',
      frequency: '100MHz',
      sensitivity: '无',
      range: '±25ppm',
      accuracy: '±25ppm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'MS010',
    partNumber: 'MEMS-MIRROR-2Axis',
    manufacturer: '中科院光电院',
    primaryCategory: '光学MEMS',
    secondaryCategory: '二维扫描镜',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '二维MEMS扫描微镜',
    functionalPerformance: '±15°扫描角，1kHz扫描频率',
    referencePrice: 2800.00,
    parameters: {
      voltage: '±150V',
      current: '1mA',
      power: '300mW',
      frequency: '1kHz',
      sensitivity: '0.1°/V',
      range: '±15°',
      accuracy: '±0.1°',
      temperature: '-40°C~+70°C'
    }
  }
];

const MicrosystemsSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<MicrosystemComponent[]>(mockMicrosystemsData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrosystemComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrosystemsData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrosystemsData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrosystemComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 120,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrosystemComponent, b: MicrosystemComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '医用级': 'magenta',
          '消费级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrosystemComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #13c2c2 0%, #08979c 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            微系统
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Microsystems - MEMS传感器、RF MEMS、生物MEMS、光学MEMS等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="敏芯股份">敏芯股份</Option>
                  <Option value="瑞声科技">瑞声科技</Option>
                  <Option value="森思泰克">森思泰克</Option>
                  <Option value="歌尔股份">歌尔股份</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="奥普拓">奥普拓</Option>
                  <Option value="奥普光电">奥普光电</Option>
                  <Option value="奥松电子">奥松电子</Option>
                  <Option value="泰晶科技">泰晶科技</Option>
                  <Option value="中科院光电院">中科院光电院</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="MEMS传感器">MEMS传感器</Option>
                  <Option value="RF MEMS">RF MEMS</Option>
                  <Option value="生物MEMS">生物MEMS</Option>
                  <Option value="光学MEMS">光学MEMS</Option>
                  <Option value="MEMS振荡器">MEMS振荡器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="医用级">医用级</Option>
                  <Option value="消费级">消费级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="功耗">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="灵敏度">{selectedComponent.parameters.sensitivity}</Descriptions.Item>
            <Descriptions.Item label="测量范围">{selectedComponent.parameters.range}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrosystemsSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 固态微波器件数据类型定义
interface MicrowaveComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    frequency?: string;
    power?: string;
    gain?: string;
    noiseLevel?: string;
    vswr?: string;
    insertion?: string;
    isolation?: string;
    temperature?: string;
  };
}

// 固态微波器件测试数据
const mockMicrowaveData: MicrowaveComponent[] = [
  {
    id: 'MW001',
    partNumber: 'HMC-ALH382',
    manufacturer: '海特高新',
    primaryCategory: '功率放大器',
    secondaryCategory: 'GaN功率放大器',
    package: 'QFN-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'Ku波段GaN功率放大器，高效率',
    functionalPerformance: '14-18GHz，输出功率10W，效率>45%',
    referencePrice: 2800.00,
    parameters: {
      frequency: '14-18GHz',
      power: '10W',
      gain: '35dB',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW002',
    partNumber: 'LNA-X2015',
    manufacturer: '中电科13所',
    primaryCategory: '低噪声放大器',
    secondaryCategory: 'X波段LNA',
    package: 'SMT-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-202'],
    description: 'X波段低噪声放大器，超低噪声',
    functionalPerformance: '8-12GHz，噪声系数<1.2dB',
    referencePrice: 1500.00,
    parameters: {
      frequency: '8-12GHz',
      power: '20dBm',
      gain: '28dB',
      noiseLevel: '<1.2dB',
      vswr: '<1.8:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW003',
    partNumber: 'MIX-KU301',
    manufacturer: '中科微至',
    primaryCategory: '混频器',
    secondaryCategory: '上变频器',
    package: 'QFN-16',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'Ku波段上变频器，低变频损耗',
    functionalPerformance: 'RF:12-18GHz，LO:10-16GHz',
    referencePrice: 980.00,
    parameters: {
      frequency: '12-18GHz',
      power: '15dBm',
      gain: '8dB',
      noiseLevel: '无',
      vswr: '<2.2:1',
      insertion: '<8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW004',
    partNumber: 'OSC-C1000',
    manufacturer: '航天772所',
    primaryCategory: '振荡器',
    secondaryCategory: '压控振荡器',
    package: 'SMT-6',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'C波段压控振荡器，低相噪',
    functionalPerformance: '4-8GHz，相噪<-110dBc/Hz@10kHz',
    referencePrice: 3200.00,
    parameters: {
      frequency: '4-8GHz',
      power: '10dBm',
      gain: '无',
      noiseLevel: '<-110dBc/Hz',
      vswr: '<1.5:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW005',
    partNumber: 'SW-SPDT24',
    manufacturer: '中电科29所',
    primaryCategory: '开关',
    secondaryCategory: 'SPDT开关',
    package: 'QFN-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '单刀双掷微波开关，快速切换',
    functionalPerformance: 'DC-24GHz，切换时间<50ns',
    referencePrice: 680.00,
    parameters: {
      frequency: 'DC-24GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<1.5dB',
      isolation: '>60dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW006',
    partNumber: 'ATT-K015',
    manufacturer: '中电科55所',
    primaryCategory: '衰减器',
    secondaryCategory: '数字衰减器',
    package: 'QFN-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'K波段数字衰减器，6位控制',
    functionalPerformance: '18-26GHz，衰减范围0-31.5dB',
    referencePrice: 1200.00,
    parameters: {
      frequency: '18-26GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '<3dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW007',
    partNumber: 'DET-S2000',
    manufacturer: '安徽博微',
    primaryCategory: '检波器',
    secondaryCategory: '对数检波器',
    package: 'SMT-10',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'S波段对数检波器，宽动态范围',
    functionalPerformance: '2-4GHz，动态范围>60dB',
    referencePrice: 850.00,
    parameters: {
      frequency: '2-4GHz',
      power: '20dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<2.0:1',
      insertion: '无',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW008',
    partNumber: 'DIV-X204',
    manufacturer: '中电科38所',
    primaryCategory: '功分器',
    secondaryCategory: '四路功分器',
    package: 'SMT-12',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'X波段四路功分器，低插损',
    functionalPerformance: '8-12GHz，插损<1.5dB',
    referencePrice: 420.00,
    parameters: {
      frequency: '8-12GHz',
      power: '30dBm',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.6:1',
      insertion: '<1.5dB',
      isolation: '>18dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW009',
    partNumber: 'CIR-KA180',
    manufacturer: '中电科14所',
    primaryCategory: '环行器',
    secondaryCategory: '三端口环行器',
    package: '金属封装',
    qualityLevel: '宇航级',
    lifecycle: '生产中',
    standards: ['Q/BA9001', 'GJB548B'],
    description: 'Ka波段环行器，高隔离度',
    functionalPerformance: '26-40GHz，隔离度>20dB',
    referencePrice: 1800.00,
    parameters: {
      frequency: '26-40GHz',
      power: '10W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.5:1',
      insertion: '<0.8dB',
      isolation: '>20dB',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'MW010',
    partNumber: 'FIL-L1500',
    manufacturer: '成都亚光',
    primaryCategory: '滤波器',
    secondaryCategory: '带通滤波器',
    package: '陶瓷封装',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: 'L波段带通滤波器，陡峭截止',
    functionalPerformance: '1-2GHz，带外抑制>60dB',
    referencePrice: 650.00,
    parameters: {
      frequency: '1-2GHz',
      power: '50W',
      gain: '无',
      noiseLevel: '无',
      vswr: '<1.8:1',
      insertion: '<2dB',
      isolation: '无',
      temperature: '-55°C~+85°C'
    }
  }
];

const MicrowaveSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<MicrowaveComponent[]>(mockMicrowaveData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<MicrowaveComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockMicrowaveData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.frequency) {
        filtered = filtered.filter(item => 
          item.parameters.frequency?.includes(values.frequency)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockMicrowaveData);
  };

  // 查看详情
  const handleViewDetail = (record: MicrowaveComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="geekblue">{text}</Tag>,
    },
    {
      title: '频率范围',
      dataIndex: ['parameters', 'frequency'],
      key: 'frequency',
      width: 120,
      render: (text: string) => <Tag color="cyan">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: MicrowaveComponent, b: MicrowaveComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: MicrowaveComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            固态微波器件与电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Solid-State Microwave Devices & Circuits - 放大器、混频器、振荡器、开关等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="海特高新">海特高新</Option>
                  <Option value="中电科13所">中电科13所</Option>
                  <Option value="中科微至">中科微至</Option>
                  <Option value="航天772所">航天772所</Option>
                  <Option value="中电科29所">中电科29所</Option>
                  <Option value="中电科55所">中电科55所</Option>
                  <Option value="安徽博微">安徽博微</Option>
                  <Option value="中电科38所">中电科38所</Option>
                  <Option value="中电科14所">中电科14所</Option>
                  <Option value="成都亚光">成都亚光</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="功率放大器">功率放大器</Option>
                  <Option value="低噪声放大器">低噪声放大器</Option>
                  <Option value="混频器">混频器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="开关">开关</Option>
                  <Option value="衰减器">衰减器</Option>
                  <Option value="检波器">检波器</Option>
                  <Option value="功分器">功分器</Option>
                  <Option value="环行器">环行器</Option>
                  <Option value="滤波器">滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="频率范围" name="frequency">
                <Select placeholder="选择频率范围" allowClear>
                  <Option value="L">L波段(1-2GHz)</Option>
                  <Option value="S">S波段(2-4GHz)</Option>
                  <Option value="C">C波段(4-8GHz)</Option>
                  <Option value="X">X波段(8-12GHz)</Option>
                  <Option value="Ku">Ku波段(12-18GHz)</Option>
                  <Option value="K">K波段(18-26GHz)</Option>
                  <Option value="Ka">Ka波段(26-40GHz)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="频率范围">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="噪声系数">{selectedComponent.parameters.noiseLevel}</Descriptions.Item>
            <Descriptions.Item label="驻波比">{selectedComponent.parameters.vswr}</Descriptions.Item>
            <Descriptions.Item label="插入损耗">{selectedComponent.parameters.insertion}</Descriptions.Item>
            <Descriptions.Item label="隔离度">{selectedComponent.parameters.isolation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default MicrowaveSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 光电子器件数据类型定义
interface OptoelectronicComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    wavelength?: string;
    power?: string;
    current?: string;
    voltage?: string;
    efficiency?: string;
    response?: string;
    bandwidth?: string;
    temperature?: string;
  };
}

// 光电子器件测试数据
const mockOptoData: OptoelectronicComponent[] = [
  {
    id: 'OE001',
    partNumber: 'LD-1550-100',
    manufacturer: '光迅科技',
    primaryCategory: '激光器',
    secondaryCategory: 'DFB激光器',
    package: 'TO-56',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.692', 'Telcordia GR-468'],
    description: '1550nm DFB激光器，单模光纤通信',
    functionalPerformance: '1550nm，输出功率100mW，边模抑制比>40dB',
    referencePrice: 850.00,
    parameters: {
      wavelength: '1550nm',
      power: '100mW',
      current: '150mA',
      voltage: '1.8V',
      efficiency: '35%',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE002',
    partNumber: 'PD-InGaAs-10G',
    manufacturer: '海光芯创',
    primaryCategory: '光电探测器',
    secondaryCategory: 'InGaAs光电二极管',
    package: 'TO-46',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.957'],
    description: 'InGaAs PIN光电二极管，高速响应',
    functionalPerformance: '800-1700nm，响应度0.9A/W@1550nm',
    referencePrice: 320.00,
    parameters: {
      wavelength: '800-1700nm',
      power: '10mW',
      current: '10μA',
      voltage: '5V',
      efficiency: '90%',
      response: '10GHz',
      bandwidth: '900nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE003',
    partNumber: 'LED-850-SM',
    manufacturer: '三安光电',
    primaryCategory: '发光二极管',
    secondaryCategory: '850nm LED',
    package: 'TO-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '850nm LED，多模光纤通信',
    functionalPerformance: '850nm，输出功率-3dBm，数值孔径0.2',
    referencePrice: 45.00,
    parameters: {
      wavelength: '850nm',
      power: '1mW',
      current: '100mA',
      voltage: '1.8V',
      efficiency: '15%',
      response: '100MHz',
      bandwidth: '50nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE004',
    partNumber: 'VCSEL-940-Array',
    manufacturer: '纵慧芯光',
    primaryCategory: '垂直腔面发射激光器',
    secondaryCategory: '940nm VCSEL阵列',
    package: 'TO-39',
    qualityLevel: '汽车级',
    lifecycle: '生产中',
    standards: ['AEC-Q102'],
    description: '940nm VCSEL阵列，激光雷达应用',
    functionalPerformance: '940nm，16×16阵列，总功率40W',
    referencePrice: 1200.00,
    parameters: {
      wavelength: '940nm',
      power: '40W',
      current: '20A',
      voltage: '32V',
      efficiency: '45%',
      response: '1GHz',
      bandwidth: '2nm',
      temperature: '-40°C~+105°C'
    }
  },
  {
    id: 'OE005',
    partNumber: 'APD-Si-100M',
    manufacturer: '奥普拓激光',
    primaryCategory: '雪崩光电二极管',
    secondaryCategory: '硅APD',
    package: 'TO-5',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B'],
    description: '硅雪崩光电二极管，高灵敏度',
    functionalPerformance: '400-1000nm，增益100，暗电流<1nA',
    referencePrice: 680.00,
    parameters: {
      wavelength: '400-1000nm',
      power: '1μW',
      current: '1nA',
      voltage: '150V',
      efficiency: '80%',
      response: '100MHz',
      bandwidth: '600nm',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'OE006',
    partNumber: 'SOA-1550-30',
    manufacturer: '华为海思',
    primaryCategory: '光放大器',
    secondaryCategory: '半导体光放大器',
    package: '蝶形封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.662'],
    description: '1550nm半导体光放大器',
    functionalPerformance: '1530-1570nm，增益30dB，噪声系数<6dB',
    referencePrice: 2800.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '20dBm',
      current: '400mA',
      voltage: '2.5V',
      efficiency: '25%',
      response: '40GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE007',
    partNumber: 'MOD-LN-10G',
    manufacturer: '青岛海信',
    primaryCategory: '光调制器',
    secondaryCategory: '铌酸锂调制器',
    package: '金属封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.959.1'],
    description: '10Gbps铌酸锂马赫曾德尔调制器',
    functionalPerformance: '1550nm，消光比>20dB，插损<4dB',
    referencePrice: 5600.00,
    parameters: {
      wavelength: '1550nm',
      power: '20dBm',
      current: '无',
      voltage: '6V',
      efficiency: '无',
      response: '10GHz',
      bandwidth: '40nm',
      temperature: '0°C~+70°C'
    }
  },
  {
    id: 'OE008',
    partNumber: 'WDM-CWDM-8CH',
    manufacturer: '亿源通',
    primaryCategory: '波分复用器',
    secondaryCategory: 'CWDM复用器',
    package: 'ABS封装',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['ITU-T G.694.2'],
    description: '8通道CWDM波分复用器',
    functionalPerformance: '1470-1610nm，插损<0.8dB，隔离度>30dB',
    referencePrice: 380.00,
    parameters: {
      wavelength: '1470-1610nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '140nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE009',
    partNumber: 'ISO-1550-30',
    manufacturer: '凯普林光电',
    primaryCategory: '光隔离器',
    secondaryCategory: '1550nm光隔离器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-910'],
    description: '1550nm光隔离器，高隔离度',
    functionalPerformance: '1550nm，隔离度>30dB，插损<0.8dB',
    referencePrice: 120.00,
    parameters: {
      wavelength: '1550nm',
      power: '500mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'OE010',
    partNumber: 'CIR-1550-3P',
    manufacturer: '欧普特',
    primaryCategory: '光环形器',
    secondaryCategory: '三端口光环形器',
    package: 'FC/PC',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['Telcordia GR-1221'],
    description: '1550nm三端口光环形器',
    functionalPerformance: '1530-1570nm，隔离度>40dB，插损<0.8dB',
    referencePrice: 280.00,
    parameters: {
      wavelength: '1530-1570nm',
      power: '300mW',
      current: '无',
      voltage: '无',
      efficiency: '无',
      response: '无',
      bandwidth: '40nm',
      temperature: '-40°C~+85°C'
    }
  }
];

const OptoelectronicSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<OptoelectronicComponent[]>(mockOptoData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<OptoelectronicComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockOptoData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      if (values.wavelength) {
        filtered = filtered.filter(item => 
          item.parameters.wavelength?.includes(values.wavelength)
        );
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockOptoData);
  };

  // 查看详情
  const handleViewDetail = (record: OptoelectronicComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 130,
      render: (text: string) => <Tag color="red">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="pink">{text}</Tag>,
    },
    {
      title: '波长',
      dataIndex: ['parameters', 'wavelength'],
      key: 'wavelength',
      width: 120,
      render: (text: string) => <Tag color="lime">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: OptoelectronicComponent, b: OptoelectronicComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '汽车级': 'purple',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: OptoelectronicComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #ff4d4f 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            光电子器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Optoelectronic Devices - 激光器、LED、光电探测器、光调制器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="光迅科技">光迅科技</Option>
                  <Option value="海光芯创">海光芯创</Option>
                  <Option value="三安光电">三安光电</Option>
                  <Option value="纵慧芯光">纵慧芯光</Option>
                  <Option value="奥普拓激光">奥普拓激光</Option>
                  <Option value="华为海思">华为海思</Option>
                  <Option value="青岛海信">青岛海信</Option>
                  <Option value="亿源通">亿源通</Option>
                  <Option value="凯普林光电">凯普林光电</Option>
                  <Option value="欧普特">欧普特</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="激光器">激光器</Option>
                  <Option value="光电探测器">光电探测器</Option>
                  <Option value="发光二极管">发光二极管</Option>
                  <Option value="垂直腔面发射激光器">垂直腔面发射激光器</Option>
                  <Option value="雪崩光电二极管">雪崩光电二极管</Option>
                  <Option value="光放大器">光放大器</Option>
                  <Option value="光调制器">光调制器</Option>
                  <Option value="波分复用器">波分复用器</Option>
                  <Option value="光隔离器">光隔离器</Option>
                  <Option value="光环形器">光环形器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="波长范围" name="wavelength">
                <Select placeholder="选择波长范围" allowClear>
                  <Option value="850">850nm</Option>
                  <Option value="940">940nm</Option>
                  <Option value="1310">1310nm</Option>
                  <Option value="1550">1550nm</Option>
                  <Option value="可见光">可见光(400-700nm)</Option>
                  <Option value="近红外">近红外(700-1700nm)</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="汽车级">汽车级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作波长">{selectedComponent.parameters.wavelength}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="响应速度">{selectedComponent.parameters.response}</Descriptions.Item>
            <Descriptions.Item label="光谱带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default OptoelectronicSearch;

```

继续修复剩余的三个文件：


```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 半导体分立器件数据类型定义
interface DiscreteComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    resistance?: string;
    capacitance?: string;
    inductance?: string;
  };
}

// 半导体分立器件测试数据
const mockDiscreteData: DiscreteComponent[] = [
  {
    id: 'DS001',
    partNumber: '1N4148W',
    manufacturer: '长电科技',
    primaryCategory: '二极管',
    secondaryCategory: '开关二极管',
    package: 'SOD-123',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: '高速开关二极管，低正向压降',
    functionalPerformance: '快速恢复时间4ns，低漏电流',
    referencePrice: 0.80,
    parameters: {
      voltage: '100V',
      current: '300mA',
      power: '500mW',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '25Ω@100mA',
      capacitance: '4pF@0V',
      inductance: '无'
    }
  },
  {
    id: 'DS002',
    partNumber: 'MMBT2222A',
    manufacturer: '华润微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN通用放大三极管',
    functionalPerformance: '高增益，低噪声，快速开关',
    referencePrice: 1.20,
    parameters: {
      voltage: '40V',
      current: '600mA',
      power: '1W',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '8pF',
      inductance: '无'
    }
  },
  {
    id: 'DS003',
    partNumber: 'IRFZ44N',
    manufacturer: '士兰微',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET，低导通阻抗',
    functionalPerformance: '55V/49A，低Rds(on)=17.5mΩ',
    referencePrice: 8.50,
    parameters: {
      voltage: '55V',
      current: '49A',
      power: '94W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '17.5mΩ',
      capacitance: '1700pF',
      inductance: '无'
    }
  },
  {
    id: 'DS004',
    partNumber: 'BZX84C5V1',
    manufacturer: '韦尔股份',
    primaryCategory: '二极管',
    secondaryCategory: '稳压二极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '5.1V稳压二极管，低动态阻抗',
    functionalPerformance: '精密稳压，温度系数低',
    referencePrice: 0.45,
    parameters: {
      voltage: '5.1V',
      current: '300mA',
      power: '1.3W',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '2Ω@5mA',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS005',
    partNumber: 'SS34',
    manufacturer: '捷捷微电',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'SMA',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基整流二极管，低正向压降',
    functionalPerformance: '快速恢复，低功耗',
    referencePrice: 0.25,
    parameters: {
      voltage: '40V',
      current: '3A',
      power: '无',
      temperature: '-65°C~+150°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS006',
    partNumber: 'AO3401A',
    manufacturer: '新洁能',
    primaryCategory: '场效应管',
    secondaryCategory: 'P沟道MOSFET',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'P沟道小信号MOSFET',
    functionalPerformance: '-30V/-4A，低Rds(on)=44mΩ',
    referencePrice: 0.95,
    parameters: {
      voltage: '-30V',
      current: '-4A',
      power: '1.4W',
      temperature: '-55°C~+150°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1050pF',
      inductance: '无'
    }
  },
  {
    id: 'DS007',
    partNumber: 'MMBT5551',
    manufacturer: '华微电子',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-750'],
    description: 'NPN高压三极管',
    functionalPerformance: '160V耐压，高增益hFE',
    referencePrice: 1.80,
    parameters: {
      voltage: '160V',
      current: '600mA',
      power: '625mW',
      temperature: '-55°C~+150°C',
      frequency: '100MHz',
      resistance: '无',
      capacitance: '4pF',
      inductance: '无'
    }
  },
  {
    id: 'DS008',
    partNumber: '1N5819',
    manufacturer: '扬杰科技',
    primaryCategory: '二极管',
    secondaryCategory: '肖特基二极管',
    package: 'DO-41',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '肖特基功率二极管',
    functionalPerformance: '40V/1A，低压降0.45V',
    referencePrice: 0.15,
    parameters: {
      voltage: '40V',
      current: '1A',
      power: '无',
      temperature: '-65°C~+125°C',
      frequency: '无',
      resistance: '无',
      capacitance: '无',
      inductance: '无'
    }
  },
  {
    id: 'DS009',
    partNumber: 'BC847C',
    manufacturer: '中芯国际',
    primaryCategory: '三极管',
    secondaryCategory: 'NPN三极管',
    package: 'SOT-23',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'NPN小信号三极管，高增益',
    functionalPerformance: '45V/100mA，hFE=420-800',
    referencePrice: 0.35,
    parameters: {
      voltage: '45V',
      current: '100mA',
      power: '250mW',
      temperature: '-55°C~+150°C',
      frequency: '300MHz',
      resistance: '无',
      capacitance: '6pF',
      inductance: '无'
    }
  },
  {
    id: 'DS010',
    partNumber: 'IRF540N',
    manufacturer: '华虹半导体',
    primaryCategory: '场效应管',
    secondaryCategory: 'N沟道MOSFET',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: 'N沟道功率MOSFET',
    functionalPerformance: '100V/33A，Rds(on)=44mΩ',
    referencePrice: 12.50,
    parameters: {
      voltage: '100V',
      current: '33A',
      power: '130W',
      temperature: '-55°C~+175°C',
      frequency: '无',
      resistance: '44mΩ',
      capacitance: '1900pF',
      inductance: '无'
    }
  }
];

const DiscreteSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<DiscreteComponent[]>(mockDiscreteData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DiscreteComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDiscreteData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDiscreteData);
  };

  // 查看详情
  const handleViewDetail = (record: DiscreteComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="volcano">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="magenta">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DiscreteComponent, b: DiscreteComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DiscreteComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #f5222d 0%, #cf1322 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            半导体分立器件
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Semiconductor Discrete Devices - 二极管、三极管、场效应管、晶闸管等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="长电科技">长电科技</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="捷捷微电">捷捷微电</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="华微电子">华微电子</Option>
                  <Option value="扬杰科技">扬杰科技</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华虹半导体">华虹半导体</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="二极管">二极管</Option>
                  <Option value="三极管">三极管</Option>
                  <Option value="场效应管">场效应管</Option>
                  <Option value="晶闸管">晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="开关二极管">开关二极管</Option>
                  <Option value="稳压二极管">稳压二极管</Option>
                  <Option value="肖特基二极管">肖特基二极管</Option>
                  <Option value="整流二极管">整流二极管</Option>
                  <Option value="NPN三极管">NPN三极管</Option>
                  <Option value="PNP三极管">PNP三极管</Option>
                  <Option value="达林顿管">达林顿管</Option>
                  <Option value="N沟道MOSFET">N沟道MOSFET</Option>
                  <Option value="P沟道MOSFET">P沟道MOSFET</Option>
                  <Option value="N沟道JFET">N沟道JFET</Option>
                  <Option value="P沟道JFET">P沟道JFET</Option>
                  <Option value="单向晶闸管">单向晶闸管</Option>
                  <Option value="双向晶闸管">双向晶闸管</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="电阻">{selectedComponent.parameters.resistance}</Descriptions.Item>
            <Descriptions.Item label="电容">{selectedComponent.parameters.capacitance}</Descriptions.Item>
            <Descriptions.Item label="功率">{selectedComponent.parameters.power}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DiscreteSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 模拟单片集成电路数据类型定义
interface AnalogComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    gain?: string;
    bandwidth?: string;
    accuracy?: string;
  };
}

// 国产模拟单片集成电路测试数据
const mockAnalogData: AnalogComponent[] = [
  {
    id: 'A001',
    partNumber: 'CA3140E',
    manufacturer: '华润微电子',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '高输入阻抗运算放大器，CMOS输入级',
    functionalPerformance: '4.5MHz增益带宽积，低失调电压',
    referencePrice: 8.50,
    parameters: {
      voltage: '±4V~±22V',
      current: '2mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '4.5MHz',
      gain: '100dB',
      bandwidth: '4.5MHz',
      accuracy: '±2mV'
    }
  },
  {
    id: 'A002',
    partNumber: 'LM358N',
    manufacturer: '士兰微',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747', 'JESD30'],
    description: '双路低功耗运算放大器',
    functionalPerformance: '单电源供电，宽共模输入范围',
    referencePrice: 3.20,
    parameters: {
      voltage: '3V~32V',
      current: '0.7mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±3mV'
    }
  },
  {
    id: 'A003',
    partNumber: 'ADC0804',
    manufacturer: '中芯国际',
    primaryCategory: '数据转换器',
    secondaryCategory: '模数转换器(ADC)',
    package: 'DIP-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60748', 'JESD22'],
    description: '8位逐次逼近型ADC，内置时钟',
    functionalPerformance: '100μs转换时间，±1/2LSB线性度',
    referencePrice: 12.80,
    parameters: {
      voltage: '5V±5%',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '640kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A004',
    partNumber: 'DAC0832',
    manufacturer: '华大半导体',
    primaryCategory: '数据转换器',
    secondaryCategory: '数模转换器(DAC)',
    package: 'DIP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位乘法型DAC，快速建立时间',
    functionalPerformance: '1μs建立时间，±1/2LSB线性度',
    referencePrice: 18.60,
    parameters: {
      voltage: '5V~15V',
      current: '2.3mA@15V',
      temperature: '-55°C~+125°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1/2LSB'
    }
  },
  {
    id: 'A005',
    partNumber: 'NE555P',
    manufacturer: '韦尔股份',
    primaryCategory: '时序电路',
    secondaryCategory: '定时器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '精密定时器，多种工作模式',
    functionalPerformance: '单稳态、双稳态、无稳态工作模式',
    referencePrice: 2.50,
    parameters: {
      voltage: '4.5V~16V',
      current: '3mA@5V',
      temperature: '-40°C~+85°C',
      frequency: '500kHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±50ppm/°C'
    }
  },
  {
    id: 'A006',
    partNumber: 'LM317T',
    manufacturer: '圣邦微电子',
    primaryCategory: '电源管理',
    secondaryCategory: '线性稳压器',
    package: 'TO-220',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '可调正电压稳压器',
    functionalPerformance: '1.25V~37V输出，1.5A输出电流',
    referencePrice: 4.80,
    parameters: {
      voltage: '3V~40V',
      current: '1.5A',
      temperature: '-55°C~+150°C',
      frequency: '无',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1%'
    }
  },
  {
    id: 'A007',
    partNumber: 'CD4017BE',
    manufacturer: '中科银河芯',
    primaryCategory: '时序电路',
    secondaryCategory: '计数器',
    package: 'DIP-16',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '十进制计数器/分频器',
    functionalPerformance: 'CMOS工艺，低功耗设计',
    referencePrice: 1.80,
    parameters: {
      voltage: '3V~18V',
      current: '0.01mA@5V',
      temperature: '-55°C~+125°C',
      frequency: '5MHz',
      gain: '无',
      bandwidth: '无',
      accuracy: '±1计数'
    }
  },
  {
    id: 'A008',
    partNumber: 'TL072CP',
    manufacturer: '芯海科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '双路JFET输入运算放大器',
    functionalPerformance: '低噪声，高输入阻抗',
    referencePrice: 6.20,
    parameters: {
      voltage: '±6V~±18V',
      current: '2.5mA@±15V',
      temperature: '-40°C~+85°C',
      frequency: '3MHz',
      gain: '106dB',
      bandwidth: '3MHz',
      accuracy: '±6mV'
    }
  },
  {
    id: 'A009',
    partNumber: 'LM324N',
    manufacturer: '新洁能',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '四路运算放大器，单电源供电',
    functionalPerformance: '低功耗，宽电源电压范围',
    referencePrice: 2.80,
    parameters: {
      voltage: '3V~32V',
      current: '0.8mA@30V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz',
      gain: '100dB',
      bandwidth: '1MHz',
      accuracy: '±7mV'
    }
  },
  {
    id: 'A010',
    partNumber: 'MC1458P',
    manufacturer: '长电科技',
    primaryCategory: '放大器类',
    secondaryCategory: '运算放大器',
    package: 'DIP-8',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '双路运算放大器，高可靠性',
    functionalPerformance: '内部频率补偿，短路保护',
    referencePrice: 15.50,
    parameters: {
      voltage: '±3V~±18V',
      current: '2.8mA@±15V',
      temperature: '-55°C~+125°C',
      frequency: '1MHz',
      gain: '94dB',
      bandwidth: '1MHz',
      accuracy: '±5mV'
    }
  }
];

const AnalogICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<AnalogComponent[]>(mockAnalogData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<AnalogComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockAnalogData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockAnalogData);
  };

  // 查看详情
  const handleViewDetail = (record: AnalogComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="purple">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: AnalogComponent, b: AnalogComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '生产中': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: AnalogComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #722ed1 0%, #531dab 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            模拟单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Analog Integrated Circuits - 运算放大器、数据转换器、电源管理、时序电路等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="士兰微">士兰微</Option>
                  <Option value="中芯国际">中芯国际</Option>
                  <Option value="华大半导体">华大半导体</Option>
                  <Option value="韦尔股份">韦尔股份</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="中科银河芯">中科银河芯</Option>
                  <Option value="芯海科技">芯海科技</Option>
                  <Option value="新洁能">新洁能</Option>
                  <Option value="长电科技">长电科技</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="放大器类">放大器类</Option>
                  <Option value="数据转换器">数据转换器</Option>
                  <Option value="时序电路">时序电路</Option>
                  <Option value="电源管理">电源管理</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="运算放大器">运算放大器</Option>
                  <Option value="仪表放大器">仪表放大器</Option>
                  <Option value="比较器">比较器</Option>
                  <Option value="模数转换器(ADC)">模数转换器(ADC)</Option>
                  <Option value="数模转换器(DAC)">数模转换器(DAC)</Option>
                  <Option value="定时器">定时器</Option>
                  <Option value="计数器">计数器</Option>
                  <Option value="振荡器">振荡器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="开关稳压器">开关稳压器</Option>
                  <Option value="电压基准">电压基准</Option>
                  <Option value="电源监控">电源监控</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="purple">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="增益">{selectedComponent.parameters.gain}</Descriptions.Item>
            <Descriptions.Item label="带宽">{selectedComponent.parameters.bandwidth}</Descriptions.Item>
            <Descriptions.Item label="精度">{selectedComponent.parameters.accuracy}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default AnalogICSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 数字单片集成电路数据类型定义
interface DigitalComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    memory?: string;
    speed?: string;
  };
}

// 国产数字单片集成电路测试数据
const mockDigitalData: DigitalComponent[] = [
  {
    id: 'D001',
    partNumber: 'GD32F407VET6',
    manufacturer: '兆易创新',
    primaryCategory: '处理器类',
    secondaryCategory: '微控制器(MCU)',
    package: 'LQFP-100',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60749', 'AEC-Q100'],
    description: '32位ARM Cortex-M4内核微控制器',
    functionalPerformance: '168MHz主频，512KB Flash，192KB SRAM',
    referencePrice: 15.80,
    parameters: {
      voltage: '2.6V~3.6V',
      current: '50mA@168MHz',
      temperature: '-40°C~+85°C',
      frequency: '168MHz',
      memory: '512KB Flash + 192KB SRAM'
    }
  },
  {
    id: 'D002',
    partNumber: 'AC7015',
    manufacturer: '复旦微电子',
    primaryCategory: '处理器类',
    secondaryCategory: '现场可编程门阵列(FPGA)',
    package: 'FBGA-484',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '低功耗FPGA芯片，适用于航天应用',
    functionalPerformance: '15K逻辑单元，36个DSP模块，抗辐照设计',
    referencePrice: 850.00,
    parameters: {
      voltage: '1.0V~1.05V',
      current: '150mA@1.0V',
      temperature: '-55°C~+125°C',
      frequency: '300MHz',
      memory: '540Kb块RAM'
    }
  },
  {
    id: 'D003',
    partNumber: 'EM636165TS',
    manufacturer: '上海华虹',
    primaryCategory: '存储器类',
    secondaryCategory: '静态随机存储器(SRAM)',
    package: 'TSOP-44',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD21-C', 'JESD79'],
    description: '16Mb高速SRAM，低功耗设计',
    functionalPerformance: '2M×8位组织，存取时间10ns',
    referencePrice: 28.50,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '90mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '16Mb'
    }
  },
  {
    id: 'D004',
    partNumber: 'BF533SBBC600',
    manufacturer: '中科昊芯',
    primaryCategory: '处理器类',
    secondaryCategory: '数字信号处理器(DSP)',
    package: 'PBGA-88',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'QJ3234'],
    description: '高性能16位定点DSP处理器',
    functionalPerformance: '600MHz主频，单周期MAC运算',
    referencePrice: 320.00,
    parameters: {
      voltage: '1.2V~1.32V',
      current: '300mA@600MHz',
      temperature: '-55°C~+125°C',
      frequency: '600MHz',
      memory: '148KB内置存储器'
    }
  },
  {
    id: 'D005',
    partNumber: 'HC574A',
    manufacturer: '华润微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '计数器/定时器',
    package: 'SOP-20',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB548B', 'MIL-STD-883'],
    description: '8位D型触发器，三态输出',
    functionalPerformance: '高速CMOS工艺，低功耗设计',
    referencePrice: 3.20,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '8mA@6V',
      temperature: '-55°C~+125°C',
      frequency: '125MHz',
      memory: '8位寄存器'
    }
  },
  {
    id: 'D006',
    partNumber: 'CSM610A',
    manufacturer: '晶晨半导体',
    primaryCategory: '时钟管理类',
    secondaryCategory: '时钟发生器',
    package: 'QFN-20',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '多路输出时钟发生器，低抖动',
    functionalPerformance: '4路输出，频率范围1MHz~200MHz',
    referencePrice: 12.50,
    parameters: {
      voltage: '2.5V~3.3V',
      current: '45mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '1MHz~200MHz',
      memory: '内置配置寄存器'
    }
  },
  {
    id: 'D007',
    partNumber: 'FM25V02A',
    manufacturer: '富满电子',
    primaryCategory: '存储器类',
    secondaryCategory: '闪存(Flash)',
    package: 'SOP-8',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['JESD216', 'IEC-60749'],
    description: '2Mb串行Flash存储器，SPI接口',
    functionalPerformance: '高速读写，100K次擦写循环',
    referencePrice: 4.80,
    parameters: {
      voltage: '2.7V~3.6V',
      current: '15mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '104MHz SPI',
      memory: '2Mb'
    }
  },
  {
    id: 'D008',
    partNumber: 'AiP8548',
    manufacturer: '爱普特微电子',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '编解码器',
    package: 'TSSOP-14',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '8位二进制译码器，低功耗CMOS',
    functionalPerformance: '3线到8线译码，使能控制功能',
    referencePrice: 1.50,
    parameters: {
      voltage: '2.0V~6.0V',
      current: '2mA@6V',
      temperature: '-40°C~+85°C',
      frequency: '100MHz',
      memory: '无'
    }
  },
  {
    id: 'D009',
    partNumber: 'PT2262',
    manufacturer: '普冉半导体',
    primaryCategory: '逻辑器件类',
    secondaryCategory: '多路复用器',
    package: 'DIP-18',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '遥控编码专用电路',
    functionalPerformance: 'CMOS工艺，12位三态地址/数据编码',
    referencePrice: 2.80,
    parameters: {
      voltage: '4V~15V',
      current: '5mA@12V',
      temperature: '-40°C~+85°C',
      frequency: '10kHz',
      memory: '12位编码'
    }
  },
  {
    id: 'D010',
    partNumber: 'SW3518S',
    manufacturer: '矽力杰',
    primaryCategory: '时钟管理类',
    secondaryCategory: '锁相环(PLL)',
    package: 'QFN-24',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '高性能时钟发生器PLL芯片',
    functionalPerformance: '低抖动，多种输出频率可选',
    referencePrice: 18.20,
    parameters: {
      voltage: '3.0V~3.6V',
      current: '35mA@3.3V',
      temperature: '-40°C~+85°C',
      frequency: '25MHz~800MHz',
      memory: '内置锁相环'
    }
  }
];

const DigitalICSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [filteredData, setFilteredData] = useState<DigitalComponent[]>(mockDigitalData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<DigitalComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockDigitalData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockDigitalData);
  };

  // 查看详情
  const handleViewDetail = (record: DigitalComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 130,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 100,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 100,
      sorter: (a: DigitalComponent, b: DigitalComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 100,
      render: (lifecycle: string) => {
        const colorMap: { [key: string]: string } = {
          '量产': 'green',
          '工程样片': 'orange',
          '停产': 'red'
        };
        return <Tag color={colorMap[lifecycle] || 'default'}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: DigitalComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            数字单片集成电路
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Digital Integrated Circuits - 微处理器、存储器、逻辑器件、信号处理等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="兆易创新">兆易创新</Option>
                  <Option value="复旦微电子">复旦微电子</Option>
                  <Option value="上海华虹">上海华虹</Option>
                  <Option value="中科昊芯">中科昊芯</Option>
                  <Option value="华润微电子">华润微电子</Option>
                  <Option value="晶晨半导体">晶晨半导体</Option>
                  <Option value="富满电子">富满电子</Option>
                  <Option value="爱普特微电子">爱普特微电子</Option>
                  <Option value="普冉半导体">普冉半导体</Option>
                  <Option value="矽力杰">矽力杰</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="处理器类">处理器类</Option>
                  <Option value="存储器类">存储器类</Option>
                  <Option value="逻辑器件类">逻辑器件类</Option>
                  <Option value="时钟管理类">时钟管理类</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="二级分类" name="secondaryCategory">
                <Select placeholder="选择二级分类" allowClear>
                  <Option value="微处理器(CPU)">微处理器(CPU)</Option>
                  <Option value="微控制器(MCU)">微控制器(MCU)</Option>
                  <Option value="数字信号处理器(DSP)">数字信号处理器(DSP)</Option>
                  <Option value="现场可编程门阵列(FPGA)">现场可编程门阵列(FPGA)</Option>
                  <Option value="静态随机存储器(SRAM)">静态随机存储器(SRAM)</Option>
                  <Option value="动态随机存储器(DRAM)">动态随机存储器(DRAM)</Option>
                  <Option value="闪存(Flash)">闪存(Flash)</Option>
                  <Option value="只读存储器(ROM)">只读存储器(ROM)</Option>
                  <Option value="门电路">门电路</Option>
                  <Option value="计数器/定时器">计数器/定时器</Option>
                  <Option value="编解码器">编解码器</Option>
                  <Option value="多路复用器">多路复用器</Option>
                  <Option value="晶振">晶振</Option>
                  <Option value="时钟发生器">时钟发生器</Option>
                  <Option value="锁相环(PLL)">锁相环(PLL)</Option>
                  <Option value="时钟分配器">时钟分配器</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="量产">量产</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1200 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="blue">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="工作电压">{selectedComponent.parameters.voltage}</Descriptions.Item>
            <Descriptions.Item label="工作电流">{selectedComponent.parameters.current}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
            <Descriptions.Item label="工作频率">{selectedComponent.parameters.frequency}</Descriptions.Item>
            <Descriptions.Item label="存储容量">{selectedComponent.parameters.memory}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default DigitalICSearch;

```

检查并修复 PowerSearch.tsx：


修复 PowerSearch.tsx 中未使用的导入：


```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Divider,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 电能源数据类型定义
interface PowerComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    inputVoltage?: string;
    outputVoltage?: string;
    outputCurrent?: string;
    power?: string;
    efficiency?: string;
    ripple?: string;
    regulation?: string;
    temperature?: string;
  };
}

// 电能源测试数据
const mockPowerData: PowerComponent[] = [
  {
    id: 'PS001',
    partNumber: 'PSU-24V-100W',
    manufacturer: '英飞凌',
    primaryCategory: '开关电源',
    secondaryCategory: 'AC-DC电源模块',
    package: '金属外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60950', 'UL1950'],
    description: '24V/100W开关电源模块',
    functionalPerformance: '85-264VAC输入，24VDC/4.2A输出',
    referencePrice: 180.00,
    parameters: {
      inputVoltage: '85-264VAC',
      outputVoltage: '24VDC',
      outputCurrent: '4.2A',
      power: '100W',
      efficiency: '85%',
      ripple: '<100mVpp',
      regulation: '±1%',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'PS002',
    partNumber: 'DCDC-12V-50W',
    manufacturer: '中航光电',
    primaryCategory: 'DC-DC转换器',
    secondaryCategory: '隔离DC-DC模块',
    package: 'DIP-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB151B', 'MIL-STD-461'],
    description: '28V转12V隔离DC-DC转换器',
    functionalPerformance: '18-36VDC输入，12VDC/4.2A输出，隔离3kV',
    referencePrice: 320.00,
    parameters: {
      inputVoltage: '18-36VDC',
      outputVoltage: '12VDC',
      outputCurrent: '4.2A',
      power: '50W',
      efficiency: '88%',
      ripple: '<50mVpp',
      regulation: '±0.5%',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'PS003',
    partNumber: 'LDO-3V3-1A',
    manufacturer: '圣邦微电子',
    primaryCategory: '线性稳压器',
    secondaryCategory: 'LDO稳压器',
    package: 'SOT-223',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '3.3V/1A低压差线性稳压器',
    functionalPerformance: '4.5-20V输入，3.3V/1A输出，压差0.3V',
    referencePrice: 2.50,
    parameters: {
      inputVoltage: '4.5-20VDC',
      outputVoltage: '3.3VDC',
      outputCurrent: '1A',
      power: '3.3W',
      efficiency: '65%',
      ripple: '<20mVpp',
      regulation: '±2%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'PS004',
    partNumber: 'UPS-500VA-Online',
    manufacturer: '山特电子',
    primaryCategory: 'UPS电源',
    secondaryCategory: '在线式UPS',
    package: '机架式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62040'],
    description: '500VA在线式UPS不间断电源',
    functionalPerformance: '220VAC输入，220VAC输出，后备时间15分钟',
    referencePrice: 1200.00,
    parameters: {
      inputVoltage: '220VAC',
      outputVoltage: '220VAC',
      outputCurrent: '2.3A',
      power: '500VA',
      efficiency: '90%',
      ripple: '<3%',
      regulation: '±1%',
      temperature: '0°C~+40°C'
    }
  },
  {
    id: 'PS005',
    partNumber: 'INV-12V-300W',
    manufacturer: '正弦电气',
    primaryCategory: '逆变器',
    secondaryCategory: '正弦波逆变器',
    package: '铝合金外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61683'],
    description: '12V转220V纯正弦波逆变器',
    functionalPerformance: '12VDC输入，220VAC输出，THD<3%',
    referencePrice: 280.00,
    parameters: {
      inputVoltage: '12VDC',
      outputVoltage: '220VAC',
      outputCurrent: '1.4A',
      power: '300W',
      efficiency: '90%',
      ripple: '<3%',
      regulation: '±5%',
      temperature: '-10°C~+50°C'
    }
  },
  {
    id: 'PS006',
    partNumber: 'CHG-LiPo-4S',
    manufacturer: '欣旺达',
    primaryCategory: '电池充电器',
    secondaryCategory: '锂电池充电器',
    package: 'PCB模块',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62133'],
    description: '4S锂电池平衡充电器',
    functionalPerformance: '12-24V输入，16.8V/2A输出，带平衡功能',
    referencePrice: 85.00,
    parameters: {
      inputVoltage: '12-24VDC',
      outputVoltage: '16.8VDC',
      outputCurrent: '2A',
      power: '33.6W',
      efficiency: '85%',
      ripple: '<50mVpp',
      regulation: '±1%',
      temperature: '0°C~+45°C'
    }
  },
  {
    id: 'PS007',
    partNumber: 'SOLAR-100W-MPPT',
    manufacturer: '晶澳太阳能',
    primaryCategory: '太阳能控制器',
    secondaryCategory: 'MPPT控制器',
    package: '防水外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61215'],
    description: '100W MPPT太阳能充电控制器',
    functionalPerformance: '12/24V系统，最大功率点跟踪，效率>97%',
    referencePrice: 450.00,
    parameters: {
      inputVoltage: '12-50VDC',
      outputVoltage: '12/24VDC',
      outputCurrent: '8A',
      power: '100W',
      efficiency: '97%',
      ripple: '<100mVpp',
      regulation: '±2%',
      temperature: '-35°C~+60°C'
    }
  },
  {
    id: 'PS008',
    partNumber: 'EMI-Filter-10A',
    manufacturer: '德力西',
    primaryCategory: 'EMI滤波器',
    secondaryCategory: '电源线滤波器',
    package: '金属外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60939'],
    description: '10A单相电源线EMI滤波器',
    functionalPerformance: '250VAC/10A，插损>40dB@150kHz-30MHz',
    referencePrice: 65.00,
    parameters: {
      inputVoltage: '250VAC',
      outputVoltage: '250VAC',
      outputCurrent: '10A',
      power: '2500W',
      efficiency: '99%',
      ripple: '无',
      regulation: '无',
      temperature: '-25°C~+85°C'
    }
  }
];

const PowerSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<PowerComponent[]>(mockPowerData);
  const [filteredData, setFilteredData] = useState<PowerComponent[]>(mockPowerData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<PowerComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockPowerData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockPowerData);
  };

  // 查看详情
  const handleViewDetail = (record: PowerComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="gold">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '输出功率',
      dataIndex: ['parameters', 'power'],
      key: 'power',
      width: 100,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: PowerComponent, b: PowerComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: PowerComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            电能源
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Power Sources - 开关电源、DC-DC转换器、UPS、逆变器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="英飞凌">英飞凌</Option>
                  <Option value="中航光电">中航光电</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="山特电子">山特电子</Option>
                  <Option value="正弦电气">正弦电气</Option>
                  <Option value="欣旺达">欣旺达</Option>
                  <Option value="晶澳太阳能">晶澳太阳能</Option>
                  <Option value="德力西">德力西</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="开关电源">开关电源</Option>
                  <Option value="DC-DC转换器">DC-DC转换器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="UPS电源">UPS电源</Option>
                  <Option value="逆变器">逆变器</Option>
                  <Option value="电池充电器">电池充电器</Option>
                  <Option value="太阳能控制器">太阳能控制器</Option>
                  <Option value="EMI滤波器">EMI滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="输入电压">{selectedComponent.parameters.inputVoltage}</Descriptions.Item>
            <Descriptions.Item label="输出电压">{selectedComponent.parameters.outputVoltage}</Descriptions.Item>
            <Descriptions.Item label="输出电流">{selectedComponent.parameters.outputCurrent}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="纹波噪声">{selectedComponent.parameters.ripple}</Descriptions.Item>
            <Descriptions.Item label="负载调整率">{selectedComponent.parameters.regulation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default PowerSearch;

```

```typescriptreact
import React, { useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
} from 'antd';
import {
  SearchOutlined,
  FilterOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
} from '@ant-design/icons';

const { Option } = Select;

// 电能源数据类型定义
interface PowerComponent {
  id: string;
  partNumber: string;
  manufacturer: string;
  primaryCategory: string;  // 一级分类
  secondaryCategory: string; // 二级分类
  package: string;
  qualityLevel: string;
  lifecycle: string;
  standards: string[];
  description: string;
  functionalPerformance: string;
  referencePrice: number;
  parameters: {
    inputVoltage?: string;
    outputVoltage?: string;
    outputCurrent?: string;
    power?: string;
    efficiency?: string;
    ripple?: string;
    regulation?: string;
    temperature?: string;
  };
}

// 电能源测试数据
const mockPowerData: PowerComponent[] = [
  {
    id: 'PS001',
    partNumber: 'PSU-24V-100W',
    manufacturer: '英飞凌',
    primaryCategory: '开关电源',
    secondaryCategory: 'AC-DC电源模块',
    package: '金属外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60950', 'UL1950'],
    description: '24V/100W开关电源模块',
    functionalPerformance: '85-264VAC输入，24VDC/4.2A输出',
    referencePrice: 180.00,
    parameters: {
      inputVoltage: '85-264VAC',
      outputVoltage: '24VDC',
      outputCurrent: '4.2A',
      power: '100W',
      efficiency: '85%',
      ripple: '<100mVpp',
      regulation: '±1%',
      temperature: '-20°C~+70°C'
    }
  },
  {
    id: 'PS002',
    partNumber: 'DCDC-12V-50W',
    manufacturer: '中航光电',
    primaryCategory: 'DC-DC转换器',
    secondaryCategory: '隔离DC-DC模块',
    package: 'DIP-24',
    qualityLevel: '军用级',
    lifecycle: '生产中',
    standards: ['GJB151B', 'MIL-STD-461'],
    description: '28V转12V隔离DC-DC转换器',
    functionalPerformance: '18-36VDC输入，12VDC/4.2A输出，隔离3kV',
    referencePrice: 320.00,
    parameters: {
      inputVoltage: '18-36VDC',
      outputVoltage: '12VDC',
      outputCurrent: '4.2A',
      power: '50W',
      efficiency: '88%',
      ripple: '<50mVpp',
      regulation: '±0.5%',
      temperature: '-55°C~+85°C'
    }
  },
  {
    id: 'PS003',
    partNumber: 'LDO-3V3-1A',
    manufacturer: '圣邦微电子',
    primaryCategory: '线性稳压器',
    secondaryCategory: 'LDO稳压器',
    package: 'SOT-223',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60747'],
    description: '3.3V/1A低压差线性稳压器',
    functionalPerformance: '4.5-20V输入，3.3V/1A输出，压差0.3V',
    referencePrice: 2.50,
    parameters: {
      inputVoltage: '4.5-20VDC',
      outputVoltage: '3.3VDC',
      outputCurrent: '1A',
      power: '3.3W',
      efficiency: '65%',
      ripple: '<20mVpp',
      regulation: '±2%',
      temperature: '-40°C~+85°C'
    }
  },
  {
    id: 'PS004',
    partNumber: 'UPS-500VA-Online',
    manufacturer: '山特电子',
    primaryCategory: 'UPS电源',
    secondaryCategory: '在线式UPS',
    package: '机架式',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62040'],
    description: '500VA在线式UPS不间断电源',
    functionalPerformance: '220VAC输入，220VAC输出，后备时间15分钟',
    referencePrice: 1200.00,
    parameters: {
      inputVoltage: '220VAC',
      outputVoltage: '220VAC',
      outputCurrent: '2.3A',
      power: '500VA',
      efficiency: '90%',
      ripple: '<3%',
      regulation: '±1%',
      temperature: '0°C~+40°C'
    }
  },
  {
    id: 'PS005',
    partNumber: 'INV-12V-300W',
    manufacturer: '正弦电气',
    primaryCategory: '逆变器',
    secondaryCategory: '正弦波逆变器',
    package: '铝合金外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61683'],
    description: '12V转220V纯正弦波逆变器',
    functionalPerformance: '12VDC输入，220VAC输出，THD<3%',
    referencePrice: 280.00,
    parameters: {
      inputVoltage: '12VDC',
      outputVoltage: '220VAC',
      outputCurrent: '1.4A',
      power: '300W',
      efficiency: '90%',
      ripple: '<3%',
      regulation: '±5%',
      temperature: '-10°C~+50°C'
    }
  },
  {
    id: 'PS006',
    partNumber: 'CHG-LiPo-4S',
    manufacturer: '欣旺达',
    primaryCategory: '电池充电器',
    secondaryCategory: '锂电池充电器',
    package: 'PCB模块',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-62133'],
    description: '4S锂电池平衡充电器',
    functionalPerformance: '12-24V输入，16.8V/2A输出，带平衡功能',
    referencePrice: 85.00,
    parameters: {
      inputVoltage: '12-24VDC',
      outputVoltage: '16.8VDC',
      outputCurrent: '2A',
      power: '33.6W',
      efficiency: '85%',
      ripple: '<50mVpp',
      regulation: '±1%',
      temperature: '0°C~+45°C'
    }
  },
  {
    id: 'PS007',
    partNumber: 'SOLAR-100W-MPPT',
    manufacturer: '晶澳太阳能',
    primaryCategory: '太阳能控制器',
    secondaryCategory: 'MPPT控制器',
    package: '防水外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-61215'],
    description: '100W MPPT太阳能充电控制器',
    functionalPerformance: '12/24V系统，最大功率点跟踪，效率>97%',
    referencePrice: 450.00,
    parameters: {
      inputVoltage: '12-50VDC',
      outputVoltage: '12/24VDC',
      outputCurrent: '8A',
      power: '100W',
      efficiency: '97%',
      ripple: '<100mVpp',
      regulation: '±2%',
      temperature: '-35°C~+60°C'
    }
  },
  {
    id: 'PS008',
    partNumber: 'EMI-Filter-10A',
    manufacturer: '德力西',
    primaryCategory: 'EMI滤波器',
    secondaryCategory: '电源线滤波器',
    package: '金属外壳',
    qualityLevel: '工业级',
    lifecycle: '生产中',
    standards: ['IEC-60939'],
    description: '10A单相电源线EMI滤波器',
    functionalPerformance: '250VAC/10A，插损>40dB@150kHz-30MHz',
    referencePrice: 65.00,
    parameters: {
      inputVoltage: '250VAC',
      outputVoltage: '250VAC',
      outputCurrent: '10A',
      power: '2500W',
      efficiency: '99%',
      ripple: '无',
      regulation: '无',
      temperature: '-25°C~+85°C'
    }
  }
];

const PowerSearch: React.FC = () => {
  const [searchParams] = useSearchParams();
  const [form] = Form.useForm();
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState<PowerComponent[]>(mockPowerData);
  const [filteredData, setFilteredData] = useState<PowerComponent[]>(mockPowerData);
  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<PowerComponent | null>(null);

  // 搜索处理
  const handleSearch = (values: any) => {
    setLoading(true);
    
    setTimeout(() => {
      let filtered = mockPowerData;
      
      if (values.partNumber) {
        filtered = filtered.filter(item => 
          item.partNumber.toLowerCase().includes(values.partNumber.toLowerCase())
        );
      }
      
      if (values.manufacturer) {
        filtered = filtered.filter(item => item.manufacturer === values.manufacturer);
      }
      
      if (values.primaryCategory) {
        filtered = filtered.filter(item => item.primaryCategory === values.primaryCategory);
      }
      
      if (values.secondaryCategory) {
        filtered = filtered.filter(item => item.secondaryCategory === values.secondaryCategory);
      }
      
      setFilteredData(filtered);
      setLoading(false);
    }, 1000);
  };

  // 重置搜索
  const handleReset = () => {
    form.resetFields();
    setFilteredData(mockPowerData);
  };

  // 查看详情
  const handleViewDetail = (record: PowerComponent) => {
    setSelectedComponent(record);
    setDetailModalVisible(true);
  };

  // 表格列定义
  const columns = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      render: (text: string) => <strong style={{ color: '#1890ff' }}>{text}</strong>,
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 120,
      render: (text: string) => <Tag color="gold">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 140,
      render: (text: string) => <Tag color="orange">{text}</Tag>,
    },
    {
      title: '输出功率',
      dataIndex: ['parameters', 'power'],
      key: 'power',
      width: 100,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 200,
      ellipsis: true,
      render: (text: string) => (
        <Tooltip title={text}>
          <span>{text}</span>
        </Tooltip>
      ),
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 120,
      sorter: (a: PowerComponent, b: PowerComponent) => a.referencePrice - b.referencePrice,
      render: (price: number) => {
        if (price === 0) {
          return <span style={{ color: '#999' }}>-</span>;
        }
        return <span style={{ color: '#1890ff', fontWeight: 'bold' }}>¥{price.toFixed(2)}</span>;
      },
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 100,
      render: (level: string) => {
        const colorMap: { [key: string]: string } = {
          '宇航级': 'red',
          '军用级': 'orange',
          '工业级': 'blue',
          '商用级': 'green'
        };
        return <Tag color={colorMap[level] || 'default'}>{level}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 150,
      render: (_: any, record: PowerComponent) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="link"
              icon={<EyeOutlined />}
              onClick={() => handleViewDetail(record)}
            />
          </Tooltip>
          <Tooltip title="对比">
            <Button
              type="link"
              icon={<SwapOutlined />}
            />
          </Tooltip>
          <Tooltip title="加入选型">
            <Button
              type="link"
              icon={<ShoppingCartOutlined />}
              style={{ color: '#52c41a' }}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #52c41a 0%, #389e0d 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            电能源
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            Power Sources - 开关电源、DC-DC转换器、UPS、逆变器等
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      <Card title="器件查询" extra={<FilterOutlined />}>
        <Form
          form={form}
          layout="vertical"
          onFinish={handleSearch}
        >
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="制造商" name="manufacturer">
                <Select placeholder="选择制造商" allowClear>
                  <Option value="英飞凌">英飞凌</Option>
                  <Option value="中航光电">中航光电</Option>
                  <Option value="圣邦微电子">圣邦微电子</Option>
                  <Option value="山特电子">山特电子</Option>
                  <Option value="正弦电气">正弦电气</Option>
                  <Option value="欣旺达">欣旺达</Option>
                  <Option value="晶澳太阳能">晶澳太阳能</Option>
                  <Option value="德力西">德力西</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="一级分类" name="primaryCategory">
                <Select placeholder="选择一级分类" allowClear>
                  <Option value="开关电源">开关电源</Option>
                  <Option value="DC-DC转换器">DC-DC转换器</Option>
                  <Option value="线性稳压器">线性稳压器</Option>
                  <Option value="UPS电源">UPS电源</Option>
                  <Option value="逆变器">逆变器</Option>
                  <Option value="电池充电器">电池充电器</Option>
                  <Option value="太阳能控制器">太阳能控制器</Option>
                  <Option value="EMI滤波器">EMI滤波器</Option>
                </Select>
              </Form.Item>
            </Col>
            <Col span={6}>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                  <Option value="商用级">商用级</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row gutter={16}>
            <Col span={6}>
              <Form.Item label="生命周期" name="lifecycle">
                <Select placeholder="选择生命周期" allowClear>
                  <Option value="生产中">生产中</Option>
                  <Option value="工程样片">工程样片</Option>
                  <Option value="停产">停产</Option>
                </Select>
              </Form.Item>
            </Col>
          </Row>
          
          <Row>
            <Col span={24}>
              <Space>
                <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                  搜索
                </Button>
                <Button onClick={handleReset}>
                  重置
                </Button>
              </Space>
            </Col>
          </Row>
        </Form>
      </Card>

      <Card
        title={`搜索结果 (${filteredData.length})`}
        style={{ marginTop: 16 }}
        extra={
          <Space>
            <span>已选择 {selectedRowKeys.length} 项</span>
            <Button type="primary" disabled={selectedRowKeys.length === 0}>
              批量对比
            </Button>
          </Space>
        }
      >
        <Table
          columns={columns}
          dataSource={filteredData}
          rowKey="id"
          loading={loading}
          scroll={{ x: 1300 }}
          rowSelection={{
            selectedRowKeys,
            onChange: setSelectedRowKeys,
            preserveSelectedRowKeys: true,
          }}
          pagination={{
            total: filteredData.length,
            pageSize: 10,
            showSizeChanger: true,
            showQuickJumper: true,
            showTotal: (total, range) => `第 ${range[0]}-${range[1]} 条，共 ${total} 条记录`,
          }}
        />
      </Card>

      {/* 详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={null}
        width={800}
      >
        {selectedComponent && (
          <Descriptions bordered column={2}>
            <Descriptions.Item label="器件型号" span={2}>
              <strong style={{ fontSize: '16px', color: '#1890ff' }}>
                {selectedComponent.partNumber}
              </strong>
            </Descriptions.Item>
            <Descriptions.Item label="制造商">{selectedComponent.manufacturer}</Descriptions.Item>
            <Descriptions.Item label="参考价格">
              {selectedComponent.referencePrice === 0 ? (
                <span style={{ color: '#999' }}>暂无报价</span>
              ) : (
                <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
                  ¥{selectedComponent.referencePrice.toFixed(2)}
                </span>
              )}
            </Descriptions.Item>
            <Descriptions.Item label="一级分类">{selectedComponent.primaryCategory}</Descriptions.Item>
            <Descriptions.Item label="二级分类">{selectedComponent.secondaryCategory}</Descriptions.Item>
            <Descriptions.Item label="封装形式">{selectedComponent.package}</Descriptions.Item>
            <Descriptions.Item label="质量等级">{selectedComponent.qualityLevel}</Descriptions.Item>
            <Descriptions.Item label="生命周期">{selectedComponent.lifecycle}</Descriptions.Item>
            <Descriptions.Item label="适用标准">
              <Space wrap>
                {selectedComponent.standards.map(std => (
                  <Tag key={std} color="volcano">{std}</Tag>
                ))}
              </Space>
            </Descriptions.Item>
            <Descriptions.Item label="器件描述" span={2}>
              {selectedComponent.description}
            </Descriptions.Item>
            <Descriptions.Item label="功能性能" span={2}>
              {selectedComponent.functionalPerformance}
            </Descriptions.Item>
            <Descriptions.Item label="输入电压">{selectedComponent.parameters.inputVoltage}</Descriptions.Item>
            <Descriptions.Item label="输出电压">{selectedComponent.parameters.outputVoltage}</Descriptions.Item>
            <Descriptions.Item label="输出电流">{selectedComponent.parameters.outputCurrent}</Descriptions.Item>
            <Descriptions.Item label="输出功率">{selectedComponent.parameters.power}</Descriptions.Item>
            <Descriptions.Item label="转换效率">{selectedComponent.parameters.efficiency}</Descriptions.Item>
            <Descriptions.Item label="纹波噪声">{selectedComponent.parameters.ripple}</Descriptions.Item>
            <Descriptions.Item label="负载调整率">{selectedComponent.parameters.regulation}</Descriptions.Item>
            <Descriptions.Item label="工作温度">{selectedComponent.parameters.temperature}</Descriptions.Item>
          </Descriptions>
        )}
      </Modal>
    </div>
  );
};

export default PowerSearch;

```

所有 linter 错误已修复。检查是否还有其他未使用的导入：


所有 linter 错误已修复。修复内容：

1. **API 响应类型兼容**：在 `UserList.tsx`、`TenantList.tsx`、`OfficeList.tsx` 中处理 API 可能返回数组或分页对象的情况
2. **删除未使用的变量**：移除了所有搜索组件中未使用的 `data` 变量（`GeneralSearch`、`ElectromechanicalSearch`、`HybridICSearch`、`MicrosystemsSearch`、`MicrowaveSearch`、`OptoelectronicSearch`、`DiscreteSearch`、`AnalogICSearch`、`DigitalICSearch`）
3. **清理未使用的导入**：移除了未使用的 `useEffect` 和 `Divider` 导入

当前没有 linter 错误。代码已清理并符合 TypeScript 和 ESLint 规范。

---

**User**

========================================
启动 MongoDB (使用本地数据目录)
========================================

✅ 配置检查通过

📁 数据目录: F:\Business_plat\backend\data
📝 日志文件: F:\Business_plat\backend\logs\mongod.log
📋 配置文件: F:\Business_plat\backend\mongod.conf

⚠️  检测到 MongoDB Windows 服务正在运行
   服务使用数据目录: E:\data\db
   项目配置数据目录: F:\Business_plat\backend\data

正在停止 Windows 服务以使用本地配置...
System error 5 has occurred.

Access is denied.

✅ Windows 服务已停止

⚠️  警告: 端口 27017 仍被占用，等待 5 秒后重试...
❌ 端口仍被占用，请手动检查并关闭占用端口的进程
Press any key to continue . . .

我在CMD命令行中

告诉我i步骤，我自己在命令行操作

---

**Cursor**

了解。按照下面步骤在 CMD 里操作即可：

1. **确认 27017 被谁占用**  
   运行：
   ```
   netstat -ano | findstr 27017
   ```
   记下 `PID`。

2. **结束对应进程**  
   如果是后台 mongod，可以直接结束：
   ```
   taskkill /PID <PID> /F
   ```
   若提示权限不足，需要以管理员身份重新打开 CMD。

3. **确保 Windows MongoDB 服务已停**  
   ```
   sc query MongoDB
   ```
   如果 `STATE` 不是 `STOPPED`：
   ```
   net stop MongoDB
   ```

4. **启动项目自带的 MongoDB**  
   在项目根目录 `F:\Business_plat`：
   ```
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
   ```
   （如果脚本名不同，用你们的启动脚本；核心是 `mongod --config backend\mongod.conf`）

5. **确认启动成功**  
   看到日志提示 `waiting for connections on port 27017` 即完成；也可用：
   ```
   mongo --eval "db.runCommand({ping:1})"
   ```
   返回 `ok: 1` 表示正常。

如果某一步出错，把错误信息贴出来，我再帮你判断下一步。

```plaintext
   netstat -ano | findstr 27017
```

```plaintext
   taskkill /PID <PID> /F
```

```plaintext
   sc query MongoDB
```

```plaintext
   net stop MongoDB
```

```plaintext
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
```

```plaintext
   mongo --eval "db.runCommand({ping:1})"
```

---

**User**

(space_env) F:\Business_plat\backend>netstat -ano | findstr 27017
  TCP    127.0.0.1:27017        0.0.0.0:0              LISTENING       5812
  TCP    127.0.0.1:27017        127.0.0.1:49716        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49717        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49718        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49719        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49720        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49721        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49722        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49724        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49725        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:49738        ESTABLISHED     5812
  TCP    127.0.0.1:27017        127.0.0.1:59662        ESTABLISHED     5812
  TCP    127.0.0.1:49716        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49717        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49718        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49719        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49720        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49721        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49722        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49724        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49725        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:49738        127.0.0.1:27017        ESTABLISHED     4384
  TCP    127.0.0.1:59662        127.0.0.1:27017        ESTABLISHED     4384

(space_env) F:\Business_plat\backend>

---

**Cursor**

端口 27017 目前被 PID 5812 和 4384 占用（5812 为监听进程，4384 为客户端连接）。接下来这样处理：

1. 查询它们是什么进程（可选但建议）：
   ```
   tasklist | findstr 5812
   tasklist | findstr 4384
   ```

2. 如果确认它们就是之前残留的 mongod 或相关工具，直接结束：
   ```
   taskkill /PID 5812 /F
   taskkill /PID 4384 /F
   ```
   若提示拒绝访问，请用管理员 CMD 再执行。

3. 结束后再运行一次：
   ```
   netstat -ano | findstr 27017
   ```
   确认端口空闲。如果已经没有输出，端口释放成功。

4. 然后在 `F:\Business_plat` 目录重新启动项目里的 MongoDB（例如：
   ```
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
   ```
   具体脚本按你们项目的为准）。

执行过程中如果有报错，把信息贴上来我再帮你看。

```plaintext
   tasklist | findstr 5812
   tasklist | findstr 4384
```

```plaintext
   taskkill /PID 5812 /F
   taskkill /PID 4384 /F
```

```plaintext
   netstat -ano | findstr 27017
```

```plaintext
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
```

---

**User**

(space_env) F:\Business_plat\backend>tasklist | findstr 5812
mongod.exe                    5812 Services                   0    172,604 K

(space_env) F:\Business_plat\backend>tasklist | findstr 4384
MongoDBCompass.exe            4384 Console                    2    275,164 K

(space_env) F:\Business_plat\backend>

---

**Cursor**

看到了：`mongod.exe` 是服务进程（PID 5812），`MongoDBCompass.exe` 是连接客户端（PID 4384）。要释放端口：

1. **先关掉 Compass**（如果你需要使用它，等重启 MongoDB 后再打开）：
   ```
   taskkill /PID 4384 /F
   ```

2. **停止当前 mongod 服务**：
   ```
   taskkill /PID 5812 /F
   ```
   如果提示需要管理员权限，请在管理员 CMD 里重复执行。

3. **确认端口已释放**：
   ```
   netstat -ano | findstr 27017
   ```
   没有输出表示 27017 空闲，可以启动你的 MongoDB。

4. **回到项目根目录，重启 MongoDB**（示例命令，按你们脚本调整）：
   ```
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
   ```

启动成功后再打开 Compass 即可连上。途中有任何报错告诉我。

```plaintext
   taskkill /PID 4384 /F
```

```plaintext
   taskkill /PID 5812 /F
```

```plaintext
   netstat -ano | findstr 27017
```

```plaintext
   cd /d F:\Business_plat
   backend\start-mongodb-local.bat
```

---

**User**

(space_env) F:\Business_plat\backend>netstat -ano | findstr 27017
  TCP    127.0.0.1:27017        0.0.0.0:0              LISTENING       5812

(space_env) F:\Business_plat\backend>

---

**Cursor**

5812 的 `mongod.exe` 还在监听，需要停掉：

1. （若还没执行）先关掉 Compass：`taskkill /PID 4384 /F`
2. 停止服务：`taskkill /PID 5812 /F` 或者用 `net stop MongoDB`（需管理员权限）
3. 再次 `netstat -ano | findstr 27017`，确认端口空

确认端口空闲后，再去项目根目录重新启动 MongoDB。

---

**User**

把目前的进展更新到@DoEEEt功能开发总览.md 和@DoEEEt集成实施总结.md 中

---

**Cursor**

```markdown
 DoEEEt 功能开发总览

## 📋 项目概述

DoEEEt（Defense & Aerospace Electronic Equipment Database）是一个专门用于航空航天电子器件的数据库系统，包含了15个顶层分类、181个叶子分类、360个动态参数的完整电子元器件数据。

本文档总览了 DoEEEt 功能的开发进度和实施计划。

---

## 🎯 核心功能模块

### 1. ✅ 分类筛选功能（已完成 100%）

**功能描述**：
- 15个顶层分类展示（Microcircuits, Capacitors, Connectors 等）
- 2-5层深度的分类层级导航
- 双重交互方式：级联选择器 + Tab侧边栏

**技术实现**：
- 后端：`buildCategoryTree()` 服务 + Redis缓存
- 前端：`CategoryFilter` 组件（Cascader + Tabs）
- API：`/api/doeeet/categories/tree`

**文档**：
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md)
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md)

**状态**: ✅ 已完成（2025-10-31）

---

### 2. ✅ 动态参数表头（已完成 100%）

**功能描述**：
- 智能表头展示（有 `short_name` 显示简写 + Tooltip，无则显示完整名称）
- HTML标签支持（下标 `<sub>`、上标 `<sup>`）
- 360个动态参数的灵活展示

**技术实现**：
- 工具函数库：`parameterUtils.tsx`
- 8个核心函数：生成列、分组、导出CSV等
- 安全防护：DOMPurify清理HTML

**文档**：
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)

**示例代码**：
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

**状态**: ✅ 已集成到 `ComponentSearch` 页面（2025-10-31）

#### 🆕 表头与固定参数规范（概述）
- 表头规则：有 `short_name` → 显示“✖ short_name”且 Hover 显示完整 `name`；无 `short_name` → 直接显示 `name`。
- 固定参数：`Package` 与 `TOP (Operating Temperature)` 固定两列、固定顺序展示；名称从 `parameter_definitions`，取值从 `parameters`（按 `component_id + parameter_key`）。
- 聚合输出：后端统一返回 `static`（基础信息）、`fixedExtras`（Package/TOP）、`dynamic`（按 `meta.json` 顺序），空值用 “--”。

---

### 3. ⏳ 组件搜索功能（进行中 40%）

**功能描述**：
- 关键词搜索（器件型号、制造商）
- 分类筛选（集成 CategoryFilter）
- 参数范围筛选（电压、温度等）
- 分页、排序、导出

**待实施任务**：
- [x] 集成 CategoryFilter 到 ComponentSearch 页面
- [x] 集成动态参数表头到搜索结果
- [ ] 实现参数范围筛选
- [ ] 优化搜索性能

**状态**: ⏳ 进行中

---

### 4. ⏳ 动态参数筛选器（计划中 0%）

**功能描述**：
- 根据选择的分类，动态显示该分类的参数筛选器
- 支持范围筛选（数值型参数）
- 支持枚举筛选（离散值参数）

**实现思路**：
```tsx
// 监听分类变化
useEffect(() => {
  if (selectedCategory.length > 0) {
    loadDynamicParameters(selectedCategory);
  }
}, [selectedCategory]);

// 加载该分类的参数配置
const loadDynamicParameters = async (categoryPath: string[]) => {
  const response = await fetch(`/api/doeeet/category-meta/${encodeURIComponent(JSON.stringify(categoryPath))}`);
  const result = await response.json();
  setDynamicParams(result.data.meta);
};

// 渲染动态筛选器
<DynamicParameterFilter
  parameters={dynamicParams}
  onParameterChange={handleParameterChange}
/>
```

**状态**: ⏳ 计划中

---

### 5. ⏳ 组件详情页（计划中 20%）

**功能描述**：
- 基本信息展示（型号、制造商、封装等）
- 参数列表（分类展示）
- 数据表文档（Datasheet）
- 供应商信息
- 辐照测试数据

**待实施任务**：
- [ ] 完善参数详情展示（使用 parameterUtils）
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据展示
- [ ] 实现替代品推荐

**状态**: ⏳ 计划中

---

## 📊 开发进度总览

| 功能模块 | 进度 | 状态 | 预计完成时间 |
|---------|------|------|-------------|
| 分类筛选功能 | 100% | ✅ 完成 | 2025-10-31 |
| 动态参数表头 | 75% | ✅ 核心完成 | 2025-11-01 |
| 组件搜索功能 | 40% | ⏳ 进行中 | 2025-11-03 |
| 动态参数筛选器 | 0% | ⏳ 计划中 | 2025-11-05 |
| 组件详情页 | 20% | ⏳ 计划中 | 2025-11-07 |
| 组件对比功能 | 0% | 📋 待规划 | TBD |
| 替代品推荐 | 0% | 📋 待规划 | TBD |
| 批量导入/导出 | 0% | 📋 待规划 | TBD |

**整体进度**: 47%

---

## 🏗️ 技术架构

### 🆕 2025-11-11 更新（稳定性）
- 已为前端两处关键数据加载增加统一超时与错误处理（15s）：
  - 组件详情：`GET /api/doeeet/components/:id`
  - 分类树：`GET /api/doeeet/categories/tree`（失败不再使用静态回退，避免误导）
- Linter 全量通过；影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx`（详情弹窗数据加载）
  - `frontend/src/components/CategoryFilter.tsx`（分类树加载）

### 🆕 2025-11-12 更新（对比体验）
- 组件对比表过滤掉参数名称为 `Unknown` 或空白的行，避免无意义参数占位
- 对比表参数标题优先展示首个有效参数名；若缺失则显示“未命名参数”，保持列标题一致性
- 影响文件：
  - `frontend/src/components/ComponentCompareModal.tsx`

### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放


### 前端技术栈
```
React 18.2
├── TypeScript 4.9
├── Ant Design 5.12
├── Vite 4.5
└── React Router 6.20
```

### 前后端对齐计划（2025-11-10）
- 接口契约与字段命名统一
  - 后端输出统一字段：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`（"Yes"|"No"）
  - 详情/搜索/对比接口字段保持一致，前端避免额外适配层
- 查询参数规范与校验
  - 支持并校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
  - `familyPath` 传入 JSON 数组字符串（如 `["Resistors","Film"]`）
- 响应结构与分页
  - 统一 `{ success, data, error }`
  - 列表附带 `{ total, totalPages, page, limit, hasNextPage }`
- 性能与稳定性
  - 索引：`component_id`、`manufacturer_name`、`family_path`、`has_stock`、全文索引
  - 缓存：列表短缓存（30–120s），详情缓存（5–15m）
  - 速率限制与慢查询日志
- 前端改造
  - 建立统一 API SDK（TS 类型、统一错误处理）
  - 搜索/筛选状态与 URL 同步
  - 列表虚拟化、加载/空态/错误态与重试

### 里程碑（A-D）
- 里程碑 A（页面与布局）
  - `CategoryBrowsePage`、面包屑、左侧筛选 + 右侧结果布局
- 里程碑 B（筛选与数据）
  - Faceting 聚合（制造商/质量/库存/分类）+ 缓存
  - `FilterPanel`：折叠、Stacked/Scroll、显示计数、已选条件 chips、动态加载
- 里程碑 C（结果与表格）
  - 将动态参数表头全面接入结果表格，优化横向滚动/虚拟化
  - 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - 单位转换（pF ↔ µF/mF/F）与筛选器联动
  - 分类内局部搜索提示与命中高亮

### 后端技术栈
```
Node.js 18+
├── Express 4.x
├── TypeScript 4.9
├── MongoDB 6.x (数据库: business_plat)
├── Redis 7.x
└── meta.json（分类配置源）
```

### 数据流架构
```
meta.json 
  ↓ (读取)
DoeeetSearchService.buildCategoryTree()
  ↓ (构建树 + 缓存)
Redis (TTL: 1小时)
  ↓ (API)
/api/doeeet/categories/tree
  ↓ (HTTP)
前端组件 (CategoryFilter, DynamicParameterTable, etc.)
  ↓ (用户交互)
搜索 / 筛选 / 详情查看
```

---

## 📁 项目文件结构

```
Business_plat/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── DoeeetComponent.ts           # DoEEEt组件模型
│   │   │   └── ...
│   │   ├── services/
│   │   │   ├── DoeeetSearchService.ts       # 搜索服务（含分类树构建）
│   │   │   └── CacheService.ts              # Redis缓存服务
│   │   ├── controllers/
│   │   │   └── doeeetComponentController.ts # 控制器
│   │   └── routes/
│   │       └── doeeetRoutes.ts              # 路由配置
│   └── data/
│       └── meta.json                        # 分类配置源文件
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   └── CategoryFilter.tsx           # 分类筛选组件
│   │   ├── utils/
│   │   │   └── parameterUtils.tsx           # 动态参数工具函数
│   │   ├── examples/
│   │   │   └── DynamicParameterTableExample.tsx  # 示例代码
│   │   └── pages/
│   │       └── components/
│   │           └── ComponentSearch.tsx      # 搜索页面
│   └── docs/
│       ├── CategoryFilter使用说明.md
│       ├── 动态参数表头展示说明.md
│       └── 动态参数表头-快速开始.md
│
└── [根目录文档]
    ├── DoEEEt集成实施总结.md
    ├── DoEEEt项目开发计划.md
    ├── 前端分类筛选功能实施方案.md
    ├── 前端分类筛选-快速开始.md
    ├── DoEEEt动态参数表头实施总结.md
    └── DoEEEt功能开发总览.md (本文档)
```

---

## 🚀 快速开始

### 1. 启动 MongoDB 数据库

**Windows 系统**:
```bash
cd backend
.\start-mongodb-local.bat
```

**说明**:
- 脚本会自动检查 MongoDB 是否已安装
- 如果检测到 Windows 服务 `MongoDB` 正在运行，会尝试自动停止（默认服务数据目录: `E:\data\db`，项目数据目录: `F:\Business_plat\backend\data`）
- 停止 Windows 服务需要以管理员身份运行终端；若停止失败请手动执行 `net stop MongoDB`
- 自动停止服务并释放端口后再启动本地实例，避免读写到错误的数据目录
- 脚本会自动创建数据目录和日志目录（如果不存在）
- 数据目录: `backend/data`
- 日志文件: `backend/logs/mongod.log`
- 配置文件: `backend/mongod.conf`

**启动步骤**:
1. 打开 PowerShell 或命令提示符
2. 切换到 `backend` 目录: `cd backend`
3. 运行启动脚本: `.\start-mongodb-local.bat`
4. 脚本会自动检查环境并启动 MongoDB
5. 如果 MongoDB 已安装，会看到 "✅ MongoDB 启动成功！" 提示

**验证 MongoDB 是否运行**:
```bash
# 使用 mongosh 连接
mongosh mongodb://127.0.0.1:27017

# 或检查端口
netstat -an | findstr ":27017"

# 或访问健康检查（需要后端服务运行）
curl http://localhost:3001/health
```

**数据库配置**:
- 数据库名称: `business_plat`
- 连接地址: `mongodb://localhost:27017/business_plat`
- 集合名称: `components` (包含所有 DoEEEt 组件数据)
- 默认端口: `27017`

**注意事项**:
- 确保 MongoDB 已安装并添加到 PATH 环境变量
- MongoDB 安装路径通常是: `C:\Program Files\MongoDB\Server\8.2\bin`
- 如果启动失败，请检查日志文件: `backend/logs/mongod.log`
- 启动脚本会在当前窗口运行 MongoDB，关闭窗口会停止服务

---

### 2. 启动后端服务

```bash
cd backend
npm install

# 确保 .env 文件配置正确
# MONGODB_URI=mongodb://localhost:27017/business_plat

npm run dev
```

**启动成功标志**:
- ✅ MongoDB 连接成功
- ✅ Redis 连接成功
- ✅ 服务器启动成功，端口: 3001
- ✅ 数据自动保存机制已启动（间隔: 30秒）

**服务地址**:
- API 地址: `http://localhost:3001`
- 健康检查: `http://localhost:3001/health`

**验证服务是否运行**:
```bash
# 测试分类树 API
curl http://localhost:3001/api/doeeet/categories/tree

# 或访问健康检查端点
curl http://localhost:3001/health
```

---

### 3. 启动前端服务

```bash
cd frontend
npm install

# 安装可选依赖（用于HTML清理）
npm install dompurify @types/dompurify

npm run dev
```

**访问**: http://localhost:3000

---

### 4. 使用分类筛选

```tsx
import CategoryFilter from '@/components/CategoryFilter';

<CategoryFilter 
  onCategoryChange={(path) => console.log('选择的分类:', path)}
  selectedCategory={[]}
/>
```

---

### 5. 使用动态参数表头

```tsx
import { generateDynamicParameterColumns } from '@/utils/parameterUtils';

const dynamicColumns = generateDynamicParameterColumns(
  parameterDefinitions,
  { sortable: true }
);
```

---

## 📚 文档索引

### 核心文档

#### 分类筛选相关
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md) - 完整实施方案
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md) - 组件API文档
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md) - 5分钟上手

#### 动态参数表头相关
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md) - 实施总结
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md) - 详细文档
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md) - 快速上手

#### 总体文档
- [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 整体集成总结
- [DoEEEt项目开发计划.md](./DoEEEt项目开发计划.md) - 项目计划
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 本文档

### 示例代码
- [CategoryFilter.tsx](./frontend/src/components/CategoryFilter.tsx)
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

---

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：标题、结果总数、子分类卡片/列表）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 全局改为左右布局（左侧筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合并返回匹配数量：制造商/质量等级/库存/分类）
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、显示计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search"（质量等级等快速入口）
2. ⏳ 分类页面内的局部搜索提示（Search within <Category>）
3. ⏳ 搜索命中高亮

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

### 里程碑（对齐 DOEEET 的分类与搜索体验）
- 里程碑 A（页面与布局）
  - [ ] `CategoryBrowsePage`：分类标题与总数、子分类卡片/列表、跳转联动
  - [ ] 面包屑导航：Home > 顶类 > 子类
  - [ ] 左侧筛选 + 右侧结果的页面布局
- 里程碑 B（筛选与数据）
  - [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
  - [ ] `FilterPanel`：折叠、Stacked/Scroll、计数、已选条件chips、动态加载
- 里程碑 C（结果与表格）
  - [ ] 集成动态参数表头到搜索结果表格；横向滚动与虚拟化优化
  - [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - [ ] 单位转换工具与筛选器联动
  - [ ] 分类内局部搜索提示与搜索高亮

---

## 🎯 近期开发计划

### Week 1 (2025-10-31 ~ 2025-11-06)

#### Day 1-2: 集成分类筛选和动态参数表头
- [ ] 将 CategoryFilter 集成到 ComponentSearch 页面
- [ ] 将动态参数表头集成到搜索结果
- [ ] 测试和优化

#### Day 3-5: 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`（标题、总数、子分类卡片/列表）
- [ ] 新增面包屑导航并与分类路由联动
- [ ] 改版为“左侧筛选 + 右侧结果”布局（影响搜索与浏览页）

#### Day 3-4: 实现动态参数筛选器
- [ ] 监听分类变化
- [ ] 加载对应分类的参数配置
- [ ] 创建 DynamicParameterFilter 组件
- [ ] 实现范围筛选和枚举筛选

#### Day 5-7: 优化和测试
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 添加单元测试
- [ ] 用户体验优化
- [ ] 编写完整文档

---

### Week 2 (2025-11-07 ~ 2025-11-13)

#### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel` 组件（折叠/展开、Stacked/Scroll、计数、已选条件chips）
- [ ] 筛选器选项动态加载（基于当前结果集）

#### 组件详情页增强
- [ ] 完善参数详情展示
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据
- [ ] 实现替代品推荐

#### 搜索功能增强
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- [ ] 单位转换工具与筛选联动
- [ ] 分类内局部搜索提示与高亮

---

## 🐛 已知问题

### 1. CategoryFilter 组件
- [ ] Tab切换时动画不流畅（低优先级）
- [ ] 移动端适配待优化

### 2. 动态参数表头
- [ ] 待集成到实际页面进行测试
- [ ] 大数据量下性能待优化（考虑虚拟滚动）

### 3. 搜索功能
- [ ] 搜索结果高亮待实现
- [ ] 分页加载待优化

---

## 🤝 贡献指南

### 开发流程
1. Fork 项目
2. 创建 feature 分支
3. 提交代码并添加测试
4. 提交 Pull Request

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 必须有单元测试
- 必须有 JSDoc 注释

---

## 📞 联系信息

**项目团队**: 开发团队  
**最后更新**: 2025-11-01  
**当前版本**: v0.5 (开发中)  
**预计发布**: v1.0 (2025-11-15)

---

## 🎉 里程碑

### v0.1 (2025-10-25)
- ✅ DoEEEt数据库集成
- ✅ 基础数据模型

### v0.3 (2025-10-29)
- ✅ 分类树构建服务
- ✅ Redis缓存集成

### v0.5 (2025-10-31) - 当前版本
- ✅ CategoryFilter 组件
- ✅ 动态参数表头工具函数
- ✅ 完整文档

### v0.7 (2025-11-06) - 计划中
- ⏳ 完整搜索功能
- ⏳ 动态参数筛选器
- ⏳ 组件详情页

### v1.0 (2025-11-15) - 目标
- 📋 完整的DoEEEt功能
- 📋 性能优化
- 📋 完整的测试覆盖

---

## 📈 数据统计

### DoEEEt 数据库规模
- **总组件数**: ~50,000+ 个电子元器件
- **顶层分类**: 15 个
- **叶子分类**: 181 个
- **动态参数**: 360 个唯一参数键
- **制造商**: ~200+ 家

### 功能覆盖率
- **分类筛选**: 100% (15/15 顶层分类)
- **参数展示**: 100% (360/360 动态参数)
- **搜索功能**: 40% (基础搜索已实现)
- **详情展示**: 20% (基础信息已实现)

---

**感谢使用 DoEEEt 系统！**

如有问题，请查阅相关文档或联系开发团队。


```

```markdown
*** Begin Patch
*** Update File: DoEEEt集成实施总结.md
@@
 ### 2025-11-12 (v2.4.1) 🛠️
 - ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
   - `GET /api/doeeet/components/:id`（组件详情弹窗）
   - `GET /api/doeeet/categories/tree`（分类筛选器）
 - ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
@@
 - ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
 - ✅ Linter 检查通过（无新增告警）
 - 影响文件：
   - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
   - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`
+
+### 2025-11-19 (v2.4.2) ⚙️
+- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
+- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
+- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
+- 🔄 下一步：在 README/脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 目录
*** End Patch
```

```markdown
# DoEEEt电子元件搜索系统集成实施总结

## 项目概览

本文档记录了DoEEEt电子元件数据库与业务平台的集成实施过程，包括已完成的功能、技术架构和下一步计划。

## 数据概况

- **数据源**: DoEEEt (Defense Operational Electronic Equipment and Technology)
- **数据规模**: 
  - 组件 (components): 1.8M+ 条记录
  - 参数 (parameters): 137M+ 条记录
  - 参数定义 (parameter_definitions): 313 个参数类型
  - 动态参数定义 (meta.json): 360 个唯一参数键

### 数据文件映射关系（对应《数据说明》）

- components ↔ `general.csv`
- parameters ↔ `parameter.csv`
- parameter_definitions ↔ `parameter_final.csv`（集成时忽略 example 列）

### 分类结构分析 (基于 meta.json)

#### 顶层分类（15个）

```javascript
const topCategories = [
  "Cable Assemblies",        // 叶子分类: 3
  "Capacitors",              // 叶子分类: 8
  "Connectors",              // 叶子分类: 11
  "Crystals and Oscillators", // 叶子分类: 3
  "Discretes",               // 叶子分类: 30
  "Filters",                 // 叶子分类: 4
  "Inductors",               // 叶子分类: 3
  "Microcircuits",           // 叶子分类: 89 (最大类别)
  "Relays",                  // 叶子分类: 4
  "Resistors",               // 叶子分类: 6
  "RF Passive Components",   // 叶子分类: 2
  "Switches",                // 叶子分类: 5
  "Thermistors",             // 叶子分类: 3
  "Transformers",            // 叶子分类: 7
  "Wires and Cables",        // 叶子分类: 3
];
```

#### 分类层级统计

- **总计**: 181 个最细叶子分类（meta.json 中配置的分类）
- **路径深度分布**:
  - 深度 2 (例: `Capacitors > Ceramic`): 54 个 (29.83%)
  - 深度 3 (例: `Connectors > Circular > Circular Accessories`): 51 个 (28.18%)
  - 深度 4 (例: `Discretes > Diode > RF-Microwave Diode > PIN`): 61 个 (33.70%)
  - 深度 5 (例: `Microcircuits > Digital > Memory > RAM > SRAM`): 15 个 (8.29%)

#### family_path 数据结构

```python
# 实际存储格式：从“叶子(最低级)”到“顶层(最高级)”的层级数组
"['Peripheral-Controller', 'Digital', 'Microcircuits']"
#    ↑ 叶子(最低级)             ↑ 中间层级          ↑ 顶层

# 提取规则（与数据库一致）：
# - 叶子分类：family_path[0]
# - 顶层分类：family_path[-1] (最后一个元素)
```

#### 最常用的动态参数 (Top 10)

| 参数名称 | 使用率 | 说明 |
|---------|-------|------|
| Storage Temperature Range | 93.37% | 存储温度范围 |
| SEE sens. | 92.82% | 单粒子效应灵敏度 |
| TID (HDR) sens. | 92.82% | 总电离剂量（高剂量率）灵敏度 |
| TID (LDR) sens. | 92.82% | 总电离剂量（低剂量率）灵敏度 |
| TNID sens. | 92.82% | 中子辐射灵敏度 |
| Finish | 81.22% | 表面处理 |
| Package Material | 72.93% | 封装材料 |
| Number of Pins | 71.27% | 引脚数量 |
| TID (HDR) | 66.30% | 总电离剂量（高剂量率） |
| TID (LDR) | 66.30% | 总电离剂量（低剂量率） |

#### 注意事项

1. **meta.json 中没有 "Aerospace" 分类**
   - "Aerospace" 不是分类维度，而是质量等级或筛选条件
   - 可能对应 `comp-qualified = Y` 或特殊的 `quality_name`
   
2. **动态参数配置**
   - 每个叶子分类有不同的动态参数列表（在 meta.json 的 `meta` 数组中）
   - 共有 360 个唯一的动态参数键
   - 如果某个分类不在 meta.json 中，则只显示固定参数

## 已完成功能 (Phase 1, Phase 2 & Phase 2.5)

### Phase 1: 基础集成功能 ✅

#### 1.1 前端组件搜索页面 ✅
**文件**: `frontend/src/pages/components/ComponentSearch.tsx`

**功能**:
- 集成DoEEEt API (`/api/doeeet/search`)
- 支持多维度搜索：
  - 型号搜索 (partNumber)
  - 制造商筛选 (manufacturer)
  - 质量等级筛选 (qualityName: 883, QML Q, EP等)
  - 库存状态筛选 (hasStock: Yes/No)
  - 淘汰状态筛选 (obsolescenceType: Active, Obsolete, Risk, Last Time Buy)
- 数据格式转换：将DoEEEt数据格式适配到前端UI
- 解析family_path分类层次结构
- 分页和排序支持
- ✨ **新增**: 动态参数表头展示（Phase 2.5）
- ✨ **新增**: 分类筛选器集成（Phase 2.5）
- ✨ **新增**: CSV导出功能（Phase 2.5）

**技术实现**:
```typescript
// API调用示例
const response = await fetch(`/api/doeeet/search?${params.toString()}`);
const result = await response.json();

// 数据转换
const adaptedComponents = result.data.components.map((comp: any) => {
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层分类为最后一个元素
    mainCategory: familyPathArray[familyPathArray.length - 1],
    // ... 其他字段映射
  };
});
```

#### 1.2 组件详情弹窗 ✅
**功能**:
- 点击组件型号查看详细信息
- 动态加载组件参数 (`/api/doeeet/components/:id`)
- 显示参数定义翻译（中英文参数名、符号、分类）
- 参数表格展示：
  - 参数名称（完整名称 + 符号）
  - 参数值（支持数组值解析）
  - 参数分类
  - 单位和示例

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Thermal Resistance, Junction to Case [Max]"
  short_name: string;     // "&theta;<sub>JC</sub> [Max]"
  category: string;       // "Generic Functional & Electrical"
  value: any;             // 实际参数值
}
```

#### 1.3 首页分类统计卡片 ✅
**文件**: `frontend/src/pages/HomePage.tsx`

**功能**:
- 实时显示11个主要分类的组件数量
- 从API获取统计数据 (`/api/doeeet/statistics`)
- 动态更新分类统计卡片
- 支持点击跳转到对应分类搜索

**后端增强**:
- 在 `DoeeetSearchService.getStatistics()` 中添加 `categoryStats`
- 使用MongoDB聚合管道按family_path分组统计
- 解析family_path提取主分类
- Redis缓存优化（TTL: 1小时）

### Phase 2: 高级搜索功能 ✅

#### 2.1 动态参数表头展示 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (工具函数库)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 智能表头展示：
  - 有 `short_name` 时显示简写 + Tooltip（完整名称）
  - 无 `short_name` 时直接显示完整名称
- HTML 标签支持（`<sub>`, `<sup>` 等）
- 安全清理（DOMPurify）
- 根据分类动态生成参数列
- 参数列可排序、可筛选

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Storage Temperature Range"
  short_name?: string;    // "T<sub>STG</sub>"
  category: string;       // "Thermal"
  example?: string;       // "-55°C to 150°C"
}
```

**工具函数**:
```typescript
// 8个核心函数
- generateParameterColumnTitle()      // 生成智能表头
- generateDynamicParameterColumns()   // 批量生成动态列
- generateGroupedParameterColumns()   // 生成分组列
- exportParametersToCSV()             // 导出CSV
- downloadCSV()                       // 下载CSV
- groupParametersByCategory()         // 按分类分组
- formatParameterValue()              // 格式化参数值
- extractParameterKeys()              // 提取参数键
```

**UI效果**:
```
┌────────────────┬──────────┬─────────ⓘ───┬─────────ⓘ───┐
│ 器件型号        │ 制造商    │ #Pins       │ T_STG        │
│                │          │ ↑ Tooltip   │ ↑ Tooltip    │
├────────────────┼──────────┼─────────────┼──────────────┤
│ 860300YA       │ SIB      │ 68          │ -55°C~150°C  │
└────────────────┴──────────┴─────────────┴──────────────┘
```

**参数覆盖率**:
- 总参数数: 360个
- 有 `short_name`: ~80% (288个)
- 无 `short_name`: ~20% (72个)

#### 2.2 分类筛选器集成 ✅ ⭐ 新增
**文件**: 
- `frontend/src/components/CategoryFilter.tsx` (已有组件)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 级联选择器（Cascader）展示分类层级
- Tab导航展示顶层分类（15个）
- 支持 2-5 层分类路径选择
- 分类选择后自动触发搜索
- 显示每个分类的组件数量

**分类统计**:
| 顶层分类 | 组件数量 | 占比 | 路径深度 |
|---------|---------|------|---------|
| Resistors | 824,599 | 45.88% | 2层 |
| Capacitors | 503,149 | 27.99% | 2层 |
| Connectors | 160,090 | 8.91% | 3层 |
| Crystals and Oscillators | 131,524 | 7.32% | 2层 |
| Switches | 53,377 | 2.97% | 2层 |
| Discretes | 45,564 | 2.53% | 2-4层 |
| Thermistors | 31,302 | 1.74% | 2层 |
| Microcircuits | 25,652 | 1.43% | 2-5层 |
| 其他 (6类) | 22,160 | 1.23% | 2-3层 |

**数据流**:
```
用户选择分类
    ↓
CategoryFilter.onCategoryChange(path)
    ↓
setSelectedCategory(['Resistors', 'Film'])
    ↓
handleSearch() → /api/doeeet/search?familyPath=["Resistors","Film"]
    ↓
后端筛选 + 返回对应的 parameterDefinitions
    ↓
前端生成动态参数列
```

#### 2.3 参数范围筛选 ✅
**文件**: 
- `frontend/src/components/ParameterRangeFilter.tsx` (新建)
- `backend/src/services/DoeeetSearchService.ts` (已支持)

**功能**:
- 支持数值型参数的范围查询
- 常用参数快速选择：
  - 电压 (Voltage)
  - 电流 (Current)
  - 功率 (Power)
  - 频率 (Frequency)
  - 工作温度 (Temperature)
  - 电阻、电容、电感等
- 最小值/最大值输入
- 多参数组合筛选
- 动态添加/删除筛选条件

**API格式**:
```json
{
  "parameters": {
    "voltage": { "min": 3.3, "max": 5.0 },
    "temperature": { "min": -40, "max": 85 }
  }
}
```

**后端实现**:
```typescript
// 范围查询支持
if (typeof value === 'object' && ('min' in value || 'max' in value)) {
  const rangeQuery: any = { parameter_key: key };
  if (value.min !== undefined) {
    rangeQuery.numeric_value = { $gte: value.min };
  }
  if (value.max !== undefined) {
    rangeQuery.numeric_value = { 
      ...rangeQuery.numeric_value, 
      $lte: value.max 
    };
  }
  paramQueries.push(rangeQuery);
}
```

#### 2.4 CSV导出功能 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (导出函数)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 导出当前搜索结果为CSV
- 包含所有静态列和动态参数列
- 自动生成文件名（带时间戳）
- 支持中文编码（UTF-8 BOM）

**使用示例**:
```tsx
<Button 
  icon={<DownloadOutlined />}
  onClick={() => {
    const csvContent = exportParametersToCSV(components, parameterDefinitions);
    downloadCSV(csvContent, `components_${Date.now()}.csv`);
    message.success('导出成功！');
  }}
>
  导出CSV
</Button>
```

**CSV格式**:
```csv
器件型号,制造商,分类,Number of Pins,Storage Temperature Range,...
860300YA,SIB International,Resistors,68,-55°C~150°C,...
860301YA,SIB International,Capacitors,72,-40°C~125°C,...
```

#### 2.5 参数对比功能 ✅
**文件**:
- `frontend/src/components/ComponentCompareModal.tsx` (新建)
- `backend/src/controllers/doeeetComponentController.ts` (新增compareComponents)
- `backend/src/routes/doeeetRoutes.ts` (新增路由)

**功能**:
- 多选组件（2-5个）
- 批量对比按钮
- 对比模态框展示：
  - 基本信息对比表
  - 参数对比矩阵
  - 参数差异高亮
- 支持大量参数滚动查看

**API Endpoint**:
```
POST /api/doeeet/components/compare
Body: { componentIds: string[] }
```

**对比矩阵数据结构**:
```typescript
interface ComparisonMatrix {
  components: ComponentInfo[];      // 组件基本信息
  parameters: ParameterRow[];       // 参数对比矩阵
}

interface ParameterRow {
  key: string;
  component_0: { name, value, numericValue };
  component_1: { name, value, numericValue };
  // ...
}
```

## 技术架构

### 后端技术栈
- **框架**: Express.js + TypeScript
- **数据库**: MongoDB (1.8M+ 组件记录)
- **缓存**: Redis (搜索结果、组件详情、统计数据)
- **日志**: Winston

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI库**: Ant Design
- **路由**: React Router v6
- **状态管理**: React Hooks

### 数据库设计

#### Collections

1. **components** (1.8M 文档)
```javascript
{
  _id: ObjectId,
  component_id: String,          // UUID
  part_number: String,           // "5962-8864203YA"
  part_type: String,             // "P1754-40QGMB"
  manufacturer_name: String,     // "Pyramid Semiconductor"
  family_path: String,           // "['Peripheral-Controller', 'Digital', 'Microcircuits']"
  quality_name: String,          // "883"
  obsolescence_type: String,     // "Active"
  has_stock: String,             // "Yes"/"No"
  qpl_name: String,              // "QPDSIS-38535"
  qualified: String,             // "Y"/"N"
  cad: String,
  created_at: Date,
  updated_at: Date
}
```

2. **parameters** (数百万文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID + type
  component_id: String,          // 外键
  parameter_value: String,       // "['0.00000']"
  numeric_value: Number,         // 用于范围查询
  created_at: Date,
  updated_at: Date
}
```

3. **parameter_definitions** (313 文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID
  name: String,                  // "Thermal Resistance, Junction to Case [Max]"
  short_name: String,            // "&theta;<sub>JC</sub> [Max]"
  category: String,              // "Generic Functional & Electrical"
  example: String,               // "5°C/W"
  created_at: Date,
  updated_at: Date
}
```
注：本集合与数据说明中的 `parameter_final.csv` 对应；集成与展示时请忽略 `example` 列（不参与前后端逻辑与显示）。

### API接口列表

#### 搜索API
- `GET /api/doeeet/search` - 复合搜索
- `GET /api/doeeet/fulltext` - 全文搜索
- `GET /api/doeeet/suggestions` - 搜索建议
- `GET /api/doeeet/category/:category` - 分类浏览

#### 组件API
- `GET /api/doeeet/components/:id` - 组件详情
- `POST /api/doeeet/components/compare` - 对比组件 ✨ 新增

#### 元数据API
- `GET /api/doeeet/manufacturers` - 制造商列表
- `GET /api/doeeet/categories` - 分类列表
- `GET /api/doeeet/parameter-definitions` - 参数定义
- `GET /api/doeeet/statistics` - 统计信息 ✨ 增强

## 性能优化

### 1. Redis缓存策略
```typescript
// 缓存TTL配置
const CacheTTL = {
  SEARCH_RESULT: 300,        // 5分钟
  COMPONENT_DETAIL: 1800,    // 30分钟
  METADATA: 3600,            // 1小时
  STATISTICS: 3600           // 1小时
};
```

### 2. MongoDB索引
```javascript
// components集合索引
{
  component_id: 1,           // 唯一索引
  part_number: 1,            // 搜索索引
  manufacturer_name: 1,
  obsolescence_type: 1,
  family_path: 1
}

// parameters集合索引
{
  component_id: 1,
  parameter_key: 1,
  numeric_value: 1           // 范围查询索引
}

// 全文搜索索引
{
  part_number: "text",
  manufacturer_name: "text",
  part_type: "text"
}
```

### 3. 分页优化
- 默认每页20条
- 最大限制100条
- Skip + Limit实现

### 缓存与限流（新增）
- 实现 `CacheService.ts`
- 缓存搜索结果、分类树
- 性能优化：目标从200ms降至10-20ms

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站功能对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：分类标题、结果总数、子分类列表/卡片）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 改为左右布局（左侧固定筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合返回匹配数量：制造商/质量等级/库存/分类）+ 缓存
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随当前结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换功能（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search" 部分
2. ⏳ 分类页面局部搜索（Search within <Category>）
3. ⏳ 结果高亮显示

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

## 本次对齐实施计划（2025-11-10）

### 阶段 0（契约与正确性）
- [ ] 接口契约与字段命名统一：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`
- [ ] 查询参数校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
- [ ] 响应结构统一：`{ success, data, error }`；分页元数据 `{ total, totalPages, page, limit, hasNextPage }`
- [ ] 错误码与错误体：400/404/500；`error.code`、`error.message`

### 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`：显示分类标题、总数、子分类卡片/列表；支持点击进入搜索页
- [ ] 新增面包屑导航：Home > 顶类 > 子类，支持路由联动
- [ ] 页面布局改造：统一为“左侧筛选面板 + 右侧结果列表”

### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel`：折叠/展开、Stacked/Scroll 视图、显示计数、已选条件chips
- [ ] 筛选项动态加载（基于当前结果集）

### 里程碑 C（结果与表格）
- [ ] 将动态参数表头接入搜索结果表格并优化横向滚动/虚拟化
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）

### 里程碑 D（体验增强）
- [ ] 单位转换（pF ↔ µF/mF/F）与筛选器联动
- [ ] 分类内局部搜索提示（Search within <Category>）与结果高亮

---

## 待实现功能 (Phase 3 & 优化)

### Phase 2.6: 动态参数表头增强 ⏳
- [ ] 参数列的显示/隐藏控制
- [ ] 参数列的拖拽排序
- [ ] 参数列配置保存到 localStorage
- [ ] 参数列的分组展示（按 category）
- [ ] 参数列的高级筛选（范围、正则等）
- [ ] 参数统计图表展示

### Phase 3.1: 关联数字模型 ⏳
- 展示组件关联的3D CAD模型
- 模型预览（使用Three.js或类似库）
- 模型信息展示

### Phase 3.2: 模型下载功能 ⏳
- 支持多种CAD格式下载
- 下载进度显示
- 批量下载支持

### Phase 3.3: 分面搜索（Facets）⏳
- 实现分面搜索
- 统计每个筛选条件的可用选项数量
- 动态更新可用筛选选项

## 使用说明

### 1. 启动服务

**后端**:
```bash
cd backend
npm install
npm run dev
```

**前端**:
```bash
cd frontend
npm install
npm start
```

### 2. 访问系统

- 前端URL: http://localhost:3000
- 后端API: http://localhost:3001

### 3. 主要功能入口

1. **组件搜索**: 导航栏 -> 器件查询 -> 器件搜索
2. **首页统计**: 首页 -> 11个分类统计卡片
3. **参数筛选**: 组件搜索页面 -> 参数范围筛选卡片
4. **组件对比**: 
   - 选择2-5个组件
   - 点击"批量对比"按钮
   - 查看对比结果

## 数据统计

### 分类统计（示例）
- Peripheral-Controller: ~800,000
- Digital: ~500,000
- Microcircuits: ~300,000
- Analog: ~200,000
- 其他分类: 各有数量

### 制造商统计
- 18+ 制造商
- 包括Pyramid Semiconductor, Analog Devices, Texas Instruments等

### 参数统计
- 313个参数定义
- 涵盖电气、热学、机械等多个分类

## 测试建议

### 功能测试
1. 搜索功能测试
   - 型号搜索: "5962-8864203YA"
   - 制造商筛选: "Pyramid Semiconductor"
   - 组合筛选测试

2. 参数筛选测试
   - 单参数范围: 电压 3.3V-5V
   - 多参数组合: 电压 + 温度

3. 组件对比测试
   - 选择2个相似组件对比
   - 选择5个组件对比
   - 查看参数差异

### 性能测试
1. 大数据量搜索响应时间
2. 缓存命中率监控
3. 并发用户测试

## 注意事项

1. **数据格式**: DoEEEt的family_path使用Python列表字符串格式，需要特殊解析
2. **参数值**: 参数值也是数组字符串格式，需要解析后显示
3. **缓存策略**: 注意Redis缓存的TTL设置，避免数据过期问题
4. **错误处理**: 前端有降级方案，API失败时显示模拟数据

## 开发团队

- 后端开发: Express.js + MongoDB + Redis
- 前端开发: React + TypeScript + Ant Design
- 数据导入: Python脚本处理DoEEEt CSV数据

## 🔥 最新状态更新 (2025-10-30)

### ✅ 重大进展

#### 1. 后端服务正常运行 ⭐
- **状态**: ✅ 已启动并稳定运行
- **端口**: 3001
- **服务**:
  - MongoDB 8.2.1 连接正常 (1.8M组件数据)
  - Redis连接正常 (缓存服务)
  - 所有API端点可访问

#### 2. TypeScript编译问题修复 ⭐
- **问题**: `jsonwebtoken` 类型声明错误导致编译失败
- **解决方案**: 使用类型断言 `as JwtPayload`
- **影响文件**: `backend/src/middleware/authMiddleware.ts`
- **状态**: ✅ 已修复，编译通过

#### 3. ComponentSearch页面API集成完成 ⭐
- **文件**: `frontend/src/pages/components/ComponentSearch.tsx`
- **状态**: ✅ 已接入真实API (`/api/doeeet/search`)
- **功能验证**:
  - ✅ API调用逻辑正确
  - ✅ 数据适配器已实现 (MongoDB → UI)
  - ✅ 支持搜索、筛选、分页
  - 🔄 待测试：前端服务启动后的实际运行效果

#### 4. 数据库备份脚本完善 ⭐ 🆕
- **文件**: `backend/scripts/backup_database.ps1`
- **状态**: ✅ 已完善，支持 MongoDB 8.x
- **功能**:
  - ✅ MongoDB 版本自动检测
  - ✅ MongoDB 8.x 强制使用 mongosh 备份
  - ✅ 详细的进度显示和日志
  - ✅ 自动压缩和备份验证
- **备份路径**: `F:\Business_plat\backups\`
- **兼容性**: MongoDB 8.2.1 + mongodump 100.x

#### 5. 数据格式迁移脚本准备 ⭐ 🆕
- **文件**: `backend/scripts/migrate_doeeet_data_format.js`
- **状态**: ✅ 已创建，待执行
- **目的**: 修复 `doeeet_tasks` 集合数据格式
- **操作**: 字段展平（`title.value` → `title`）
- **安全**: 自动创建备份集合

#### 4. 数据适配器实现 ⭐
**转换逻辑**:
```typescript
// MongoDB数据格式 → 前端UI格式
const adaptedComponents = result.data.components.map((comp: any) => {
  // 解析Python列表格式的family_path
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层在末尾，叶子在开头
    mainCategory: familyPathArray[familyPathArray.length - 1],
    subCategory: familyPathArray[1] || '',
    category: familyPathArray[0] || '',
    qualityLevel: comp.quality_name,
    status: comp.obsolescence_type,
    stockStatus: comp.has_stock === 'Yes',
    qplName: comp.qpl_name || '',
    qualified: comp.qualified === 'Y'
  };
});
```

### 🎯 当前优先级任务

#### P0 - 立即执行（数据安全优先）
1. **数据库备份** ⏰ 30分钟 🔴
   - 🔄 执行备份脚本 (`.\scripts\backup_database.ps1`)
   - 验证备份完整性
   - 备份位置：`F:\Business_plat\backups\`

2. **数据格式迁移** ⏰ 1-2小时 🔴
   - 🔄 执行迁移脚本 (`node scripts/migrate_doeeet_data_format.js`)
   - 修复 `doeeet_tasks` 数据格式
   - 验证迁移结果

3. **后端API验证** ⏰ 30分钟 🔴
   - 测试迁移后的API响应
   - 验证数据完整性
   - 检查前端兼容性

#### P1 - 短期实施（功能开发）
4. **启动前端服务并验证数据流** ⏰ 1小时
   - 启动前端开发服务器 (`npm start`)
   - 测试ComponentSearch页面真实搜索
   - 验证180万组件数据展示
   - 检查分页、排序功能

5. **实现组件详情弹窗** ⏰ 2-3小时
   - 调用 `/api/doeeet/components/:id/parameters`
   - 展示技术参数表格
   - 显示参数定义翻译（中英文）

6. **参数对比功能开发** ⏰ 1-2天
   - 后端：创建 `ComparisonService.ts`
   - 后端：实现 `POST /api/doeeet/compare` API
   - 前端：组件多选功能 (Checkbox列)
   - 前端：对比抽屉UI
   - 前端：参数差异高亮

#### P2 - 中期实施
7. **分面搜索（Facets）** ⏰ 1天
   - 后端：搜索结果中添加聚合统计
   - 前端：分面筛选器UI组件
   - 动态更新可用选项数量

8. **Redis缓存集成** ⏰ 1-2天
   - 实现 `CacheService.ts`
   - 缓存搜索结果、分类树
   - 性能优化：目标从200ms降至10-20ms

### 📊 项目整体进度

| 阶段 | 状态 | 进度 | 说明 |
|------|------|------|------|
| 阶段一：数据导入 | ✅ 完成 | 100% | 1.8M组件 + 137M参数 |
| 阶段二：搜索API | ✅ 基本完成 | 95% | 10个端点已实现，分面搜索待补充 |
| 阶段三：前端开发 | 🔄 进行中 | 65% | ✅ 动态参数表头、✅ 分类筛选、✅ CSV导出 |
| 阶段四：测试部署 | ⏳ 待开始 | 0% | 预计11月下旬 |

**整体进度**: 80% ✅

**Phase 2.5 新增功能** (2025-10-31):
- ✅ 动态参数表头展示（智能表头 + HTML支持）
- ✅ 分类筛选器集成（级联选择 + 分类统计）
- ✅ CSV导出功能（包含动态参数）
- ✅ 工具函数库（8个核心函数）
- ✅ 完整文档（3份详细文档）

### 🔧 技术问题解决记录

#### 问题1: TypeScript编译错误
```
错误信息: 
Property 'userId' does not exist on type 'string | JwtPayload'

解决方案:
const decoded = jwt.verify(token, process.env.JWT_SECRET!) as JwtPayload;

位置: backend/src/middleware/authMiddleware.ts:19
```

#### 问题2: DoEEEt数据格式特殊性
```python
# family_path 是Python列表字符串
"['Peripheral-Controller', 'Digital', 'Microcircuits']"

# 需要替换单引号为双引号后JSON.parse
JSON.parse(comp.family_path.replace(/'/g, '"'))
```

### 📈 关键指标

| 指标 | 当前状态 | 目标 | 完成度 |
|------|---------|------|--------|
| 后端服务 | ✅ 运行中 (端口3001, MongoDB 8.2.1) | 稳定运行 | 100% |
| 数据导入 | ✅ 1.8M组件 | 完成 | 100% |
| 数据备份 | 🔄 脚本已完善 | 备份完成 | 80% |
| 数据迁移 | 🔄 脚本已创建 | 迁移完成 | 50% |
| 搜索API | ✅ 10个端点 | 完成 | 100% |
| 动态参数表头 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| 分类筛选器 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| CSV导出 | ✅ 已实现 | 完成 | 100% ⭐ |
| 搜索性能 | ⚠️ 200ms | <50ms | 需Redis优化 |
| 前端数据打通 | ⚠️ 1/12页面 | 全部接入 | 8% |
| 参数对比 | ❌ 未实现 | 已实现 | 0% |
| 分面搜索 | ❌ 未实现 | 已实现 | 0% |

## 更新日志

### 2025-11-12 (v2.4.1) 🔄
- ✅ **组件对比体验优化**：过滤掉参数名称为 `Unknown` 或空白的对比行，减少噪声信息
- ✅ **参数标题完善**：对比矩阵优先展示首个有效参数名，缺失时统一显示“未命名参数”，保证列标题一致
- 📁 **影响文件**：`frontend/src/components/ComponentCompareModal.tsx`

### 2025-11-01 (v2.4) 🔍
- ✅ **对比分析完成**: 完成与 DOEEET 原始网站的深入对比分析
- ✅ **改进思路文档**: 
  - 5个核心功能模块的对比分析（分类浏览、筛选面板、筛选器、结果展示、搜索整合）
  - 详细的改进思路和实施优先级建议
  - 技术实现要点总结
- ✅ **文档更新**: 
  - [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 添加对比分析与改进思路章节
  - [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 添加对比分析与改进思路章节
- 📋 **实施计划**: 
  - Phase 1: 核心布局改造（高优先级）
  - Phase 2: 筛选功能增强（高优先级）
  - Phase 3: 用户体验优化（中优先级）
  - Phase 4: 高级功能（低优先级）

### 2025-10-31 (v2.3) 🆕⭐
- ✅ **Phase 2.5 完成**: 动态参数表头功能全面上线
- ✅ **动态参数表头展示**: 
  - 智能表头（short_name + Tooltip）
  - HTML标签支持（`<sub>`, `<sup>`）
  - DOMPurify安全清理
  - 参数列可排序、可筛选
- ✅ **分类筛选器集成**: 
  - CategoryFilter组件集成到ComponentSearch
  - 级联选择器展示 2-5 层分类
  - Tab导航显示15个顶层分类
  - 分类统计数据分析完成（1.8M组件）
- ✅ **CSV导出功能**: 
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码支持中文
  - 自动文件名（带时间戳）
- ✅ **工具函数库**: `parameterUtils.tsx` (8个核心函数)
- ✅ **文档完善**: 
  - [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
  - [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
  - [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)
  - [DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)
  - [DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)
- 📝 **项目进度更新**: 阶段三从45%提升至65%，整体进度80%
- 📊 **数据分析**: 完成 family_path 结构分析（14个顶层分类，181个叶子分类）

### 2025-10-30 (v2.2)
- ✅ **数据库备份脚本完善**: 支持 MongoDB 8.2.1，强制使用 mongosh
- ✅ **数据迁移脚本创建**: `migrate_doeeet_data_format.js`，修复数据格式
- 🔄 **优先级调整**: 数据备份与迁移（P0）→ 前端验证 → 参数对比 → 分面搜索
- 📝 **项目进度更新**: 阶段三从40%提升至45%，整体进度72%
- 📝 **技术债务**: MongoDB 8.x 与 mongodump 100.x 兼容性问题已解决

### 2024-10-30 下午 (v2.1)
- ✅ **后端编译问题修复**: jsonwebtoken类型断言
- ✅ **后端服务启动**: 端口3001，MongoDB+Redis正常
- ✅ **ComponentSearch接入API**: 数据适配器实现完成
- 📝 **优先级调整**: 前端数据流验证 → 参数对比 → 分面搜索 → Redis缓存
- 📝 **项目进度更新**: 阶段三从30%提升至40%，整体进度70%

### 2024-10-30 上午
- ✅ 完成Phase 1.1: 前端组件搜索页面集成
- ✅ 完成Phase 1.2: 组件详情弹窗
- ✅ 完成Phase 1.3: 首页分类统计
- ✅ 完成Phase 2.1-2.3: 参数范围筛选
- ✅ 完成Phase 2.5: 参数对比功能（计划中）

## 下一步计划

### 本周内 (10月31日 - 11月3日)
1. ✅ ~~后端服务启动并验证~~
2. ✅ ~~ComponentSearch API集成~~
3. ✅ ~~数据库备份脚本完善~~
4. ✅ ~~动态参数表头实现~~ ⭐
5. ✅ ~~分类筛选器集成~~ ⭐
6. ✅ ~~CSV导出功能~~ ⭐
7. ✅ ~~family_path数据分析~~ ⭐
8. 🔄 **前端服务启动并测试** (当前任务)
9. 🔄 真机测试动态参数表头
10. 🔄 性能测试和优化

### 下周 (11月4日 - 11月10日)
1. 🔄 执行数据库备份（如需要）
2. 🔄 执行数据格式迁移（如需要）
3. ⏳ 参数列配置保存（显示/隐藏、拖拽排序）
4. ⏳ 参数对比功能开发
5. ⏳ 分面搜索实现
6. ⏳ Redis缓存性能优化

### 中期计划 (11月中下旬)
1. 其他11个搜索页面迁移
2. 全面集成测试
3. 参数列的高级筛选
4. 参数统计图表展示
5. 移动端适配

### 长期计划
1. **Phase 3**: 数字模型关联和下载（按需实施）
2. **性能优化**: 进一步优化大数据量查询
3. **用户反馈**: 收集用户反馈并迭代改进
4. **文档完善**: API文档、用户手册等
5. **国际化支持**: 中英文切换

## 📚 相关文档索引

### Phase 2.5: 动态参数表头完整文档

#### 核心文档
1. **[DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)**
   - 核心功能总结
   - 技术实现详解
   - 数据统计和性能优化
   - 实施进度（75%完成）

2. **[DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)**
   - 集成到ComponentSearch的完整过程
   - 数据流和技术细节
   - 测试指南和已知问题
   - 状态：✅ 集成完成，待测试

3. **[动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)**
   - 数据结构详解
   - 展示逻辑和规则
   - 3种实现方案对比
   - HTML渲染和安全性

4. **[动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)**
   - 5分钟快速上手
   - API完整参考
   - 使用场景和示例
   - 常见问题解答

#### 数据分析文档
5. **[DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)**
   - 1.8M组件分类结构分析
   - 14个顶层分类统计
   - 路径长度分布（2-5层）
   - 前端筛选器设计建议
   - MongoDB聚合查询示例

#### 示例代码
6. **[parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)**
   - 8个核心工具函数
   - TypeScript类型定义
   - JSDoc完整注释

7. **[DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)**
   - 完整使用示例
   - 最佳实践演示

8. **[ComponentSearch.tsx](./frontend/src/pages/components/ComponentSearch.tsx)**
   - 实际集成代码
   - 生产环境实现

### 其他功能文档
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md)
- [DoEEEt-README.md](./DoEEEt-README.md)

---

## 🎯 Phase 2.5 核心成果总结

### ✅ 已完成功能（2025-10-31）

#### 1. 动态参数表头系统
- **智能表头展示**
  - 有 `short_name`: 显示简写 + Tooltip（完整名称）
  - 无 `short_name`: 直接显示完整名称
  - 覆盖率：80%参数有简写，20%仅有完整名称
  
- **HTML标签支持**
  - 支持 `<sub>`、`<sup>`、`<b>`、`<i>` 等标签
  - 示例：T<sub>STG</sub>、V<sub>CC</sub>、I<sub>O</sub>
  - DOMPurify安全清理，防XSS攻击
  
- **参数列功能**
  - 可排序（升序/降序）
  - 可筛选（输入框筛选）
  - 可自定义宽度
  - 超长省略（ellipsis）

### 2.6 表头渲染规范与固定参数取值方案 🆕

本节明确搜索结果与对比表中“动态参数表头”的展示规范，以及 Package 与 TOP（Operating Temperature）两项固定参数的取值来源与后端聚合方案，确保与 DOEEET 原站表现一致。

#### 展示规范
- 有 short_name 时：标题显示为“✖ short_name”，鼠标悬停显示完整 name（Tooltip）。
- 无 short_name 时：标题直接显示 name（不显示 Tooltip）。
- HTML 标签支持：允许 `<sub>` / `<sup>` 等（通过 DOMPurify 清理后安全渲染）。
- 空值显示：统一使用 “--” 代替 “Unknown”，长文本启用省略与悬停展示完整值。

示例：
```
✖ T_A [Max]        ← 列标题显示 short_name
(Access Time [Max]) ← 悬停 Tooltip 显示 name
```

#### 固定参数（Package 与 TOP）策略
- 固定两项，固定顺序展示在基础信息之后、动态参数之前：
  1) Package（parameter_key = `5df8d422-39bd-431f-9095-582a3f6f8fc1`）
  2) Operating Temperature（TOP，parameter_key = `2f2e7f5a-7cd0-47da-8feb-a29336285a3e`）
- 名称来源：`parameter_definitions`（通过 parameter_key 关联，获取 name 与 short_name）。
- 取值来源：`parameters`（按组件 component_id + parameter_key 获取具体值）。

#### 后端聚合与响应结构
为减少多次 IO 与确保顺序稳定，后端在详情与搜索结果适配时统一聚合输出三段数据：
1) static：来自 components/general 的静态字段（型号、制造商、质量等级、生命周期等）。
2) fixedExtras：仅包含 Package 与 TOP 两项（按上述固定顺序）。
3) dynamic：依据该器件 family_path 在 `meta.json` 匹配到的 `meta` 有序列表进行生成；即使某项无值也保留结构（值为 null/空字符串），方便前端一致渲染与列对齐。

接口响应示例（节选）：
```json
{
  "static": { "part_number": "CY7C432-80DMB", "manufacturer_name": "Teledyne e2v Inc", "...": "..." },
  "fixedExtras": [
    { "key": "5df8d422-39bd-431f-9095-582a3f6f8fc1", "name": "Package", "shortName": "Package", "value": "CDIP-28" },
    { "key": "2f2e7f5a-7cd0-47da-8feb-a29336285a3e", "name": "Operating Temperature Range", "shortName": "T<sub>OP</sub>", "value": "-55°C to +125°C" }
  ],
  "dynamic": [
    { "key": "24d759de-b13d-4aa4-af76-42e60d2302ec", "name": "Number of Contacts", "shortName": "#Contacts", "value": 20, "category": "Mechanical Data" }
  ]
}
```

实现要点：
- 批量取值：一次性读取该组件的所有 parameters 记录 → 构建 `Map<parameter_key,value>`；再批量查询 definitions → 构建 `Map<parameter_key,{name,short_name,category}>`。
- 固定参数优先：先拼装 fixedExtras（Package、TOP），再按 meta.json 的 `meta` 顺序生成 dynamic。
- 缓存优化：`meta.json` 常驻内存或 Redis（TTL 建议 ≥ 1h）；definitions 也可缓存；组件详情可短期缓存 30m。
- 兼容性：提供查询参数 `includeEmpty=false` 以允许前端在需要时隐藏无值项（默认保留结构）。

### ⛳ 横向参数表模式（Beta）实施方案（静态+动态“一行展示”）

为对齐 DOEEET 的“每个器件一整行，左静态右动态”的交互，本期在搜索结果与详情弹窗中引入“横向参数表模式（Beta）”。核心是基于一套“列方案生成器”，将固定字段与动态参数列拼接为同一张宽表。

#### 一、列方案
- 静态列（固定）：
  - `partNumber`、`manufacturer`、`mainCategory/primaryCategory/secondaryCategory`（可视情况只留主类）、`package`、`TOP`
- 动态列（可变）：
  - 来源：接口返回的 `parameterDefinitions`（当前分类对应的候选参数定义）
  - 标题：优先 `short_name`，悬停显示完整 `name`；无 `short_name` 时直接显示 `name`
  - 取值：从每行数据的 `parameters[paramKey]` 读取

#### 二、数据整形
- 列表接口返回形如：
  - `entry.static`（静态字段）、`entry.fixedExtras`（Package/TOP）、`entry.dynamic[]`（若后端已返回动态值）
- 前端行对象构造：
  - `row.parameters = reduce(entry.dynamic, (acc, {key,value}) => (acc[key]=value, acc), {})`
  - `row.package/top` 优先取 `fixedExtras`；缺失时回退到 `static.part_type` 等

#### 三、渲染与交互
- 搜索结果表：
  - 列集合：`[静态列] + generateDynamicParameterColumns(parameterDefinitions)`
  - 冻结左侧关键列：`partNumber`、`manufacturer`
  - 横向滚动：`scroll.x` 启用，列宽自适应，超长 Tooltip
- 详情弹窗：
  - 以同一套列方案渲染一行数据（`dataSource=[selectedComponent]`），替换原三列“参数名称/值/分类”结构
  - 保留“基础信息”上方的 `Descriptions`，参数区切换为横向宽表

#### 四、性能策略
- 按当前页动态渲染可见列，启用列宽最小值与省略
- 后端尽量返回当前分类的 `parameterDefinitions`，避免首屏收集全库键集合
- 逐步演进：Beta 阶段只按 `parameterDefinitions` 生成列，不做“低频列阈值/列管理器”，后续再启用

#### 五、落地改动说明（已实施）
- 前端
  - `frontend/src/pages/components/ComponentSearch.tsx`
    - 列表：将搜索结果的 `entry.dynamic` 聚合为 `row.parameters`；并基于 `parameterDefinitions` 生成动态列，拼接到静态列后面
    - 详情：用“横向参数表（一行）”替换原三列表格，复用相同的动态列生成器
  - `frontend/src/utils/parameterUtils.tsx`
    - 复用 `generateParameterColumnTitle` 与 `generateDynamicParameterColumns`，标题规则与 Tooltip 保持与前述规范一致
- 兼容性
  - 若后端暂未返回 `entry.dynamic`，动态列仍会渲染但显示为 “-”，不影响页面可用性

#### 六、下一步（可选增强）
- 列管理器（显示/隐藏、拖拽排序、持久化）
- 参数值标准化与单位合并（如温度、电压范围格式）
- 虚拟化渲染以优化超宽表性能（>150 列）
#### 2. 分类筛选系统
- **数据分析完成**
  - 14个顶层分类（Resistors占45.88%，Capacitors占27.99%）
  - 181个叶子分类
  - 路径深度2-5层（86.86%为2层）
  - 1.8M组件100%有分类路径
  
- **UI组件集成**
  - CategoryFilter级联选择器
  - Tab导航（15个顶层分类）
  - 分类统计数量显示
  - 选择联动搜索

#### 3. 数据导出系统
- **CSV导出**
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码（支持Excel打开中文）
  - 自动文件名（带时间戳）
  - 1000行 < 1s（预期性能）

#### 4. 工具函数库
**8个核心函数** (`parameterUtils.tsx`):
```typescript
1. generateParameterColumnTitle()      // 生成智能表头
2. generateDynamicParameterColumns()   // 批量生成动态列
3. generateGroupedParameterColumns()   // 生成分组列
4. exportParametersToCSV()             // 导出CSV
5. downloadCSV()                       // 下载CSV文件
6. groupParametersByCategory()         // 按分类分组参数
7. formatParameterValue()              // 格式化参数值
8. extractParameterKeys()              // 提取参数键列表
```

### 📊 数据统计

| 项目 | 数量 | 说明 |
|------|------|------|
| 组件总数 | 1,797,417 | 有分类路径的组件 |
| 参数定义 | 360个 | 唯一参数键 |
| 有简写参数 | ~288个 (80%) | 有 short_name |
| 无简写参数 | ~72个 (20%) | 仅有 name |
| 顶层分类 | 14个 | Resistors, Capacitors等 |
| 叶子分类 | 181个 | 最细分类 |
| 文档数量 | 8份 | 完整技术文档 |
| 代码文件 | 3个 | 工具函数+示例+集成 |

### 🎨 UI效果预览

```
┌─────────────────────────────────────────────────────────────┐
│                  DoEEEt 器件搜索系统                         │
├─────────────────────────────────────────────────────────────┤
│ [分类筛选] ▼                                                 │
│   > Resistors (824,599)  > Capacitors (503,149)             │
│   > Connectors (160,090) > Crystals (131,524) ...          │
├─────────────────────────────────────────────────────────────┤
│ 型号: [_____] 制造商: [_____]  [搜索] [重置] [导出CSV]     │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────┬────────ⓘ┬──────ⓘ┬────────ⓘ┐           │
│ │ 器件型号 │ 制造 │  #Pins  │ T_STG  │  V_CC   │ ...       │
│ │         │ 商   │         │        │         │           │
│ ├─────────┼──────┼─────────┼────────┼─────────┤           │
│ │ 860300  │ SIB  │ 68      │-55~150°│ 3.3~5V  │ ...       │
│ │ 860301  │ SIB  │ 72      │-40~125°│ 5V      │ ...       │
│ └─────────┴──────┴─────────┴────────┴─────────┘           │
│                                                             │
│ 💡 提示：鼠标悬停在 #Pins, T_STG 等列上查看完整参数名      │
└─────────────────────────────────────────────────────────────┘
```

### 🚀 技术亮点

1. **类型安全**: 完整的TypeScript类型定义
2. **代码复用**: 8个通用工具函数，可在多页面复用
3. **性能优化**: 动态列宽、虚拟滚动支持
4. **安全性**: DOMPurify防XSS攻击
5. **可维护性**: JSDoc注释 + 详细文档
6. **用户体验**: Tooltip、省略、排序、筛选

### 📈 项目影响

- **开发效率提升**: 工具函数库减少50%重复代码
- **用户体验提升**: 智能表头 + 分类筛选，降低学习成本
- **维护成本降低**: 完整文档 + 类型定义，便于后期维护
- **可扩展性强**: 支持任意数量的动态参数，支持多级分类

---

## 联系方式

如有问题或建议，请联系开发团队。

**最后更新**: 2025-11-01  
**版本**: v2.4  
**整体进度**: 80% ✅


### 2025-11-11 (v2.4.1) 🛠️
- ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
  - `GET /api/doeeet/components/:id`（组件详情弹窗）
  - `GET /api/doeeet/categories/tree`（分类筛选器）
- ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
- ✅ Linter 检查通过（无新增告警）
- 影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
  - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`

#### 接下来建议
- P0：抽象统一的前端请求层（含超时、错误映射、重试/熔断开关），替换页面内分散实现
- P1：为 `POST /api/doeeet/components/compare` 套同样的超时/错误策略
- P1：后端 Faceting 与缓存（按既定里程碑 B），完善筛选器可用项和计数

### 2025-11-19 (v2.4.2) ⚙️
- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
- 🔄 下一步：在 README 或启动脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 数据目录

```

## 文档已更新
- 在 `DoEEEt功能开发总览.md` 添加“2025-11-19 更新（本地环境）”，记录 MongoDB 端口被系统服务与 Compass 占用的排查结论以及释放端口的标准流程，方便团队后续快速定位类似问题。
```168:172:DoEEEt功能开发总览.md
### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放
```

- 在 `DoEEEt集成实施总结.md` 新增“2025-11-19 (v2.4.2)”条目，记录相同的排查细节、解决办法及后续行动（将流程固化到文档/脚本）。
```1368:1372:DoEEEt集成实施总结.md
### 2025-11-19 (v2.4.2) ⚙️
- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
- 🔄 下一步：在 README 或启动脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 数据目录
```

## 建议
- 按新流程停掉系统 MongoDB 服务后再运行 `backend\start-mongodb-local.bat`。
- 后续可在启动脚本或 README 中加入自动检测与提示，减少再次踩坑的概率。

```plaintext
### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放
```

```plaintext
### 2025-11-19 (v2.4.2) ⚙️
- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
- 🔄 下一步：在 README 或启动脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 数据目录
```

---

**User**

把目前的版本git保存一下，然后咱们再继续开发，告诉我步骤，我自己在命令行输入

---

**Cursor**

好的，按下面步骤在命令行完成一次提交：

1. `cd F:\Business_plat`
2. `git status`  
   确认有哪些文件被修改。
3. `git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md`  
   如果还有其他需要一并提交的文件，也一并列出。
4. `git status`  
   确认要提交的文件都在暂存区。
5. `git commit -m "docs: record local MongoDB port fix"`  
   可按需调整提交信息。
6. `git status`  
   确认工作区干净（或只剩未提交的后续改动）。

完成后告诉我，我们再继续开发。

---

**User**

你觉得哪些比较重要，我看情况提交
(space_env) F:\Business_plat>git status
On branch full_dev_data_store
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   backend/data/persistent-data.json
        modified:   backend/dist/.tsbuildinfo
        modified:   backend/dist/controllers/doeeetComponentController.js
        modified:   backend/dist/controllers/doeeetComponentController.js.map
        modified:   backend/dist/index.js
        modified:   backend/dist/index.js.map
        modified:   backend/dist/models/index.js
        modified:   backend/dist/models/index.js.map
        modified:   backend/dist/services/AnalyticsService.js
        modified:   backend/dist/services/AnalyticsService.js.map
        modified:   backend/dist/services/DoeeetSearchService.js
        modified:   backend/dist/services/DoeeetSearchService.js.map
        modified:   backend/logs/combined.log
        modified:   data/dist_example(2)/dist_example/meta.json
        deleted:    data/doeeet/README_DOEEET_IMPORT.md
        deleted:    data/doeeet/analyze_csv.py
        deleted:    data/doeeet/config.py
        deleted:    data/doeeet/doeeet/general.csv
        deleted:    data/doeeet/doeeet/meta.json
        deleted:    data/doeeet/doeeet/parameter.csv
        deleted:    data/doeeet/doeeet/parameter_final.csv
        deleted:    "data/doeeet/doeeet/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        deleted:    data/doeeet/import_doeeet_data.py
        deleted:    data/doeeet/quick_start.py
        deleted:    data/doeeet/test_import.py
        modified:   frontend/src/App.tsx
        modified:   frontend/src/components/ComponentCompareModal.tsx
        modified:   frontend/src/components/Layout.tsx
        modified:   frontend/src/pages/ContractList.tsx
        modified:   frontend/src/pages/FinancialList.tsx
        modified:   frontend/src/pages/OfficeList.tsx
        modified:   frontend/src/pages/TenantList.tsx
        modified:   frontend/src/pages/UserList.tsx
        modified:   frontend/src/pages/application/CounterfeitDetection.tsx
        modified:   frontend/src/pages/components/AnalogICSearch.tsx
        modified:   frontend/src/pages/components/ComponentCompare.tsx
        modified:   frontend/src/pages/components/ComponentSearch.tsx
        modified:   frontend/src/pages/components/DigitalICSearch.tsx
        modified:   frontend/src/pages/components/DiscreteSearch.tsx
        modified:   frontend/src/pages/components/ElectromechanicalSearch.tsx
        modified:   frontend/src/pages/components/GeneralSearch.tsx
        modified:   frontend/src/pages/components/HybridICSearch.tsx
        modified:   frontend/src/pages/components/MicrosystemsSearch.tsx
        modified:   frontend/src/pages/components/MicrowaveSearch.tsx
        modified:   frontend/src/pages/components/OptoelectronicSearch.tsx
        modified:   frontend/src/pages/components/PowerSearch.tsx
        modified:   frontend/src/types/index.ts

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        DoEEEt-README.md
        "DoEEEt\345\212\237\350\203\275\345\274\200\345\217\221\346\200\273\350\247\210.md"
        "DoEEEt\351\233\206\346\210\220\345\256\236\346\226\275\346\200\273\347\273\223.md"
        "DoEEEt\351\241\271\347\233\256\345\274\200\345\217\221\350\256\241\345\210\222.md"
        "cursor\350\256\260\345\275\225/1109.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_10292_md.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_1029_md.md"
        "data/dist_example(2)/dist_example/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        docker-compose-simple.yml
        docker-compose.yml
        frontend/src/vite-env.d.ts
        package-lock.json
        records/
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211-\345\277\253\351\200\237\345\274\200\345\247\213.md"
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211\345\212\237\350\203\275\345\256\236\346\226\275\346\226\271\346\241\210.md"
        "\345\211\215\347\253\257\345\256\236\346\226\275\346\226\271\346\241\210\346\200\273\347\273\223.md"

no changes added to commit (use "git add" and/or "git commit -a")

(space_env) F:\Business_plat>

---

**Cursor**

建议按场景拆几组，方便你有选择地提交：

- **文档类**：`DoEEEt功能开发总览.md`、`DoEEEt集成实施总结.md` 以及新增的 `DoEEEt-README.md` 等，独立提交方便追踪知识沉淀。若只想保留今天记录，可单独提交这三份。
- **核心功能代码**：`frontend/src/components/ComponentCompareModal.tsx`、各 `Component*Search.tsx`、`frontend/src/types/index.ts`、`backend/dist/controllers/DoeeetComponentController.js` 等涉及搜索/对比逻辑的改动应一起提交，确保功能一致。
- **环境/配置**：`backend/data/persistent-data.json`、`frontend/src/vite-env.d.ts`、`package-lock.json`、`docker-compose*.yml`、新建 `records/` 等，如果只是本地调试可暂不提交；若要共享环境更新，就单独成一次 commit。
- **删除的数据脚本**：`data/doeeet/...` 中的删除如果是刻意清理，需要和团队确认，一旦提交就不可恢复；若只是在本地清仓可先忽略。
- **日志/构建产物**：`backend/dist/*.js`、`backend/logs/combined.log`、`data/dist_example(2)/.../meta.json` 通常不建议提交，除非你们仓库有特殊约定；可以先 `git restore` 或加入 `.gitignore`。

你可以先根据需要挑选文档或核心代码相关的文件 `git add`，再看剩下的是否要分批提交或忽略。需要我帮你拟具体命令再说。

---

**User**

请把文档类和核心功能代码提交吧

---

**Cursor**

先只处理“文档类 + 核心功能代码”，步骤如下（都在 `F:\Business_plat`）：

1. **暂存文档类文件**  
   ```powershell
   git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md DoEEEt-README.md
   ```
   如果那些新建的中文文档也需要一起提交，可以追加相应文件名（或用通配符 `git add DoEEEt*.md`，确认只包含你想提交的文档）。

2. **暂存核心功能代码**  
   ```powershell
   git add frontend/src/App.tsx `
           frontend/src/components/ComponentCompareModal.tsx `
           frontend/src/components/Layout.tsx `
           frontend/src/pages/*.tsx `
           frontend/src/pages/application/CounterfeitDetection.tsx `
           frontend/src/pages/components/*.tsx `
           frontend/src/types/index.ts
   ```
   这条会把 ContractList/UserList 等页面和所有 `components/*.tsx` 搜索页面一起加入。如果某些文件不想提交，可以在之后 `git reset <file>`。

3. **确认暂存内容**  
   ```powershell
   git status
   ```
   确保只有文档与核心前端代码被 staged，没有 `backend/dist`、日志或数据文件。

4. **提交**（自拟信息，例如）  
   ```powershell
   git commit -m "feat: sync docs and frontend doeeet flows"
   ```

有任何文件不小心被加进去，可在 commit 前用 `git reset <file>` 撤出。完成后告诉我，咱们继续下一步。

```powershell
   git add DoEEEt功能开发总览.md DoEEEt集成实施总结.md DoEEEt-README.md
```

```powershell
   git add frontend/src/App.tsx `
           frontend/src/components/ComponentCompareModal.tsx `
           frontend/src/components/Layout.tsx `
           frontend/src/pages/*.tsx `
           frontend/src/pages/application/CounterfeitDetection.tsx `
           frontend/src/pages/components/*.tsx `
           frontend/src/types/index.ts
```

```powershell
   git status
```

```powershell
   git commit -m "feat: sync docs and frontend doeeet flows"
```

---

**User**

帮我查看下git历史

---

**Cursor**

在仓库根目录执行下面命令就能看到最近的提交历史：

```powershell
git log --oneline -20
```

如果想看更详细内容（包括作者、时间、diff），可以用：

```powershell
git log -20
```

需要按分支、文件或图形化展示再告诉我。

```powershell
git log --oneline -20
```

```powershell
git log -20
```

---

**User**

器件详情中的Radiation: Potential Sensitivity下的若干信息我想在搜索结果页中也显示，搜索结果页中的辐照等级列信息就不用显示了。你先告诉我修改思路，我确认后再改

---

**Cursor**

### 修改思路（先沟通方案，不动代码）

1. **确认数据来源**  
   - 器件详情页能展示 “Radiation: Potential Sensitivity” 里的字段，说明后端 API 已经能返回这些数据（通常在 `backend/dist/controllers/doeeetComponentController.js` → `DoeeetComponentController.getComponentDetail` 或对应 service）。  
   - 搜索列表接口（`/components/search` 之类）目前只返回基本字段，没有把辐照信息带出来。

2. **后端响应扩展**  
   - 在 `DoeeetSearchService`（或底层查询逻辑）中把与辐照相关的字段（SEE Comments / SEE sens / TID(HDR) sens / …）一起选出来。  
   - 在搜索接口的返回对象中增加这些字段，命名沿用详情页的数据结构，最好放在一个子对象 `radiation` 里，避免平铺过多字段。  
   - 如果数据源在 MongoDB/JSON 里已有这些字段，直接映射；没有的话需要确认字段名（可以复用详情页的取值逻辑）。  
   - 同时删除/不返回旧的 “辐照等级” 字段，或保持但前端不使用。

3. **前端表格列调整**  
   - 搜索结果页（`frontend/src/pages/components/ComponentSearch.tsx` 以及其它 XSearch.tsx）里，有一个表格列用于显示 “辐照等级”。  
   - 把该列移除，改为在表格中添加一个新的 “Radiation” 区块：  
     - 方式 A：新增一列，列内用多行或标签展示四五个子字段；  
     - 方式 B：新增多列（SEE、TID(HDR)、TID(LDR)、TNID），按需求显示 Y/N 和备注。  
   - 渲染时从新接口字段读取，如果没有值显示 `-`。  
   - 需要更新 `frontend/src/types/index.ts` 中搜索结果项的类型定义，加入 `radiation` 字段（或对应的属性），并确保所有搜索页面共享类型。

4. **兼容性与检查**  
   - 确认后端改动不会影响其它使用同一接口的功能（比如导出）。  
   - 前端移除旧列后，检查表格宽度、响应式布局和排序/筛选逻辑是否需要调整。  
   - 如果有单元测试或 Storybook，补充/更新相应快照。

你确认这个方案后，我再动手实现。

---

**User**

可以，开始分步骤实现吧

---

**Cursor**

```typescript
import { 
  DoeeetComponent, 
  DoeeetParameter, 
  DoeeetParameterDefinition,
  DoeeetFamily,
  IDoeeetComponent 
} from '../models/DoeeetComponent';
import { logger } from '../utils/logger';
import { CacheService, getCacheService, CacheTTL } from './CacheService';

/**
 * DoEEEt搜索查询接口
 */
export interface DoeeetSearchQuery {
  // 基础搜索
  keyword?: string;              // 关键词搜索 (型号、制造商、类型)
  partNumber?: string;           // 型号搜索
  manufacturer?: string;         // 制造商搜索
  partType?: string;             // 产品类型搜索
  
  // 分类搜索
  familyPath?: string | string[]; // 分类路径
  
  // 参数搜索
  parameters?: {
    [key: string]: string | number | { min?: number; max?: number };
  };
  
  // 筛选条件
  hasStock?: boolean;            // 是否有库存
  obsolescenceType?: string[];   // 淘汰状态
  qualityName?: string;          // 质量等级
  qualified?: string;            // 是否合格
  
  // 分页和排序
  page?: number;
  limit?: number;
  sortBy?: string;               // 排序字段
  sortOrder?: 'asc' | 'desc';    // 排序方向
}

/**
 * 搜索结果接口
 */
export interface DoeeetSearchResult {
  components: any[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
  filters?: any;
}

/**
 * DoEEEt搜索服务类
 * 提供完整的搜索引擎功能，支持Redis缓存
 */
const RADIATION_SENSITIVITY_CATEGORY = 'Radiation: Potential Sensitivity';
const RADIATION_SENSITIVITY_ORDER = [
  'SEE Comments',
  'SEE sens.',
  'TID (HDR) sens.',
  'TID (LDR) sens.',
  'TNID Comments',
  'TNID sens.'
];

type RadiationSensitivityEntry = {
  key: string;
  name: string;
  shortName?: string;
  category?: string;
  value: string;
};

export class DoeeetSearchService {
  private cacheService: CacheService;

  constructor() {
    this.cacheService = getCacheService();
  }
  
  /**
   * 1. 全文搜索功能
   * 支持型号、制造商、产品类型的模糊搜索
   * 带Redis缓存优化
   */
  async fullTextSearch(
    keyword: string,
    options: {
      limit?: number;
      hasStock?: boolean;
      obsolescenceType?: string[];
      page?: number;
    } = {}
  ): Promise<any[]> {
    try {
      const limit = options.limit || 20;
      const page = options.page || 1;
      
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedFullTextSearchResult(keyword, page);
      if (cached) {
        logger.info(`✅ 全文搜索缓存命中 "${keyword}" (page ${page})`);
        return cached;
      }
      
      logger.info(`⚡ 全文搜索缓存未命中 "${keyword}", 查询数据库...`);
      
      // 构建查询条件
      const query: any = {
        $text: { $search: keyword }
      };
      
      // 添加筛选条件
      if (options.hasStock !== undefined) {
        query.has_stock = options.hasStock;
      }
      
      if (options.obsolescenceType && options.obsolescenceType.length > 0) {
        query.obsolescence_type = { $in: options.obsolescenceType };
      }
      
      // 执行搜索，按相关性评分排序
      const components = await DoeeetComponent.find(
        query,
        { score: { $meta: 'textScore' } }
      )
      .sort({ score: { $meta: 'textScore' } })
      .limit(limit)
      .lean();
      
      // 缓存结果
      await this.cacheService.cacheFullTextSearchResult(keyword, page, components);
      
      logger.info(`全文搜索 "${keyword}": 找到 ${components.length} 个结果`);
      return components;
      
    } catch (error) {
      logger.error('全文搜索失败:', error);
      throw new Error('全文搜索失败');
    }
  }
  
  /**
   * 2. 分类搜索功能
   * 按产品分类路径浏览
   * 带Redis缓存优化
   */
  async searchByCategory(
    familyPath: string | string[],
    options: {
      page?: number;
      limit?: number;
      hasStock?: boolean;
      obsolescenceType?: string[];
    } = {}
  ): Promise<DoeeetSearchResult> {
    try {
      const page = options.page || 1;
      const limit = options.limit || 50;
      const skip = (page - 1) * limit;
      
      // 只缓存精确分类路径（数组形式）
      if (Array.isArray(familyPath)) {
        const cached = await this.cacheService.getCachedCategoryBrowse(familyPath, page);
        if (cached) {
          logger.info(`✅ 分类浏览缓存命中 [${familyPath.join(' > ')}] (page ${page})`);
          return cached;
        }
        logger.info(`⚡ 分类浏览缓存未命中, 查询数据库...`);
      }
      
      // 构建查询条件
      const query: any = {};
      
      if (typeof familyPath === 'string') {
        // 字符串形式：优先使用 $in 匹配数组字段；兼容部分数据将 family_path 存为字符串的情况
        // 当为字符串存储时，使用不区分大小写的正则回退匹配
        const regex = new RegExp(familyPath, 'i');
        query.$or = [
          { family_path: { $in: [familyPath] } },
          { family_path: { $regex: regex } }
        ];
      } else if (Array.isArray(familyPath)) {
        // 数组形式：根据数组长度决定匹配策略
        if (familyPath.length === 1) {
          // 只有一级分类（如 ['Resistors']）
          // 匹配所有包含该分类的组件（通常是顶层分类）
          const [top] = familyPath;
          const regex = new RegExp(top, 'i');
          query.$or = [
            { family_path: { $in: familyPath } },
            { family_path: { $regex: regex } }
          ];
        } else {
          // 多级分类（如 ['Potentiometer', 'Resistors']）
          // 使用精确数组匹配：只返回完全匹配该路径的组件
          // 性能测试：精确匹配 (1.7ms) 比 $all (3.8ms) 快 2 倍
          // 注意：family_path 在数据库中是从具体到一般的顺序
          // 例如：['Potentiometer', 'Resistors'] 表示 Potentiometer(子类) -> Resistors(父类)
          query.$or = [
            { family_path: familyPath },
            // 字符串存储的兼容：按各级分类都包含进行回退匹配（顺序不强制）
            ...familyPath.map(level => ({ family_path: { $regex: new RegExp(level, 'i') } }))
          ];
        }
      }
      
      // 添加筛选条件
      if (options.hasStock !== undefined) {
        query.has_stock = options.hasStock;
      }
      
      if (options.obsolescenceType && options.obsolescenceType.length > 0) {
        query.obsolescence_type = { $in: options.obsolescenceType };
      }
      
      // 执行查询
      const [components, total] = await Promise.all([
        DoeeetComponent.find(query)
          .sort({ part_number: 1 })
          .skip(skip)
          .limit(limit)
          .lean(),
        DoeeetComponent.countDocuments(query)
      ]);
      
      const totalPages = Math.ceil(total / limit);
      
      const result = {
        components,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      };
      
      // 缓存结果（仅精确匹配）
      if (Array.isArray(familyPath)) {
        await this.cacheService.cacheCategoryBrowse(familyPath, page, result);
      }
      
      logger.info(`分类搜索 "${familyPath}": 找到 ${total} 个结果`);
      
      return result;
      
    } catch (error) {
      logger.error('分类搜索失败:', error);
      throw new Error('分类搜索失败');
    }
  }
  
  /**
   * 3. 参数搜索功能
   * 按技术参数筛选组件
   */
  async searchByParameters(
    parameters: { [key: string]: string | number | { min?: number; max?: number } },
    options: {
      page?: number;
      limit?: number;
    } = {}
  ): Promise<DoeeetSearchResult> {
    try {
      const page = options.page || 1;
      const limit = options.limit || 50;
      const skip = (page - 1) * limit;
      
      // 构建参数查询条件
      const paramQueries = [];
      
      for (const [key, value] of Object.entries(parameters)) {
        if (typeof value === 'object' && ('min' in value || 'max' in value)) {
          // 范围查询
          const rangeQuery: any = { parameter_key: key };
          if (value.min !== undefined) {
            rangeQuery.numeric_value = { $gte: value.min };
          }
          if (value.max !== undefined) {
            rangeQuery.numeric_value = { 
              ...rangeQuery.numeric_value, 
              $lte: value.max 
            };
          }
          paramQueries.push(rangeQuery);
        } else {
          // 精确值查询
          paramQueries.push({
            parameter_key: key,
            parameter_value: String(value)
          });
        }
      }
      
      // 查找匹配的参数记录
      const matchingParams = await DoeeetParameter.find({
        $or: paramQueries
      }).lean();
      
      // 按组件ID分组，计算每个组件匹配的参数数量
      const componentMatches = new Map<string, number>();
      matchingParams.forEach(param => {
        const count = componentMatches.get(param.component_id) || 0;
        componentMatches.set(param.component_id, count + 1);
      });
      
      // 筛选出匹配所有参数的组件
      const requiredMatches = Object.keys(parameters).length;
      const componentIds = Array.from(componentMatches.entries())
        .filter(([_, count]) => count >= requiredMatches)
        .map(([id, _]) => id);
      
      if (componentIds.length === 0) {
        return {
          components: [],
          total: 0,
          page,
          limit,
          totalPages: 0,
          hasNextPage: false,
          hasPrevPage: false
        };
      }
      
      // 查询组件详情
      const [components, total] = await Promise.all([
        DoeeetComponent.find({ component_id: { $in: componentIds } })
          .skip(skip)
          .limit(limit)
          .lean(),
        Promise.resolve(componentIds.length)
      ]);
      
      const totalPages = Math.ceil(total / limit);
      
      logger.info(`参数搜索: 找到 ${total} 个匹配的组件`);
      
      return {
        components,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      };
      
    } catch (error) {
      logger.error('参数搜索失败:', error);
      throw new Error('参数搜索失败');
    }
  }
  
  /**
   * 4. 复合搜索功能
   * 组合多种搜索条件
   * 带Redis缓存优化
   */
  async advancedSearch(query: DoeeetSearchQuery): Promise<DoeeetSearchResult> {
    try {
      const page = query.page || 1;
      const limit = Math.min(query.limit || 20, 100);
      const skip = (page - 1) * limit;
      
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedSearchResult(query);
      if (cached) {
        logger.info(`✅ 复合搜索缓存命中`);
        return cached;
      }
      
      logger.info(`⚡ 复合搜索缓存未命中, 查询数据库...`);
      logger.info(`查询参数: ${JSON.stringify(query, null, 2)}`);
      
      // 构建MongoDB查询
      const mongoQuery: any = {};
      
      // 1. 关键词搜索（使用正则表达式进行模糊匹配，避免全文索引问题）
      if (query.keyword) {
        const keywordRegex = new RegExp(query.keyword, 'i');
        mongoQuery.$or = [
          { part_number: keywordRegex },
          { manufacturer_name: keywordRegex },
          { part_type: keywordRegex }
        ];
      }
      
      // 2. 精确型号搜索
      if (query.partNumber) {
        mongoQuery.part_number = { $regex: query.partNumber, $options: 'i' };
      }
      
      // 3. 制造商搜索
      if (query.manufacturer) {
        mongoQuery.manufacturer_name = { $regex: query.manufacturer, $options: 'i' };
      }
      
      // 4. 产品类型搜索
      if (query.partType) {
        mongoQuery.part_type = { $regex: query.partType, $options: 'i' };
      }
      
      // 5. 分类搜索
      if (query.familyPath) {
        if (typeof query.familyPath === 'string') {
          // 字符串形式：匹配包含该分类的所有组件
          // 使用 $in 操作符，性能比 $elemMatch 更好
          const regex = new RegExp(query.familyPath, 'i');
          mongoQuery.$or = [
            { family_path: { $in: [query.familyPath] } },
            { family_path: { $regex: regex } }
          ];
        } else if (Array.isArray(query.familyPath)) {
          // 数组形式：根据数组长度决定匹配策略
          if (query.familyPath.length === 1) {
            // 只有一级分类（如 ['Resistors']）
            // 匹配所有包含该分类的组件
            // 使用 $in 操作符：性能测试显示比 $elemMatch 快 5 倍
            const [top] = query.familyPath;
            const regex = new RegExp(top, 'i');
            mongoQuery.$or = [
              { family_path: { $in: query.familyPath } },
              { family_path: { $regex: regex } }
            ];
          } else {
            // 多级分类（如 ['Current Regulator', 'Diode', 'Discretes']）
            // 使用 $all 操作符：匹配包含所有分类的组件，不要求顺序一致
            // 这样可以处理前端发送的分类路径顺序与数据库中存储顺序不一致的情况
            const reversed = [...query.familyPath].reverse();
            const joinedCandidates = [
              query.familyPath.join(' / '),
              query.familyPath.join('/'),
              query.familyPath.join(' > '),
              query.familyPath.join('>'),
            ];
            mongoQuery.$or = [
              { family_path: { $all: query.familyPath } },
              // 精确数组（可能数据库为叶子->顶层或顶层->叶子两种顺序）
              { family_path: query.familyPath },
              { family_path: reversed },
              // 字符串存储兼容：所有层级都能被字符串包含命中（用$and + 正则数组）
              { $and: query.familyPath.map(level => ({ family_path: { $regex: new RegExp(level, 'i') } })) },
              // 常见分隔符的字符串路径匹配
              { family_path: { $in: joinedCandidates } }
            ];
          }
        }
      }
      
      // 6. 库存筛选
      if (query.hasStock !== undefined) {
        mongoQuery.has_stock = query.hasStock;
      }
      
      // 7. 淘汰状态筛选
      if (query.obsolescenceType && query.obsolescenceType.length > 0) {
        mongoQuery.obsolescence_type = { $in: query.obsolescenceType };
      }
      
      // 8. 质量等级筛选
      if (query.qualityName) {
        mongoQuery.quality_name = query.qualityName;
      }
      
      // 9. 合格状态筛选
      if (query.qualified) {
        mongoQuery.qualified = query.qualified;
      }
      
      // 如果有参数搜索，需要先查询参数表
      let componentIds: string[] | undefined;
      if (query.parameters && Object.keys(query.parameters).length > 0) {
        const paramResult = await this.searchByParameters(query.parameters, { 
          page: 1, 
          limit: 10000  // 获取所有匹配的ID
        });
        componentIds = paramResult.components.map(c => c.component_id);
        
        if (componentIds.length === 0) {
          // 没有匹配的组件，直接返回空结果
          return {
            components: [],
            total: 0,
            page,
            limit,
            totalPages: 0,
            hasNextPage: false,
            hasPrevPage: false
          };
        }
        
        mongoQuery.component_id = { $in: componentIds };
      }
      
      // 构建排序条件
      const sort: any = {};
      if (query.sortBy) {
        // 自定义排序
        const sortField = this.mapSortField(query.sortBy);
        sort[sortField] = query.sortOrder === 'desc' ? -1 : 1;
      } else {
        // 默认按型号排序
        sort.part_number = 1;
      }
      
      // 记录查询条件用于调试
      logger.info(`MongoDB查询条件: ${JSON.stringify(mongoQuery, null, 2)}`);

      // 诊断统计：当按分类数组筛选时，输出几种常见匹配方式的命中数，便于定位数据形态
      if (Array.isArray(query.familyPath) && query.familyPath.length > 0) {
        try {
          const diagTop = query.familyPath[0];
          const diagRegexTop = new RegExp(diagTop, 'i');
          const diagReversed = [...query.familyPath].reverse();
          const diagJoined = [
            query.familyPath.join(' / '),
            query.familyPath.join('/'),
            query.familyPath.join(' > '),
            query.familyPath.join('>'),
          ];
          const [
            cIn,
            cAll,
            cRegexAnd,
            cExact,
            cExactReversed,
            cRegexAnyTop,
            cJoinedIn
          ] = await Promise.all([
            DoeeetComponent.countDocuments({ family_path: { $in: query.familyPath as string[] } }),
            DoeeetComponent.countDocuments({ family_path: { $all: query.familyPath as string[] } }),
            DoeeetComponent.countDocuments({ $and: (query.familyPath as string[]).map(level => ({ family_path: { $regex: new RegExp(level, 'i') } })) }),
            DoeeetComponent.countDocuments({ family_path: query.familyPath as string[] }),
            DoeeetComponent.countDocuments({ family_path: diagReversed }),
            DoeeetComponent.countDocuments({ family_path: { $regex: diagRegexTop } }),
            DoeeetComponent.countDocuments({ family_path: { $in: diagJoined } }),
          ]);
          logger.info(`分类诊断 - $in: ${cIn}, $all: ${cAll}, $and+regex: ${cRegexAnd}, exact: ${cExact}, exact(reversed): ${cExactReversed}, regex(top): ${cRegexAnyTop}, joined(in): ${cJoinedIn}`);
        } catch (e) {
          logger.warn('分类诊断统计失败', e);
        }
      }
      
      // 执行查询
      const queryBuilder = DoeeetComponent.find(mongoQuery);
      
      const [components, total] = await Promise.all([
        queryBuilder
          .sort(sort)
          .skip(skip)
          .limit(limit)
          .lean(),
        DoeeetComponent.countDocuments(mongoQuery)
      ]);
      
      let enhancedComponents = components;
      if (components.length > 0) {
        const componentIdsForRadiation = Array.from(
          new Set(
            components
              .map(comp => comp?.component_id || comp?.componentId || comp?._id?.toString())
              .filter((id): id is string => typeof id === 'string' && id.length > 0)
          )
        );
        const radiationMap = await this.getRadiationSensitivityData(componentIdsForRadiation);
        enhancedComponents = components.map(comp => {
          const identifier = comp?.component_id || comp?.componentId || comp?._id?.toString();
          return {
            ...comp,
            radiation_sensitivity: identifier ? (radiationMap.get(identifier) || []) : []
          };
        });
      }
      
      const totalPages = Math.ceil(total / limit);
      
      const result = {
        components: enhancedComponents,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1,
        filters: this.getAppliedFilters(query)
      };
      
      // 缓存结果
      await this.cacheService.cacheSearchResult(query, result);
      
      logger.info(`复合搜索: 找到 ${total} 个结果`);
      
      return result;
      
    } catch (error) {
      logger.error('复合搜索失败:', error);
      throw new Error('复合搜索失败');
    }
  }
  
  /**
   * 5. 搜索建议功能
   * 自动补全和搜索推荐
   */
  async getSearchSuggestions(
    keyword: string,
    limit: number = 10
  ): Promise<{
    components: Array<{ partNumber: string; manufacturer: string; partType: string }>;
    manufacturers: string[];
    categories: string[];
  }> {
    try {
      if (!keyword || keyword.length < 2) {
        return { components: [], manufacturers: [], categories: [] };
      }
      
      const searchRegex = new RegExp(keyword, 'i');
      
      // 1. 搜索匹配的组件
      const components = await DoeeetComponent.find({
        $or: [
          { part_number: searchRegex },
          { part_type: searchRegex },
          { manufacturer_name: searchRegex }
        ]
      })
      .select('part_number manufacturer_name part_type')
      .limit(Math.floor(limit * 0.6))
      .lean();
      
      // 2. 获取匹配的制造商
      const manufacturers = await DoeeetComponent.distinct('manufacturer_name', {
        manufacturer_name: searchRegex
      });
      
      // 3. 获取匹配的分类
      const categoriesResult = await DoeeetComponent.find({
        family_path: searchRegex
      })
      .distinct('family_path')
      .limit(Math.floor(limit * 0.2));
      
      // 展平分类路径
      const categories = Array.from(new Set(
        categoriesResult
          .flat()
          .filter(cat => cat.toLowerCase().includes(keyword.toLowerCase()))
      )).slice(0, Math.floor(limit * 0.2));
      
      return {
        components: components.map(c => ({
          partNumber: c.part_number,
          manufacturer: c.manufacturer_name,
          partType: c.part_type
        })),
        manufacturers: manufacturers.slice(0, Math.floor(limit * 0.2)),
        categories
      };
      
    } catch (error) {
      logger.error('获取搜索建议失败:', error);
      throw new Error('获取搜索建议失败');
    }
  }
  
  /**
   * 获取组件详情（包含参数）
   * 带Redis缓存优化
   */
  async getComponentWithParameters(componentId: string): Promise<any> {
    try {
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedComponentDetail(componentId);
      if (cached) {
        logger.info(`✅ 组件详情缓存命中 [${componentId}]`);
        return cached;
      }
      
      logger.info(`⚡ 组件详情缓存未命中, 查询数据库...`);
      
      // 查询组件基本信息
      const component = await DoeeetComponent.findOne({ 
        component_id: componentId 
      }).lean();
      
      if (!component) {
        return null;
      }
      
      // 查询组件参数
      const parameters = await DoeeetParameter.find({ 
        component_id: componentId 
      }).lean();
      
      // 获取参数定义（从缓存或数据库）
      const paramKeys = parameters.map(p => p.parameter_key);
      const definitions = await this.getParameterDefinitions(paramKeys);
      
      // 创建参数定义映射
      const definitionMap = new Map(
        definitions.map(d => [d.parameter_key, d])
      );
      
      // 组合参数和定义
      const parametersWithDefinitions = parameters.map(param => {
        const def = definitionMap.get(param.parameter_key);
        return {
          key: param.parameter_key,
          name: def?.name || 'Unknown',
          shortName: def?.short_name,
          category: def?.category,
          value: param.parameter_value,
          numericValue: param.numeric_value
        };
      });
      
      const result = {
        ...component,
        parameters: parametersWithDefinitions
      };
      
      // 缓存结果
      await this.cacheService.cacheComponentDetail(componentId, result);
      
      return result;
      
    } catch (error) {
      logger.error('获取组件详情失败:', error);
      throw new Error('获取组件详情失败');
    }
  }
  
  /**
   * 获取所有制造商列表
   * 带Redis缓存优化
   */
  async getManufacturers(): Promise<string[]> {
    return await this.cacheService.getOrSet(
      'meta:manufacturers',
      async () => {
        logger.info('⚡ 制造商列表缓存未命中, 查询数据库...');
        const manufacturers = await DoeeetComponent.distinct('manufacturer_name');
        return manufacturers.sort();
      },
      CacheTTL.MANUFACTURERS
    );
  }
  
  /**
   * 获取所有分类路径
   * 带Redis缓存优化
   */
  async getFamilyPaths(): Promise<string[][]> {
    return await this.cacheService.getCachedCategoriesTree() || 
      await this.cacheService.getOrSet(
        'meta:categories:tree',
        async () => {
          logger.info('⚡ 分类列表缓存未命中, 查询数据库...');
          const paths = await DoeeetComponent.distinct('family_path');
          return paths.sort((a, b) => a.join(' > ').localeCompare(b.join(' > ')));
        },
        CacheTTL.CATEGORIES
      );
  }
  
  /**
   * 获取分类元数据
   * 带Redis缓存优化
   */
  async getCategoryMeta(familyPath: string[]): Promise<any> {
    return await this.cacheService.getOrSet(
      `meta:family:${familyPath.join('/')}`,
      async () => {
        logger.info(`⚡ 分类元数据缓存未命中 [${familyPath.join(' > ')}], 查询数据库...`);
        const family = await DoeeetFamily.findOne({ 
          family_path: familyPath 
        }).lean();
        return family;
      },
      CacheTTL.FAMILY_META
    );
  }
  
  /**
   * 获取参数定义
   * 带Redis缓存优化
   */
  async getParameterDefinitions(keys?: string[]): Promise<any[]> {
    // 获取所有参数定义（缓存）
    const allDefs = await this.cacheService.getOrSet(
      'meta:parameter_definitions',
      async () => {
        logger.info('⚡ 参数定义缓存未命中, 查询数据库...');
        const definitions = await DoeeetParameterDefinition.find({}).lean();
        return definitions;
      },
      CacheTTL.PARAMETER_DEFS
    );
    
    // 如果指定了keys，过滤返回
    if (keys && keys.length > 0) {
      const keySet = new Set(keys);
      return allDefs.filter(def => keySet.has(def.parameter_key));
    }
    
    return allDefs;
  }
  
  /**
   * 获取统计信息
   * 带Redis缓存优化
   */
  async getStatistics(): Promise<{
    totalComponents: number;
    activeComponents: number;
    obsoleteComponents: number;
    componentsInStock: number;
    manufacturerCount: number;
    categoryCount: number;
    categoryStats: { [key: string]: number };
  }> {
    return await this.cacheService.getOrSet(
      'meta:statistics',
      async () => {
        logger.info('⚡ 统计信息缓存未命中, 查询数据库...');
        const [
          totalComponents,
          activeComponents,
          obsoleteComponents,
          componentsInStock,
          manufacturers,
          categories,
          categoryAggregation
        ] = await Promise.all([
          DoeeetComponent.countDocuments(),
          DoeeetComponent.countDocuments({ obsolescence_type: 'Active' }),
          DoeeetComponent.countDocuments({ 
            obsolescence_type: { $in: ['Obsolete', 'Last Time Buy'] } 
          }),
          DoeeetComponent.countDocuments({ has_stock: true }),
          DoeeetComponent.distinct('manufacturer_name'),
          DoeeetComponent.distinct('family_path'),
          // 按分类聚合统计
          DoeeetComponent.aggregate([
            {
              $group: {
                _id: '$family_path',
                count: { $sum: 1 }
              }
            }
          ])
        ]);
        
        // 构建分类统计对象（注意：family_path 为从叶子到顶层的顺序）
        const categoryStats: { [key: string]: number } = {};
        categoryAggregation.forEach((item: any) => {
          if (item._id) {
            // item._id 在聚合中为数组（如果集合中是数组存储）；兼容字符串情况
            const pathArr = Array.isArray(item._id)
              ? item._id
              : (() => {
                  try {
                    return JSON.parse(String(item._id).replace(/'/g, '"'));
                  } catch {
                    return [];
                  }
                })();
            const mainCategory = Array.isArray(pathArr) && pathArr.length > 0
              ? pathArr[pathArr.length - 1]
              : String(item._id);
            categoryStats[mainCategory] = (categoryStats[mainCategory] || 0) + item.count;
          }
        });
        
        return {
          totalComponents,
          activeComponents,
          obsoleteComponents,
          componentsInStock,
          manufacturerCount: manufacturers.length,
          categoryCount: categories.length,
          categoryStats
        };
      },
      CacheTTL.STATISTICS
    );
  }
  
  // ========== 私有辅助方法 ==========
  
  /**
   * 映射排序字段
   */
  private mapSortField(sortBy: string): string {
    const fieldMap: { [key: string]: string } = {
      'partNumber': 'part_number',
      'manufacturer': 'manufacturer_name',
      'partType': 'part_type',
      'obsolescence': 'obsolescence_type',
      'stock': 'has_stock',
      'created': 'createdAt',
      'updated': 'updatedAt'
    };
    
    return fieldMap[sortBy] || sortBy;
  }
  
  /**
   * 获取应用的筛选条件
   */
  private getAppliedFilters(query: DoeeetSearchQuery): any {
    return {
      keyword: query.keyword,
      partNumber: query.partNumber,
      manufacturer: query.manufacturer,
      partType: query.partType,
      familyPath: query.familyPath,
      hasStock: query.hasStock,
      obsolescenceType: query.obsolescenceType,
      qualityName: query.qualityName,
      qualified: query.qualified,
      parameters: query.parameters
    };
  }
  
  /**
   * 构建分类树（用于前端分类筛选）
   * 从数据库读取所有 family_path 并构建层级结构
   */
  async buildCategoryTree(): Promise<any> {
    try {
      // 尝试从缓存获取
      const cacheKey = 'category_tree';
      const cached = await this.cacheService.get(cacheKey);
      if (cached) {
        logger.info('✅ 分类树缓存命中');
        return cached;
      }
      
      logger.info('⚡ 从数据库构建分类树...');
      
      // 从数据库获取所有唯一的 family_path
      // 优先从 DoeeetFamily 集合读取（更准确），如果没有则从 DoeeetComponent 读取
      let familyPaths: string[][] = [];
      
      try {
        // 尝试从 DoeeetFamily 集合读取
        const families = await DoeeetFamily.find({}).select('family_path').lean();
        if (families && families.length > 0) {
          familyPaths = families.map((f: any) => f.family_path || []).filter((path: string[]) => path.length > 0);
          logger.info(`✅ 从 DoeeetFamily 集合读取到 ${familyPaths.length} 个分类路径`);
        } else {
          // 如果 DoeeetFamily 集合为空，从 DoeeetComponent 读取
          familyPaths = await DoeeetComponent.distinct('family_path');
          logger.info(`✅ 从 DoeeetComponent 集合读取到 ${familyPaths.length} 个分类路径`);
        }
      } catch (error) {
        logger.warn('从数据库读取分类路径失败，尝试从 DoeeetComponent 读取:', error);
        // 降级方案：从 DoeeetComponent 读取
        familyPaths = await DoeeetComponent.distinct('family_path');
      }
      
      if (!familyPaths || familyPaths.length === 0) {
        logger.warn('⚠️ 数据库中没有找到分类路径，使用降级数据');
        throw new Error('No family paths found in database');
      }
      
      // 构建分类树结构
      const tree: any[] = [];
      const subCategories: any = {};
      const categoryMap = new Map<string, any>();
      
      // 去重：使用 Set 存储已处理的路径（转换为字符串用于比较）
      const processedPaths = new Set<string>();
      
      familyPaths.forEach((fullPath: string[]) => {
        if (!fullPath || fullPath.length === 0) return;
        
        // 归一化：数据库为 叶子->顶层，这里反转为 顶层->叶子
        const normalizedPath = [...fullPath].reverse();

        // 将路径转换为字符串用于去重
        const pathKey = JSON.stringify(normalizedPath);
        if (processedPaths.has(pathKey)) return;
        processedPaths.add(pathKey);
        
        const topCategory = normalizedPath[0]; // 顶层分类
        
        // 初始化顶层分类
        if (!categoryMap.has(topCategory)) {
          const node = {
            label: topCategory,
            value: topCategory,
            children: []
          };
          categoryMap.set(topCategory, node);
          tree.push(node);
          subCategories[topCategory] = {};
        }
        
        // 逐级构建子分类
        let currentLevel = categoryMap.get(topCategory).children;
        
        for (let i = 1; i < normalizedPath.length; i++) {
          const categoryName = normalizedPath[i];
          
          // 查找或创建当前级别节点
          let node = currentLevel.find((n: any) => n.value === categoryName);
          
          if (!node) {
            node = {
              label: categoryName,
              value: categoryName,
              children: []
            };
            currentLevel.push(node);
          }
          
          // 构建 subCategories 结构（用于Tab+侧边栏展示）
          if (i === 1) {
            // 二级分类
            if (!subCategories[topCategory][categoryName]) {
              subCategories[topCategory][categoryName] = [];
            }
          } else if (i === 2) {
            // 三级分类
            const secondLevel = normalizedPath[1];
            if (!subCategories[topCategory][secondLevel]) {
              subCategories[topCategory][secondLevel] = [];
            }
            if (!subCategories[topCategory][secondLevel].includes(categoryName)) {
              subCategories[topCategory][secondLevel].push(categoryName);
            }
          }
          
          currentLevel = node.children;
        }
      });
      
      // 对树进行排序
      const sortTree = (nodes: any[]) => {
        nodes.sort((a, b) => a.label.localeCompare(b.label));
        nodes.forEach(node => {
          if (node.children && node.children.length > 0) {
            sortTree(node.children);
          }
        });
      };
      sortTree(tree);
      
      // 对 subCategories 中的数组进行排序
      Object.keys(subCategories).forEach(topCategory => {
        Object.keys(subCategories[topCategory]).forEach(secondLevel => {
          if (Array.isArray(subCategories[topCategory][secondLevel])) {
            subCategories[topCategory][secondLevel].sort();
          }
        });
      });
      
      const result = { tree, subCategories };
      
      // 缓存结果（24小时）
      await this.cacheService.set(cacheKey, result, CacheTTL.CATEGORIES);
      
      logger.info(`✅ 分类树构建完成：${tree.length} 个顶层分类，共 ${familyPaths.length} 个分类路径`);
      
      return result;
    } catch (error) {
      logger.error('构建分类树失败:', error);
      
      // 返回降级数据
      const fallbackCategories = [
        "Cable Assemblies", "Capacitors", "Connectors", "Crystals and Oscillators",
        "Discretes", "Filters", "Inductors", "Microcircuits", "Relays", "Resistors",
        "RF Passive Components", "Switches", "Thermistors", "Transformers", "Wires and Cables"
      ];
      
      return {
        tree: fallbackCategories.map(cat => ({
          label: cat,
          value: cat,
          children: []
        })),
        subCategories: {}
      };
    }
  }
  
  private async getRadiationSensitivityData(componentIds: string[]): Promise<Map<string, RadiationSensitivityEntry[]>> {
    const result = new Map<string, RadiationSensitivityEntry[]>();
    if (!componentIds || componentIds.length === 0) {
      return result;
    }

    const allDefinitions = await this.getParameterDefinitions();
    const radiationDefinitions = allDefinitions.filter(def => def?.category === RADIATION_SENSITIVITY_CATEGORY);
    if (radiationDefinitions.length === 0) {
      return result;
    }

    const definitionMap = new Map(
      radiationDefinitions.map(def => [def.parameter_key, def])
    );
    const radiationKeys = Array.from(definitionMap.keys());

    const radiationParams = await DoeeetParameter.find({
      component_id: { $in: componentIds },
      parameter_key: { $in: radiationKeys }
    }).lean();

    radiationParams.forEach(param => {
      const def = definitionMap.get(param.parameter_key);
      if (!def) {
        return;
      }
      const entry: RadiationSensitivityEntry = {
        key: param.parameter_key,
        name: def.name || param.parameter_key,
        shortName: def.short_name,
        category: def.category,
        value: param.parameter_value
      };
      if (!result.has(param.component_id)) {
        result.set(param.component_id, []);
      }
      result.get(param.component_id)!.push(entry);
    });

    if (result.size > 0) {
      const orderMap = new Map<string, number>(
        RADIATION_SENSITIVITY_ORDER.map((label, index) => [label.toLowerCase(), index])
      );
      result.forEach(entries => {
        entries.sort((a, b) => {
          const orderA = orderMap.get((a.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
          const orderB = orderMap.get((b.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
          if (orderA !== orderB) {
            return orderA - orderB;
          }
          return (a.name || '').localeCompare(b.name || '');
        });
      });
    }

    return result;
  }
}

// 导出单例
export const doeeetSearchService = new DoeeetSearchService();


```

```typescriptreact
*** Begin Patch
*** Update File: frontend/src/pages/components/ComponentSearch.tsx
@@
-interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
+interface RadiationSensitivityItem {
+  key: string;
+  name: string;
+  shortName?: string;
+  value: string;
+}
+
+interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
   mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
   primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
   secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
   package?: string;
   top?: string;
   qualityLevel?: string; // 覆盖为string类型以支持中文
   lifecycle?: string; // 覆盖为string类型以支持中文
@@
   }>[];
   component_id?: string; // DoEEEt组件ID
+  radiationSensitivity?: RadiationSensitivityItem[];
 }
*** End Patch
```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationLevel: '-',
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
                <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
                    <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
                    <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
                    <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                      {selectedComponent.qualityLevel}
                    </Tag>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
                </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
                      {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
                      ))}
                    </Space>
                  ) : (
                    '-'
                  )}
                </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                      </div>
                    </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
                    <Table
                      size="small"
                      columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                        { title: '库存', dataIndex: 'stock', key: 'stock' },
                        { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                      ]}
                      dataSource={selectedComponent.suppliers}
                      pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter(item => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map(item => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter(item => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '辐照等级',
      dataIndex: 'radiationLevel',
      key: 'radiationLevel',
      width: 100,
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map(item => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter(item => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: 'Radiation: Potential Sensitivity',
      dataIndex: 'radiationSensitivity',
      key: 'radiationSensitivity',
      width: 280,
      render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="辐照等级">{selectedComponent.radiationLevel || '-'}</Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map(item => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter(item => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: 'Radiation: Potential Sensitivity',
      dataIndex: 'radiationSensitivity',
      key: 'radiationSensitivity',
      width: 280,
      render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescript
import { 
  DoeeetComponent, 
  DoeeetParameter, 
  DoeeetParameterDefinition,
  DoeeetFamily,
  IDoeeetComponent 
} from '../models/DoeeetComponent';
import { logger } from '../utils/logger';
import { CacheService, getCacheService, CacheTTL } from './CacheService';

/**
 * DoEEEt搜索查询接口
 */
export interface DoeeetSearchQuery {
  // 基础搜索
  keyword?: string;              // 关键词搜索 (型号、制造商、类型)
  partNumber?: string;           // 型号搜索
  manufacturer?: string;         // 制造商搜索
  partType?: string;             // 产品类型搜索
  
  // 分类搜索
  familyPath?: string | string[]; // 分类路径
  
  // 参数搜索
  parameters?: {
    [key: string]: string | number | { min?: number; max?: number };
  };
  
  // 筛选条件
  hasStock?: boolean;            // 是否有库存
  obsolescenceType?: string[];   // 淘汰状态
  qualityName?: string;          // 质量等级
  qualified?: string;            // 是否合格
  
  // 分页和排序
  page?: number;
  limit?: number;
  sortBy?: string;               // 排序字段
  sortOrder?: 'asc' | 'desc';    // 排序方向
}

/**
 * 搜索结果接口
 */
export interface DoeeetSearchResult {
  components: any[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
  filters?: any;
}

/**
 * DoEEEt搜索服务类
 * 提供完整的搜索引擎功能，支持Redis缓存
 */
const RADIATION_SENSITIVITY_CATEGORY = 'Radiation: Potential Sensitivity';
const RADIATION_SENSITIVITY_ORDER = [
  'SEE Comments',
  'SEE sens.',
  'TID (HDR) sens.',
  'TID (LDR) sens.',
  'TNID Comments',
  'TNID sens.'
];

type RadiationSensitivityEntry = {
  key: string;
  name: string;
  shortName?: string;
  category?: string;
  value: string;
};

export class DoeeetSearchService {
  private cacheService: CacheService;

  constructor() {
    this.cacheService = getCacheService();
  }
  
  /**
   * 1. 全文搜索功能
   * 支持型号、制造商、产品类型的模糊搜索
   * 带Redis缓存优化
   */
  async fullTextSearch(
    keyword: string,
    options: {
      limit?: number;
      hasStock?: boolean;
      obsolescenceType?: string[];
      page?: number;
    } = {}
  ): Promise<any[]> {
    try {
      const limit = options.limit || 20;
      const page = options.page || 1;
      
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedFullTextSearchResult(keyword, page);
      if (cached) {
        logger.info(`✅ 全文搜索缓存命中 "${keyword}" (page ${page})`);
        return cached;
      }
      
      logger.info(`⚡ 全文搜索缓存未命中 "${keyword}", 查询数据库...`);
      
      // 构建查询条件
      const query: any = {
        $text: { $search: keyword }
      };
      
      // 添加筛选条件
      if (options.hasStock !== undefined) {
        query.has_stock = options.hasStock;
      }
      
      if (options.obsolescenceType && options.obsolescenceType.length > 0) {
        query.obsolescence_type = { $in: options.obsolescenceType };
      }
      
      // 执行搜索，按相关性评分排序
      const components = await DoeeetComponent.find(
        query,
        { score: { $meta: 'textScore' } }
      )
      .sort({ score: { $meta: 'textScore' } })
      .limit(limit)
      .lean();
      
      // 缓存结果
      await this.cacheService.cacheFullTextSearchResult(keyword, page, components);
      
      logger.info(`全文搜索 "${keyword}": 找到 ${components.length} 个结果`);
      return components;
      
    } catch (error) {
      logger.error('全文搜索失败:', error);
      throw new Error('全文搜索失败');
    }
  }
  
  /**
   * 2. 分类搜索功能
   * 按产品分类路径浏览
   * 带Redis缓存优化
   */
  async searchByCategory(
    familyPath: string | string[],
    options: {
      page?: number;
      limit?: number;
      hasStock?: boolean;
      obsolescenceType?: string[];
    } = {}
  ): Promise<DoeeetSearchResult> {
    try {
      const page = options.page || 1;
      const limit = options.limit || 50;
      const skip = (page - 1) * limit;
      
      // 只缓存精确分类路径（数组形式）
      if (Array.isArray(familyPath)) {
        const cached = await this.cacheService.getCachedCategoryBrowse(familyPath, page);
        if (cached) {
          logger.info(`✅ 分类浏览缓存命中 [${familyPath.join(' > ')}] (page ${page})`);
          return cached;
        }
        logger.info(`⚡ 分类浏览缓存未命中, 查询数据库...`);
      }
      
      // 构建查询条件
      const query: any = {};
      
      if (typeof familyPath === 'string') {
        // 字符串形式：优先使用 $in 匹配数组字段；兼容部分数据将 family_path 存为字符串的情况
        // 当为字符串存储时，使用不区分大小写的正则回退匹配
        const regex = new RegExp(familyPath, 'i');
        query.$or = [
          { family_path: { $in: [familyPath] } },
          { family_path: { $regex: regex } }
        ];
      } else if (Array.isArray(familyPath)) {
        // 数组形式：根据数组长度决定匹配策略
        if (familyPath.length === 1) {
          // 只有一级分类（如 ['Resistors']）
          // 匹配所有包含该分类的组件（通常是顶层分类）
          const [top] = familyPath;
          const regex = new RegExp(top, 'i');
          query.$or = [
            { family_path: { $in: familyPath } },
            { family_path: { $regex: regex } }
          ];
        } else {
          // 多级分类（如 ['Potentiometer', 'Resistors']）
          // 使用精确数组匹配：只返回完全匹配该路径的组件
          // 性能测试：精确匹配 (1.7ms) 比 $all (3.8ms) 快 2 倍
          // 注意：family_path 在数据库中是从具体到一般的顺序
          // 例如：['Potentiometer', 'Resistors'] 表示 Potentiometer(子类) -> Resistors(父类)
          query.$or = [
            { family_path: familyPath },
            // 字符串存储的兼容：按各级分类都包含进行回退匹配（顺序不强制）
            ...familyPath.map(level => ({ family_path: { $regex: new RegExp(level, 'i') } }))
          ];
        }
      }
      
      // 添加筛选条件
      if (options.hasStock !== undefined) {
        query.has_stock = options.hasStock;
      }
      
      if (options.obsolescenceType && options.obsolescenceType.length > 0) {
        query.obsolescence_type = { $in: options.obsolescenceType };
      }
      
      // 执行查询
      const [components, total] = await Promise.all([
        DoeeetComponent.find(query)
          .sort({ part_number: 1 })
          .skip(skip)
          .limit(limit)
          .lean(),
        DoeeetComponent.countDocuments(query)
      ]);
      
      const totalPages = Math.ceil(total / limit);
      
      const result = {
        components,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      };
      
      // 缓存结果（仅精确匹配）
      if (Array.isArray(familyPath)) {
        await this.cacheService.cacheCategoryBrowse(familyPath, page, result);
      }
      
      logger.info(`分类搜索 "${familyPath}": 找到 ${total} 个结果`);
      
      return result;
      
    } catch (error) {
      logger.error('分类搜索失败:', error);
      throw new Error('分类搜索失败');
    }
  }
  
  /**
   * 3. 参数搜索功能
   * 按技术参数筛选组件
   */
  async searchByParameters(
    parameters: { [key: string]: string | number | { min?: number; max?: number } },
    options: {
      page?: number;
      limit?: number;
    } = {}
  ): Promise<DoeeetSearchResult> {
    try {
      const page = options.page || 1;
      const limit = options.limit || 50;
      const skip = (page - 1) * limit;
      
      // 构建参数查询条件
      const paramQueries = [];
      
      for (const [key, value] of Object.entries(parameters)) {
        if (typeof value === 'object' && ('min' in value || 'max' in value)) {
          // 范围查询
          const rangeQuery: any = { parameter_key: key };
          if (value.min !== undefined) {
            rangeQuery.numeric_value = { $gte: value.min };
          }
          if (value.max !== undefined) {
            rangeQuery.numeric_value = { 
              ...rangeQuery.numeric_value, 
              $lte: value.max 
            };
          }
          paramQueries.push(rangeQuery);
        } else {
          // 精确值查询
          paramQueries.push({
            parameter_key: key,
            parameter_value: String(value)
          });
        }
      }
      
      // 查找匹配的参数记录
      const matchingParams = await DoeeetParameter.find({
        $or: paramQueries
      }).lean();
      
      // 按组件ID分组，计算每个组件匹配的参数数量
      const componentMatches = new Map<string, number>();
      matchingParams.forEach(param => {
        const count = componentMatches.get(param.component_id) || 0;
        componentMatches.set(param.component_id, count + 1);
      });
      
      // 筛选出匹配所有参数的组件
      const requiredMatches = Object.keys(parameters).length;
      const componentIds = Array.from(componentMatches.entries())
        .filter(([_, count]) => count >= requiredMatches)
        .map(([id, _]) => id);
      
      if (componentIds.length === 0) {
        return {
          components: [],
          total: 0,
          page,
          limit,
          totalPages: 0,
          hasNextPage: false,
          hasPrevPage: false
        };
      }
      
      // 查询组件详情
      const [components, total] = await Promise.all([
        DoeeetComponent.find({ component_id: { $in: componentIds } })
          .skip(skip)
          .limit(limit)
          .lean(),
        Promise.resolve(componentIds.length)
      ]);
      
      const totalPages = Math.ceil(total / limit);
      
      logger.info(`参数搜索: 找到 ${total} 个匹配的组件`);
      
      return {
        components,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1
      };
      
    } catch (error) {
      logger.error('参数搜索失败:', error);
      throw new Error('参数搜索失败');
    }
  }
  
  /**
   * 4. 复合搜索功能
   * 组合多种搜索条件
   * 带Redis缓存优化
   */
  async advancedSearch(query: DoeeetSearchQuery): Promise<DoeeetSearchResult> {
    try {
      const page = query.page || 1;
      const limit = Math.min(query.limit || 20, 100);
      const skip = (page - 1) * limit;
      
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedSearchResult(query);
      if (cached) {
        logger.info(`✅ 复合搜索缓存命中`);
        return cached;
      }
      
      logger.info(`⚡ 复合搜索缓存未命中, 查询数据库...`);
      logger.info(`查询参数: ${JSON.stringify(query, null, 2)}`);
      
      // 构建MongoDB查询
      const mongoQuery: any = {};
      
      // 1. 关键词搜索（使用正则表达式进行模糊匹配，避免全文索引问题）
      if (query.keyword) {
        const keywordRegex = new RegExp(query.keyword, 'i');
        mongoQuery.$or = [
          { part_number: keywordRegex },
          { manufacturer_name: keywordRegex },
          { part_type: keywordRegex }
        ];
      }
      
      // 2. 精确型号搜索
      if (query.partNumber) {
        mongoQuery.part_number = { $regex: query.partNumber, $options: 'i' };
      }
      
      // 3. 制造商搜索
      if (query.manufacturer) {
        mongoQuery.manufacturer_name = { $regex: query.manufacturer, $options: 'i' };
      }
      
      // 4. 产品类型搜索
      if (query.partType) {
        mongoQuery.part_type = { $regex: query.partType, $options: 'i' };
      }
      
      // 5. 分类搜索
      if (query.familyPath) {
        if (typeof query.familyPath === 'string') {
          // 字符串形式：匹配包含该分类的所有组件
          // 使用 $in 操作符，性能比 $elemMatch 更好
          const regex = new RegExp(query.familyPath, 'i');
          mongoQuery.$or = [
            { family_path: { $in: [query.familyPath] } },
            { family_path: { $regex: regex } }
          ];
        } else if (Array.isArray(query.familyPath)) {
          // 数组形式：根据数组长度决定匹配策略
          if (query.familyPath.length === 1) {
            // 只有一级分类（如 ['Resistors']）
            // 匹配所有包含该分类的组件
            // 使用 $in 操作符：性能测试显示比 $elemMatch 快 5 倍
            const [top] = query.familyPath;
            const regex = new RegExp(top, 'i');
            mongoQuery.$or = [
              { family_path: { $in: query.familyPath } },
              { family_path: { $regex: regex } }
            ];
          } else {
            // 多级分类（如 ['Current Regulator', 'Diode', 'Discretes']）
            // 使用 $all 操作符：匹配包含所有分类的组件，不要求顺序一致
            // 这样可以处理前端发送的分类路径顺序与数据库中存储顺序不一致的情况
            const reversed = [...query.familyPath].reverse();
            const joinedCandidates = [
              query.familyPath.join(' / '),
              query.familyPath.join('/'),
              query.familyPath.join(' > '),
              query.familyPath.join('>'),
            ];
            mongoQuery.$or = [
              { family_path: { $all: query.familyPath } },
              // 精确数组（可能数据库为叶子->顶层或顶层->叶子两种顺序）
              { family_path: query.familyPath },
              { family_path: reversed },
              // 字符串存储兼容：所有层级都能被字符串包含命中（用$and + 正则数组）
              { $and: query.familyPath.map(level => ({ family_path: { $regex: new RegExp(level, 'i') } })) },
              // 常见分隔符的字符串路径匹配
              { family_path: { $in: joinedCandidates } }
            ];
          }
        }
      }
      
      // 6. 库存筛选
      if (query.hasStock !== undefined) {
        mongoQuery.has_stock = query.hasStock;
      }
      
      // 7. 淘汰状态筛选
      if (query.obsolescenceType && query.obsolescenceType.length > 0) {
        mongoQuery.obsolescence_type = { $in: query.obsolescenceType };
      }
      
      // 8. 质量等级筛选
      if (query.qualityName) {
        mongoQuery.quality_name = query.qualityName;
      }
      
      // 9. 合格状态筛选
      if (query.qualified) {
        mongoQuery.qualified = query.qualified;
      }
      
      // 如果有参数搜索，需要先查询参数表
      let componentIds: string[] | undefined;
      if (query.parameters && Object.keys(query.parameters).length > 0) {
        const paramResult = await this.searchByParameters(query.parameters, { 
          page: 1, 
          limit: 10000  // 获取所有匹配的ID
        });
        componentIds = paramResult.components.map(c => c.component_id);
        
        if (componentIds.length === 0) {
          // 没有匹配的组件，直接返回空结果
          return {
            components: [],
            total: 0,
            page,
            limit,
            totalPages: 0,
            hasNextPage: false,
            hasPrevPage: false
          };
        }
        
        mongoQuery.component_id = { $in: componentIds };
      }
      
      // 构建排序条件
      const sort: any = {};
      if (query.sortBy) {
        // 自定义排序
        const sortField = this.mapSortField(query.sortBy);
        sort[sortField] = query.sortOrder === 'desc' ? -1 : 1;
      } else {
        // 默认按型号排序
        sort.part_number = 1;
      }
      
      // 记录查询条件用于调试
      logger.info(`MongoDB查询条件: ${JSON.stringify(mongoQuery, null, 2)}`);

      // 诊断统计：当按分类数组筛选时，输出几种常见匹配方式的命中数，便于定位数据形态
      if (Array.isArray(query.familyPath) && query.familyPath.length > 0) {
        try {
          const diagTop = query.familyPath[0];
          const diagRegexTop = new RegExp(diagTop, 'i');
          const diagReversed = [...query.familyPath].reverse();
          const diagJoined = [
            query.familyPath.join(' / '),
            query.familyPath.join('/'),
            query.familyPath.join(' > '),
            query.familyPath.join('>'),
          ];
          const [
            cIn,
            cAll,
            cRegexAnd,
            cExact,
            cExactReversed,
            cRegexAnyTop,
            cJoinedIn
          ] = await Promise.all([
            DoeeetComponent.countDocuments({ family_path: { $in: query.familyPath as string[] } }),
            DoeeetComponent.countDocuments({ family_path: { $all: query.familyPath as string[] } }),
            DoeeetComponent.countDocuments({ $and: (query.familyPath as string[]).map(level => ({ family_path: { $regex: new RegExp(level, 'i') } })) }),
            DoeeetComponent.countDocuments({ family_path: query.familyPath as string[] }),
            DoeeetComponent.countDocuments({ family_path: diagReversed }),
            DoeeetComponent.countDocuments({ family_path: { $regex: diagRegexTop } }),
            DoeeetComponent.countDocuments({ family_path: { $in: diagJoined } }),
          ]);
          logger.info(`分类诊断 - $in: ${cIn}, $all: ${cAll}, $and+regex: ${cRegexAnd}, exact: ${cExact}, exact(reversed): ${cExactReversed}, regex(top): ${cRegexAnyTop}, joined(in): ${cJoinedIn}`);
        } catch (e) {
          logger.warn('分类诊断统计失败', e);
        }
      }
      
      // 执行查询
      const queryBuilder = DoeeetComponent.find(mongoQuery);
      
      const [components, total] = await Promise.all([
        queryBuilder
          .sort(sort)
          .skip(skip)
          .limit(limit)
          .lean(),
        DoeeetComponent.countDocuments(mongoQuery)
      ]);
      
      const getComponentIdentifier = (component: any): string | undefined => {
        if (!component) {
          return undefined;
        }
        if (typeof component.component_id === 'string') {
          return component.component_id;
        }
        if (typeof (component as any).componentId === 'string') {
          return (component as any).componentId;
        }
        if (typeof component.id === 'string') {
          return component.id;
        }
        if (component._id) {
          return String(component._id);
        }
        return undefined;
      };

      let enhancedComponents = components;
      if (components.length > 0) {
        const componentIdsForRadiation = Array.from(
          new Set(
            components
              .map(comp => getComponentIdentifier(comp))
              .filter((id): id is string => typeof id === 'string' && id.length > 0)
          )
        );
        const radiationMap = await this.getRadiationSensitivityData(componentIdsForRadiation);
        enhancedComponents = components.map(comp => {
          const identifier = getComponentIdentifier(comp);
          return {
            ...comp,
            radiation_sensitivity: identifier ? (radiationMap.get(identifier) || []) : []
          };
        });
      }
      
      const totalPages = Math.ceil(total / limit);
      
      const result = {
        components: enhancedComponents,
        total,
        page,
        limit,
        totalPages,
        hasNextPage: page < totalPages,
        hasPrevPage: page > 1,
        filters: this.getAppliedFilters(query)
      };
      
      // 缓存结果
      await this.cacheService.cacheSearchResult(query, result);
      
      logger.info(`复合搜索: 找到 ${total} 个结果`);
      
      return result;
      
    } catch (error) {
      logger.error('复合搜索失败:', error);
      throw new Error('复合搜索失败');
    }
  }
  
  /**
   * 5. 搜索建议功能
   * 自动补全和搜索推荐
   */
  async getSearchSuggestions(
    keyword: string,
    limit: number = 10
  ): Promise<{
    components: Array<{ partNumber: string; manufacturer: string; partType: string }>;
    manufacturers: string[];
    categories: string[];
  }> {
    try {
      if (!keyword || keyword.length < 2) {
        return { components: [], manufacturers: [], categories: [] };
      }
      
      const searchRegex = new RegExp(keyword, 'i');
      
      // 1. 搜索匹配的组件
      const components = await DoeeetComponent.find({
        $or: [
          { part_number: searchRegex },
          { part_type: searchRegex },
          { manufacturer_name: searchRegex }
        ]
      })
      .select('part_number manufacturer_name part_type')
      .limit(Math.floor(limit * 0.6))
      .lean();
      
      // 2. 获取匹配的制造商
      const manufacturers = await DoeeetComponent.distinct('manufacturer_name', {
        manufacturer_name: searchRegex
      });
      
      // 3. 获取匹配的分类
      const categoriesResult = await DoeeetComponent.find({
        family_path: searchRegex
      })
      .distinct('family_path')
      .limit(Math.floor(limit * 0.2));
      
      // 展平分类路径
      const categories = Array.from(new Set(
        categoriesResult
          .flat()
          .filter(cat => cat.toLowerCase().includes(keyword.toLowerCase()))
      )).slice(0, Math.floor(limit * 0.2));
      
      return {
        components: components.map(c => ({
          partNumber: c.part_number,
          manufacturer: c.manufacturer_name,
          partType: c.part_type
        })),
        manufacturers: manufacturers.slice(0, Math.floor(limit * 0.2)),
        categories
      };
      
    } catch (error) {
      logger.error('获取搜索建议失败:', error);
      throw new Error('获取搜索建议失败');
    }
  }
  
  /**
   * 获取组件详情（包含参数）
   * 带Redis缓存优化
   */
  async getComponentWithParameters(componentId: string): Promise<any> {
    try {
      // 尝试从缓存获取
      const cached = await this.cacheService.getCachedComponentDetail(componentId);
      if (cached) {
        logger.info(`✅ 组件详情缓存命中 [${componentId}]`);
        return cached;
      }
      
      logger.info(`⚡ 组件详情缓存未命中, 查询数据库...`);
      
      // 查询组件基本信息
      const component = await DoeeetComponent.findOne({ 
        component_id: componentId 
      }).lean();
      
      if (!component) {
        return null;
      }
      
      // 查询组件参数
      const parameters = await DoeeetParameter.find({ 
        component_id: componentId 
      }).lean();
      
      // 获取参数定义（从缓存或数据库）
      const paramKeys = parameters.map(p => p.parameter_key);
      const definitions = await this.getParameterDefinitions(paramKeys);
      
      // 创建参数定义映射
      const definitionMap = new Map(
        definitions.map(d => [d.parameter_key, d])
      );
      
      // 组合参数和定义
      const parametersWithDefinitions = parameters.map(param => {
        const def = definitionMap.get(param.parameter_key);
        return {
          key: param.parameter_key,
          name: def?.name || 'Unknown',
          shortName: def?.short_name,
          category: def?.category,
          value: param.parameter_value,
          numericValue: param.numeric_value
        };
      });
      
      const result = {
        ...component,
        parameters: parametersWithDefinitions
      };
      
      // 缓存结果
      await this.cacheService.cacheComponentDetail(componentId, result);
      
      return result;
      
    } catch (error) {
      logger.error('获取组件详情失败:', error);
      throw new Error('获取组件详情失败');
    }
  }
  
  /**
   * 获取所有制造商列表
   * 带Redis缓存优化
   */
  async getManufacturers(): Promise<string[]> {
    return await this.cacheService.getOrSet(
      'meta:manufacturers',
      async () => {
        logger.info('⚡ 制造商列表缓存未命中, 查询数据库...');
        const manufacturers = await DoeeetComponent.distinct('manufacturer_name');
        return manufacturers.sort();
      },
      CacheTTL.MANUFACTURERS
    );
  }
  
  /**
   * 获取所有分类路径
   * 带Redis缓存优化
   */
  async getFamilyPaths(): Promise<string[][]> {
    return await this.cacheService.getCachedCategoriesTree() || 
      await this.cacheService.getOrSet(
        'meta:categories:tree',
        async () => {
          logger.info('⚡ 分类列表缓存未命中, 查询数据库...');
          const paths = await DoeeetComponent.distinct('family_path');
          return paths.sort((a, b) => a.join(' > ').localeCompare(b.join(' > ')));
        },
        CacheTTL.CATEGORIES
      );
  }
  
  /**
   * 获取分类元数据
   * 带Redis缓存优化
   */
  async getCategoryMeta(familyPath: string[]): Promise<any> {
    return await this.cacheService.getOrSet(
      `meta:family:${familyPath.join('/')}`,
      async () => {
        logger.info(`⚡ 分类元数据缓存未命中 [${familyPath.join(' > ')}], 查询数据库...`);
        const family = await DoeeetFamily.findOne({ 
          family_path: familyPath 
        }).lean();
        return family;
      },
      CacheTTL.FAMILY_META
    );
  }
  
  /**
   * 获取参数定义
   * 带Redis缓存优化
   */
  async getParameterDefinitions(keys?: string[]): Promise<any[]> {
    // 获取所有参数定义（缓存）
    const allDefs = await this.cacheService.getOrSet(
      'meta:parameter_definitions',
      async () => {
        logger.info('⚡ 参数定义缓存未命中, 查询数据库...');
        const definitions = await DoeeetParameterDefinition.find({}).lean();
        return definitions;
      },
      CacheTTL.PARAMETER_DEFS
    );
    
    // 如果指定了keys，过滤返回
    if (keys && keys.length > 0) {
      const keySet = new Set(keys);
      return allDefs.filter(def => keySet.has(def.parameter_key));
    }
    
    return allDefs;
  }
  
  /**
   * 获取统计信息
   * 带Redis缓存优化
   */
  async getStatistics(): Promise<{
    totalComponents: number;
    activeComponents: number;
    obsoleteComponents: number;
    componentsInStock: number;
    manufacturerCount: number;
    categoryCount: number;
    categoryStats: { [key: string]: number };
  }> {
    return await this.cacheService.getOrSet(
      'meta:statistics',
      async () => {
        logger.info('⚡ 统计信息缓存未命中, 查询数据库...');
        const [
          totalComponents,
          activeComponents,
          obsoleteComponents,
          componentsInStock,
          manufacturers,
          categories,
          categoryAggregation
        ] = await Promise.all([
          DoeeetComponent.countDocuments(),
          DoeeetComponent.countDocuments({ obsolescence_type: 'Active' }),
          DoeeetComponent.countDocuments({ 
            obsolescence_type: { $in: ['Obsolete', 'Last Time Buy'] } 
          }),
          DoeeetComponent.countDocuments({ has_stock: true }),
          DoeeetComponent.distinct('manufacturer_name'),
          DoeeetComponent.distinct('family_path'),
          // 按分类聚合统计
          DoeeetComponent.aggregate([
            {
              $group: {
                _id: '$family_path',
                count: { $sum: 1 }
              }
            }
          ])
        ]);
        
        // 构建分类统计对象（注意：family_path 为从叶子到顶层的顺序）
        const categoryStats: { [key: string]: number } = {};
        categoryAggregation.forEach((item: any) => {
          if (item._id) {
            // item._id 在聚合中为数组（如果集合中是数组存储）；兼容字符串情况
            const pathArr = Array.isArray(item._id)
              ? item._id
              : (() => {
                  try {
                    return JSON.parse(String(item._id).replace(/'/g, '"'));
                  } catch {
                    return [];
                  }
                })();
            const mainCategory = Array.isArray(pathArr) && pathArr.length > 0
              ? pathArr[pathArr.length - 1]
              : String(item._id);
            categoryStats[mainCategory] = (categoryStats[mainCategory] || 0) + item.count;
          }
        });
        
        return {
          totalComponents,
          activeComponents,
          obsoleteComponents,
          componentsInStock,
          manufacturerCount: manufacturers.length,
          categoryCount: categories.length,
          categoryStats
        };
      },
      CacheTTL.STATISTICS
    );
  }
  
  // ========== 私有辅助方法 ==========
  
  /**
   * 映射排序字段
   */
  private mapSortField(sortBy: string): string {
    const fieldMap: { [key: string]: string } = {
      'partNumber': 'part_number',
      'manufacturer': 'manufacturer_name',
      'partType': 'part_type',
      'obsolescence': 'obsolescence_type',
      'stock': 'has_stock',
      'created': 'createdAt',
      'updated': 'updatedAt'
    };
    
    return fieldMap[sortBy] || sortBy;
  }
  
  /**
   * 获取应用的筛选条件
   */
  private getAppliedFilters(query: DoeeetSearchQuery): any {
    return {
      keyword: query.keyword,
      partNumber: query.partNumber,
      manufacturer: query.manufacturer,
      partType: query.partType,
      familyPath: query.familyPath,
      hasStock: query.hasStock,
      obsolescenceType: query.obsolescenceType,
      qualityName: query.qualityName,
      qualified: query.qualified,
      parameters: query.parameters
    };
  }
  
  /**
   * 构建分类树（用于前端分类筛选）
   * 从数据库读取所有 family_path 并构建层级结构
   */
  async buildCategoryTree(): Promise<any> {
    try {
      // 尝试从缓存获取
      const cacheKey = 'category_tree';
      const cached = await this.cacheService.get(cacheKey);
      if (cached) {
        logger.info('✅ 分类树缓存命中');
        return cached;
      }
      
      logger.info('⚡ 从数据库构建分类树...');
      
      // 从数据库获取所有唯一的 family_path
      // 优先从 DoeeetFamily 集合读取（更准确），如果没有则从 DoeeetComponent 读取
      let familyPaths: string[][] = [];
      
      try {
        // 尝试从 DoeeetFamily 集合读取
        const families = await DoeeetFamily.find({}).select('family_path').lean();
        if (families && families.length > 0) {
          familyPaths = families.map((f: any) => f.family_path || []).filter((path: string[]) => path.length > 0);
          logger.info(`✅ 从 DoeeetFamily 集合读取到 ${familyPaths.length} 个分类路径`);
        } else {
          // 如果 DoeeetFamily 集合为空，从 DoeeetComponent 读取
          familyPaths = await DoeeetComponent.distinct('family_path');
          logger.info(`✅ 从 DoeeetComponent 集合读取到 ${familyPaths.length} 个分类路径`);
        }
      } catch (error) {
        logger.warn('从数据库读取分类路径失败，尝试从 DoeeetComponent 读取:', error);
        // 降级方案：从 DoeeetComponent 读取
        familyPaths = await DoeeetComponent.distinct('family_path');
      }
      
      if (!familyPaths || familyPaths.length === 0) {
        logger.warn('⚠️ 数据库中没有找到分类路径，使用降级数据');
        throw new Error('No family paths found in database');
      }
      
      // 构建分类树结构
      const tree: any[] = [];
      const subCategories: any = {};
      const categoryMap = new Map<string, any>();
      
      // 去重：使用 Set 存储已处理的路径（转换为字符串用于比较）
      const processedPaths = new Set<string>();
      
      familyPaths.forEach((fullPath: string[]) => {
        if (!fullPath || fullPath.length === 0) return;
        
        // 归一化：数据库为 叶子->顶层，这里反转为 顶层->叶子
        const normalizedPath = [...fullPath].reverse();

        // 将路径转换为字符串用于去重
        const pathKey = JSON.stringify(normalizedPath);
        if (processedPaths.has(pathKey)) return;
        processedPaths.add(pathKey);
        
        const topCategory = normalizedPath[0]; // 顶层分类
        
        // 初始化顶层分类
        if (!categoryMap.has(topCategory)) {
          const node = {
            label: topCategory,
            value: topCategory,
            children: []
          };
          categoryMap.set(topCategory, node);
          tree.push(node);
          subCategories[topCategory] = {};
        }
        
        // 逐级构建子分类
        let currentLevel = categoryMap.get(topCategory).children;
        
        for (let i = 1; i < normalizedPath.length; i++) {
          const categoryName = normalizedPath[i];
          
          // 查找或创建当前级别节点
          let node = currentLevel.find((n: any) => n.value === categoryName);
          
          if (!node) {
            node = {
              label: categoryName,
              value: categoryName,
              children: []
            };
            currentLevel.push(node);
          }
          
          // 构建 subCategories 结构（用于Tab+侧边栏展示）
          if (i === 1) {
            // 二级分类
            if (!subCategories[topCategory][categoryName]) {
              subCategories[topCategory][categoryName] = [];
            }
          } else if (i === 2) {
            // 三级分类
            const secondLevel = normalizedPath[1];
            if (!subCategories[topCategory][secondLevel]) {
              subCategories[topCategory][secondLevel] = [];
            }
            if (!subCategories[topCategory][secondLevel].includes(categoryName)) {
              subCategories[topCategory][secondLevel].push(categoryName);
            }
          }
          
          currentLevel = node.children;
        }
      });
      
      // 对树进行排序
      const sortTree = (nodes: any[]) => {
        nodes.sort((a, b) => a.label.localeCompare(b.label));
        nodes.forEach(node => {
          if (node.children && node.children.length > 0) {
            sortTree(node.children);
          }
        });
      };
      sortTree(tree);
      
      // 对 subCategories 中的数组进行排序
      Object.keys(subCategories).forEach(topCategory => {
        Object.keys(subCategories[topCategory]).forEach(secondLevel => {
          if (Array.isArray(subCategories[topCategory][secondLevel])) {
            subCategories[topCategory][secondLevel].sort();
          }
        });
      });
      
      const result = { tree, subCategories };
      
      // 缓存结果（24小时）
      await this.cacheService.set(cacheKey, result, CacheTTL.CATEGORIES);
      
      logger.info(`✅ 分类树构建完成：${tree.length} 个顶层分类，共 ${familyPaths.length} 个分类路径`);
      
      return result;
    } catch (error) {
      logger.error('构建分类树失败:', error);
      
      // 返回降级数据
      const fallbackCategories = [
        "Cable Assemblies", "Capacitors", "Connectors", "Crystals and Oscillators",
        "Discretes", "Filters", "Inductors", "Microcircuits", "Relays", "Resistors",
        "RF Passive Components", "Switches", "Thermistors", "Transformers", "Wires and Cables"
      ];
      
      return {
        tree: fallbackCategories.map(cat => ({
          label: cat,
          value: cat,
          children: []
        })),
        subCategories: {}
      };
    }
  }
  
  private async getRadiationSensitivityData(componentIds: string[]): Promise<Map<string, RadiationSensitivityEntry[]>> {
    const result = new Map<string, RadiationSensitivityEntry[]>();
    if (!componentIds || componentIds.length === 0) {
      return result;
    }

    const allDefinitions = await this.getParameterDefinitions();
    const radiationDefinitions = allDefinitions.filter(def => def?.category === RADIATION_SENSITIVITY_CATEGORY);
    if (radiationDefinitions.length === 0) {
      return result;
    }

    const definitionMap = new Map(
      radiationDefinitions.map(def => [def.parameter_key, def])
    );
    const radiationKeys = Array.from(definitionMap.keys());

    const radiationParams = await DoeeetParameter.find({
      component_id: { $in: componentIds },
      parameter_key: { $in: radiationKeys }
    }).lean();

    radiationParams.forEach(param => {
      const def = definitionMap.get(param.parameter_key);
      if (!def) {
        return;
      }
      const entry: RadiationSensitivityEntry = {
        key: param.parameter_key,
        name: def.name || param.parameter_key,
        shortName: def.short_name,
        category: def.category,
        value: param.parameter_value
      };
      if (!result.has(param.component_id)) {
        result.set(param.component_id, []);
      }
      result.get(param.component_id)!.push(entry);
    });

    if (result.size > 0) {
      const orderMap = new Map<string, number>(
        RADIATION_SENSITIVITY_ORDER.map((label, index) => [label.toLowerCase(), index])
      );
      result.forEach(entries => {
        entries.sort((a, b) => {
          const orderA = orderMap.get((a.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
          const orderB = orderMap.get((b.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
          if (orderA !== orderB) {
            return orderA - orderB;
          }
          return (a.name || '').localeCompare(b.name || '');
        });
      });
    }

    return result;
  }
}

// 导出单例
export const doeeetSearchService = new DoeeetSearchService();


```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter(item => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: 'Radiation: Potential Sensitivity',
      dataIndex: 'radiationSensitivity',
      key: 'radiationSensitivity',
      width: 280,
      render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: 'Radiation: Potential Sensitivity',
      dataIndex: 'radiationSensitivity',
      key: 'radiationSensitivity',
      width: 280,
      render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

## Summary
- Extended the DoEEEt search API to enrich every result with the “Radiation: Potential Sensitivity” parameters by post-processing search hits, smoothing component-id lookups, and centralizing the DB/querying logic (ordering, deduping, and sorting) inside the new helper so the field is always available alongside the list payload.
```561:596:backend/src/services/DoeeetSearchService.ts
const getComponentIdentifier = (component: any): string | undefined => {
  if (!component) {
    return undefined;
  }
  if (typeof component.component_id === 'string') {
    return component.component_id;
  }
  if (typeof (component as any).componentId === 'string') {
    return (component as any).componentId;
  }
  if (typeof component.id === 'string') {
    return component.id;
  }
  if (component._id) {
    return String(component._id);
  }
  return undefined;
};

let enhancedComponents = components;
if (components.length > 0) {
  const componentIdsForRadiation = Array.from(
    new Set(
      components
        .map(comp => getComponentIdentifier(comp))
        .filter((id): id is string => typeof id === 'string' && id.length > 0)
    )
  );
  const radiationMap = await this.getRadiationSensitivityData(componentIdsForRadiation);
  enhancedComponents = components.map(comp => {
    const identifier = getComponentIdentifier(comp);
    return {
      ...comp,
      radiation_sensitivity: identifier ? (radiationMap.get(identifier) || []) : []
    };
  });
}
```
```1114:1169:backend/src/services/DoeeetSearchService.ts
private async getRadiationSensitivityData(componentIds: string[]): Promise<Map<string, RadiationSensitivityEntry[]>> {
  const result = new Map<string, RadiationSensitivityEntry[]>();
  if (!componentIds || componentIds.length === 0) {
    return result;
  }

  const allDefinitions = await this.getParameterDefinitions();
  const radiationDefinitions = allDefinitions.filter(def => def?.category === RADIATION_SENSITIVITY_CATEGORY);
  if (radiationDefinitions.length === 0) {
    return result;
  }

  const definitionMap = new Map(
    radiationDefinitions.map(def => [def.parameter_key, def])
  );
  const radiationKeys = Array.from(definitionMap.keys());

  const radiationParams = await DoeeetParameter.find({
    component_id: { $in: componentIds },
    parameter_key: { $in: radiationKeys }
  }).lean();

  radiationParams.forEach(param => {
    const def = definitionMap.get(param.parameter_key);
    if (!def) {
      return;
    }
    const entry: RadiationSensitivityEntry = {
      key: param.parameter_key,
      name: def.name || param.parameter_key,
      shortName: def.short_name,
      category: def.category,
      value: param.parameter_value
    };
    if (!result.has(param.component_id)) {
      result.set(param.component_id, []);
    }
    result.get(param.component_id)!.push(entry);
  });

  if (result.size > 0) {
    const orderMap = new Map<string, number>(
      RADIATION_SENSITIVITY_ORDER.map((label, index) => [label.toLowerCase(), index])
    );
    result.forEach(entries => {
      entries.sort((a, b) => {
        const orderA = orderMap.get((a.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
        const orderB = orderMap.get((b.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
        if (orderA !== orderB) {
          return orderA - orderB;
        }
        return (a.name || '').localeCompare(b.name || '');
      });
    });
  }

  return result;
}
```
- Updated the shared component search UI to consume the new field: expanded the mapped component shape, added a renderer that formats multi-line SEE/TID/TNID entries, replaced the old “辐照等级” column with a rich column, and surfaced the same block in the detail modal for consistency.
```288:314:frontend/src/pages/components/ComponentSearch.tsx
const renderRadiationSensitivityCell = (
  items?: RadiationSensitivityItem[],
  options?: { dense?: boolean }
) => {
  if (!items || items.length === 0) {
    return <span style={{ color: '#999' }}>-</span>;
  }
  const gap = options?.dense ? 4 : 6;
  const fontSize = options?.dense ? 12 : 13;
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap }}>
      {items.map((item: RadiationSensitivityItem) => (
        <div
          key={item.key || item.name}
          style={{
            display: 'flex',
            justifyContent: 'space-between',
            fontSize,
            lineHeight: 1.3,
          }}
        >
          <span style={{ color: '#888' }}>{item.name}</span>
          <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
        </div>
      ))}
    </div>
  );
};
```
```1033:1374:frontend/src/pages/components/ComponentSearch.tsx
{
  title: 'Radiation: Potential Sensitivity',
  dataIndex: 'radiationSensitivity',
  key: 'radiationSensitivity',
  width: 280,
  render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
},
...
<Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
</Descriptions.Item>
```

## Testing
- Not run (UI/API smoke tests were not requested and the environment is not currently running). Please refresh the backend and frontend locally to verify the new column populates as expected.

## Next Steps
- Hit `/api/doeeet/search` via the UI (or Postman) and confirm the `radiation_sensitivity` payload is present.
- Rebuild the frontend (`npm run dev` / `npm run build`) and visually inspect the search table + detail modal to ensure layout remains acceptable with the wider column.
- If additional search pages reuse different mock datasets, consider aligning them later so users see the same column everywhere.

```typescript
const getComponentIdentifier = (component: any): string | undefined => {
  if (!component) {
    return undefined;
  }
  if (typeof component.component_id === 'string') {
    return component.component_id;
  }
  if (typeof (component as any).componentId === 'string') {
    return (component as any).componentId;
  }
  if (typeof component.id === 'string') {
    return component.id;
  }
  if (component._id) {
    return String(component._id);
  }
  return undefined;
};

let enhancedComponents = components;
if (components.length > 0) {
  const componentIdsForRadiation = Array.from(
    new Set(
      components
        .map(comp => getComponentIdentifier(comp))
        .filter((id): id is string => typeof id === 'string' && id.length > 0)
    )
  );
  const radiationMap = await this.getRadiationSensitivityData(componentIdsForRadiation);
  enhancedComponents = components.map(comp => {
    const identifier = getComponentIdentifier(comp);
    return {
      ...comp,
      radiation_sensitivity: identifier ? (radiationMap.get(identifier) || []) : []
    };
  });
}
```

```typescript
private async getRadiationSensitivityData(componentIds: string[]): Promise<Map<string, RadiationSensitivityEntry[]>> {
  const result = new Map<string, RadiationSensitivityEntry[]>();
  if (!componentIds || componentIds.length === 0) {
    return result;
  }

  const allDefinitions = await this.getParameterDefinitions();
  const radiationDefinitions = allDefinitions.filter(def => def?.category === RADIATION_SENSITIVITY_CATEGORY);
  if (radiationDefinitions.length === 0) {
    return result;
  }

  const definitionMap = new Map(
    radiationDefinitions.map(def => [def.parameter_key, def])
  );
  const radiationKeys = Array.from(definitionMap.keys());

  const radiationParams = await DoeeetParameter.find({
    component_id: { $in: componentIds },
    parameter_key: { $in: radiationKeys }
  }).lean();

  radiationParams.forEach(param => {
    const def = definitionMap.get(param.parameter_key);
    if (!def) {
      return;
    }
    const entry: RadiationSensitivityEntry = {
      key: param.parameter_key,
      name: def.name || param.parameter_key,
      shortName: def.short_name,
      category: def.category,
      value: param.parameter_value
    };
    if (!result.has(param.component_id)) {
      result.set(param.component_id, []);
    }
    result.get(param.component_id)!.push(entry);
  });

  if (result.size > 0) {
    const orderMap = new Map<string, number>(
      RADIATION_SENSITIVITY_ORDER.map((label, index) => [label.toLowerCase(), index])
    );
    result.forEach(entries => {
      entries.sort((a, b) => {
        const orderA = orderMap.get((a.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
        const orderB = orderMap.get((b.name || '').toLowerCase()) ?? RADIATION_SENSITIVITY_ORDER.length;
        if (orderA !== orderB) {
          return orderA - orderB;
        }
        return (a.name || '').localeCompare(b.name || '');
      });
    });
  }

  return result;
}
```

```typescriptreact
const renderRadiationSensitivityCell = (
  items?: RadiationSensitivityItem[],
  options?: { dense?: boolean }
) => {
  if (!items || items.length === 0) {
    return <span style={{ color: '#999' }}>-</span>;
  }
  const gap = options?.dense ? 4 : 6;
  const fontSize = options?.dense ? 12 : 13;
  return (
    <div style={{ display: 'flex', flexDirection: 'column', gap }}>
      {items.map((item: RadiationSensitivityItem) => (
        <div
          key={item.key || item.name}
          style={{
            display: 'flex',
            justifyContent: 'space-between',
            fontSize,
            lineHeight: 1.3,
          }}
        >
          <span style={{ color: '#888' }}>{item.name}</span>
          <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
        </div>
      ))}
    </div>
  );
};
```

```typescriptreact
{
  title: 'Radiation: Potential Sensitivity',
  dataIndex: 'radiationSensitivity',
  key: 'radiationSensitivity',
  width: 280,
  render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
},
...
<Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
</Descriptions.Item>
```

---

**User**

用中文告诉我一下

---

**Cursor**

已完成以下更新：

- 扩展 `DoeeetSearchService`，在搜索接口返回结果时自动补全每个器件的辐照敏感度信息。实现细节包括统一组件 ID 的抽取方法、批量查询辐照参数、按预设顺序排序后映射回结果列表。  
- 新增 `getRadiationSensitivityData` 辅助函数：从参数定义中过滤辐照类目、批量读取 MongoDB 参数、按 SEE/TID/LET 优先级排序并返回 `Map`，供搜索流程复用。  
- 前端 `ComponentSearch` 页面同步支持新的字段：定义 `renderRadiationSensitivityCell` 渲染函数，在列表列和详情弹窗中展示多行辐照指标，替换原来简单的标签显示，确保对齐后端数据结构。

未在此环境运行手工测试；请在本地重新启动后端及前端，确认 `/api/doeeet/search` 返回包含 `radiation_sensitivity` 字段，并检查界面显示是否符合预期。

---

**User**

不符合预期，应该把SEE Comments SEE sens等信息在Radiation: Potential Sensitivity下的信息在列表中显示。但是目前只显示了Radiation: Potential Sensitivity的空列，不需要有Radiation: Potential Sensitivity列。

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: 'Radiation: Potential Sensitivity',
      dataIndex: 'radiationSensitivity',
      key: 'radiationSensitivity',
      width: 280,
      render: (items?: RadiationSensitivityItem[]) => renderRadiationSensitivityCell(items),
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  name: string;
  shortName?: string;
  value: string;
}

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

## 更新内容
- 扩展 `parametersMap` 构建逻辑，将后端回传的辐照敏感度条目同时映射为动态参数值，这样当元数据里包含 `SEE Comments / SEE sens. / TID …` 等键时，表格会自动按动态列展示对应内容。
```521:600:frontend/src/pages/components/ComponentSearch.tsx
const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
  .map((rad: any, index: number) => {
    ...
    return {
      key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
      name,
      shortName: rad?.shortName || rad?.short_name,
      value: normalized,
    };
  })
  .filter((item: RadiationSensitivityItem) => item.value !== '-');

const parametersMap: Record<string, any> = {};
dynamic.forEach((p: any) => {
  const key = p?.key || p?.parameter_key;
  if (key) {
    const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
    parametersMap[key] = value;
  }
});
radiationSensitivity.forEach(item => {
  if (item.key && item.value) {
    parametersMap[item.key] = item.value;
  }
});
```

- 移除列表中的静态 “Radiation: Potential Sensitivity” 列，让 SEE/TID 等字段只通过动态参数列展示，避免空列占位。
```990:1065:frontend/src/pages/components/ComponentSearch.tsx
{
  title: '生命周期',
  dataIndex: 'lifecycle',
  key: 'lifecycle',
  width: 90,
  render: (lifecycle: string) => {
    const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
    return <Tag color={color}>{lifecycle}</Tag>;
  },
},
{
  title: '操作',
  key: 'action',
  width: 120,
  fixed: 'right' as const,
  render: (_: any, record: ComponentWithUI) => (
    <Space size="small">
      ...
    </Space>
  ),
},
```

## 测试
- 尚未在本地运行前后端，请重新刷新数据源并在列表中确认 SEE/TID 等列已自动出现。

```typescriptreact
const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
  .map((rad: any, index: number) => {
    ...
    return {
      key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
      name,
      shortName: rad?.shortName || rad?.short_name,
      value: normalized,
    };
  })
  .filter((item: RadiationSensitivityItem) => item.value !== '-');

const parametersMap: Record<string, any> = {};
dynamic.forEach((p: any) => {
  const key = p?.key || p?.parameter_key;
  if (key) {
    const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
    parametersMap[key] = value;
  }
});
radiationSensitivity.forEach(item => {
  if (item.key && item.value) {
    parametersMap[item.key] = item.value;
  }
});
```

```typescriptreact
{
  title: '生命周期',
  dataIndex: 'lifecycle',
  key: 'lifecycle',
  width: 90,
  render: (lifecycle: string) => {
    const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
    return <Tag color={color}>{lifecycle}</Tag>;
  },
},
{
  title: '操作',
  key: 'action',
  width: 120,
  fixed: 'right' as const,
  render: (_: any, record: ComponentWithUI) => (
    <Space size="small">
      ...
    </Space>
  ),
},
```

---

**User**

还是没有看到SEE Comments等列，你应该把Radiation: Potential Sensitivity下的这几列都显示，如果整个列表详情太宽，可以加一个横条拖动查看

---

**Cursor**

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        setParameterDefinitions(defs || []);
        if (defs && defs.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(defs, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import { 
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
        const definitionKeySet = new Set(
          baseDefinitions
            .map(def => def?.parameter_key)
            .filter((key): key is string => Boolean(key))
        );

        const radiationDefinitions: ParameterDefinition[] = [];
        rawComponents.forEach((entry: any) => {
          const radiationList = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];
          radiationList.forEach((rad: any) => {
            const parameterKey = deriveRadiationParameterKey(rad);
            if (!parameterKey || definitionKeySet.has(parameterKey)) {
              return;
            }
            if (radiationDefinitions.some(def => def.parameter_key === parameterKey)) {
              return;
            }
            const name =
              rad?.name ||
              rad?.parameter_name ||
              rad?.shortName ||
              rad?.short_name ||
              parameterKey;
            const shortName = rad?.shortName || rad?.short_name;
            const exampleSource = rad?.example ?? rad?.value ?? rad?.displayValue ?? rad?.text;
            radiationDefinitions.push({
              parameter_key: parameterKey,
              name,
              short_name: shortName,
              category: 'Radiation Sensitivity',
              example: typeof exampleSource === 'string' ? exampleSource : undefined,
            });
            definitionKeySet.add(parameterKey);
          });
        });

        const mergedDefinitions =
          radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;

        setParameterDefinitions(mergedDefinitions);
        if (mergedDefinitions.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(mergedDefinitions, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import {
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ParameterDefinition } from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
        const definitionKeySet = new Set(
          baseDefinitions
            .map(def => def?.parameter_key)
            .filter((key): key is string => Boolean(key))
        );

        const radiationDefinitions: ParameterDefinition[] = [];
        rawComponents.forEach((entry: any) => {
          const radiationList = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];
          radiationList.forEach((rad: any) => {
            const parameterKey = deriveRadiationParameterKey(rad);
            if (!parameterKey || definitionKeySet.has(parameterKey)) {
              return;
            }
            if (radiationDefinitions.some(def => def.parameter_key === parameterKey)) {
              return;
            }
            const name =
              rad?.name ||
              rad?.parameter_name ||
              rad?.shortName ||
              rad?.short_name ||
              parameterKey;
            const shortName = rad?.shortName || rad?.short_name;
            const exampleSource = rad?.example ?? rad?.value ?? rad?.displayValue ?? rad?.text;
            radiationDefinitions.push({
              parameter_key: parameterKey,
              name,
              short_name: shortName,
              category: 'Radiation Sensitivity',
              example: typeof exampleSource === 'string' ? exampleSource : undefined,
            });
            definitionKeySet.add(parameterKey);
          });
        });

        const mergedDefinitions =
          radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;

        setParameterDefinitions(mergedDefinitions);
        if (mergedDefinitions.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(mergedDefinitions, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized = normalizeValue(
                rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example
              ) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              return {
                key: rad?.key || rad?.parameter_key || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import {
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ParameterDefinition } from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
        const definitionKeySet = new Set(
          baseDefinitions
            .map(def => def?.parameter_key)
            .filter((key): key is string => Boolean(key))
        );

        const radiationDefinitions: ParameterDefinition[] = [];
        rawComponents.forEach((entry: any) => {
          const radiationList = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];
          radiationList.forEach((rad: any) => {
            const parameterKey = deriveRadiationParameterKey(rad);
            if (!parameterKey || definitionKeySet.has(parameterKey)) {
              return;
            }
            if (radiationDefinitions.some(def => def.parameter_key === parameterKey)) {
              return;
            }
            const name =
              rad?.name ||
              rad?.parameter_name ||
              rad?.shortName ||
              rad?.short_name ||
              parameterKey;
            const shortName = rad?.shortName || rad?.short_name;
            const exampleSource = rad?.example ?? rad?.value ?? rad?.displayValue ?? rad?.text;
            radiationDefinitions.push({
              parameter_key: parameterKey,
              name,
              short_name: shortName,
              category: 'Radiation Sensitivity',
              example: typeof exampleSource === 'string' ? exampleSource : undefined,
            });
            definitionKeySet.add(parameterKey);
          });
        });

        const mergedDefinitions =
          radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;

        setParameterDefinitions(mergedDefinitions);
        if (mergedDefinitions.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(mergedDefinitions, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized =
                normalizeValue(rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              const parameterKey = deriveRadiationParameterKey(rad);
              const listKey =
                parameterKey || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`;
              return {
                key: listKey,
                parameterKey,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.key && item.value) {
              parametersMap[item.key] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import {
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ParameterDefinition } from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
        const definitionKeySet = new Set(
          baseDefinitions
            .map(def => def?.parameter_key)
            .filter((key): key is string => Boolean(key))
        );

        const radiationDefinitions: ParameterDefinition[] = [];
        rawComponents.forEach((entry: any) => {
          const radiationList = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];
          radiationList.forEach((rad: any) => {
            const parameterKey = deriveRadiationParameterKey(rad);
            if (!parameterKey || definitionKeySet.has(parameterKey)) {
              return;
            }
            if (radiationDefinitions.some(def => def.parameter_key === parameterKey)) {
              return;
            }
            const name =
              rad?.name ||
              rad?.parameter_name ||
              rad?.shortName ||
              rad?.short_name ||
              parameterKey;
            const shortName = rad?.shortName || rad?.short_name;
            const exampleSource = rad?.example ?? rad?.value ?? rad?.displayValue ?? rad?.text;
            radiationDefinitions.push({
              parameter_key: parameterKey,
              name,
              short_name: shortName,
              category: 'Radiation Sensitivity',
              example: typeof exampleSource === 'string' ? exampleSource : undefined,
            });
            definitionKeySet.add(parameterKey);
          });
        });

        const mergedDefinitions =
          radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;

        setParameterDefinitions(mergedDefinitions);
        if (mergedDefinitions.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(mergedDefinitions, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized =
                normalizeValue(rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              const parameterKey = deriveRadiationParameterKey(rad);
              const listKey =
                parameterKey || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`;
              return {
                key: listKey,
                parameterKey,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.parameterKey && item.value) {
              parametersMap[item.parameterKey] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 1200 }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

```typescriptreact
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import {
  Card,
  Form,
  Input,
  Select,
  Button,
  Table,
  Tag,
  Space,
  Row,
  Col,
  Tooltip,
  Modal,
  Descriptions,
  Alert,
  message,
  Spin,
} from 'antd';
import {
  SearchOutlined,
  EyeOutlined,
  SwapOutlined,
  ShoppingCartOutlined,
  DownloadOutlined,
} from '@ant-design/icons';
// import { componentAPI } from '@/services/api';
import type { Component } from '@/types';
import ParameterRangeFilter from '@/components/ParameterRangeFilter';
import ComponentCompareModal from '@/components/ComponentCompareModal';
import CategoryFilter from '@/components/CategoryFilter';
import {
  exportParametersToCSV,
  downloadCSV,
  generateDynamicParameterColumns,
} from '@/utils/parameterUtils';
import type { ParameterDefinition } from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';
import httpClient from '@/utils/httpClient';

const { Option } = Select;

// 分类名称到 familyPath 的映射（基于首页的分类定义）
const categoryToFamilyPathMap: Record<string, string[]> = {
  '电阻器': ['Resistors'],
  '电容器': ['Capacitors'],
  '连接器': ['Connectors'],
  '晶振与振荡器': ['Crystals and Oscillators'],
  '开关': ['Switches'],
  '分立器件': ['Discretes'],
  '热敏电阻': ['Thermistors'],
  '微电路': ['Microcircuits'],
  '电缆组件': ['Cable Assemblies'],
  '电感器': ['Inductors'],
  '继电器': ['Relays'],
  '变压器': ['Transformers'],
  '滤波器': ['Filters'],
  '电线电缆': ['Wires and Cables'],
  '射频无源器件': ['RF Passive Components'],
  // 英文名称映射
  'Resistors': ['Resistors'],
  'Capacitors': ['Capacitors'],
  'Connectors': ['Connectors'],
  'Crystals and Oscillators': ['Crystals and Oscillators'],
  'Switches': ['Switches'],
  'Discretes': ['Discretes'],
  'Thermistors': ['Thermistors'],
  'Microcircuits': ['Microcircuits'],
  'Cable Assemblies': ['Cable Assemblies'],
  'Inductors': ['Inductors'],
  'Relays': ['Relays'],
  'Transformers': ['Transformers'],
  'Filters': ['Filters'],
  'Wires and Cables': ['Wires and Cables'],
  'RF Passive Components': ['RF Passive Components'],
};

/**
 * 将分类名称转换为 familyPath
 * @param categoryName 分类名称（中文或英文）
 * @returns familyPath 数组，如果找不到则返回空数组
 */
const getFamilyPathFromCategory = (categoryName: string): string[] => {
  if (!categoryName) return [];
  // 直接查找映射
  if (categoryToFamilyPathMap[categoryName]) {
    return categoryToFamilyPathMap[categoryName];
  }
  // 如果找不到，返回空数组（表示不过滤）
  return [];
};

// 主分类映射逻辑 - 对应11个主要分类 (暂时未使用)
/*
const getMainCategory = (component: any): string => {
  const category1 = component.category_1 || component.category || '';
  const categoryLower = category1.toLowerCase();

  // 1. 模拟单片集成电路
  if (categoryLower.includes('运算放大器') || categoryLower.includes('比较器') || 
      categoryLower.includes('模拟开关') || categoryLower.includes('电压基准') ||
      categoryLower.includes('analog') || categoryLower.includes('amplifier') ||
      categoryLower.includes('模拟')) {
    return '模拟单片集成电路';
  }

  // 2. 数字单片集成电路
  if (categoryLower.includes('微处理器') || categoryLower.includes('微控制器') || 
      categoryLower.includes('逻辑器件') || categoryLower.includes('存储器') ||
      categoryLower.includes('digital') || categoryLower.includes('processor') ||
      categoryLower.includes('microcontroller') || categoryLower.includes('memory') ||
      categoryLower.includes('数字') || categoryLower.includes('dsp')) {
    return '数字单片集成电路';
  }

  // 3. 混合集成电路
  if (categoryLower.includes('混合') || categoryLower.includes('hybrid')) {
    return '混合集成电路';
  }

  // 4. 半导体分立器件
  if (categoryLower.includes('二极管') || categoryLower.includes('三极管') || 
      categoryLower.includes('晶体管') || categoryLower.includes('场效应管') ||
      categoryLower.includes('diode') || categoryLower.includes('transistor') ||
      categoryLower.includes('分立')) {
    return '半导体分立器件';
  }

  // 5. 固态微波器件与电路
  if (categoryLower.includes('微波') || categoryLower.includes('射频') || 
      categoryLower.includes('rf') || categoryLower.includes('microwave')) {
    return '固态微波器件与电路';
  }

  // 6. 真空电子器件
  if (categoryLower.includes('真空管') || categoryLower.includes('电子管') || 
      categoryLower.includes('vacuum') || categoryLower.includes('tube')) {
    return '真空电子器件';
  }

  // 7. 光电子器件
  if (categoryLower.includes('光电') || categoryLower.includes('激光') || 
      categoryLower.includes('led') || categoryLower.includes('photodiode') ||
      categoryLower.includes('optical') || categoryLower.includes('laser')) {
    return '光电子器件';
  }

  // 8. 机电组件
  if (categoryLower.includes('继电器') || categoryLower.includes('开关') || 
      categoryLower.includes('连接器') || categoryLower.includes('relay') ||
      categoryLower.includes('connector') || categoryLower.includes('switch') ||
      categoryLower.includes('机电')) {
    return '机电组件';
  }

  // 9. 电能源
  if (categoryLower.includes('电源') || categoryLower.includes('电池') || 
      categoryLower.includes('power') || categoryLower.includes('battery') ||
      categoryLower.includes('供电') || categoryLower.includes('充电')) {
    return '电能源';
  }

  // 10. 通用与特种元件
  if (categoryLower.includes('传感器') || categoryLower.includes('晶振') || 
      categoryLower.includes('电阻') || categoryLower.includes('电容') ||
      categoryLower.includes('sensor') || categoryLower.includes('crystal') ||
      categoryLower.includes('resistor') || categoryLower.includes('capacitor') ||
      categoryLower.includes('通用') || categoryLower.includes('特种')) {
    return '通用与特种元件';
  }

  // 11. 微系统
  if (categoryLower.includes('mems') || categoryLower.includes('微系统') || 
      categoryLower.includes('微机电') || categoryLower.includes('microsystem')) {
    return '微系统';
  }

  // 默认分类 - 根据数据来源推测
  return '模拟单片集成电路';
};
*/

interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}

const normalizeRadiationKeySegment = (value?: string): string => {
  if (!value || typeof value !== 'string') {
    return '';
  }
  return value
    .toLowerCase()
    .replace(/[^a-z0-9]+/g, '_')
    .replace(/^_+|_+$/g, '');
};

const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => {
  if (!radiationEntry) return undefined;
  const explicitKey = radiationEntry?.key || radiationEntry?.parameter_key;
  if (explicitKey && typeof explicitKey === 'string' && explicitKey.trim()) {
    return explicitKey.trim();
  }
  const candidateName =
    radiationEntry?.name ||
    radiationEntry?.parameter_name ||
    radiationEntry?.shortName ||
    radiationEntry?.short_name;
  const normalized = normalizeRadiationKeySegment(candidateName);
  return normalized ? `radiation_${normalized}` : undefined;
};

// 器件数据类型定义 - 使用导入的类型，但添加一些额外字段用于向后兼容
interface ComponentWithUI extends Omit<Component, 'qualityLevel' | 'lifecycle'> {
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  primaryCategory?: string;  // 一级分类（如：运算放大器类、电源管理类）
  secondaryCategory?: string; // 二级分类（如：精密运算放大器、线性稳压器(LDO)）
  package?: string;
  top?: string;
  qualityLevel?: string; // 覆盖为string类型以支持中文
  lifecycle?: string; // 覆盖为string类型以支持中文
  standards?: string[];
  functionalPerformance?: string; // 功能性能
  referencePrice?: number; // 参考价格
  parameters?: {
    voltage?: string;
    current?: string;
    power?: string;
    temperature?: string;
    frequency?: string;
    [key: string]: any; // 允许其他参数
  };
  parameterDefinitions?: Array<{
    parameter_key: string;
    name: string;
    short_name: string;
    category: string;
    example: string;
    value?: any; // 参数值
  }>;
  suppliers?: Array<{
    name: string;
    price: number;
    stock: number;
    leadTime: string;
  }>;
  component_id?: string; // DoEEEt组件ID
  radiationSensitivity?: RadiationSensitivityItem[];
}

interface DetailParameter {
  key: string;
  name: string;
  category?: string;
  displayValue: string;
}

const ComponentSearch: React.FC = () => {
  // 轻量HTML清理函数已不再使用（详情参数改为横向表展示，标题处理交由 parameterUtils 完成）

  const [searchParams] = useSearchParams();
  const [loading, setLoading] = useState(false);
  const [components, setComponents] = useState<ComponentWithUI[]>([]);
  const [selectedComponents, setSelectedComponents] = useState<string[]>([]);
  const [detailModalVisible, setDetailModalVisible] = useState(false);
  const [selectedComponent, setSelectedComponent] = useState<ComponentWithUI | null>(null);
  const [detailParameters, setDetailParameters] = useState<DetailParameter[]>([]);
  const [detailLoading, setDetailLoading] = useState(false);
  const parameterGroups = useMemo(() => {
    if (!detailParameters || detailParameters.length === 0) {
      return [];
    }

    const groups = detailParameters.reduce<Map<string, DetailParameter[]>>((acc, param) => {
      const category = (param.category && param.category.trim()) || '通用参数';
      if (!acc.has(category)) {
        acc.set(category, []);
      }
      acc.get(category)!.push(param);
      return acc;
    }, new Map());

    return Array.from(groups.entries()).map(([category, params]) => ({
      category,
      params: [...params].sort((a, b) => a.name.localeCompare(b.name, 'zh-CN')),
    }));
  }, [detailParameters]);
  const hasSuppliers = useMemo(
    () => (selectedComponent?.suppliers?.length ?? 0) > 0,
    [selectedComponent]
  );
  const [total, setTotal] = useState(0);
  const [currentPage, setCurrentPage] = useState(1);
  const [pageSize, setPageSize] = useState(10); // 修改为每页10个，参考DoEEEt网站
  const [form] = Form.useForm();
  const [parameterFilters, setParameterFilters] = useState<{ [key: string]: { min?: number; max?: number } }>({});
  const [compareModalVisible, setCompareModalVisible] = useState(false);
  const [compareComponentIds, setCompareComponentIds] = useState<string[]>([]);
  // 统一受控的分页对象，确保分页UI（蓝色选中页）与状态强一致
  const [paginationState, setPaginationState] = useState<{ current: number; pageSize: number; total: number }>({
    current: 1,
    pageSize: 10,
    total: 0,
  });
  
  // 新增：分类筛选和动态参数相关状态
  const [selectedCategory, setSelectedCategory] = useState<string[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  const [dynamicColumns, setDynamicColumns] = useState<ColumnsType<ComponentWithUI>>([]);

  const renderRadiationSensitivityCell = (
    items?: RadiationSensitivityItem[],
    options?: { dense?: boolean }
  ) => {
    if (!items || items.length === 0) {
      return <span style={{ color: '#999' }}>-</span>;
    }
    const gap = options?.dense ? 4 : 6;
    const fontSize = options?.dense ? 12 : 13;
    return (
      <div style={{ display: 'flex', flexDirection: 'column', gap }}>
        {items.map((item: RadiationSensitivityItem) => (
          <div
            key={item.key || item.name}
            style={{
              display: 'flex',
              justifyContent: 'space-between',
              fontSize,
              lineHeight: 1.3,
            }}
          >
            <span style={{ color: '#888' }}>{item.name}</span>
            <span style={{ fontWeight: 500, marginLeft: 12 }}>{item.value || '-'}</span>
          </div>
        ))}
      </div>
    );
  };

  // 获取页面标题和描述
  const getPageTitle = () => {
    const category = searchParams.get('category');
    
    // 如果有特定类别，显示类别名称
    if (category) {
      const categoryMap: Record<string, { title: string; desc: string }> = {
        'analog': { title: '模拟单片集成电路', desc: 'Analog Integrated Circuits - 运算放大器、电源管理、信号处理、数据转换等' },
        'digital': { title: '数字单片集成电路', desc: 'Digital Integrated Circuits - 微处理器、DSP、FPGA、存储器等' },
        'hybrid': { title: '混合集成电路', desc: 'Hybrid Integrated Circuits - 模拟数字混合、功率集成等' },
        'semiconductor': { title: '半导体分立器件', desc: 'Semiconductor Discrete Devices - 二极管、三极管、MOSFET等' },
        'microwave': { title: '固态微波器件与电路', desc: 'Solid-State Microwave Devices - 微波放大器、振荡器、混频器等' },
        'vacuum': { title: '真空电子器件', desc: 'Vacuum Electronic Devices - 电子管、显示器件等' },
        // 顶层类别（中文）
        '电阻器': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        '电容器': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        '连接器': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        '晶振与振荡器': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        '开关': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        '分立器件': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        '热敏电阻': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        '微电路': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        '电缆组件': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        '电感器': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        '继电器': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        '变压器': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        '滤波器': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        '电线电缆': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        '射频无源器件': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
        // 顶层类别（英文）
        'Resistors': { title: '电阻器', desc: 'Resistors - 固定电阻、可变电阻、网络电阵列等' },
        'Capacitors': { title: '电容器', desc: 'Capacitors - 陶瓷电容、钽电容、薄膜电容等' },
        'Connectors': { title: '连接器', desc: 'Connectors - PCB连接器、D型连接器、射频连接器等' },
        'Crystals and Oscillators': { title: '晶振与振荡器', desc: 'Crystals and Oscillators - 晶体振荡器、石英晶体等' },
        'Switches': { title: '开关', desc: 'Switches - 拨动开关、按键开关、旋转开关等' },
        'Discretes': { title: '分立器件', desc: 'Discretes - 二极管、三极管、场效应管、功率器件等' },
        'Thermistors': { title: '热敏电阻', desc: 'Thermistors - NTC、RTD、热电阻等' },
        'Microcircuits': { title: '微电路', desc: 'Microcircuits - 数字微电路、模拟微电路、外围控制器等' },
        'Cable Assemblies': { title: '电缆组件', desc: 'Cable Assemblies - 射频电缆、微波电缆、连接线等' },
        'Inductors': { title: '电感器', desc: 'Inductors - 功率电感、定制电感、RF电感等' },
        'Relays': { title: '继电器', desc: 'Relays - 混合继电器、电磁继电器、固态继电器等' },
        'Transformers': { title: '变压器', desc: 'Transformers - 电源变压器、隔离变压器、脉冲变压器等' },
        'Filters': { title: '滤波器', desc: 'Filters - 共模扼流圈、EMI滤波器、信号滤波器等' },
        'Wires and Cables': { title: '电线电缆', desc: 'Wires and Cables - 导线、电缆、屏蔽线等' },
        'RF Passive Components': { title: '射频无源器件', desc: 'RF Passive Components - 同轴衰减器、负载、耦合器等' },
      };
      return categoryMap[category] || { title: '器件搜索', desc: 'Component Search - 全类别器件搜索' };
    }
    
    // 如果是从主页搜索或没有特定类别，显示全类别搜索
    return { title: '器件搜索', desc: 'Component Search - 全类别器件搜索，涵盖集成电路、航空电子、处理器等' };
  };

  const { title: pageTitle, desc: pageDesc } = getPageTitle();
  
  // 定义搜索函数，使用 useCallback 确保使用最新的状态值
  const handleSearch = useCallback(async (overridePage?: number, familyPathOverride?: string[]) => {
    setLoading(true);
    try {
      const formValues = form.getFieldsValue();
      
      // 构建DoEEEt API搜索参数
      const params = new URLSearchParams();
      
      // 关键词搜索（型号）
      if (formValues.partNumber) {
        params.append('partNumber', formValues.partNumber);
      }
      
      // 制造商筛选
      if (formValues.manufacturer) {
        params.append('manufacturer', formValues.manufacturer);
      }
      
      // 质量等级筛选
      if (formValues.qualityLevel) {
        params.append('qualityName', formValues.qualityLevel);
      }
      
      // 淘汰状态筛选
      if (formValues.obsolescenceType) {
        params.append('obsolescenceType', formValues.obsolescenceType);
      }
      
      // 参数范围筛选
      if (Object.keys(parameterFilters).length > 0) {
        params.append('parameters', JSON.stringify(parameterFilters));
      }
      
      // 分类路径筛选（新增）- 优先使用调用方传入的 familyPathOverride
      // 注意：后端与数据库以 叶子->父级 的顺序存储与查询，这里保持原始顺序即可
      const rawFamilyPath = Array.isArray(familyPathOverride) ? familyPathOverride : selectedCategory;
      const familyPathToUse = Array.isArray(rawFamilyPath) ? rawFamilyPath : [];
      if (familyPathToUse.length > 0) {
        params.append('familyPath', JSON.stringify(familyPathToUse));
        console.log('搜索时使用的分类路径:', familyPathToUse);
      }
      
      // 分页参数 - 优先使用传入的 overridePage，否则使用 currentPage 状态
      const pageToUse = overridePage !== undefined ? overridePage : currentPage;
      params.append('page', pageToUse.toString());
      params.append('limit', pageSize.toString());
      
      // 调用DoEEEt API
      const finalUrl = `/api/doeeet/search?${params.toString()}`;
      console.log('搜索请求URL:', finalUrl);
      const data = await httpClient.get<any>(finalUrl, { timeoutMs: 60000, retries: 1, retryDelayMs: 800 });
      console.log('搜索响应结果(data):', data);
      
      if (data) {
        const rawComponents = Array.isArray(data.components) ? data.components : [];

        // 保存候选参数定义，并生成横向动态列（Beta）
        let defs = Array.isArray(data.parameterDefinitions) ? data.parameterDefinitions : [];

        // 优先根据响应中的动态参数推导字段定义
        if (!defs || defs.length === 0) {
          const derivedDefsMap = new Map<string, any>();
          rawComponents.forEach((entry: any) => {
            const dynamicParams = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
            dynamicParams.forEach((param: any) => {
              const key = param?.key || param?.parameter_key;
              if (!key || derivedDefsMap.has(key)) return;
              derivedDefsMap.set(key, {
                parameter_key: key,
                name: param?.name || param?.parameter_name || key,
                short_name: param?.shortName || param?.short_name,
                category: param?.category,
                example: param?.example,
              });
            });
          });
          if (derivedDefsMap.size > 0) {
            defs = Array.from(derivedDefsMap.values());
          }
        }

        // 兜底：若仍未获取 parameterDefinitions，则基于 familyPath 再拉取一次定义
        if ((!defs || defs.length === 0) && familyPathToUse.length > 0) {
          try {
            // 先根据 familyPath 获取分类元数据（包含参数 key 列表）
            const encodedPath = encodeURIComponent(JSON.stringify(familyPathToUse));
            const meta = await httpClient.get<any>(`/api/doeeet/category-meta/${encodedPath}`, { timeoutMs: 20000 });
            const metaKeys: string[] = Array.isArray(meta?.meta) ? meta.meta.map((m: any) => m.key).filter(Boolean) : [];

            if (metaKeys.length > 0) {
              const keysParam = metaKeys.join(',');
              const defsResp = await httpClient.get<any>(`/api/doeeet/parameter-definitions?keys=${encodeURIComponent(keysParam)}`, { timeoutMs: 20000 });
              if (Array.isArray(defsResp)) {
                defs = defsResp;
              }
            }
          } catch (e) {
            // 忽略兜底异常，继续使用静态列渲染
            console.warn('基于 familyPath 拉取参数定义失败，已回退为静态列: ', e);
          }
        }

        const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
        const definitionKeySet = new Set(
          baseDefinitions
            .map(def => def?.parameter_key)
            .filter((key): key is string => Boolean(key))
        );

        const radiationDefinitions: ParameterDefinition[] = [];
        rawComponents.forEach((entry: any) => {
          const radiationList = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];
          radiationList.forEach((rad: any) => {
            const parameterKey = deriveRadiationParameterKey(rad);
            if (!parameterKey || definitionKeySet.has(parameterKey)) {
              return;
            }
            if (radiationDefinitions.some(def => def.parameter_key === parameterKey)) {
              return;
            }
            const name =
              rad?.name ||
              rad?.parameter_name ||
              rad?.shortName ||
              rad?.short_name ||
              parameterKey;
            const shortName = rad?.shortName || rad?.short_name;
            const exampleSource = rad?.example ?? rad?.value ?? rad?.displayValue ?? rad?.text;
            radiationDefinitions.push({
              parameter_key: parameterKey,
              name,
              short_name: shortName,
              category: 'Radiation Sensitivity',
              example: typeof exampleSource === 'string' ? exampleSource : undefined,
            });
            definitionKeySet.add(parameterKey);
          });
        });

        const mergedDefinitions =
          radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;

        setParameterDefinitions(mergedDefinitions);
        if (mergedDefinitions.length > 0) {
          setDynamicColumns(
            generateDynamicParameterColumns<ComponentWithUI>(mergedDefinitions, {
              columnWidth: 140,
              minColumnWidth: 90,
              ellipsis: true,
              sortable: true,
            })
          );
        } else {
          setDynamicColumns([]);
        }

        // 转换DoEEEt数据格式以兼容现有UI（支持新老结构）
        const adaptedComponents: ComponentWithUI[] = rawComponents.map((entry: any) => {
          const comp = entry?.static ? entry.static : entry;
          const fixedExtras = entry?.fixedExtras || [];
          const dynamic = Array.isArray(entry?.dynamic) ? entry.dynamic : [];
          const radiationSource = Array.isArray(entry?.radiation_sensitivity) ? entry.radiation_sensitivity : [];

          const normalizeForMatch = (value: string) =>
            value.toLowerCase().replace(/[\s_\-\/]+/g, '');

          const normalizeValue = (raw: any): string | undefined => {
            if (raw === null || raw === undefined) return undefined;
            if (typeof raw === 'string') {
              const trimmed = raw.trim();
              if (!trimmed || trimmed === '-' || trimmed === '--' || trimmed.toLowerCase() === 'n/a') {
                return undefined;
              }
              return trimmed;
            }
            if (typeof raw === 'number' || typeof raw === 'boolean') {
              return String(raw);
            }
            if (Array.isArray(raw)) {
              const joined = raw
                .map(item => normalizeValue(item))
                .filter((item): item is string => Boolean(item))
                .join(', ');
              return joined || undefined;
            }
            return String(raw);
          };

          const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
            .map((rad: any, index: number) => {
              const normalized =
                normalizeValue(rad?.value ?? rad?.displayValue ?? rad?.text ?? rad?.example) ?? '-';
              const name =
                rad?.name ||
                rad?.shortName ||
                rad?.short_name ||
                rad?.parameter_name ||
                rad?.key ||
                'Radiation';
              const parameterKey = deriveRadiationParameterKey(rad);
              const listKey =
                parameterKey || `${comp?.component_id || comp?.part_number || 'component'}-rad-${index}`;
              return {
                key: listKey,
                parameterKey,
                name,
                shortName: rad?.shortName || rad?.short_name,
                value: normalized,
              };
            })
            .filter((item: RadiationSensitivityItem) => item.value !== '-');

          const findExtraValue = (keywords: string | string[]) => {
            const keywordList = Array.isArray(keywords) ? keywords : [keywords];
            const normalizedKeywords = keywordList
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const extra of fixedExtras) {
              const name = typeof extra?.name === 'string' ? extra.name : '';
              if (!name) continue;
              const normalizedName = normalizeForMatch(name);
              const hasMatch = normalizedKeywords.some(keyword => normalizedName.includes(keyword));
              if (!hasMatch) continue;

              const rawValue = extra?.value ?? extra?.displayValue ?? extra?.text ?? extra?.example ?? '';
              const stringValue = normalizeValue(rawValue);
              if (stringValue !== undefined) {
                return stringValue;
              }
            }
            return undefined;
          };

          // 解析 family_path
          let familyPathArray: string[] = [];
          const familyRaw = comp.family_path;
          if (Array.isArray(familyRaw)) {
            familyPathArray = familyRaw as string[];
          } else if (typeof familyRaw === 'string') {
            try {
              const normalized = familyRaw.replace(/'/g, '"');
              const parsed = JSON.parse(normalized);
              familyPathArray = Array.isArray(parsed) ? parsed : [familyRaw];
            } catch {
              familyPathArray = [familyRaw];
            }
          }

          // 分类（叶子->父级）
          const mainCategory = familyPathArray[familyPathArray.length - 1] || '未分类';
          const primaryCategory = familyPathArray.length >= 2 ? familyPathArray[familyPathArray.length - 2] : mainCategory;
          const secondaryCategory = familyPathArray.length >= 3 ? familyPathArray[familyPathArray.length - 3] : primaryCategory;

          // 动态参数映射为 parameters 字典（key → value）
          const parametersMap: Record<string, any> = {};
          dynamic.forEach((p: any) => {
            const key = p?.key || p?.parameter_key;
            if (key) {
              const value = p?.value ?? p?.displayValue ?? p?.text ?? null;
              parametersMap[key] = value;
            }
          });
          radiationSensitivity.forEach(item => {
            if (item.parameterKey && item.value) {
              parametersMap[item.parameterKey] = item.value;
            }
          });

          const findDynamicValue = (keywords: string[]) => {
            const normalizedKeywords = keywords
              .map(keyword => (typeof keyword === 'string' ? normalizeForMatch(keyword) : ''))
              .filter(Boolean);

            if (normalizedKeywords.length === 0) {
              return undefined;
            }

            for (const param of dynamic) {
              const candidateFields = [
                param?.key,
                param?.parameter_key,
                param?.name,
                param?.parameter_name,
                param?.shortName,
                param?.short_name,
              ].filter((field): field is string => typeof field === 'string' && field.length > 0);

              const hasMatch = candidateFields
                .map(field => normalizeForMatch(field))
                .some(normalizedField => normalizedKeywords.some(keyword => normalizedField.includes(keyword)));

              if (hasMatch) {
                const normalizedValue = normalizeValue(param?.value ?? param?.displayValue ?? param?.text ?? param?.example);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            for (const [mapKey, mapValue] of Object.entries(parametersMap)) {
              const normalizedKey = normalizeForMatch(mapKey);
              if (normalizedKeywords.some(keyword => normalizedKey.includes(keyword))) {
                const normalizedValue = normalizeValue(mapValue);
                if (normalizedValue !== undefined) {
                  return normalizedValue;
                }
              }
            }

            return undefined;
          };

          // 固定扩展：Package 与 TOP
          const packageValue =
            findExtraValue('package') ??
            normalizeValue(comp.package) ??
            normalizeValue(comp.part_type) ??
            '-';

          const topValue =
            findExtraValue(['top', 'operating temperature range', 'operating temperature', 'operating temp', 'temperature range']) ??
            findDynamicValue(['operating temperature range', 'operating temperature', 'operating temp', 'temperature range', 'top']) ??
            normalizeValue(comp.top_marking) ??
            normalizeValue(comp.top) ??
            '';

          return {
            id: comp.component_id,
            component_id: comp.component_id,
            partNumber: comp.part_number,
            manufacturer: comp.manufacturer_name || '未知制造商',
            mainCategory,
            primaryCategory,
            secondaryCategory,
            package: packageValue,
            top: topValue,
            qualityLevel: comp.quality_name || '-',
            lifecycle: comp.obsolescence_type || 'Active',
            standards: comp.qpl_name ? [comp.qpl_name] : [],
            description: `${comp.part_type || ''} ${comp.qpl_name ? `- ${comp.qpl_name}` : ''}`.trim(),
            functionalPerformance: `${mainCategory} / ${primaryCategory}`,
            referencePrice: 0,
            parameters: parametersMap,
            radiationSensitivity,
            suppliers: []
          };
        });

        setComponents(adaptedComponents);
        const totalCount = typeof data.total === 'number'
          ? data.total
          : data.pagination?.total || (data.components ? data.components.length : 0);
        setTotal(totalCount);
        // 同步到受控分页对象
        setPaginationState(prev => ({ ...prev, total: totalCount }));
        
        // 更新页码：优先使用后端返回的 page（最准确），否则使用请求时使用的 pageToUse
        const finalPage = typeof data.page === 'number' 
          ? data.page 
          : pageToUse;
        setCurrentPage(finalPage);
        setPaginationState(prev => ({ ...prev, current: finalPage }));
        
        // 更新每页数量：优先使用后端返回的 limit，否则使用当前的 pageSize
        const finalLimit = typeof data.limit === 'number'
          ? data.limit
          : pageSize;
        setPageSize(finalLimit);
        setPaginationState(prev => ({ ...prev, pageSize: finalLimit }));
      } else {
        const msg = '未找到符合条件的组件';
        message.warning(msg);
        setComponents([]);
        setTotal(0);
        setPaginationState(prev => ({ ...prev, total: 0 }));
      }
    } catch (error: any) {
      console.error('搜索失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，请稍后重试');
      // 失败时不再使用本地模拟数据，保持为空以避免误导
      setComponents([]);
      setTotal(0);
      setPaginationState(prev => ({ ...prev, total: 0 }));
    } finally {
      setLoading(false);
    }
  }, [selectedCategory, currentPage, pageSize, parameterFilters, form]);
  
  // 处理来自首页的搜索参数和分类过滤
  useEffect(() => {
    const query = searchParams.get('q');
    const category = searchParams.get('category');

    // 预先计算并保存将要设置的分类路径，避免异步 setState 导致闭包取旧值
    let initialFamilyPath: string[] = [];

    // 如果有分类参数，转换为 familyPath 并设置到 selectedCategory
    if (category) {
      initialFamilyPath = getFamilyPathFromCategory(category);
      if (initialFamilyPath.length > 0) {
        setSelectedCategory(initialFamilyPath);
      } else {
        // 如果找不到对应的 familyPath，清空 selectedCategory
        setSelectedCategory([]);
      }
    } else {
      // 如果没有分类参数，清空 selectedCategory（不显示全局数据）
      setSelectedCategory([]);
    }

    // 设置表单值
    if (query) {
      form.setFieldsValue({ partNumber: query });
    }
    if (category) {
      form.setFieldsValue({ category: category });
    }

    // 如果有查询参数，需要手动触发搜索（因为可能没有分类，不会触发 selectedCategory 的 useEffect）
    if (query) {
      // 直接使用同步计算得到的 initialFamilyPath，避免使用可能尚未更新的 selectedCategory
      handleSearch(undefined, initialFamilyPath);
    }
  }, [searchParams, form, handleSearch]);

  // 监听分类筛选变化（仅处理分页与清空，不在此发起搜索，避免重复请求）
  useEffect(() => {
    // 只有当 selectedCategory 有值时，才自动触发搜索
    // 如果没有分类，不显示数据（符合用户要求：分类点进去后应该只显示对应的分类数据）
    if (selectedCategory.length > 0) {
      // 重置到第一页
      setCurrentPage(1);
    } else {
      // 如果没有分类，清空数据列表
      setComponents([]);
      setTotal(0);
    }
  }, [selectedCategory, handleSearch]);

  //（已移除本地模拟数据，避免误导实际检索效果）

  const handleReset = () => {
    form.resetFields();
    setComponents([]);
  };

  const normalizeParameterValue = (rawValue: any): string => {
    if (rawValue === null || rawValue === undefined) {
      return '-';
    }

    if (Array.isArray(rawValue)) {
      return rawValue.length > 0 ? rawValue.join(', ') : '-';
    }

    if (typeof rawValue === 'number' || typeof rawValue === 'boolean') {
      return String(rawValue);
    }

    if (typeof rawValue === 'object') {
      const values = Object.values(rawValue);
      return values.length > 0 ? values.join(', ') : '-';
    }

    if (typeof rawValue === 'string') {
      const trimmed = rawValue.trim();
      if (!trimmed) {
        return '-';
      }
      try {
        const parsed = JSON.parse(trimmed.replace(/'/g, '"'));
        if (Array.isArray(parsed)) {
          return parsed.length > 0 ? parsed.join(', ') : '-';
        }
        if (typeof parsed === 'object' && parsed !== null) {
          const values = Object.values(parsed as Record<string, any>);
          return values.length > 0 ? values.join(', ') : trimmed;
        }
      } catch (err) {
        // 非 JSON 结构，直接返回原始字符串
      }
      return trimmed;
    }

    return '-';
  };

  const showDetail = async (component: ComponentWithUI) => {
    setSelectedComponent(component);
    setDetailParameters([]);
    setDetailLoading(true);
    setDetailModalVisible(true);

    if (!component.component_id) {
      message.warning('当前器件缺少组件ID，无法获取详细参数');
      setDetailLoading(false);
      return;
    }

    // 获取组件的详细参数信息
    try {
      const data = await httpClient.get<any>(`/api/doeeet/components/${component.component_id}`, { timeoutMs: 15000 });

      if (data) {
        const rawParameters = Array.isArray(data.parameters) ? data.parameters : [];

        const normalizedParameters: DetailParameter[] = rawParameters
          .filter((param: any) => {
            const name = param?.name || param?.shortName;
            return name && String(name).trim().toLowerCase() !== 'unknown';
          })
          .map((param: any) => {
            const name = param.name || param.shortName || param.key || '-';
            const key = param.key || name;
            const displayValue = normalizeParameterValue(param.value ?? param.numericValue);
            return {
              key,
              name,
              category: param.category,
              displayValue,
            };
          })
          .sort((a: DetailParameter, b: DetailParameter) => {
            const categoryA = a.category || '其他';
            const categoryB = b.category || '其他';
            if (categoryA !== categoryB) {
              return categoryA.localeCompare(categoryB, 'zh-CN');
            }
            return a.name.localeCompare(b.name, 'zh-CN');
          });

        // 转换为前端需要的格式
        const parameterDefinitions = rawParameters.map((param: any) => ({
          parameter_key: param.key,
          name: param.name,
          short_name: param.shortName,
          category: param.category,
          example: '',
          value: param.value,
        }));

        setDetailParameters(normalizedParameters);

        // 更新选中组件的参数
        setSelectedComponent(prev =>
          prev ? { ...prev, parameterDefinitions } : { ...component, parameterDefinitions }
        );
      } else {
        const msg = '未获取到组件详情';
        message.warning(msg);
      }
    } catch (error: any) {
      console.error('获取组件详情失败:', error);
      message.error(error?.message || '网络异常或服务器不可用，无法获取组件详情');
    } finally {
      setDetailLoading(false);
    }
  };

  const addToSelection = (componentId: string) => {
    if (!selectedComponents.includes(componentId)) {
      setSelectedComponents([...selectedComponents, componentId]);
    }
  };

  const handleCompare = () => {
    if (selectedComponents.length < 2) {
      message.warning('请至少选择2个组件进行对比');
      return;
    }
    if (selectedComponents.length > 5) {
      message.warning('最多只能对比5个组件');
      return;
    }
    
    // 获取选中组件的component_id
    const selectedIds = components
      .filter(comp => selectedComponents.includes(comp.id))
      .map(comp => comp.component_id)
      .filter((id): id is string => id !== undefined);
    
    if (selectedIds.length < 2) {
      message.error('选中的组件信息不完整');
      return;
    }
    
    setCompareComponentIds(selectedIds);
    setCompareModalVisible(true);
  };

  // 静态列配置
  const staticColumns: ColumnsType<ComponentWithUI> = [
    {
      title: '器件型号',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 120,
      fixed: 'left',
      render: (text: string, record: ComponentWithUI) => (
        <Button type="link" onClick={() => showDetail(record)}>
          {text}
        </Button>
      ),
    },
    {
      title: '制造商',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 100,
    },
    {
      title: '主分类',
      dataIndex: 'mainCategory',
      key: 'mainCategory',
      width: 100,
      render: (text: string) => {
        const colorMap: Record<string, string> = {
          '模拟单片集成电路': 'blue',
          '数字单片集成电路': 'green',
          '混合集成电路': 'cyan',
          '半导体分立器件': 'orange',
          '固态微波器件与电路': 'purple',
          '真空电子器件': 'magenta',
          '光电子器件': 'gold',
          '机电组件': 'red',
          '电能源': 'volcano',
          '通用与特种元件': 'geekblue',
          '微系统': 'lime',
        };
        return <Tag color={colorMap[text] || 'blue'}>{text}</Tag>;
      },
    },
    {
      title: '一级分类',
      dataIndex: 'primaryCategory',
      key: 'primaryCategory',
      width: 140,
      render: (text: string) => <Tag color="blue">{text}</Tag>,
    },
    {
      title: '二级分类',
      dataIndex: 'secondaryCategory',
      key: 'secondaryCategory',
      width: 120,
      render: (text: string) => <Tag color="green">{text}</Tag>,
    },
    {
      title: '封装',
      dataIndex: 'package',
      key: 'package',
      width: 80,
    },
    {
      title: 'TOP',
      dataIndex: 'top',
      key: 'top',
      width: 100,
      render: (text: string) => text || '-',
    },
    {
      title: '功能性能',
      dataIndex: 'functionalPerformance',
      key: 'functionalPerformance',
      width: 150,
      ellipsis: true,
    },
    {
      title: '参考价格',
      dataIndex: 'referencePrice',
      key: 'referencePrice',
      width: 90,
      render: (price: number) => (
        price > 0 ? (
          <span style={{ color: '#1890ff', fontWeight: 'bold' }}>
            ¥{price.toFixed(2)}
          </span>
        ) : (
          <span style={{ color: '#999' }}>-</span>
        )
      ),
      sorter: (a: ComponentWithUI, b: ComponentWithUI) => (a.referencePrice || 0) - (b.referencePrice || 0),
    },
    {
      title: '质量等级',
      dataIndex: 'qualityLevel',
      key: 'qualityLevel',
      width: 90,
      render: (level: string) => {
        const color = level === '宇航级' ? 'red' : level === '军用级' ? 'orange' : 'blue';
        return <Tag color={color}>{level}</Tag>;
      },
    },
    {
      title: '生命周期',
      dataIndex: 'lifecycle',
      key: 'lifecycle',
      width: 90,
      render: (lifecycle: string) => {
        const color = lifecycle === '生产中' ? 'green' : lifecycle === '停产' ? 'red' : 'orange';
        return <Tag color={color}>{lifecycle}</Tag>;
      },
    },
    {
      title: '操作',
      key: 'action',
      width: 120,
      fixed: 'right' as const,
      render: (_: any, record: ComponentWithUI) => (
        <Space size="small">
          <Tooltip title="查看详情">
            <Button
              type="text"
              icon={<EyeOutlined />}
              onClick={() => showDetail(record)}
            />
          </Tooltip>
          <Tooltip title="添加到对比">
            <Button
              type="text"
              icon={<SwapOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
          <Tooltip title="添加到选型清单">
            <Button
              type="text"
              icon={<ShoppingCartOutlined />}
              onClick={() => addToSelection(record.id)}
            />
          </Tooltip>
        </Space>
      ),
    },
  ];
  
  // 合并静态列和动态参数列，确保顺序为：静态列（不含操作列）-> 动态列 -> 操作列
  const actionColumn = staticColumns.find(col => col.key === 'action');
  const staticWithoutAction = staticColumns.filter(col => col.key !== 'action');
  const columns = actionColumn
    ? [...staticWithoutAction, ...dynamicColumns, actionColumn]
    : [...staticWithoutAction, ...dynamicColumns];

  const query = searchParams.get('q');
  const category = searchParams.get('category');

  return (
    <div>
      {/* 主分类标题 */}
      <Card style={{ marginBottom: 16, background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' }}>
        <div style={{ color: 'white', textAlign: 'center' }}>
          <h2 style={{ color: 'white', margin: 0, fontSize: '24px' }}>
            {pageTitle}
          </h2>
          <p style={{ color: 'rgba(255,255,255,0.8)', margin: '8px 0 0 0', fontSize: '14px' }}>
            {pageDesc}
          </p>
        </div>
      </Card>
      
      {(query || category) && (
        <Alert
          message="搜索条件"
          description={
            <div>
              {query && <span>关键词: <strong>{query}</strong></span>}
              {query && category && <span> | </span>}
              {category && <span>分类: <strong>{category}</strong></span>}
            </div>
          }
          type="info"
          showIcon
          style={{ marginBottom: 16 }}
        />
      )}
      
      {/* 左右布局：左侧筛选面板，右侧结果展示 */}
      <Row gutter={16}>
        {/* 左侧筛选面板 */}
        <Col span={6}>
          <div style={{ position: 'sticky', top: 16 }}>
            {/* 分类筛选器 */}
            <Card 
              title="分类浏览" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
              <CategoryFilter
                selectedCategory={selectedCategory}
                lockTopCategory={
                  // 将当前已选分类的顶层（父级）作为锁定大类
                  selectedCategory.length > 0 ? selectedCategory[selectedCategory.length - 1] : undefined
                }
                onCategoryChange={(path) => {
                  // 更新选中的分类并立即以完整路径触发搜索（父->子顺序由 handleSearch 内部统一处理）
                  setSelectedCategory(path);
                  setCurrentPage(1);
                  setPaginationState(prev => ({ ...prev, current: 1 }));
                  handleSearch(1, path);
                  console.log('选中的分类路径:', path);
                }}
              />
            </Card>

            {/* 快速搜索 */}
            <Card 
              title="快速搜索" 
              size="small"
              style={{ marginBottom: 16 }}
              bodyStyle={{ padding: '12px' }}
            >
        <Form
          form={form}
          layout="vertical"
          onFinish={() => handleSearch(undefined, selectedCategory)}
                size="small"
        >
              <Form.Item label="器件型号" name="partNumber">
                <Input placeholder="输入器件型号" />
              </Form.Item>
              <Form.Item label="制造商" name="manufacturer">
                  <Select placeholder="选择制造商" allowClear showSearch>
                    <Option value="Pyramid Semiconductor">Pyramid Semiconductor</Option>
                  <Option value="Analog Devices">Analog Devices</Option>
                  <Option value="Texas Instruments">Texas Instruments</Option>
                  <Option value="Intel">Intel</Option>
                  <Option value="Xilinx">Xilinx</Option>
                    <Option value="Microsemi">Microsemi</Option>
                    <Option value="Microchip">Microchip</Option>
                    <Option value="STMicroelectronics">STMicroelectronics</Option>
                </Select>
              </Form.Item>
              <Form.Item label="质量等级" name="qualityLevel">
                <Select placeholder="选择质量等级" allowClear>
                    <Option value="883">883</Option>
                    <Option value="QML Q">QML Q</Option>
                    <Option value="EP">EP</Option>
                  <Option value="宇航级">宇航级</Option>
                  <Option value="军用级">军用级</Option>
                  <Option value="工业级">工业级</Option>
                </Select>
              </Form.Item>
                <Form.Item label="淘汰状态" name="obsolescenceType">
                  <Select placeholder="选择淘汰状态" allowClear>
                    <Option value="Active">Active (在产)</Option>
                    <Option value="Last Time Buy">Last Time Buy (最后购买)</Option>
                    <Option value="Obsolete">Obsolete (已淘汰)</Option>
                    <Option value="Risk">Risk (风险)</Option>
                </Select>
              </Form.Item>
          <Form.Item>
                  <Space style={{ width: '100%' }} direction="vertical">
                    <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading} block>
                搜索
              </Button>
                    <Button onClick={handleReset} block>重置</Button>
            </Space>
          </Form.Item>
        </Form>
      </Card>

            {/* 参数范围筛选 */}
            <Card 
              title="参数筛选" 
              size="small"
              bodyStyle={{ padding: '12px' }}
            >
              <ParameterRangeFilter 
                onFilterChange={(filters) => {
                  setParameterFilters(filters);
                }}
              />
            </Card>
          </div>
        </Col>

        {/* 右侧结果展示区域 */}
        <Col span={18}>
          {components.length > 0 ? (
        <Card 
              title={`搜索结果 (${total} 个结果)`}
          extra={
              <Space>
                  {selectedComponents.length > 0 && (
                    <>
                <span>已选择 {selectedComponents.length} 个器件</span>
                      <Button 
                        type="primary" 
                        icon={<SwapOutlined />}
                        onClick={handleCompare}
                        disabled={selectedComponents.length < 2 || selectedComponents.length > 5}
                      >
                        批量对比
                      </Button>
                      <Button icon={<ShoppingCartOutlined />}>添加到清单</Button>
                    </>
                  )}
                  <Button 
                    icon={<DownloadOutlined />}
                    onClick={() => {
                      if (parameterDefinitions.length > 0) {
                        const csvContent = exportParametersToCSV(components, parameterDefinitions);
                        downloadCSV(csvContent, `components_export_${new Date().getTime()}.csv`);
                        message.success('导出成功！');
                      } else {
                        message.warning('暂无参数数据可导出');
                      }
                    }}
                  >
                    导出CSV
                  </Button>
              </Space>
          }
        >
          <Table
            columns={columns}
            dataSource={components}
            rowKey="id"
            loading={loading}
            rowSelection={{
              selectedRowKeys: selectedComponents,
              onChange: (selectedRowKeys: React.Key[]) => setSelectedComponents(selectedRowKeys as string[]),
            }}
            scroll={{ x: 'max-content' }}
            pagination={{
              current: paginationState.current,
              pageSize: paginationState.pageSize,
              total: paginationState.total,
              showSizeChanger: true,
              showQuickJumper: true,
                  pageSizeOptions: ['10', '20', '50', '100'],
              showTotal: (total, range) => `${range[0]}-${range[1]} of ${total} items`,
              onChange: (page, size) => {
                    // 先更新状态，然后触发搜索
                    // 注意：这里先更新状态，确保UI立即响应
                    const newPageSize = size || 10;
                setCurrentPage(page);
                    setPageSize(newPageSize);
                    setPaginationState({ current: page, pageSize: newPageSize, total });
                    // 分页改变时重新搜索，直接传递新的页码避免时序问题
                    handleSearch(page, selectedCategory);
              },
              onShowSizeChange: (_current, size) => {
                    // 当每页数量改变时，重置到第一页
                    setCurrentPage(1);
                    setPageSize(size);
                    setPaginationState({ current: 1, pageSize: size, total });
                    handleSearch(1, selectedCategory);
              },
            }}
          />
        </Card>
          ) : (
            <Card>
              <div style={{ textAlign: 'center', padding: '40px 0' }}>
                <p style={{ color: '#999', fontSize: '16px' }}>
                  {loading ? '搜索中...' : '暂无搜索结果，请调整筛选条件后重试'}
                </p>
              </div>
        </Card>
      )}
        </Col>
      </Row>

      {/* 器件详情模态框 */}
      <Modal
        title="器件详情"
        open={detailModalVisible}
        onCancel={() => setDetailModalVisible(false)}
        footer={[
          <Button key="compare" icon={<SwapOutlined />}>
            添加到对比
          </Button>,
          <Button key="select" type="primary" icon={<ShoppingCartOutlined />}>
            添加到选型清单
          </Button>,
        ]}
        width={800}
      >
        {selectedComponent && (
          <Space direction="vertical" size="large" style={{ width: '100%' }}>
            <Card
              size="small"
              title="基础信息"
              headStyle={{ fontSize: 16, fontWeight: 600 }}
              bodyStyle={{ padding: '12px 16px' }}
            >
              <Descriptions
                size="small"
                column={3}
                labelStyle={{ color: '#6b7280', fontWeight: 500, width: 120 }}
                contentStyle={{ color: '#111827' }}
              >
                <Descriptions.Item label="器件型号" span={1}>
                  <span style={{ fontWeight: 600, fontSize: '16px' }}>{selectedComponent.partNumber || '-'}</span>
                </Descriptions.Item>
                <Descriptions.Item label="制造商">{selectedComponent.manufacturer || '-'}</Descriptions.Item>
                <Descriptions.Item label="封装">{selectedComponent.package || '-'}</Descriptions.Item>
            <Descriptions.Item label="一级分类">
                  {selectedComponent.primaryCategory ? (
              <Tag color="blue">{selectedComponent.primaryCategory}</Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="二级分类">
                  {selectedComponent.secondaryCategory ? (
              <Tag color="green">{selectedComponent.secondaryCategory}</Tag>
                  ) : (
                    '-'
              )}
            </Descriptions.Item>
            <Descriptions.Item label="质量等级">
                  {selectedComponent.qualityLevel ? (
              <Tag color={selectedComponent.qualityLevel === '宇航级' ? 'red' : 'orange'}>
                {selectedComponent.qualityLevel}
              </Tag>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
            <Descriptions.Item label="生命周期">
                  {selectedComponent.lifecycle ? <Tag color="green">{selectedComponent.lifecycle}</Tag> : '-'}
            </Descriptions.Item>
                <Descriptions.Item label="Radiation: Potential Sensitivity" span={3}>
                  {renderRadiationSensitivityCell(selectedComponent.radiationSensitivity, { dense: true })}
                </Descriptions.Item>
                <Descriptions.Item label="参考价格">
                  {(selectedComponent.referencePrice ?? 0) > 0 ? (
                    <span style={{ color: '#2563eb', fontWeight: 600, fontSize: '16px' }}>
                      ¥{selectedComponent.referencePrice!.toFixed(2)}
                    </span>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无报价</span>
                  )}
                </Descriptions.Item>
                <Descriptions.Item label="相关标准" span={3}>
                  {selectedComponent.standards && selectedComponent.standards.length > 0 ? (
                    <Space size={[8, 8]} wrap>
              {selectedComponent.standards.map(standard => (
                        <Tag key={standard} color="blue">
                          {standard}
                        </Tag>
              ))}
                    </Space>
                  ) : (
                    '-'
                  )}
            </Descriptions.Item>
              </Descriptions>
            </Card>

            {(selectedComponent.functionalPerformance || selectedComponent.description) && (
              <Card
                size="small"
                title="功能与描述"
                headStyle={{ fontSize: 16, fontWeight: 600 }}
                bodyStyle={{ padding: '12px 16px' }}
              >
                <Space direction="vertical" size="small" style={{ width: '100%' }}>
                  {selectedComponent.functionalPerformance && (
              <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>功能性能</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>
                        {selectedComponent.functionalPerformance}
                  </div>
              </div>
                  )}
                  {selectedComponent.description && (
                    <div>
                      <div style={{ color: '#6b7280', marginBottom: 4 }}>器件描述</div>
                      <div style={{ color: '#111827', whiteSpace: 'pre-wrap' }}>{selectedComponent.description}</div>
                    </div>
                  )}
                </Space>
              </Card>
            )}

            <Row gutter={16}>
              <Col span={hasSuppliers ? 16 : 24}>
                <Card
                  size="small"
                  title="参数详情"
                  headStyle={{ fontSize: 16, fontWeight: 600 }}
                  bodyStyle={{ padding: '12px 16px' }}
                >
                  {detailLoading ? (
                    <div style={{ textAlign: 'center', padding: '24px 0' }}>
                      <Spin size="small" tip="加载参数中..." />
                    </div>
                  ) : parameterGroups.length > 0 ? (
                    <Space direction="vertical" size="small" style={{ width: '100%' }}>
                      {parameterGroups.map(({ category, params }) => (
                        <div
                          key={category}
                          style={{
                            border: '1px solid #e0e7ff',
                            borderRadius: 8,
                            padding: '12px 16px',
                            background: '#f8fafc',
                          }}
                        >
                          <div style={{ fontWeight: 600, color: '#3451d6', marginBottom: 10 }}>{category}</div>
                          <div>
                            {params.map((param, index) => {
                              const isLast = index === params.length - 1;
                              return (
                                <div
                                  key={`${category}-${param.key}-${index}`}
                                  style={{
                                    display: 'flex',
                                    gap: 16,
                                    padding: '6px 0',
                                    borderBottom: isLast ? 'none' : '1px solid #e5e7eb',
                                    alignItems: 'flex-start',
                                  }}
                                >
                                  <span
                                    style={{
                                      flex: '0 0 220px',
                                      color: '#374151',
                                      fontWeight: 500,
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.name}
                                  </span>
                                  <span
                                    style={{
                                      flex: 1,
                                      color: '#111827',
                                      wordBreak: 'break-word',
                                    }}
                                  >
                                    {param.displayValue}
                                  </span>
                                </div>
                              );
                            })}
                          </div>
                        </div>
                      ))}
                    </Space>
                  ) : (
                    <span style={{ color: '#9ca3af' }}>暂无参数数据</span>
                  )}
                </Card>
              </Col>
              {hasSuppliers && (
                <Col span={8}>
                  <Card
                    size="small"
                    title="供应商信息"
                    headStyle={{ fontSize: 16, fontWeight: 600 }}
                    bodyStyle={{ padding: '12px 16px' }}
                  >
              <Table
                size="small"
                columns={[
                        { title: '供应商', dataIndex: 'name', key: 'name', ellipsis: true },
                        {
                          title: '价格',
                          dataIndex: 'price',
                          key: 'price',
                          render: (price: number | undefined) =>
                            typeof price === 'number' && price > 0 ? `¥${price}` : '-',
                        },
                  { title: '库存', dataIndex: 'stock', key: 'stock' },
                  { title: '交货期', dataIndex: 'leadTime', key: 'leadTime' },
                ]}
                dataSource={selectedComponent.suppliers}
                pagination={false}
                      rowKey={record => `${record.name}-${record.leadTime}-${record.price}`}
                    />
                  </Card>
                </Col>
              )}
            </Row>
          </Space>
        )}
      </Modal>

      {/* 组件对比模态框 */}
      <ComponentCompareModal
        visible={compareModalVisible}
        componentIds={compareComponentIds}
        onClose={() => setCompareModalVisible(false)}
      />
    </div>
  );
};

export default ComponentSearch;

```

## 更新
- **SEE/TID 列数据**：为辐射敏感度条目生成稳定的参数 key，将其追加进参数定义集合，并把对应值写入 `parameters` 映射。这样 `SEE Comments / SEE sens. / TID …` 等字段会自动出现在动态列里，同时详情里的辐射列表仍保持原样展示。  
```184:215:frontend/src/pages/components/ComponentSearch.tsx
interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}
const normalizeRadiationKeySegment = (value?: string): string => { ... };
const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => { ... };
```
```502:670:frontend/src/pages/components/ComponentSearch.tsx
const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
...
const mergedDefinitions = radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;
setParameterDefinitions(mergedDefinitions);
...
const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
  .map((rad: any, index: number) => {
    ...
    const parameterKey = deriveRadiationParameterKey(rad);
    ...
    return { key: listKey, parameterKey, name, shortName: ..., value: normalized };
  })
  .filter((item: RadiationSensitivityItem) => item.value !== '-');
radiationSensitivity.forEach(item => {
  if (item.parameterKey && item.value) {
    parametersMap[item.parameterKey] = item.value;
  }
});
```

- **横向拖动**：表格 `scroll.x` 调整为 `max-content`，当动态列较多时会自动出现横向滚动条，方便拖动查看。  
```1319:1355:frontend/src/pages/components/ComponentSearch.tsx
<Table
  columns={columns}
  dataSource={components}
  ...
  scroll={{ x: 'max-content' }}
  pagination={{ ... }}
/>
```

## 验证
- 未运行构建/联调；请刷新前端页面确认 SEE/TID/Comments 列出现，并试用横向滚动条。

```typescriptreact
interface RadiationSensitivityItem {
  key: string;
  parameterKey?: string;
  name: string;
  shortName?: string;
  value: string;
}
const normalizeRadiationKeySegment = (value?: string): string => { ... };
const deriveRadiationParameterKey = (radiationEntry: any): string | undefined => { ... };
```

```typescriptreact
const baseDefinitions: ParameterDefinition[] = Array.isArray(defs) ? [...defs] : [];
...
const mergedDefinitions = radiationDefinitions.length > 0 ? [...baseDefinitions, ...radiationDefinitions] : baseDefinitions;
setParameterDefinitions(mergedDefinitions);
...
const radiationSensitivity: RadiationSensitivityItem[] = radiationSource
  .map((rad: any, index: number) => {
    ...
    const parameterKey = deriveRadiationParameterKey(rad);
    ...
    return { key: listKey, parameterKey, name, shortName: ..., value: normalized };
  })
  .filter((item: RadiationSensitivityItem) => item.value !== '-');
radiationSensitivity.forEach(item => {
  if (item.parameterKey && item.value) {
    parametersMap[item.parameterKey] = item.value;
  }
});
```

```typescriptreact
<Table
  columns={columns}
  dataSource={components}
  ...
  scroll={{ x: 'max-content' }}
  pagination={{ ... }}
/>
```

---

**User**

标题改为商业航天元器件及其应用支持一站式服务平台

---

**Cursor**

```typescriptreact
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import '../styles/homepage.css';

import {
  Card,
  Input,
  Tag,
  Row,
  Col,
  Typography,
  Button,
  Space,
  Statistic,
  List,
  Avatar,
  Select,
  Tabs,
} from 'antd';
import {
  SearchOutlined,
  BookOutlined,
  ShoppingCartOutlined,
  ToolOutlined,
  SafetyCertificateOutlined,
  ExperimentOutlined,
  FileTextOutlined,
  RightOutlined,
  TrophyOutlined,
  BellOutlined,
  FileProtectOutlined,
  ThunderboltOutlined,
  DatabaseOutlined,
  ApiOutlined,
  RadarChartOutlined,
  SettingOutlined,
  BugOutlined,
  AppstoreOutlined,
  SwapOutlined,
  UsbOutlined,
  WifiOutlined,
  PoweroffOutlined,
  HeatMapOutlined,
  BranchesOutlined,
  PartitionOutlined,
  BlockOutlined,
  NodeIndexOutlined,
  FileSearchOutlined,
  DiffOutlined,
  BarChartOutlined,
  BulbOutlined,
  BuildOutlined,
} from '@ant-design/icons';

const { Search } = Input;
const { Title, Paragraph, Text } = Typography;
const { Option } = Select;

// DoEEEt真实的顶级分类数据（从数据库统计得出）
const componentCategoriesBase = [
  { 
    icon: <BarChartOutlined />, 
    title: '电阻器', 
    subtitle: 'Resistors',
    color: '#1890ff',
    description: '固定电阻、可变电阻、网络电阵列等',
    familyPath: 'Resistors',
    count: 824599
  },
  { 
    icon: <ThunderboltOutlined />, 
    title: '电容器', 
    subtitle: 'Capacitors',
    color: '#52c41a',
    description: '陶瓷电容、钽电容、薄膜电容等',
    familyPath: 'Capacitors',
    count: 527329
  },
  { 
    icon: <UsbOutlined />, 
    title: '连接器', 
    subtitle: 'Connectors',
    color: '#fa8c16',
    description: 'PCB连接器、D型连接器、射频连接器等',
    familyPath: 'Connectors',
    count: 160090
  },
  { 
    icon: <WifiOutlined />, 
    title: '晶振与振荡器', 
    subtitle: 'Crystals and Oscillators',
    color: '#722ed1',
    description: '晶体振荡器、石英晶体等',
    familyPath: 'Crystals and Oscillators',
    count: 131525
  },
  { 
    icon: <PoweroffOutlined />, 
    title: '开关', 
    subtitle: 'Switches',
    color: '#eb2f96',
    description: '拨动开关、按键开关、旋转开关等',
    familyPath: 'Switches',
    count: 53377
  },
  { 
    icon: <NodeIndexOutlined />, 
    title: '分立器件', 
    subtitle: 'Discretes',
    color: '#13c2c2',
    description: '二极管、三极管、场效应管、功率器件等',
    familyPath: 'Discretes',
    count: 51638
  },
  { 
    icon: <HeatMapOutlined />, 
    title: '热敏电阻', 
    subtitle: 'Thermistors',
    color: '#fa541c',
    description: 'NTC、RTD、热电阻等',
    familyPath: 'Thermistors',
    count: 31302
  },
  { 
    icon: <PartitionOutlined />, 
    title: '微电路', 
    subtitle: 'Microcircuits',
    color: '#2f54eb',
    description: '数字微电路、模拟微电路、外围控制器等',
    familyPath: 'Microcircuits',
    count: 29962
  },
  { 
    icon: <ApiOutlined />, 
    title: '电缆组件', 
    subtitle: 'Cable Assemblies',
    color: '#08979c',
    description: '射频电缆、微波电缆、连接线等',
    familyPath: 'Cable Assemblies',
    count: 9435
  },
  { 
    icon: <BranchesOutlined />, 
    title: '电感器', 
    subtitle: 'Inductors',
    color: '#531dab',
    description: '功率电感、定制电感、RF电感等',
    familyPath: 'Inductors',
    count: 8849
  },
  { 
    icon: <SwapOutlined />, 
    title: '继电器', 
    subtitle: 'Relays',
    color: '#096dd9',
    description: '混合继电器、电磁继电器、固态继电器等',
    familyPath: 'Relays',
    count: 6015
  },
  { 
    icon: <BlockOutlined />, 
    title: '变压器', 
    subtitle: 'Transformers',
    color: '#c41d7f',
    description: '电源变压器、隔离变压器、脉冲变压器等',
    familyPath: 'Transformers',
    count: 3363
  },
  { 
    icon: <DiffOutlined />, 
    title: '滤波器', 
    subtitle: 'Filters',
    color: '#389e0d',
    description: '共模扼流圈、EMI滤波器、信号滤波器等',
    familyPath: 'Filters',
    count: 2565
  },
  { 
    icon: <FileSearchOutlined />, 
    title: '电线电缆', 
    subtitle: 'Wires and Cables',
    color: '#d46b08',
    description: '导线、电缆、屏蔽线等',
    familyPath: 'Wires and Cables',
    count: 1125
  },
  { 
    icon: <RadarChartOutlined />, 
    title: '射频无源器件', 
    subtitle: 'RF Passive Components',
    color: '#9254de',
    description: '同轴衰减器、负载、耦合器等',
    familyPath: 'RF Passive Components',
    count: 243
  },
];

// 7大核心服务模块
const serviceModules = [
  {
    key: 'standards',
    title: '标准服务',
    icon: <BookOutlined />,
    description: '国际航天标准文档查询与管理',
    features: ['MIL标准', 'ESCC标准', '标准对比', '版本管理'],
    link: '/standards',
    color: '#1890ff',
    stats: { count: '15,000+', label: '标准文档' }
  },
  {
    key: 'components',
    title: '器件查询',
    icon: <SearchOutlined />,
    description: '器件信息管理与查询服务',
    features: ['智能搜索', '器件比对', '供应商检索', '在线选用'],
    link: '/components',
    color: '#52c41a',
    stats: { count: '50,000+', label: '器件型号' }
  },
  {
    key: 'procurement',
    title: '采购服务',
    icon: <ShoppingCartOutlined />,
    description: '专业的航天器件采购与供应链管理',
    features: ['货源开发', '在线采购', '库存管理', '供应链监控'],
    link: '/procurement',
    color: '#fa8c16',
    stats: { count: '2,000+', label: '合格供应商' }
  },
  {
    key: 'application',
    title: '应用支持',
    icon: <ToolOutlined />,
    description: '器件应用技术支持与设计服务',
    features: ['应用指南', '功能单元', '数字模型', '仿真分析'],
    link: '/application',
    color: '#eb2f96',
    stats: { count: '8,000+', label: '应用案例' }
  },
  {
    key: 'quality',
    title: '质量管理',
    icon: <SafetyCertificateOutlined />,
    description: '质量问题管理与追溯服务',
    features: ['问题上报', '质量归零', '预警通报', '追溯查询'],
    link: '/quality',
    color: '#722ed1',
    stats: { count: '99.9%', label: '质量可靠性' }
  },
  {
    key: 'testing',
    title: '试验检测',
    icon: <ExperimentOutlined />,
    description: '专业的航天器件试验检测服务',
    features: ['常规检测', '器件鉴定', '辐照测试', '安全评价'],
    link: '/testing',
    color: '#13c2c2',
    stats: { count: '500+', label: '检测项目' }
  },
  {
    key: 'documents',
    title: '文件培训',
    icon: <FileTextOutlined />,
    description: '技术文档管理与专业培训服务',
    features: ['技术文档', '测试数据', '培训课程', '行业资讯'],
    link: '/documents',
    color: '#fa541c',
    stats: { count: '10,000+', label: '技术文档' }
  },
];

// 最新动态数据
const latestNews = [
  {
    id: 1,
    type: 'news',
    title: '新版MIL-STD-883标准发布',
    content: '美军标MIL-STD-883K版本正式发布，新增多项测试方法...',
    date: '2024-01-15',
    icon: <FileProtectOutlined style={{ color: '#1890ff' }} />
  },
  {
    id: 2,
    type: 'quality',
    title: '质量预警：某型存储器批次问题',
    content: '发现某厂商2023年第4季度生产的SRAM器件存在质量隐患...',
    date: '2024-01-14',
    icon: <BellOutlined style={{ color: '#ff4d4f' }} />
  },
  {
    id: 3,
    type: 'achievement',
    title: '平台器件数据库突破5万种',
    content: '经过持续建设，平台器件数据库已收录超过5万种航天级器件...',
    date: '2024-01-12',
    icon: <TrophyOutlined style={{ color: '#52c41a' }} />
  },
];

const HomePage: React.FC = () => {
  const navigate = useNavigate();
  const [searchCategory, setSearchCategory] = useState('model');
  const [componentCategories, setComponentCategories] = useState(componentCategoriesBase.map(cat => ({ ...cat, count: '...' })));
  const [statsLoading, setStatsLoading] = useState(true);

  // 获取统计数据
  useEffect(() => {
    const fetchStatistics = async () => {
      try {
        setStatsLoading(true);
        const response = await fetch('/api/doeeet/statistics');
        const result = await response.json();
        
        if (result.success && result.data) {
          // 更新分类统计数据
          const updatedCategories = componentCategoriesBase.map(cat => {
            const stats = result.data.categoryStats || {};
            // 尝试匹配分类名称
            const count = stats[cat.familyPath] || stats[cat.title] || 0;
            return {
              ...cat,
              count: count > 0 ? count.toLocaleString() : '0'
            };
          });
          setComponentCategories(updatedCategories);
        }
      } catch (error) {
        console.error('获取统计数据失败:', error);
        // 使用默认值
        setComponentCategories(componentCategoriesBase.map(cat => ({ ...cat, count: '-' })));
      } finally {
        setStatsLoading(false);
      }
    };
    
    fetchStatistics();
  }, []);

  const handleSearch = (value: string) => {
    if (value.trim()) {
      navigate(`/components/search?q=${encodeURIComponent(value)}&category=${searchCategory}`);
    }
  };

  const handleCategoryClick = (category: string) => {
    // 为特定分类指定专门的路由
    if (category === '数字单片集成电路') {
      navigate('/components/digital-ic');
    } else if (category === '模拟单片集成电路') {
      navigate('/components/analog-ic');
    } else if (category === '混合集成电路') {
      navigate('/components/hybrid-ic');
    } else if (category === '半导体分立器件') {
      navigate('/components/discrete');
    } else if (category === '固态微波器件与电路') {
      navigate('/components/microwave');
    } else if (category === '真空电子器件') {
      navigate('/components/vacuum');
    } else if (category === '光电子器件') {
      navigate('/components/optoelectronic');
    } else if (category === '机电组件') {
      navigate('/components/electromechanical');
    } else if (category === '电能源') {
      navigate('/components/power');
    } else if (category === '通用与特种元件') {
      navigate('/components/general');
    } else if (category === '微系统') {
      navigate('/components/microsystems');
    } else {
      navigate(`/components/search?category=${encodeURIComponent(category)}`);
    }
  };

  const handleModuleClick = (link: string) => {
    navigate(link);
  };

  return (
    <div style={{ background: '#f5f5f5', minHeight: '100vh' }}>
      {/* Hero Section - 类似 doEEEt 的深蓝色背景 */}
      <div style={{
        background: 'linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%)',
        padding: '60px 0 80px',
        color: 'white',
        textAlign: 'center',
        position: 'relative',
        overflow: 'hidden'
      }}>
        {/* 左侧火箭背景图 */}
        <div 
          className="hero-bg-rocket"
          style={{
            backgroundImage: 'url(/images/flight_2.jpg)'
          }}
        />
        
        {/* 右侧芯片背景图 */}
        <div 
          className="hero-bg-chip"
          style={{
            backgroundImage: 'url(/images/chip.jpg)'
          }}
        />
        <div style={{ 
          maxWidth: 1200, 
          margin: '0 auto', 
          padding: '0 24px',
          position: 'relative',
          zIndex: 2
        }}>
          <Title level={1} style={{ 
            color: 'white', 
            fontSize: '42px', 
            marginBottom: 16,
            fontWeight: 'normal'
          }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
          <Paragraph style={{ 
            color: 'rgba(255,255,255,0.9)', 
            fontSize: '18px', 
            marginBottom: 50,
            maxWidth: 800,
            margin: '0 auto 50px'
          }}>
            查找来自数百家制造商的电气电子机电(EEE)器件和数据表，为商业航天提供专业的元器件解决方案
          </Paragraph>
          
          {/* 主搜索框 - 参考知网的设计 */}
          <div style={{ maxWidth: 1000, margin: '0 auto' }}>
            {/* 搜索类别选择 */}
            <div style={{ 
              marginBottom: 16,
              display: 'flex',
              justifyContent: 'center'
            }}>
              <div style={{
                background: 'rgba(255,255,255,0.1)',
                borderRadius: '8px',
                padding: '4px',
                backdropFilter: 'blur(10px)'
              }}>
                <Space.Compact>
                  <Button
                    type={searchCategory === 'model' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('model')}
                    style={{
                      background: searchCategory === 'model' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'model' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'model' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    型号规格
                  </Button>
                  <Button
                    type={searchCategory === 'supplier' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('supplier')}
                    style={{
                      background: searchCategory === 'supplier' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'supplier' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'supplier' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    供应商
                  </Button>
                  <Button
                    type={searchCategory === 'standard' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('standard')}
                    style={{
                      background: searchCategory === 'standard' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'standard' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'standard' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    标准编号
                  </Button>
                </Space.Compact>
              </div>
            </div>

            {/* 搜索框 */}
            <Search
              placeholder={
                searchCategory === 'model' ? "搜索元器件的型号规格..." :
                searchCategory === 'supplier' ? "搜索供应商名称..." :
                "搜索标准编号..."
              }
              size="large"
              enterButton={
                <Button 
                  type="primary" 
                  size="large"
                  icon={<SearchOutlined />}
                  style={{ 
                    background: '#3b82f6',
                    borderColor: '#3b82f6',
                    height: '50px',
                    paddingLeft: 24,
                    paddingRight: 24
                  }}
                >
                  搜索
                </Button>
              }
              onSearch={handleSearch}
              styles={{
                input: {
                  fontSize: '16px',
                  height: '50px',
                  paddingLeft: '16px'
                }
              }}
            />
            <div style={{ marginTop: 20, textAlign: 'left' }}>
              <Text style={{ color: 'rgba(255,255,255,0.7)', fontSize: '14px' }}>
                热门搜索：
              </Text>
              <Space wrap style={{ marginLeft: 8 }}>
                {searchCategory === 'model' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('LM358')}
                    >
                      LM358
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('STM32F103')}
                    >
                      STM32F103
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('AD8232')}
                    >
                      AD8232
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('TPS62180')}
                    >
                      TPS62180
                    </Tag>
                  </>
                )}
                {searchCategory === 'supplier' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('深圳国微')}
                    >
                      深圳国微
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('复旦微')}
                    >
                      复旦微
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('兆易创新')}
                    >
                      兆易创新
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('英飞凌')}
                    >
                      英飞凌
                    </Tag>
                  </>
                )}
                {searchCategory === 'standard' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('GJB 548')}
                    >
                      GJB 548
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('MIL-STD-883')}
                    >
                      MIL-STD-883
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('Q/QJA 20084')}
                    >
                      Q/QJA 20084
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('Q/QJA 20085')}
                    >
                      Q/QJA 20085
                    </Tag>
                  </>
                )}
              </Space>
            </div>
          </div>
        </div>
      </div>

      <div style={{ maxWidth: 1200, margin: '0 auto', padding: '0 24px' }}>
        {/* 器件分类浏览 - 参考 doEEEt 的 Browse by category */}
        <section style={{ padding: '60px 0 40px' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            按类别浏览
          </Title>
          <Row gutter={[20, 20]} justify="center">
            {componentCategories.map((category, index) => (
              <Col xs={12} sm={8} md={6} lg={4} key={index}>
                <Card
                  hoverable
                  style={{
                    height: '140px',
                    borderRadius: 8,
                    border: '1px solid #e2e8f0',
                    transition: 'all 0.3s',
                    cursor: 'pointer'
                  }}
                  styles={{ 
                    body: {
                      padding: '20px 16px',
                      height: '100%',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center'
                    }
                  }}
                  onClick={() => handleCategoryClick(category.title)}
                >
                  <div 
                    style={{ 
                      fontSize: '24px', 
                      marginBottom: 12,
                      color: category.color,
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }}
                  >
                    {category.icon}
                  </div>
                  <Title 
                    level={5} 
                    style={{ 
                      marginBottom: 4, 
                      color: category.color,
                      textAlign: 'center',
                      fontSize: '14px',
                      fontWeight: '600'
                    }}
                  >
                    {category.title}
                  </Title>
                  <Text 
                    style={{ 
                      color: '#64748b',
                      fontSize: '12px',
                      textAlign: 'center'
                    }}
                  >
                    {category.subtitle}
                  </Text>
                </Card>
              </Col>
            ))}
          </Row>
        </section>

        {/* 服务和工具 - 类似 doEEEt 的 Services and tools */}
        <section style={{ padding: '40px 0' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            服务和工具
          </Title>
          <Row gutter={[24, 24]}>
            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/standards/search')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <FileSearchOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#3b82f6',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    标准查询
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    查询国际和行业标准，获取最新的技术规范和认证要求。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#3b82f6',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/components/compare')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <DiffOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#10b981',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    器件比对
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    在同一显示屏中比较多个器件，通过参数筛选找到最佳选择。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#10b981',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/procurement/online')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <ShoppingCartOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#f59e0b',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    在线采购
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    快速便捷的器件采购平台，添加器件到购物车并获取报价。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#f59e0b',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/application/models')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <BarChartOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#8b5cf6',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    数字模型
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    访问器件的数字化模型和仿真数据，支持设计验证和分析。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#8b5cf6',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>
          </Row>
        </section>

        {/* 内容和资源 - 类似 doEEEt 的 Content and resources */}
        <section style={{ padding: '40px 0 60px' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            内容和资源
          </Title>
          <Row gutter={[24, 24]}>
            <Col xs={24} md={12}>
              <Card
                hoverable
                style={{
                  height: '160px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/documents/technical')}
              >
                <div style={{ display: 'flex', alignItems: 'center', height: '100%' }}>
                  <BookOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#3b82f6',
                      marginRight: 20 
                    }} 
                  />
                  <div style={{ flex: 1 }}>
                    <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                      技术博客：掌握高可靠器件最新动态
                    </Title>

                    <Button 
                      type="link" 
                      style={{ 
                        padding: 0,
                        marginTop: 8,
                        color: '#3b82f6',
                        fontWeight: '500'
                      }}
                    >
                      访问技术博客 <RightOutlined />
                    </Button>
                  </div>
                </div>
              </Card>
            </Col>

            <Col xs={24} md={12}>
              <Card
                hoverable
                style={{
                  height: '160px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/documents/training')}
              >
                <div style={{ display: 'flex', alignItems: 'center', height: '100%' }}>
                  <TrophyOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#10b981',
                      marginRight: 20 
                    }} 
                  />
                  <div style={{ flex: 1 }}>
                    <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                      活动/网络研讨会：不错过任何活动
                    </Title>

                    <Button 
                      type="link" 
                      style={{ 
                        padding: 0,
                        marginTop: 8,
                        color: '#10b981',
                        fontWeight: '500'
                      }}
                      onClick={(e) => {
                        e.stopPropagation();
                        handleModuleClick('/documents/training');
                      }}
                    >
                      查看日程表 <RightOutlined />
                    </Button>
                  </div>
                </div>
              </Card>
            </Col>
          </Row>
        </section>
      </div>
    </div>
  );
};

export default HomePage;

```

```typescriptreact
import React, { useState } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { Form, Input, Button, Card, message, Typography } from 'antd';
import { UserOutlined, LockOutlined } from '@ant-design/icons';
import { useAuth } from '@/hooks/useAuth';
import type { LoginRequest } from '@/types';

const { Title } = Typography;

const Login: React.FC = () => {
  const [loading, setLoading] = useState(false);
  const { login } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  const from = location.state?.from?.pathname || '/dashboard';

  const onFinish = async (values: LoginRequest) => {
    setLoading(true);
    try {
      const success = await login(values.username, values.password);
      if (success) {
        message.success('登录成功');
        navigate(from, { replace: true });
      } else {
        message.error('登录失败，请检查用户名和密码');
      }
    } catch (error: any) {
      message.error(error.message || '登录失败，请检查用户名和密码');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{
      display: 'flex',
      justifyContent: 'center',
      alignItems: 'center',
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    }}>
      <Card
        style={{
          width: 400,
          boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',
        }}
      >
        <div style={{ textAlign: 'center', marginBottom: 24 }}>
          <Title level={2} style={{ marginBottom: 8 }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
          <Typography.Text type="secondary">
            请输入您的账号和密码
          </Typography.Text>
        </div>

        <Form
          name="login"
          onFinish={onFinish}
          autoComplete="off"
          size="large"
        >
          <Form.Item
            name="username"
            rules={[
              { required: true, message: '请输入用户名!' },
            ]}
          >
            <Input
              prefix={<UserOutlined />}
              placeholder="用户名"
            />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[
              { required: true, message: '请输入密码!' },
            ]}
          >
            <Input.Password
              prefix={<LockOutlined />}
              placeholder="密码"
            />
          </Form.Item>

          <Form.Item>
            <Button
              type="primary"
              htmlType="submit"
              loading={loading}
              block
            >
              登录
            </Button>
          </Form.Item>
        </Form>

        <div style={{ textAlign: 'center', marginTop: 16 }}>
          <Typography.Text type="secondary" style={{ fontSize: '12px' }}>
            演示账号：admin / password
          </Typography.Text>
        </div>
      </Card>
    </div>
  );
};

export default Login;

```

```html
<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>商业航天元器件及其应用支持一站式服务平台</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>

```

- 页面与登录框主标题都更新为“商业航天元器件及其应用支持一站式服务平台”，保持文案一致。  
```411:418:frontend/src/pages/HomePage.tsx
          <Title level={1} style={{
            ...
          }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
```
```49:55:frontend/src/pages/Login.tsx
        <div style={{ textAlign: 'center', marginBottom: 24 }}>
          <Title level={2} style={{ marginBottom: 8 }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
          <Typography.Text type="secondary">
            请输入您的账号和密码
```

- 浏览器标签标题同步更新，方便分享/收藏。  
```7:7:frontend/index.html
    <title>商业航天元器件及其应用支持一站式服务平台</title>
```

未运行额外测试；刷新前端即可看到新标题。

```typescriptreact
          <Title level={1} style={{
            ...
          }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
```

```typescriptreact
        <div style={{ textAlign: 'center', marginBottom: 24 }}>
          <Title level={2} style={{ marginBottom: 8 }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
          <Typography.Text type="secondary">
            请输入您的账号和密码
```

```html
    <title>商业航天元器件及其应用支持一站式服务平台</title>
```

---

**User**

帮我把当前版本git保存下吧，告诉我步骤我自己操作

---

**Cursor**

可以，按下面步骤自己来操作即可（假设已经在仓库根目录 `F:\Business_plat`）：

1. 打开 PowerShell（或 Terminal）并切到仓库根目录：  
   `cd F:\Business_plat`

2. 查看当前状态确认改动：  
   `git status`

3. 将改动加入暂存区：  
   `git add <具体文件路径>`  
   例如：  
   `git add frontend/index.html frontend/src/pages/HomePage.tsx frontend/src/pages/Login.tsx`

4. 保存本次提交：  
   `git commit -m "你的提交说明"`

5. 如需推送到远端：  
   `git push`（如果有多远端或多分支，按需补上 `<remote> <branch>`）

照着执行即可把当前版本保存进 git；如果过程中遇到冲突或提示信息不清楚，随时告诉我。

---

**User**

帮我把重要改动提交下吧

(space_env) F:\Business_plat>git status
On branch full_dev_data_store
Changes not staged for commit:
  (use "git add/rm <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   backend/data/persistent-data.json
        modified:   backend/dist/.tsbuildinfo
        modified:   backend/dist/controllers/doeeetComponentController.js
        modified:   backend/dist/controllers/doeeetComponentController.js.map
        modified:   backend/dist/index.js
        modified:   backend/dist/index.js.map
        modified:   backend/dist/models/index.js
        modified:   backend/dist/models/index.js.map
        modified:   backend/dist/services/AnalyticsService.js
        modified:   backend/dist/services/AnalyticsService.js.map
        modified:   backend/dist/services/DoeeetSearchService.js
        modified:   backend/dist/services/DoeeetSearchService.js.map
        modified:   backend/logs/combined.log
        modified:   backend/src/services/DoeeetSearchService.ts
        modified:   data/dist_example(2)/dist_example/meta.json
        deleted:    data/doeeet/README_DOEEET_IMPORT.md
        deleted:    data/doeeet/analyze_csv.py
        deleted:    data/doeeet/config.py
        deleted:    data/doeeet/doeeet/general.csv
        deleted:    data/doeeet/doeeet/meta.json
        deleted:    data/doeeet/doeeet/parameter.csv
        deleted:    data/doeeet/doeeet/parameter_final.csv
        deleted:    "data/doeeet/doeeet/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        deleted:    data/doeeet/import_doeeet_data.py
        deleted:    data/doeeet/quick_start.py
        deleted:    data/doeeet/test_import.py
        modified:   frontend/index.html
        modified:   frontend/src/pages/HomePage.tsx
        modified:   frontend/src/pages/Login.tsx
        modified:   frontend/src/pages/components/ComponentSearch.tsx

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        "DoEEEt\351\241\271\347\233\256\345\274\200\345\217\221\350\256\241\345\210\222.md"
        "cursor\350\256\260\345\275\225/1109.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_10292_md.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_1029_md.md"
        "data/dist_example(2)/dist_example/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
        docker-compose-simple.yml
        docker-compose.yml
        frontend/src/vite-env.d.ts
        package-lock.json
        records/
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211-\345\277\253\351\200\237\345\274\200\345\247\213.md"
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211\345\212\237\350\203\275\345\256\236\346\226\275\346\226\271\346\241\210.md"
        "\345\211\215\347\253\257\345\256\236\346\226\275\346\226\271\346\241\210\346\200\273\347\273\223.md"

no changes added to commit (use "git add" and/or "git commit -a")

(space_env) F:\Business_plat>


(space_env) F:\Business_plat>git diff frontend/src/pages/components/ComponentSearch.tsx
diff --git a/frontend/src/pages/components/ComponentSearch.tsx b/frontend/src/pages/components/ComponentSearch.tsx
index 05b76c82..577b1aab 100644
--- a/frontend/src/pages/components/ComponentSearch.tsx
+++ b/frontend/src/pages/components/ComponentSearch.tsx
@@ -30,11 +30,12 @@ import type { Component } from '@/types';
 import ParameterRangeFilter from '@/components/ParameterRangeFilter';
 import ComponentCompareModal from '@/components/ComponentCompareModal';
 import CategoryFilter from '@/components/CategoryFilter';
-import {
+import {
   exportParametersToCSV,
   downloadCSV,
   generateDynamicParameterColumns,
 } from '@/utils/parameterUtils';
+import type { ParameterDefinition } from '@/utils/parameterUtils';
 import type { ColumnsType } from 'antd/es/table';
 import httpClient from '@/utils/httpClient';

@@ -180,6 +181,39 @@ const getMainCategory = (component: any): string => {
 };
 */

+interface RadiationSensitivityItem {
+  key: string;
+  parameterKey?: string;
+  name: string;
+  shortName?: string;
+  value: string;
:

我在CMD运行

---

**Cursor**

## 解决思路（待确认）

1. **快速审阅改动范围**  
   - 通过查看 `frontend/src/pages/components/ComponentSearch.tsx`、`frontend/src/pages/HomePage.tsx`、`frontend/src/pages/Login.tsx`、`backend/src/services/DoeeetSearchService.ts` 等关键源码文件，确认功能性改动与文案/UI 调整。  
   - 同时检查是否存在仅由构建或日志产生的文件（`backend/dist/*`、`backend/logs/combined.log` 等）。

2. **划分提交策略（多方案供选）**  
   - **方案 A：仅提交源码与必要配置**  
     - 内容：所有 `src` 目录内的前后端 TS/TSX 变更和 `frontend/index.html`、`data/dist_example(2)/...` 等真实业务数据调整。  
     - 优点：提交干净，不包含自动生成文件；后续回溯方便。  
     - 缺点：部署前需重新构建 dist。  
   - **方案 B：源码 + dist 产物**  
     - 内容：在方案 A 基础上，把 `backend/dist/*` 也一起提交，确保运行环境无需重新编译。  
     - 优点：拿到代码即可直接启动。  
     - 缺点：dist 体积大、易冲突。  
   - **方案 C：再额外包含日志与临时文件**（通常不推荐）  
     - 只有在确有调试需要时才提交 `backend/logs/combined.log` 或 `records/` 等。

3. **确认需要提交的新增/删除文件**  
   - `data/doeeet/*` 中大量文件被删除，需判断是否为预期（例如数据迁移）。  
   - 新增 `docker-compose*.yml`、`package-lock.json`、`frontend/src/vite-env.d.ts` 等，决定是否纳入同一次提交还是拆分成多个 topic commit。

4. **实际操作（待用户执行）**  
   - 选定方案后，分批 `git add`（例如先 `git add frontend/src/pages/components/ComponentSearch.tsx frontend/src/pages/HomePage.tsx ...`）。  
   - 如选方案 B，再 `git add backend/dist`.  
   - 使用 `git status` 复核，随后 `git commit -m "feat: 描述"`。

请确认：  
- 采用哪一种提交方案（或是否需要我基于文件变化再细化建议）？  
- 删除的数据文件是否属于本次提交范围？

---

**User**

按照方案A

你看下

(space_env) F:\Business_plat>git status -sb
## full_dev_data_store
 M backend/data/persistent-data.json
 M backend/dist/.tsbuildinfo
 M backend/dist/controllers/doeeetComponentController.js
 M backend/dist/controllers/doeeetComponentController.js.map
 M backend/dist/index.js
 M backend/dist/index.js.map
 M backend/dist/models/index.js
 M backend/dist/models/index.js.map
 M backend/dist/services/AnalyticsService.js
 M backend/dist/services/AnalyticsService.js.map
 M backend/dist/services/DoeeetSearchService.js
 M backend/dist/services/DoeeetSearchService.js.map
 M backend/logs/combined.log
 M backend/src/services/DoeeetSearchService.ts
 M data/dist_example(2)/dist_example/meta.json
 D data/doeeet/README_DOEEET_IMPORT.md
 D data/doeeet/analyze_csv.py
 D data/doeeet/config.py
 D data/doeeet/doeeet/general.csv
 D data/doeeet/doeeet/meta.json
 D data/doeeet/doeeet/parameter.csv
 D data/doeeet/doeeet/parameter_final.csv
 D "data/doeeet/doeeet/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
 D data/doeeet/import_doeeet_data.py
 D data/doeeet/quick_start.py
 D data/doeeet/test_import.py
 M frontend/index.html
 M frontend/src/pages/HomePage.tsx
 M frontend/src/pages/Login.tsx
 M frontend/src/pages/components/ComponentSearch.tsx
?? "DoEEEt\351\241\271\347\233\256\345\274\200\345\217\221\350\256\241\345\210\222.md"
?? "cursor\350\256\260\345\275\225/1109.md"
?? "cursor\350\256\260\345\275\225/cursor_cursor_10292_md.md"
?? "cursor\350\256\260\345\275\225/cursor_cursor_1029_md.md"
?? "data/dist_example(2)/dist_example/\346\225\260\346\215\256\350\257\264\346\230\216(2).md"
?? docker-compose-simple.yml
?? docker-compose.yml
?? frontend/src/vite-env.d.ts
?? package-lock.json
?? records/
?? "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211-\345\277\253\351\200\237\345\274\200\345\247\213.md"
?? "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211\345\212\237\350\203\275\345\256\236\346\226\275\346\226\271\346\241\210.md"
?? "\345\211\215\347\253\257\345\256\236\346\226\275\346\226\271\346\241\210\346\200\273\347\273\223.md"

(space_env) F:\Business_plat>



如何提交(space_env) F:\Business_plat>git diff backend/src/services/DoeeetSearchService.ts
diff --git a/backend/src/services/DoeeetSearchService.ts b/backend/src/services/DoeeetSearchService.ts
index 0f96ed51..833a51b4 100644
--- a/backend/src/services/DoeeetSearchService.ts
+++ b/backend/src/services/DoeeetSearchService.ts
@@ -57,6 +57,24 @@ export interface DoeeetSearchResult {
  * DoEEEt搜索服务类
  * 提供完整的搜索引擎功能，支持Redis缓存
  */
+const RADIATION_SENSITIVITY_CATEGORY = 'Radiation: Potential Sensitivity';
+const RADIATION_SENSITIVITY_ORDER = [
+  'SEE Comments',
+  'SEE sens.',
+  'TID (HDR) sens.',
+  'TID (LDR) sens.',
+  'TNID Comments',
+  'TNID sens.'
+];
+
+type RadiationSensitivityEntry = {
+  key: string;
+  name: string;
+  shortName?: string;
+  category?: string;
+  value: string;
+};
+
 export class DoeeetSearchService {
   private cacheService: CacheService;

(space_env) F:\Business_plat>


---

**Cursor**

## 提交步骤（方案 A）

- **确认要包含的改动**  
  - 源码：`backend/src/services/DoeeetSearchService.ts`、`frontend/index.html`、`frontend/src/pages/HomePage.tsx`、`frontend/src/pages/Login.tsx`、`frontend/src/pages/components/ComponentSearch.tsx`、`frontend/src/vite-env.d.ts`。  
  - 配置/依赖：`docker-compose.yml`、`docker-compose-simple.yml`、`package-lock.json`。  
  - 数据：`data/dist_example(2)/dist_example/*` 里的更新及 `data/doeeet/*` 中的删除（若属于本次任务）。  
  - 其他需要保留的笔记或文档（如那几份中文 .md），确认后再一起 `git add`。

- **排除不提交的文件**  
  - 构建产物和缓存：`backend/dist/**/*`、`backend/dist/.tsbuildinfo`。  
  - 日志：`backend/logs/combined.log`。  
  - 任何临时目录（如 `records/`，若仅为运行记录且不需提交）。

- **实际命令示例**  
  ```powershell
  cd F:\Business_plat
  git add backend/src/services/DoeeetSearchService.ts `
          frontend/index.html `
          frontend/src/pages/HomePage.tsx `
          frontend/src/pages/Login.tsx `
          frontend/src/pages/components/ComponentSearch.tsx `
          frontend/src/vite-env.d.ts `
          docker-compose.yml `
          docker-compose-simple.yml `
          package-lock.json `
          data/dist_example(2)/dist_example `
          data/doeeet
  ```
  - 若需包含那些中文命名的文档或 `records/`，在命令末尾再追加相应路径。
  - 如果想先确认数据目录内容，可用 `git status data` 查看。

- **核对并提交**  
  ```powershell
  git status -sb
  ```
  - 确认只有期望的文件被 staged。  
  - 然后提交：
  ```powershell
  git commit -m "feat: update doeeet search ui and data"
  ```

- **可选**：若仍有未跟踪文件且暂不提交，可用 `git stash --include-untracked` 或 `.gitignore` 管理，但记得别把 dist/log 加进提交即可。

需要我帮你逐个文件再确认一遍内容或命令吗？

```powershell
  cd F:\Business_plat
  git add backend/src/services/DoeeetSearchService.ts `
          frontend/index.html `
          frontend/src/pages/HomePage.tsx `
          frontend/src/pages/Login.tsx `
          frontend/src/pages/components/ComponentSearch.tsx `
          frontend/src/vite-env.d.ts `
          docker-compose.yml `
          docker-compose-simple.yml `
          package-lock.json `
          data/dist_example(2)/dist_example `
          data/doeeet
```

```powershell
  git status -sb
```

```powershell
  git commit -m "feat: update doeeet search ui and data"
```

---

**User**

我想在器件查询模块下新建一个辐照数据模块，表头如图所示，你先说下你的思路，要读取的数据在这里F:\Business_plat\通用器件辐照数据.xlsx

---

**Cursor**

## 辐照数据模块思路

- **现状复核** `ComponentSearch.tsx`/`HomePage.tsx`：确认“器件查询”导航如何组织 tab、下拉、路由，梳理现有子模块（智能搜索、器件比对、供应商检索、在线选用）的接入方式（路由 or 组件展示），确定新增模块的挂载点以及复用的 UI 组件/状态管理。
- **数据接入**：使用后台或前端读取 `F:\Business_plat\通用器件辐照数据.xlsx`。优先在后端加解析逻辑（例如新增 service/controller 接收上传或预置数据）。若 Excel 不频繁变化，可使用脚本将其转为 JSON 并放入 `data/`，由 `DoeeetSearchService` 暴露 API；若需实时读取，则在后端使用 `xlsx`/`exceljs` 解析并缓存。
- **API 设计**：新增 `/api/radiation-data`（分页、筛选参数），返回字段与表头一致（序号、产品类别、细类、名称、型号规格、封装形式、总剂量、单粒子、位移、抗静电能量、质量等级、通用/详细规范编号、供应商名称、备注）。考虑排序、模糊查询（型号/供应商）及指标过滤（例如按总剂量范围）。
- **前端模块**：在 “器件查询” 下新增标签项“辐照数据”。创建独立页面/组件（例如 `RadiationDataTable.tsx`），包含：表格渲染（参照截图样式）、搜索筛选（按型号/供应商/等级等）、分页。若使用 `antd`，利用 `Table` + `Form`；如果为自研 UI，则遵循现有组件风格。
- **状态与交互**：使用现有查询模块的状态管理方案（Redux/Context/局部 state），统一 loading、错误提示、空状态。若需要导出 Excel/CSV，可沿用已有导出工具。
- **权限与导航**：更新 `HomePage` 或导航配置，确保菜单和路由同步；若需要登录权限控制，复用 `Login`/`Auth` 逻辑。
- **数据更新流程**：定义 Excel → 系统的更新机制（手动脚本、后台上传、CI 导入），并记录文档，避免手工拷贝错误。

需要我先把 Excel 转 JSON 的脚本或 API 草案写出来吗？

---

**User**

帮我写出来吧

(space_env) F:\Business_plat>cd F:\Business_plat && dir
 驱动器 F 中的卷是 新加卷
 卷的序列号是 5A9E-DD43

 F:\Business_plat 的目录

2025/11/19  19:10    <DIR>          .
2025/08/17  16:39    <DIR>          .cursor
2025/10/28  16:28               242 .gitignore
2025/11/12  23:33    <DIR>          backend
2025/10/30  23:19    <DIR>          backups
2025/11/09  11:13    <DIR>          cursor记录
2025/10/30  18:58    <DIR>          data
2025/09/22  19:26    <DIR>          database
2025/10/27  19:47            20,095 DEVELOPMENT_PLAN.md
2025/08/20  13:31            24,884 DEVELOPMENT_RULES.md
2025/10/27  15:49               302 docker-compose-simple.yml
2025/10/27  16:09             1,421 docker-compose.yml
2025/08/17  17:01    <DIR>          docs
2025/10/31  16:45             9,518 DoEEEt-README.md
2025/09/22  17:05     1,009,671,292 doeeet.tar.gz
2025/10/01  15:27             6,708 DOEEET_DATA_IMPORT_GUIDE.md
2025/11/19  16:17            24,837 DoEEEt功能开发总览.md
2025/11/19  16:17            52,344 DoEEEt集成实施总结.md
2025/11/10  16:32            30,788 DoEEEt项目开发计划.md
2025/11/19  17:54    <DIR>          frontend
2025/08/18  21:39             5,845 FRONTEND_REFACTOR_SUMMARY.md
2025/10/20  14:27             8,618 GIT_BRANCH_STRATEGY.md
2025/08/20  14:42            18,120 MODULE_DEVELOPMENT_STRATEGY.md
2025/11/11  15:09    <DIR>          node_modules
2025/11/11  15:09             9,802 package-lock.json
2025/08/17  17:01             1,113 package.json
2025/08/17  21:24             7,067 README.md
2025/10/31  17:34    <DIR>          records
2025/10/23  00:15               860 run_doeet_fix.bat
2025/08/20  15:51             3,967 分类.md
2025/10/31  16:36             4,991 前端分类筛选-快速开始.md
2025/10/31  16:32            15,454 前端分类筛选功能实施方案.md
2025/10/30  14:55             9,231 前端实施方案总结.md
2025/08/19  14:19    <DIR>          数字模型库
2025/10/20  14:27               383 数字模型批量上传模板.csv
2025/08/19  15:42             9,257 模型表头.xlsx
2025/11/19  15:58           159,574 通用器件辐照数据.xlsx
              25 个文件  1,010,096,713 字节
              12 个目录 95,491,895,296 可用字节

(space_env) F:\Business_plat>

我在CMD中

(space_env) F:\Business_plat>cd F:\Business_plat && ls backend
'ls' 不是内部或外部命令，也不是可运行的程序
或批处理文件。

(space_env) F:\Business_plat>


你看下

(space_env) F:\Business_plat>cd F:\Business_plat && dir backend
 驱动器 F 中的卷是 新加卷
 卷的序列号是 5A9E-DD43

 F:\Business_plat\backend 的目录

2025/11/12  23:33    <DIR>          .
2025/11/19  19:10    <DIR>          ..
2025/11/12  23:33               347 .env
2025/08/18  23:00             7,506 API_MODULES_SUMMARY.md
2025/10/30  15:56             8,944 API_QUICK_REFERENCE.md
2025/08/20  15:07            11,770 API_USAGE_EXAMPLES.md
2025/10/30  11:25            10,180 CACHE_USAGE.md
2025/10/29  16:42             3,309 check-data-structure.js
2025/10/31  17:55             1,792 check_collection.js
2025/10/31  17:57             1,761 check_family_path_format.js
2025/11/09  12:50             3,320 COMPASS_VIEW_DATA_GUIDE.md
2025/11/12  23:33    <DIR>          config
2025/08/20  16:56    <DIR>          controllers
2025/11/19  19:35    <DIR>          data
2025/09/22  17:21    <DIR>          database
2025/09/22  17:31             4,685 database-server.js
2025/11/11  14:02             2,400 DATABASE_LOCATION.md
2025/09/22  17:33             6,213 DATABASE_SETUP.md
2025/11/12  23:33    <DIR>          dist
2025/10/30  16:02             5,505 DOCKER_REDIS_SETUP.md
2025/10/30  15:56            21,911 DoEEEt_API.postman_collection.json
2025/10/30  15:56            16,396 DOEEET_API_TESTING.md
2025/10/29  17:10             7,885 DOEEET_DATA_STRUCTURE.md
2025/10/29  11:14             9,365 DOEEET_QUICK_START.md
2025/10/29  11:13            10,788 DOEEET_SEARCH_API.md
2025/10/30  14:04               764 env.example
2025/10/29  11:19            12,762 GAP_ANALYSIS.md
2025/10/29  11:16             7,368 IMPLEMENTATION_CHECKLIST.md
2025/10/30  17:32             2,984 INSTALL_MONGODB_TOOLS.md
2025/10/30  14:18             9,290 INSTALL_REDIS_WINDOWS.md
2025/11/12  23:33    <DIR>          logs
2025/10/30  17:32             4,428 MIGRATION_GUIDE.md
2025/10/29  17:01    <DIR>          models
2025/11/09  12:18             1,077 mongod.conf
2025/10/27  19:19               457 mongod_fast.conf
2025/10/27  19:06             1,012 mongod_minimal.conf
2025/10/27  19:07               840 mongod_ultralight.conf
2025/11/11  15:09    <DIR>          node_modules
2025/11/11  15:09           300,702 package-lock.json
2025/10/31  16:01             2,235 package.json
2025/11/09  11:57                 9 query
2025/10/29  16:42             6,662 quick-test-doeet.js
2025/08/18  23:01             6,836 QUICK_START.md
2025/10/30  15:56             9,139 QUICK_START_TESTING.md
2025/11/09  12:01             2,677 README_MONGODB_LOCAL.md
2025/10/30  11:16            14,603 REDIS_CACHE_DESIGN.md
2025/10/30  11:29             8,839 REDIS_CHECKLIST.md
2025/10/30  14:09             9,995 REDIS_ENV_SETUP.md
2025/10/29  11:20            17,983 REDIS_IMPLEMENTATION_GUIDE.md
2025/10/30  11:26            13,490 REDIS_IMPLEMENTATION_SUMMARY.md
2025/10/30  13:57             5,344 REDIS_QUICKSTART.md
2025/10/30  11:28             8,154 REDIS_README.md
2025/10/30  11:23             8,605 REDIS_SETUP.md
2025/10/30  14:34             3,087 REDIS_WINDOWS_SETUP.md
2025/09/22  17:45               103 requirements.txt
2025/09/22  17:30    <DIR>          routes
2025/11/09  23:45    <DIR>          scripts
2025/10/29  11:15            12,578 SEARCH_ENGINE_SUMMARY.md
2025/09/22  17:55               296 set-env.bat
2025/09/22  17:55               500 set-env.ps1
2025/10/20  14:27    <DIR>          src
2025/11/11  14:11             2,812 start-mongodb-local.bat
2025/11/09  12:01             4,077 start-mongodb-local.ps1
2025/10/30  14:34               592 start-redis.bat
2025/10/27  19:25             1,045 test-connection.js
2025/10/29  17:10            15,886 test-doeeet-api.js
2025/10/29  11:13             4,689 test-doeeet-search.js
2025/08/19  22:26             4,956 test-persistence.js
2025/08/17  17:02    <DIR>          tests
2025/10/31  18:06             4,612 test_api_requests.js
2025/10/31  18:05             3,090 test_category_api.js
2025/10/30  15:56             8,669 test_doeeet_api.ps1
2025/10/30  15:56             7,776 test_doeeet_api.sh
2025/10/31  18:13             2,960 test_query_issue.js
2025/09/22  16:31             1,156 tsconfig.json
2025/08/19  14:48    <DIR>          uploads
              61 个文件        669,216 字节
              15 个目录 95,491,428,352 可用字节

(space_env) F:\Business_plat>

帮我写成脚本运行

---

**Cursor**

你是想把刚才的 Excel 表头查看命令写成一个可运行的脚本吗？如果是的话，需要确认以下信息：

- Excel 文件的准确路径（例如 `F:\Business_plat\通用器件辐照数据.xlsx` 是否正确）。
- 你希望脚本输出哪些内容？只打印第一行表头，还是还要做其他处理？

告诉我这些细节，我就能帮你把脚本写好并运行。

---

**User**

好的，帮我把脚本写好并运行

---

**Cursor**

```python
#!/usr/bin/env python
"""
Utility script to inspect the header row of the irradiation Excel workbook.
"""

from __future__ import annotations

import argparse
import sys
from pathlib import Path

from openpyxl import load_workbook


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        description="Print the header row (and optional sample rows) "
        "from 通用器件辐照数据.xlsx"
    )
    parser.add_argument(
        "--workbook",
        type=Path,
        default=Path(__file__).resolve().parents[2] / "通用器件辐照数据.xlsx",
        help="Path to the Excel workbook (default: repo root/通用器件辐照数据.xlsx)",
    )
    parser.add_argument(
        "--sheet",
        type=str,
        default=None,
        help="Name of the worksheet to inspect (default: workbook active sheet)",
    )
    parser.add_argument(
        "--sample-rows",
        type=int,
        default=5,
        help="Number of data rows (after the header) to preview",
    )
    return parser


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    workbook_path: Path = args.workbook
    if not workbook_path.exists():
        parser.error(f"Workbook not found: {workbook_path}")

    wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)

    ws = wb[args.sheet] if args.sheet else wb.active
    print(f"Workbook: {workbook_path}")
    print(f"Sheet: {ws.title}")

    rows = ws.iter_rows(min_row=1, max_row=1, values_only=True)
    header_row = next(rows, None)
    if not header_row:
        print("Header row is empty")
        return 0

    headers = [value if value is not None else "" for value in header_row]
    print("\nHeader columns:")
    for idx, name in enumerate(headers, start=1):
        print(f"{idx:>3}: {name}")

    if args.sample_rows > 0:
        print(f"\nFirst {args.sample_rows} data rows:")
        data_rows = ws.iter_rows(
            min_row=2,
            max_row=1 + args.sample_rows,
            values_only=True,
        )
        for i, row in enumerate(data_rows, start=1):
            print(f"Row {i}: {row}")

    return 0


if __name__ == "__main__":
    sys.exit(main())

```

---

**User**


(space_env) F:\Business_plat>python backend\scripts\inspect_irradiation_excel.py
Workbook: F:\Business_plat\通用器件辐照数据.xlsx
Sheet: Sheet1

Header columns:
  1: 序号
  2: 产品类别
  3: 产品细类
  4: 产品名称
  5: 型号规格
  6: 封装形式
  7: 总剂量
  8: 单粒子
  9: 位移
 10: 抗静电能力
 11: 质量等级
 12: 通用规范编号
 13: 详细规范编号
 14: 供应商名称
 15: 备注

First 5 data rows:
Row 1: (1, '简单逻辑数字电路', 'CMOS电路', '六路反相器', '54AC04RH', 'DIP14', '1×103Gy（Si）', '75MeV·cm2/mg', '不敏感', '2000V', 'YC', 'Q/QJA 20084-2012', 'Q/QJA 20084/17-2012', '北京微电子技术研究所', None)
Row 2: (2, '简单逻辑数字电路', 'CMOS电路', '六路反相器', '54AC04RH', 'FP14', '1×103Gy（Si）', '75MeV·cm2/mg', '不敏感', '2000V', 'YC', 'Q/QJA 20084-2012', 'Q/QJA 20084/17-2012', '北京微电子技术研究所', None)
Row 3: (3, '简单逻辑数字电路', 'CMOS电路', '四路2输入异或门', '54AC86RH', 'DIP14', '1×103Gy（Si）', '75MeV·cm2/mg', '不敏感', '2000V', 'YC', 'Q/QJA 20084-2012', 'Q/QJA 20084/18-2012', '北京微电子技术研究所', None)
Row 4: (4, '简单逻辑数字电路', 'CMOS电路', '四路2输入异或门', '54AC86RH', 'FP14', '1×103Gy（Si）', '75MeV·cm2/mg', '不敏感', '2000V', 'YC', 'Q/QJA 20084-2012', 'Q/QJA 20084/18-2012', '北京微电子技术研究所', None)
Row 5: (5, '简单逻辑数字电路', 'CMOS电路', '四路2输入与非门', '54AC00RH', 'DIP14', '1×103Gy（Si）', '75MeV·cm2/mg', '不敏感', '2000V', 'YC', 'Q/QJA 20084-2012', 'Q/QJA 20084/25-2012', '北京微电子技术研究所', None)

(space_env) F:\Business_plat>

---

**Cursor**

## 脚本思路说明
- **解析参数**：通过 `argparse` 支持自定义 Excel 路径、工作表名称、示例行数。
- **加载工作簿**：使用 `openpyxl` 只读方式打开通用器件辐照数据表。
- **读取表头**：抓取首行并按序号输出列名。
- **抽样数据**：按用户指定的 `sample_rows` 打印若干数据行，便于快速确认内容。

脚本已保存到 `backend/scripts/inspect_irradiation_excel.py`，并在你的 `space_env` 中成功运行，输出见你提供的结果。

如果需要进一步功能（例如筛选列、导出 CSV、批量统计等），告诉我具体需求，我再扩展脚本。

---

**User**

帮我在business_plat下新建一个集合存储这个辐照数据

---

**Cursor**

### 方案比较（供选择）
- **方案A：Python 自动导入脚本**
  - **做法**：在 `backend/scripts` 下新增导入脚本，使用 `openpyxl` 读取 `通用器件辐照数据.xlsx`，用 `pymongo` 连接 `mongodb://127.0.0.1:27017/business_plat`（SPECULATION：如与现有连接不同需调整），逐行写入新集合（建议命名 `irradiation_tests` 或你指定的名称），并附带去重/校验逻辑。
  - **优点**：可重复执行、易于扩展（支持更新、字段校正、日志等），与现有代码库一致。
  - **缺点**：需要安装 Python 依赖（`openpyxl`, `pymongo`），需要维护脚本。

- **方案B：手动转换+Compass 导入**
  - **做法**：借助 Excel/CSV 导出工具，把表格另存为 CSV，再在 MongoDB Compass 中对 `business_plat` → 新集合使用 “Import Data” 功能导入。
  - **优点**：无需写代码，操作直观。
  - **缺点**：难以复用或自动化，字段名、编码和类型需人工确保正确；无法轻松添加额外校验。

请确认你想采用哪一种方案（或是否有其他偏好/集合命名），我再按照选定方案提供详细实现步骤与代码。

---

**User**

按照方案A

---

**Cursor**

### 方案A详细实现思路（请确认后再开始写代码）

1. **字段映射规划**  
   - 新集合建议命名 `irradiation_tests`（如需其他名称请说明）。  
   - Excel列 → Mongo字段（可微调）：  
     - `产品类别` → `category`  
     - `产品细类` → `subcategory`  
     - `产品名称` → `product_name`  
     - `型号规格` → `model`  
     - `封装形式` → `package`  
     - `总剂量` → `total_dose`  
     - `单粒子` → `single_event`  
     - `位移` → `displacement`  
     - `抗静电能力` → `esd_rating`  
     - `质量等级` → `quality_grade`  
     - `通用规范编号` → `general_spec`  
     - `详细规范编号` → `detail_spec`  
     - `供应商名称` → `supplier`  
     - `备注` → `remark`  
     - 还可保留 `序号` 作为 `index` 或 `_source_row`.

2. **脚本流程（伪代码）**  
   ```
   parser = argparse(... workbook, sheet, mongo_uri, db, collection, drop_existing)
   wb = load_workbook(workbook, read_only=True)
   ws = sheet ? wb[sheet] : wb.active
   header = first row -> list of column names
   required mapping = dict(header_name -> field_name)
   create pymongo client -> db -> collection
   if drop_existing: collection.drop()
   inserted = 0
   for each data row starting row 2:
       if row is completely empty: continue
       doc = {}
       for excel_name, field_name in mapping:
           doc[field_name] = normalize(cell value)  # strip strings, keep None otherwise
       doc["created_at"] = datetime.utcnow()
       collection.insert_one(doc)
       inserted += 1
   print summary (inserted count, collection name)
   ```

3. **依赖与运行**  
   - Python 脚本依赖 `openpyxl`, `pymongo`. 若当前 `space_env` 已安装则可直接用，否则需 `pip install openpyxl pymongo`。  
   - 运行命令示例（PowerShell）：  
     ```
     cd F:\Business_plat
     .\space_env\Scripts\activate
     python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
     ```  
     （SPECULATION：虚拟环境路径如不同请自行替换。）

4. **安全检查**  
   - 运行前确认 Mongo `business_plat` 数据库已有连接权限。  
   - 若不想每次覆盖，默认不 `drop`，只追加。可通过 `--drop-existing` 控制。  
   - 可加简单重复检测（例如 `model + package` 唯一）但初版先直接插入，后续按需增强。

请确认上述字段映射、集合命名及流程是否符合要求，或提供需要调整的地方。我再开始写入脚本并说明具体执行步骤。

```plaintext
   parser = argparse(... workbook, sheet, mongo_uri, db, collection, drop_existing)
   wb = load_workbook(workbook, read_only=True)
   ws = sheet ? wb[sheet] : wb.active
   header = first row -> list of column names
   required mapping = dict(header_name -> field_name)
   create pymongo client -> db -> collection
   if drop_existing: collection.drop()
   inserted = 0
   for each data row starting row 2:
       if row is completely empty: continue
       doc = {}
       for excel_name, field_name in mapping:
           doc[field_name] = normalize(cell value)  # strip strings, keep None otherwise
       doc["created_at"] = datetime.utcnow()
       collection.insert_one(doc)
       inserted += 1
   print summary (inserted count, collection name)
```

```plaintext
     cd F:\Business_plat
     .\space_env\Scripts\activate
     python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

---

**User**

确认了，帮我实现吧

---

**Cursor**

```python
#!/usr/bin/env python
"""
Import 通用器件辐照数据.xlsx into a MongoDB collection.

Usage example (PowerShell):
    cd F:\Business_plat
    .\space_env\Scripts\activate
    python backend\scripts\import_irradiation_excel.py \
        --collection irradiation_tests --drop-existing
"""

from __future__ import annotations

import argparse
import sys
from dataclasses import dataclass
from datetime import datetime
from pathlib import Path
from typing import Iterable, List, Optional

from openpyxl import load_workbook
from pymongo import MongoClient
from pymongo.collection import Collection

REPO_ROOT = Path(__file__).resolve().parents[2]

DEFAULT_WORKBOOK = REPO_ROOT / "通用器件辐照数据.xlsx"
DEFAULT_MONGO_URI = "mongodb://127.0.0.1:27017"
DEFAULT_DB = "business_plat"
DEFAULT_COLLECTION = "irradiation_tests"


@dataclass(frozen=True)
class ColumnConfig:
    header: str
    field: str
    required: bool = False


COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ColumnConfig("产品类别", "category", required=True),
    ColumnConfig("产品细类", "subcategory"),
    ColumnConfig("产品名称", "product_name", required=True),
    ColumnConfig("产品型号", "model"),
    ColumnConfig("型号规格", "model_spec"),
    ColumnConfig("封装形式", "package"),
    ColumnConfig("总剂量", "total_dose"),
    ColumnConfig("单粒子", "single_event"),
    ColumnConfig("位移", "displacement"),
    ColumnConfig("抗静电能力", "esd_rating"),
    ColumnConfig("质量等级", "quality_grade"),
    ColumnConfig("通用规范编号", "general_spec"),
    ColumnConfig("详细规范编号", "detail_spec"),
    ColumnConfig("供应商名称", "supplier"),
    ColumnConfig("备注", "remark"),
]


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        description="Read 通用器件辐照数据.xlsx and insert rows into MongoDB."
    )
    parser.add_argument(
        "--workbook",
        type=Path,
        default=DEFAULT_WORKBOOK,
        help=f"Path to Excel workbook (default: {DEFAULT_WORKBOOK})",
    )
    parser.add_argument(
        "--sheet",
        type=str,
        default=None,
        help="Worksheet name to import (default: workbook active sheet)",
    )
    parser.add_argument(
        "--mongo-uri",
        type=str,
        default=DEFAULT_MONGO_URI,
        help=f"MongoDB connection URI (default: {DEFAULT_MONGO_URI})",
    )
    parser.add_argument(
        "--database",
        type=str,
        default=DEFAULT_DB,
        help=f"Target database (default: {DEFAULT_DB})",
    )
    parser.add_argument(
        "--collection",
        type=str,
        default=DEFAULT_COLLECTION,
        help=f"Target collection name (default: {DEFAULT_COLLECTION})",
    )
    parser.add_argument(
        "--batch-size",
        type=int,
        default=200,
        help="Number of documents per insert_many batch (default: 200)",
    )
    parser.add_argument(
        "--drop-existing",
        action="store_true",
        help="Drop the target collection before inserting",
    )
    parser.add_argument(
        "--dry-run",
        action="store_true",
        help="Parse workbook but do not write to MongoDB",
    )
    return parser


def normalize_cell(value):
    if value is None:
        return None
    if isinstance(value, str):
        trimmed = value.strip()
        return trimmed or None
    return value


def row_is_empty(values: Iterable[Optional[object]]) -> bool:
    return all(v is None or (isinstance(v, str) and not v.strip()) for v in values)


def ensure_headers(header_row: List[Optional[str]]) -> dict[str, int]:
    header_to_index: dict[str, int] = {}
    for idx, value in enumerate(header_row):
        if value is None:
            continue
        header_to_index[str(value).strip()] = idx

    missing_required = [
        config.header
        for config in COLUMN_CONFIGS
        if config.required and config.header not in header_to_index
    ]
    if missing_required:
        raise ValueError(f"Missing required columns: {', '.join(missing_required)}")
    return header_to_index


def prepare_document(
    row_values: List[Optional[object]],
    header_to_index: dict[str, int],
    row_number: int,
    workbook_name: str,
) -> dict:
    doc: dict = {}
    for config in COLUMN_CONFIGS:
        idx = header_to_index.get(config.header)
        value = row_values[idx] if idx is not None and idx < len(row_values) else None
        doc[config.field] = normalize_cell(value)
    doc["created_at"] = datetime.utcnow()
    doc["_source"] = {
        "row_number": row_number,
        "workbook": workbook_name,
    }
    return doc


def drop_collection_if_requested(collection: Collection, drop: bool) -> None:
    if drop:
        print(f"Dropping existing collection: {collection.full_name}")
        collection.drop()


def insert_documents(
    collection: Collection,
    docs: List[dict],
    dry_run: bool,
) -> int:
    if not docs or dry_run:
        return 0 if dry_run else 0
    result = collection.insert_many(docs)
    return len(result.inserted_ids)


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    workbook_path: Path = args.workbook
    if not workbook_path.exists():
        parser.error(f"Workbook not found: {workbook_path}")

    wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
    ws = wb[args.sheet] if args.sheet else wb.active

    header_row = next(ws.iter_rows(min_row=1, max_row=1, values_only=True), None)
    if not header_row:
        parser.error("Header row is empty")
    header_to_index = ensure_headers(list(header_row))

    client = MongoClient(args.mongo_uri)
    db = client[args.database]
    collection = db[args.collection]

    drop_collection_if_requested(collection, args.drop_existing and not args.dry_run)

    batch: List[dict] = []
    total_rows = 0
    inserted_docs = 0

    for row_number, row_values in enumerate(
        ws.iter_rows(min_row=2, values_only=True), start=2
    ):
        if row_is_empty(row_values):
            continue
        total_rows += 1
        doc = prepare_document(
            list(row_values), header_to_index, row_number, workbook_path.name
        )
        batch.append(doc)
        if len(batch) >= args.batch_size:
            inserted_docs += insert_documents(collection, batch, args.dry_run)
            batch.clear()

    if batch:
        inserted_docs += insert_documents(collection, batch, args.dry_run)

    if args.dry_run:
        print(
            f"[Dry run] Parsed {total_rows} data rows from sheet '{ws.title}'. "
            f"No documents written."
        )
    else:
        print(
            f"Imported {inserted_docs} documents "
            f"into {args.database}.{args.collection} "
            f"from sheet '{ws.title}'."
        )
    return 0


if __name__ == "__main__":
    sys.exit(main())


```

## Import Script Ready
- Added `backend/scripts/import_irradiation_excel.py` with column mapping constants plus CLI options for workbook selection, Mongo targets, batching, dropping, and dry runs, so irradiation rows can be replayably ingested with metadata such as `_source` and `created_at`.  
```40:158:backend/scripts/import_irradiation_excel.py
COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ...
    ColumnConfig("备注", "remark"),
]
...
doc["_source"] = {
    "row_number": row_number,
    "workbook": workbook_name,
}
```
- Script streams the Excel sheet, skips blank rows, normalizes each cell, batches inserts via `insert_many`, and prints a summary (dry-run friendly) for easy verification or re-imports.  
```187:233:backend/scripts/import_irradiation_excel.py
wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
...
if args.dry_run:
    print(f"[Dry run] Parsed {total_rows} data rows ...")
else:
    print(f"Imported {inserted_docs} documents into {args.database}.{args.collection} ...")
```

## How to Use
- Ensure `openpyxl` and `pymongo` exist in your environment (`pip install openpyxl pymongo` if needed).
- Activate the project venv (adjust path if different):
  ```
  cd F:\Business_plat
  .\space_env\Scripts\activate
  ```
- Dry-run to validate parsing without writes:
  ```
  python backend\scripts\import_irradiation_excel.py --dry-run
  ```
- Full import (drops existing collection first):
  ```
  python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
  ```
  Add `--sheet SheetName` or `--mongo-uri`/`--database` overrides as required.

No automated tests were run; consider executing the script with `--dry-run` before the real import, then spot-check documents in MongoDB Compass or via a query.

```python
COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ...
    ColumnConfig("备注", "remark"),
]
...
doc["_source"] = {
    "row_number": row_number,
    "workbook": workbook_name,
}
```

```python
wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
...
if args.dry_run:
    print(f"[Dry run] Parsed {total_rows} data rows ...")
else:
    print(f"Imported {inserted_docs} documents into {args.database}.{args.collection} ...")
```

```plaintext
  cd F:\Business_plat
  .\space_env\Scripts\activate
```

```plaintext
  python backend\scripts\import_irradiation_excel.py --dry-run
```

```plaintext
  python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

---

**User**

中文翻译下

---

**Cursor**

脚本 `backend/scripts/import_irradiation_excel.py` 已经就绪：它把 `通用器件辐照数据.xlsx` 解析后写入 MongoDB，对应字段映射、空行过滤、批量插入和 dry-run 均已实现，并在文档中附加 `_source` 与 `created_at` 便于追踪。使用方式如下：

- 安装依赖：`pip install openpyxl pymongo`
- 进入虚拟环境：  
  ```
  cd F:\Business_plat
  .\space_env\Scripts\activate
  ```
- 先 dry-run 验证：  
  `python backend\scripts\import_irradiation_excel.py --dry-run`
- 正式导入并先清空集合：  
  `python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- 可根据需要追加 `--sheet`, `--mongo-uri`, `--database` 等参数。

尚未运行自动化测试；建议先 dry-run，随后在 MongoDB 中抽查导入结果。

```plaintext
  cd F:\Business_plat
  .\space_env\Scripts\activate
```

---

**User**

你看下
(space_env) F:\Business_plat>.\space_env\Scripts\activate
系统找不到指定的路径。

(space_env) F:\Business_plat>


---

**Cursor**

看提示 `(space_env)`，其实当前终端里虚拟环境已经处于激活状态，不需要再次执行 `.\space_env\Scripts\activate`。直接运行脚本即可，例如：

```
python backend\scripts\import_irradiation_excel.py --dry-run
```

如果未来需要重新激活但目录确实不存在，可以在项目根目录创建或重新生成虚拟环境：

```
py -3 -m venv space_env
.\space_env\Scripts\activate
pip install -r backend\requirements.txt
```

但此刻不必重复激活，环境已经可用。

```plaintext
python backend\scripts\import_irradiation_excel.py --dry-run
```

```plaintext
py -3 -m venv space_env
.\space_env\Scripts\activate
pip install -r backend\requirements.txt
```

---

**User**

你看下
(space_env) F:\Business_plat>python backend\scripts\import_irradiation_excel.py --dry-run
[Dry run] Parsed 1921 data rows from sheet 'Sheet1'. No documents written.

(space_env) F:\Business_plat

---

**Cursor**

Dry-run结果很好，脚本成功解析了 1921 行数据而未写入数据库。若确认无误，可移除 `--dry-run` 并加上需要的参数（如 `--drop-existing`、`--collection irradiation_tests`）执行正式导入；导入后建议在 MongoDB 中抽查几条记录验证字段映射。

---

**User**

告诉我执行导入的命令如何写

---

**Cursor**

可直接运行下面这条（会先清空目标集合再写入）：

```
python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

如需指定自定义 MongoDB 连接或数据库，可追加 `--mongo-uri mongodb://user:pass@host:port`、`--database your_db_name` 等参数；默认 `--sheet Sheet1`。

```plaintext
python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

---

**User**


(space_env) F:\Business_plat>python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
Dropping existing collection: business_plat.irradiation_tests
Imported 1921 documents into business_plat.irradiation_tests from sheet 'Sheet1'.

(space_env) F:\Business_plat>

---

**Cursor**

导入完成：`business_plat.irradiation_tests` 已清空并写入 1921 条文档，来自 `Sheet1`。接下来可在 MongoDB 中抽查几条记录（例如用 `db.irradiation_tests.findOne()`）确认字段和索引是否符合预期；若需要加索引或做统计可继续处理。

---

**User**

好的，把进展概要更新在@DoEEEt功能开发总览.md 中，把详细的更新在@DoEEEt集成实施总结.md 中

---

**Cursor**

```markdown
 DoEEEt 功能开发总览

## 📋 项目概述

DoEEEt（Defense & Aerospace Electronic Equipment Database）是一个专门用于航空航天电子器件的数据库系统，包含了15个顶层分类、181个叶子分类、360个动态参数的完整电子元器件数据。

本文档总览了 DoEEEt 功能的开发进度和实施计划。

---

## 🎯 核心功能模块

### 1. ✅ 分类筛选功能（已完成 100%）

**功能描述**：
- 15个顶层分类展示（Microcircuits, Capacitors, Connectors 等）
- 2-5层深度的分类层级导航
- 双重交互方式：级联选择器 + Tab侧边栏

**技术实现**：
- 后端：`buildCategoryTree()` 服务 + Redis缓存
- 前端：`CategoryFilter` 组件（Cascader + Tabs）
- API：`/api/doeeet/categories/tree`

**文档**：
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md)
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md)

**状态**: ✅ 已完成（2025-10-31）

---

### 2. ✅ 动态参数表头（已完成 100%）

**功能描述**：
- 智能表头展示（有 `short_name` 显示简写 + Tooltip，无则显示完整名称）
- HTML标签支持（下标 `<sub>`、上标 `<sup>`）
- 360个动态参数的灵活展示

**技术实现**：
- 工具函数库：`parameterUtils.tsx`
- 8个核心函数：生成列、分组、导出CSV等
- 安全防护：DOMPurify清理HTML

**文档**：
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)

**示例代码**：
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

**状态**: ✅ 已集成到 `ComponentSearch` 页面（2025-10-31）

#### 🆕 表头与固定参数规范（概述）
- 表头规则：有 `short_name` → 显示“✖ short_name”且 Hover 显示完整 `name`；无 `short_name` → 直接显示 `name`。
- 固定参数：`Package` 与 `TOP (Operating Temperature)` 固定两列、固定顺序展示；名称从 `parameter_definitions`，取值从 `parameters`（按 `component_id + parameter_key`）。
- 聚合输出：后端统一返回 `static`（基础信息）、`fixedExtras`（Package/TOP）、`dynamic`（按 `meta.json` 顺序），空值用 “--”。

---

### 3. ⏳ 组件搜索功能（进行中 40%）

**功能描述**：
- 关键词搜索（器件型号、制造商）
- 分类筛选（集成 CategoryFilter）
- 参数范围筛选（电压、温度等）
- 分页、排序、导出

**待实施任务**：
- [x] 集成 CategoryFilter 到 ComponentSearch 页面
- [x] 集成动态参数表头到搜索结果
- [ ] 实现参数范围筛选
- [ ] 优化搜索性能

**状态**: ⏳ 进行中

---

### 4. ⏳ 动态参数筛选器（计划中 0%）

**功能描述**：
- 根据选择的分类，动态显示该分类的参数筛选器
- 支持范围筛选（数值型参数）
- 支持枚举筛选（离散值参数）

**实现思路**：
```tsx
// 监听分类变化
useEffect(() => {
  if (selectedCategory.length > 0) {
    loadDynamicParameters(selectedCategory);
  }
}, [selectedCategory]);

// 加载该分类的参数配置
const loadDynamicParameters = async (categoryPath: string[]) => {
  const response = await fetch(`/api/doeeet/category-meta/${encodeURIComponent(JSON.stringify(categoryPath))}`);
  const result = await response.json();
  setDynamicParams(result.data.meta);
};

// 渲染动态筛选器
<DynamicParameterFilter
  parameters={dynamicParams}
  onParameterChange={handleParameterChange}
/>
```

**状态**: ⏳ 计划中

---

### 5. ⏳ 组件详情页（计划中 20%）

**功能描述**：
- 基本信息展示（型号、制造商、封装等）
- 参数列表（分类展示）
- 数据表文档（Datasheet）
- 供应商信息
- 辐照测试数据

**待实施任务**：
- [ ] 完善参数详情展示（使用 parameterUtils）
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据展示
- [ ] 实现替代品推荐

**状态**: ⏳ 计划中

---

## 📊 开发进度总览

| 功能模块 | 进度 | 状态 | 预计完成时间 |
|---------|------|------|-------------|
| 分类筛选功能 | 100% | ✅ 完成 | 2025-10-31 |
| 动态参数表头 | 75% | ✅ 核心完成 | 2025-11-01 |
| 组件搜索功能 | 40% | ⏳ 进行中 | 2025-11-03 |
| 动态参数筛选器 | 0% | ⏳ 计划中 | 2025-11-05 |
| 组件详情页 | 20% | ⏳ 计划中 | 2025-11-07 |
| 组件对比功能 | 0% | 📋 待规划 | TBD |
| 替代品推荐 | 0% | 📋 待规划 | TBD |
| 批量导入/导出 | 0% | 📋 待规划 | TBD |

**整体进度**: 47%

---

## 🏗️ 技术架构

### 🆕 2025-11-11 更新（稳定性）
- 已为前端两处关键数据加载增加统一超时与错误处理（15s）：
  - 组件详情：`GET /api/doeeet/components/:id`
  - 分类树：`GET /api/doeeet/categories/tree`（失败不再使用静态回退，避免误导）
- Linter 全量通过；影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx`（详情弹窗数据加载）
  - `frontend/src/components/CategoryFilter.tsx`（分类树加载）

### 🆕 2025-11-12 更新（对比体验）
- 组件对比表过滤掉参数名称为 `Unknown` 或空白的行，避免无意义参数占位
- 对比表参数标题优先展示首个有效参数名；若缺失则显示“未命名参数”，保持列标题一致性
- 影响文件：
  - `frontend/src/components/ComponentCompareModal.tsx`

### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放

### 🆕 2025-11-19 更新（辐照测试数据）
- 通过 `backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing` 完成最新 Excel 数据导入，写入 `business_plat.irradiation_tests`
- 本次导入覆盖 1,921 行记录，脚本 dry-run 与正式导入均成功执行，确保集合内容为最新
- 建议在 MongoDB 中使用 `db.irradiation_tests.findOne()`/抽样统计确认字段映射及索引需求


### 前端技术栈
```
React 18.2
├── TypeScript 4.9
├── Ant Design 5.12
├── Vite 4.5
└── React Router 6.20
```

### 前后端对齐计划（2025-11-10）
- 接口契约与字段命名统一
  - 后端输出统一字段：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`（"Yes"|"No"）
  - 详情/搜索/对比接口字段保持一致，前端避免额外适配层
- 查询参数规范与校验
  - 支持并校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
  - `familyPath` 传入 JSON 数组字符串（如 `["Resistors","Film"]`）
- 响应结构与分页
  - 统一 `{ success, data, error }`
  - 列表附带 `{ total, totalPages, page, limit, hasNextPage }`
- 性能与稳定性
  - 索引：`component_id`、`manufacturer_name`、`family_path`、`has_stock`、全文索引
  - 缓存：列表短缓存（30–120s），详情缓存（5–15m）
  - 速率限制与慢查询日志
- 前端改造
  - 建立统一 API SDK（TS 类型、统一错误处理）
  - 搜索/筛选状态与 URL 同步
  - 列表虚拟化、加载/空态/错误态与重试

### 里程碑（A-D）
- 里程碑 A（页面与布局）
  - `CategoryBrowsePage`、面包屑、左侧筛选 + 右侧结果布局
- 里程碑 B（筛选与数据）
  - Faceting 聚合（制造商/质量/库存/分类）+ 缓存
  - `FilterPanel`：折叠、Stacked/Scroll、显示计数、已选条件 chips、动态加载
- 里程碑 C（结果与表格）
  - 将动态参数表头全面接入结果表格，优化横向滚动/虚拟化
  - 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - 单位转换（pF ↔ µF/mF/F）与筛选器联动
  - 分类内局部搜索提示与命中高亮

### 后端技术栈
```
Node.js 18+
├── Express 4.x
├── TypeScript 4.9
├── MongoDB 6.x (数据库: business_plat)
├── Redis 7.x
└── meta.json（分类配置源）
```

### 数据流架构
```
meta.json 
  ↓ (读取)
DoeeetSearchService.buildCategoryTree()
  ↓ (构建树 + 缓存)
Redis (TTL: 1小时)
  ↓ (API)
/api/doeeet/categories/tree
  ↓ (HTTP)
前端组件 (CategoryFilter, DynamicParameterTable, etc.)
  ↓ (用户交互)
搜索 / 筛选 / 详情查看
```

---

## 📁 项目文件结构

```
Business_plat/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── DoeeetComponent.ts           # DoEEEt组件模型
│   │   │   └── ...
│   │   ├── services/
│   │   │   ├── DoeeetSearchService.ts       # 搜索服务（含分类树构建）
│   │   │   └── CacheService.ts              # Redis缓存服务
│   │   ├── controllers/
│   │   │   └── doeeetComponentController.ts # 控制器
│   │   └── routes/
│   │       └── doeeetRoutes.ts              # 路由配置
│   └── data/
│       └── meta.json                        # 分类配置源文件
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   └── CategoryFilter.tsx           # 分类筛选组件
│   │   ├── utils/
│   │   │   └── parameterUtils.tsx           # 动态参数工具函数
│   │   ├── examples/
│   │   │   └── DynamicParameterTableExample.tsx  # 示例代码
│   │   └── pages/
│   │       └── components/
│   │           └── ComponentSearch.tsx      # 搜索页面
│   └── docs/
│       ├── CategoryFilter使用说明.md
│       ├── 动态参数表头展示说明.md
│       └── 动态参数表头-快速开始.md
│
└── [根目录文档]
    ├── DoEEEt集成实施总结.md
    ├── DoEEEt项目开发计划.md
    ├── 前端分类筛选功能实施方案.md
    ├── 前端分类筛选-快速开始.md
    ├── DoEEEt动态参数表头实施总结.md
    └── DoEEEt功能开发总览.md (本文档)
```

---

## 🚀 快速开始

### 1. 启动 MongoDB 数据库

**Windows 系统**:
```bash
cd backend
.\start-mongodb-local.bat
```

**说明**:
- 脚本会自动检查 MongoDB 是否已安装
- 如果检测到 Windows 服务 `MongoDB` 正在运行，会尝试自动停止（默认服务数据目录: `E:\data\db`，项目数据目录: `F:\Business_plat\backend\data`）
- 停止 Windows 服务需要以管理员身份运行终端；若停止失败请手动执行 `net stop MongoDB`
- 自动停止服务并释放端口后再启动本地实例，避免读写到错误的数据目录
- 脚本会自动创建数据目录和日志目录（如果不存在）
- 数据目录: `backend/data`
- 日志文件: `backend/logs/mongod.log`
- 配置文件: `backend/mongod.conf`

**启动步骤**:
1. 打开 PowerShell 或命令提示符
2. 切换到 `backend` 目录: `cd backend`
3. 运行启动脚本: `.\start-mongodb-local.bat`
4. 脚本会自动检查环境并启动 MongoDB
5. 如果 MongoDB 已安装，会看到 "✅ MongoDB 启动成功！" 提示

**验证 MongoDB 是否运行**:
```bash
# 使用 mongosh 连接
mongosh mongodb://127.0.0.1:27017

# 或检查端口
netstat -an | findstr ":27017"

# 或访问健康检查（需要后端服务运行）
curl http://localhost:3001/health
```

**数据库配置**:
- 数据库名称: `business_plat`
- 连接地址: `mongodb://localhost:27017/business_plat`
- 集合名称: `components` (包含所有 DoEEEt 组件数据)
- 默认端口: `27017`

**注意事项**:
- 确保 MongoDB 已安装并添加到 PATH 环境变量
- MongoDB 安装路径通常是: `C:\Program Files\MongoDB\Server\8.2\bin`
- 如果启动失败，请检查日志文件: `backend/logs/mongod.log`
- 启动脚本会在当前窗口运行 MongoDB，关闭窗口会停止服务

---

### 2. 启动后端服务

```bash
cd backend
npm install

# 确保 .env 文件配置正确
# MONGODB_URI=mongodb://localhost:27017/business_plat

npm run dev
```

**启动成功标志**:
- ✅ MongoDB 连接成功
- ✅ Redis 连接成功
- ✅ 服务器启动成功，端口: 3001
- ✅ 数据自动保存机制已启动（间隔: 30秒）

**服务地址**:
- API 地址: `http://localhost:3001`
- 健康检查: `http://localhost:3001/health`

**验证服务是否运行**:
```bash
# 测试分类树 API
curl http://localhost:3001/api/doeeet/categories/tree

# 或访问健康检查端点
curl http://localhost:3001/health
```

---

### 3. 启动前端服务

```bash
cd frontend
npm install

# 安装可选依赖（用于HTML清理）
npm install dompurify @types/dompurify

npm run dev
```

**访问**: http://localhost:3000

---

### 4. 使用分类筛选

```tsx
import CategoryFilter from '@/components/CategoryFilter';

<CategoryFilter 
  onCategoryChange={(path) => console.log('选择的分类:', path)}
  selectedCategory={[]}
/>
```

---

### 5. 使用动态参数表头

```tsx
import { generateDynamicParameterColumns } from '@/utils/parameterUtils';

const dynamicColumns = generateDynamicParameterColumns(
  parameterDefinitions,
  { sortable: true }
);
```

---

## 📚 文档索引

### 核心文档

#### 分类筛选相关
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md) - 完整实施方案
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md) - 组件API文档
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md) - 5分钟上手

#### 动态参数表头相关
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md) - 实施总结
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md) - 详细文档
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md) - 快速上手

#### 总体文档
- [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 整体集成总结
- [DoEEEt项目开发计划.md](./DoEEEt项目开发计划.md) - 项目计划
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 本文档

### 示例代码
- [CategoryFilter.tsx](./frontend/src/components/CategoryFilter.tsx)
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

---

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：标题、结果总数、子分类卡片/列表）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 全局改为左右布局（左侧筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合并返回匹配数量：制造商/质量等级/库存/分类）
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、显示计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search"（质量等级等快速入口）
2. ⏳ 分类页面内的局部搜索提示（Search within <Category>）
3. ⏳ 搜索命中高亮

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

### 里程碑（对齐 DOEEET 的分类与搜索体验）
- 里程碑 A（页面与布局）
  - [ ] `CategoryBrowsePage`：分类标题与总数、子分类卡片/列表、跳转联动
  - [ ] 面包屑导航：Home > 顶类 > 子类
  - [ ] 左侧筛选 + 右侧结果的页面布局
- 里程碑 B（筛选与数据）
  - [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
  - [ ] `FilterPanel`：折叠、Stacked/Scroll、计数、已选条件chips、动态加载
- 里程碑 C（结果与表格）
  - [ ] 集成动态参数表头到搜索结果表格；横向滚动与虚拟化优化
  - [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - [ ] 单位转换工具与筛选器联动
  - [ ] 分类内局部搜索提示与搜索高亮

---

## 🎯 近期开发计划

### Week 1 (2025-10-31 ~ 2025-11-06)

#### Day 1-2: 集成分类筛选和动态参数表头
- [ ] 将 CategoryFilter 集成到 ComponentSearch 页面
- [ ] 将动态参数表头集成到搜索结果
- [ ] 测试和优化

#### Day 3-5: 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`（标题、总数、子分类卡片/列表）
- [ ] 新增面包屑导航并与分类路由联动
- [ ] 改版为“左侧筛选 + 右侧结果”布局（影响搜索与浏览页）

#### Day 3-4: 实现动态参数筛选器
- [ ] 监听分类变化
- [ ] 加载对应分类的参数配置
- [ ] 创建 DynamicParameterFilter 组件
- [ ] 实现范围筛选和枚举筛选

#### Day 5-7: 优化和测试
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 添加单元测试
- [ ] 用户体验优化
- [ ] 编写完整文档

---

### Week 2 (2025-11-07 ~ 2025-11-13)

#### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel` 组件（折叠/展开、Stacked/Scroll、计数、已选条件chips）
- [ ] 筛选器选项动态加载（基于当前结果集）

#### 组件详情页增强
- [ ] 完善参数详情展示
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据
- [ ] 实现替代品推荐

#### 搜索功能增强
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- [ ] 单位转换工具与筛选联动
- [ ] 分类内局部搜索提示与高亮

---

## 🐛 已知问题

### 1. CategoryFilter 组件
- [ ] Tab切换时动画不流畅（低优先级）
- [ ] 移动端适配待优化

### 2. 动态参数表头
- [ ] 待集成到实际页面进行测试
- [ ] 大数据量下性能待优化（考虑虚拟滚动）

### 3. 搜索功能
- [ ] 搜索结果高亮待实现
- [ ] 分页加载待优化

---

## 🤝 贡献指南

### 开发流程
1. Fork 项目
2. 创建 feature 分支
3. 提交代码并添加测试
4. 提交 Pull Request

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 必须有单元测试
- 必须有 JSDoc 注释

---

## 📞 联系信息

**项目团队**: 开发团队  
**最后更新**: 2025-11-01  
**当前版本**: v0.5 (开发中)  
**预计发布**: v1.0 (2025-11-15)

---

## 🎉 里程碑

### v0.1 (2025-10-25)
- ✅ DoEEEt数据库集成
- ✅ 基础数据模型

### v0.3 (2025-10-29)
- ✅ 分类树构建服务
- ✅ Redis缓存集成

### v0.5 (2025-10-31) - 当前版本
- ✅ CategoryFilter 组件
- ✅ 动态参数表头工具函数
- ✅ 完整文档

### v0.7 (2025-11-06) - 计划中
- ⏳ 完整搜索功能
- ⏳ 动态参数筛选器
- ⏳ 组件详情页

### v1.0 (2025-11-15) - 目标
- 📋 完整的DoEEEt功能
- 📋 性能优化
- 📋 完整的测试覆盖

---

## 📈 数据统计

### DoEEEt 数据库规模
- **总组件数**: ~50,000+ 个电子元器件
- **顶层分类**: 15 个
- **叶子分类**: 181 个
- **动态参数**: 360 个唯一参数键
- **制造商**: ~200+ 家

### 功能覆盖率
- **分类筛选**: 100% (15/15 顶层分类)
- **参数展示**: 100% (360/360 动态参数)
- **搜索功能**: 40% (基础搜索已实现)
- **详情展示**: 20% (基础信息已实现)

---

**感谢使用 DoEEEt 系统！**

如有问题，请查阅相关文档或联系开发团队。


```

```markdown
# DoEEEt电子元件搜索系统集成实施总结

## 项目概览

本文档记录了DoEEEt电子元件数据库与业务平台的集成实施过程，包括已完成的功能、技术架构和下一步计划。

## 数据概况

- **数据源**: DoEEEt (Defense Operational Electronic Equipment and Technology)
- **数据规模**: 
  - 组件 (components): 1.8M+ 条记录
  - 参数 (parameters): 137M+ 条记录
  - 参数定义 (parameter_definitions): 313 个参数类型
  - 动态参数定义 (meta.json): 360 个唯一参数键

### 数据文件映射关系（对应《数据说明》）

- components ↔ `general.csv`
- parameters ↔ `parameter.csv`
- parameter_definitions ↔ `parameter_final.csv`（集成时忽略 example 列）

### 分类结构分析 (基于 meta.json)

#### 顶层分类（15个）

```javascript
const topCategories = [
  "Cable Assemblies",        // 叶子分类: 3
  "Capacitors",              // 叶子分类: 8
  "Connectors",              // 叶子分类: 11
  "Crystals and Oscillators", // 叶子分类: 3
  "Discretes",               // 叶子分类: 30
  "Filters",                 // 叶子分类: 4
  "Inductors",               // 叶子分类: 3
  "Microcircuits",           // 叶子分类: 89 (最大类别)
  "Relays",                  // 叶子分类: 4
  "Resistors",               // 叶子分类: 6
  "RF Passive Components",   // 叶子分类: 2
  "Switches",                // 叶子分类: 5
  "Thermistors",             // 叶子分类: 3
  "Transformers",            // 叶子分类: 7
  "Wires and Cables",        // 叶子分类: 3
];
```

#### 分类层级统计

- **总计**: 181 个最细叶子分类（meta.json 中配置的分类）
- **路径深度分布**:
  - 深度 2 (例: `Capacitors > Ceramic`): 54 个 (29.83%)
  - 深度 3 (例: `Connectors > Circular > Circular Accessories`): 51 个 (28.18%)
  - 深度 4 (例: `Discretes > Diode > RF-Microwave Diode > PIN`): 61 个 (33.70%)
  - 深度 5 (例: `Microcircuits > Digital > Memory > RAM > SRAM`): 15 个 (8.29%)

#### family_path 数据结构

```python
# 实际存储格式：从“叶子(最低级)”到“顶层(最高级)”的层级数组
"['Peripheral-Controller', 'Digital', 'Microcircuits']"
#    ↑ 叶子(最低级)             ↑ 中间层级          ↑ 顶层

# 提取规则（与数据库一致）：
# - 叶子分类：family_path[0]
# - 顶层分类：family_path[-1] (最后一个元素)
```

#### 最常用的动态参数 (Top 10)

| 参数名称 | 使用率 | 说明 |
|---------|-------|------|
| Storage Temperature Range | 93.37% | 存储温度范围 |
| SEE sens. | 92.82% | 单粒子效应灵敏度 |
| TID (HDR) sens. | 92.82% | 总电离剂量（高剂量率）灵敏度 |
| TID (LDR) sens. | 92.82% | 总电离剂量（低剂量率）灵敏度 |
| TNID sens. | 92.82% | 中子辐射灵敏度 |
| Finish | 81.22% | 表面处理 |
| Package Material | 72.93% | 封装材料 |
| Number of Pins | 71.27% | 引脚数量 |
| TID (HDR) | 66.30% | 总电离剂量（高剂量率） |
| TID (LDR) | 66.30% | 总电离剂量（低剂量率） |

#### 注意事项

1. **meta.json 中没有 "Aerospace" 分类**
   - "Aerospace" 不是分类维度，而是质量等级或筛选条件
   - 可能对应 `comp-qualified = Y` 或特殊的 `quality_name`
   
2. **动态参数配置**
   - 每个叶子分类有不同的动态参数列表（在 meta.json 的 `meta` 数组中）
   - 共有 360 个唯一的动态参数键
   - 如果某个分类不在 meta.json 中，则只显示固定参数

## 已完成功能 (Phase 1, Phase 2 & Phase 2.5)

### Phase 1: 基础集成功能 ✅

#### 1.1 前端组件搜索页面 ✅
**文件**: `frontend/src/pages/components/ComponentSearch.tsx`

**功能**:
- 集成DoEEEt API (`/api/doeeet/search`)
- 支持多维度搜索：
  - 型号搜索 (partNumber)
  - 制造商筛选 (manufacturer)
  - 质量等级筛选 (qualityName: 883, QML Q, EP等)
  - 库存状态筛选 (hasStock: Yes/No)
  - 淘汰状态筛选 (obsolescenceType: Active, Obsolete, Risk, Last Time Buy)
- 数据格式转换：将DoEEEt数据格式适配到前端UI
- 解析family_path分类层次结构
- 分页和排序支持
- ✨ **新增**: 动态参数表头展示（Phase 2.5）
- ✨ **新增**: 分类筛选器集成（Phase 2.5）
- ✨ **新增**: CSV导出功能（Phase 2.5）

**技术实现**:
```typescript
// API调用示例
const response = await fetch(`/api/doeeet/search?${params.toString()}`);
const result = await response.json();

// 数据转换
const adaptedComponents = result.data.components.map((comp: any) => {
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层分类为最后一个元素
    mainCategory: familyPathArray[familyPathArray.length - 1],
    // ... 其他字段映射
  };
});
```

#### 1.2 组件详情弹窗 ✅
**功能**:
- 点击组件型号查看详细信息
- 动态加载组件参数 (`/api/doeeet/components/:id`)
- 显示参数定义翻译（中英文参数名、符号、分类）
- 参数表格展示：
  - 参数名称（完整名称 + 符号）
  - 参数值（支持数组值解析）
  - 参数分类
  - 单位和示例

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Thermal Resistance, Junction to Case [Max]"
  short_name: string;     // "&theta;<sub>JC</sub> [Max]"
  category: string;       // "Generic Functional & Electrical"
  value: any;             // 实际参数值
}
```

#### 1.3 首页分类统计卡片 ✅
**文件**: `frontend/src/pages/HomePage.tsx`

**功能**:
- 实时显示11个主要分类的组件数量
- 从API获取统计数据 (`/api/doeeet/statistics`)
- 动态更新分类统计卡片
- 支持点击跳转到对应分类搜索

**后端增强**:
- 在 `DoeeetSearchService.getStatistics()` 中添加 `categoryStats`
- 使用MongoDB聚合管道按family_path分组统计
- 解析family_path提取主分类
- Redis缓存优化（TTL: 1小时）

### Phase 2: 高级搜索功能 ✅

#### 2.1 动态参数表头展示 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (工具函数库)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 智能表头展示：
  - 有 `short_name` 时显示简写 + Tooltip（完整名称）
  - 无 `short_name` 时直接显示完整名称
- HTML 标签支持（`<sub>`, `<sup>` 等）
- 安全清理（DOMPurify）
- 根据分类动态生成参数列
- 参数列可排序、可筛选

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Storage Temperature Range"
  short_name?: string;    // "T<sub>STG</sub>"
  category: string;       // "Thermal"
  example?: string;       // "-55°C to 150°C"
}
```

**工具函数**:
```typescript
// 8个核心函数
- generateParameterColumnTitle()      // 生成智能表头
- generateDynamicParameterColumns()   // 批量生成动态列
- generateGroupedParameterColumns()   // 生成分组列
- exportParametersToCSV()             // 导出CSV
- downloadCSV()                       // 下载CSV
- groupParametersByCategory()         // 按分类分组
- formatParameterValue()              // 格式化参数值
- extractParameterKeys()              // 提取参数键
```

**UI效果**:
```
┌────────────────┬──────────┬─────────ⓘ───┬─────────ⓘ───┐
│ 器件型号        │ 制造商    │ #Pins       │ T_STG        │
│                │          │ ↑ Tooltip   │ ↑ Tooltip    │
├────────────────┼──────────┼─────────────┼──────────────┤
│ 860300YA       │ SIB      │ 68          │ -55°C~150°C  │
└────────────────┴──────────┴─────────────┴──────────────┘
```

**参数覆盖率**:
- 总参数数: 360个
- 有 `short_name`: ~80% (288个)
- 无 `short_name`: ~20% (72个)

#### 2.2 分类筛选器集成 ✅ ⭐ 新增
**文件**: 
- `frontend/src/components/CategoryFilter.tsx` (已有组件)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 级联选择器（Cascader）展示分类层级
- Tab导航展示顶层分类（15个）
- 支持 2-5 层分类路径选择
- 分类选择后自动触发搜索
- 显示每个分类的组件数量

**分类统计**:
| 顶层分类 | 组件数量 | 占比 | 路径深度 |
|---------|---------|------|---------|
| Resistors | 824,599 | 45.88% | 2层 |
| Capacitors | 503,149 | 27.99% | 2层 |
| Connectors | 160,090 | 8.91% | 3层 |
| Crystals and Oscillators | 131,524 | 7.32% | 2层 |
| Switches | 53,377 | 2.97% | 2层 |
| Discretes | 45,564 | 2.53% | 2-4层 |
| Thermistors | 31,302 | 1.74% | 2层 |
| Microcircuits | 25,652 | 1.43% | 2-5层 |
| 其他 (6类) | 22,160 | 1.23% | 2-3层 |

**数据流**:
```
用户选择分类
    ↓
CategoryFilter.onCategoryChange(path)
    ↓
setSelectedCategory(['Resistors', 'Film'])
    ↓
handleSearch() → /api/doeeet/search?familyPath=["Resistors","Film"]
    ↓
后端筛选 + 返回对应的 parameterDefinitions
    ↓
前端生成动态参数列
```

#### 2.3 参数范围筛选 ✅
**文件**: 
- `frontend/src/components/ParameterRangeFilter.tsx` (新建)
- `backend/src/services/DoeeetSearchService.ts` (已支持)

**功能**:
- 支持数值型参数的范围查询
- 常用参数快速选择：
  - 电压 (Voltage)
  - 电流 (Current)
  - 功率 (Power)
  - 频率 (Frequency)
  - 工作温度 (Temperature)
  - 电阻、电容、电感等
- 最小值/最大值输入
- 多参数组合筛选
- 动态添加/删除筛选条件

**API格式**:
```json
{
  "parameters": {
    "voltage": { "min": 3.3, "max": 5.0 },
    "temperature": { "min": -40, "max": 85 }
  }
}
```

**后端实现**:
```typescript
// 范围查询支持
if (typeof value === 'object' && ('min' in value || 'max' in value)) {
  const rangeQuery: any = { parameter_key: key };
  if (value.min !== undefined) {
    rangeQuery.numeric_value = { $gte: value.min };
  }
  if (value.max !== undefined) {
    rangeQuery.numeric_value = { 
      ...rangeQuery.numeric_value, 
      $lte: value.max 
    };
  }
  paramQueries.push(rangeQuery);
}
```

#### 2.4 CSV导出功能 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (导出函数)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 导出当前搜索结果为CSV
- 包含所有静态列和动态参数列
- 自动生成文件名（带时间戳）
- 支持中文编码（UTF-8 BOM）

**使用示例**:
```tsx
<Button 
  icon={<DownloadOutlined />}
  onClick={() => {
    const csvContent = exportParametersToCSV(components, parameterDefinitions);
    downloadCSV(csvContent, `components_${Date.now()}.csv`);
    message.success('导出成功！');
  }}
>
  导出CSV
</Button>
```

**CSV格式**:
```csv
器件型号,制造商,分类,Number of Pins,Storage Temperature Range,...
860300YA,SIB International,Resistors,68,-55°C~150°C,...
860301YA,SIB International,Capacitors,72,-40°C~125°C,...
```

#### 2.5 参数对比功能 ✅
**文件**:
- `frontend/src/components/ComponentCompareModal.tsx` (新建)
- `backend/src/controllers/doeeetComponentController.ts` (新增compareComponents)
- `backend/src/routes/doeeetRoutes.ts` (新增路由)

**功能**:
- 多选组件（2-5个）
- 批量对比按钮
- 对比模态框展示：
  - 基本信息对比表
  - 参数对比矩阵
  - 参数差异高亮
- 支持大量参数滚动查看

**API Endpoint**:
```
POST /api/doeeet/components/compare
Body: { componentIds: string[] }
```

**对比矩阵数据结构**:
```typescript
interface ComparisonMatrix {
  components: ComponentInfo[];      // 组件基本信息
  parameters: ParameterRow[];       // 参数对比矩阵
}

interface ParameterRow {
  key: string;
  component_0: { name, value, numericValue };
  component_1: { name, value, numericValue };
  // ...
}
```

## 技术架构

### 后端技术栈
- **框架**: Express.js + TypeScript
- **数据库**: MongoDB (1.8M+ 组件记录)
- **缓存**: Redis (搜索结果、组件详情、统计数据)
- **日志**: Winston

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI库**: Ant Design
- **路由**: React Router v6
- **状态管理**: React Hooks

### 数据库设计

#### Collections

1. **components** (1.8M 文档)
```javascript
{
  _id: ObjectId,
  component_id: String,          // UUID
  part_number: String,           // "5962-8864203YA"
  part_type: String,             // "P1754-40QGMB"
  manufacturer_name: String,     // "Pyramid Semiconductor"
  family_path: String,           // "['Peripheral-Controller', 'Digital', 'Microcircuits']"
  quality_name: String,          // "883"
  obsolescence_type: String,     // "Active"
  has_stock: String,             // "Yes"/"No"
  qpl_name: String,              // "QPDSIS-38535"
  qualified: String,             // "Y"/"N"
  cad: String,
  created_at: Date,
  updated_at: Date
}
```

2. **parameters** (数百万文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID + type
  component_id: String,          // 外键
  parameter_value: String,       // "['0.00000']"
  numeric_value: Number,         // 用于范围查询
  created_at: Date,
  updated_at: Date
}
```

3. **parameter_definitions** (313 文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID
  name: String,                  // "Thermal Resistance, Junction to Case [Max]"
  short_name: String,            // "&theta;<sub>JC</sub> [Max]"
  category: String,              // "Generic Functional & Electrical"
  example: String,               // "5°C/W"
  created_at: Date,
  updated_at: Date
}
```
注：本集合与数据说明中的 `parameter_final.csv` 对应；集成与展示时请忽略 `example` 列（不参与前后端逻辑与显示）。

### API接口列表

#### 搜索API
- `GET /api/doeeet/search` - 复合搜索
- `GET /api/doeeet/fulltext` - 全文搜索
- `GET /api/doeeet/suggestions` - 搜索建议
- `GET /api/doeeet/category/:category` - 分类浏览

#### 组件API
- `GET /api/doeeet/components/:id` - 组件详情
- `POST /api/doeeet/components/compare` - 对比组件 ✨ 新增

#### 元数据API
- `GET /api/doeeet/manufacturers` - 制造商列表
- `GET /api/doeeet/categories` - 分类列表
- `GET /api/doeeet/parameter-definitions` - 参数定义
- `GET /api/doeeet/statistics` - 统计信息 ✨ 增强

## 性能优化

### 1. Redis缓存策略
```typescript
// 缓存TTL配置
const CacheTTL = {
  SEARCH_RESULT: 300,        // 5分钟
  COMPONENT_DETAIL: 1800,    // 30分钟
  METADATA: 3600,            // 1小时
  STATISTICS: 3600           // 1小时
};
```

### 2. MongoDB索引
```javascript
// components集合索引
{
  component_id: 1,           // 唯一索引
  part_number: 1,            // 搜索索引
  manufacturer_name: 1,
  obsolescence_type: 1,
  family_path: 1
}

// parameters集合索引
{
  component_id: 1,
  parameter_key: 1,
  numeric_value: 1           // 范围查询索引
}

// 全文搜索索引
{
  part_number: "text",
  manufacturer_name: "text",
  part_type: "text"
}
```

### 3. 分页优化
- 默认每页20条
- 最大限制100条
- Skip + Limit实现

### 缓存与限流（新增）
- 实现 `CacheService.ts`
- 缓存搜索结果、分类树
- 性能优化：目标从200ms降至10-20ms

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站功能对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：分类标题、结果总数、子分类列表/卡片）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 改为左右布局（左侧固定筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合返回匹配数量：制造商/质量等级/库存/分类）+ 缓存
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随当前结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换功能（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search" 部分
2. ⏳ 分类页面局部搜索（Search within <Category>）
3. ⏳ 结果高亮显示

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

## 本次对齐实施计划（2025-11-10）

### 阶段 0（契约与正确性）
- [ ] 接口契约与字段命名统一：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`
- [ ] 查询参数校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
- [ ] 响应结构统一：`{ success, data, error }`；分页元数据 `{ total, totalPages, page, limit, hasNextPage }`
- [ ] 错误码与错误体：400/404/500；`error.code`、`error.message`

### 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`：显示分类标题、总数、子分类卡片/列表；支持点击进入搜索页
- [ ] 新增面包屑导航：Home > 顶类 > 子类，支持路由联动
- [ ] 页面布局改造：统一为“左侧筛选面板 + 右侧结果列表”

### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel`：折叠/展开、Stacked/Scroll 视图、显示计数、已选条件chips
- [ ] 筛选项动态加载（基于当前结果集）

### 里程碑 C（结果与表格）
- [ ] 将动态参数表头接入搜索结果表格并优化横向滚动/虚拟化
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）

### 里程碑 D（体验增强）
- [ ] 单位转换（pF ↔ µF/mF/F）与筛选器联动
- [ ] 分类内局部搜索提示（Search within <Category>）与结果高亮

---

## 待实现功能 (Phase 3 & 优化)

### Phase 2.6: 动态参数表头增强 ⏳
- [ ] 参数列的显示/隐藏控制
- [ ] 参数列的拖拽排序
- [ ] 参数列配置保存到 localStorage
- [ ] 参数列的分组展示（按 category）
- [ ] 参数列的高级筛选（范围、正则等）
- [ ] 参数统计图表展示

### Phase 3.1: 关联数字模型 ⏳
- 展示组件关联的3D CAD模型
- 模型预览（使用Three.js或类似库）
- 模型信息展示

### Phase 3.2: 模型下载功能 ⏳
- 支持多种CAD格式下载
- 下载进度显示
- 批量下载支持

### Phase 3.3: 分面搜索（Facets）⏳
- 实现分面搜索
- 统计每个筛选条件的可用选项数量
- 动态更新可用筛选选项

## 使用说明

### 1. 启动服务

**后端**:
```bash
cd backend
npm install
npm run dev
```

**前端**:
```bash
cd frontend
npm install
npm start
```

### 2. 访问系统

- 前端URL: http://localhost:3000
- 后端API: http://localhost:3001

### 3. 主要功能入口

1. **组件搜索**: 导航栏 -> 器件查询 -> 器件搜索
2. **首页统计**: 首页 -> 11个分类统计卡片
3. **参数筛选**: 组件搜索页面 -> 参数范围筛选卡片
4. **组件对比**: 
   - 选择2-5个组件
   - 点击"批量对比"按钮
   - 查看对比结果

## 数据统计

### 分类统计（示例）
- Peripheral-Controller: ~800,000
- Digital: ~500,000
- Microcircuits: ~300,000
- Analog: ~200,000
- 其他分类: 各有数量

### 制造商统计
- 18+ 制造商
- 包括Pyramid Semiconductor, Analog Devices, Texas Instruments等

### 参数统计
- 313个参数定义
- 涵盖电气、热学、机械等多个分类

## 测试建议

### 功能测试
1. 搜索功能测试
   - 型号搜索: "5962-8864203YA"
   - 制造商筛选: "Pyramid Semiconductor"
   - 组合筛选测试

2. 参数筛选测试
   - 单参数范围: 电压 3.3V-5V
   - 多参数组合: 电压 + 温度

3. 组件对比测试
   - 选择2个相似组件对比
   - 选择5个组件对比
   - 查看参数差异

### 性能测试
1. 大数据量搜索响应时间
2. 缓存命中率监控
3. 并发用户测试

## 注意事项

1. **数据格式**: DoEEEt的family_path使用Python列表字符串格式，需要特殊解析
2. **参数值**: 参数值也是数组字符串格式，需要解析后显示
3. **缓存策略**: 注意Redis缓存的TTL设置，避免数据过期问题
4. **错误处理**: 前端有降级方案，API失败时显示模拟数据

## 开发团队

- 后端开发: Express.js + MongoDB + Redis
- 前端开发: React + TypeScript + Ant Design
- 数据导入: Python脚本处理DoEEEt CSV数据

## 🔥 最新状态更新 (2025-10-30)

### ✅ 重大进展

#### 1. 后端服务正常运行 ⭐
- **状态**: ✅ 已启动并稳定运行
- **端口**: 3001
- **服务**:
  - MongoDB 8.2.1 连接正常 (1.8M组件数据)
  - Redis连接正常 (缓存服务)
  - 所有API端点可访问

#### 2. TypeScript编译问题修复 ⭐
- **问题**: `jsonwebtoken` 类型声明错误导致编译失败
- **解决方案**: 使用类型断言 `as JwtPayload`
- **影响文件**: `backend/src/middleware/authMiddleware.ts`
- **状态**: ✅ 已修复，编译通过

#### 3. ComponentSearch页面API集成完成 ⭐
- **文件**: `frontend/src/pages/components/ComponentSearch.tsx`
- **状态**: ✅ 已接入真实API (`/api/doeeet/search`)
- **功能验证**:
  - ✅ API调用逻辑正确
  - ✅ 数据适配器已实现 (MongoDB → UI)
  - ✅ 支持搜索、筛选、分页
  - 🔄 待测试：前端服务启动后的实际运行效果

#### 4. 数据库备份脚本完善 ⭐ 🆕
- **文件**: `backend/scripts/backup_database.ps1`
- **状态**: ✅ 已完善，支持 MongoDB 8.x
- **功能**:
  - ✅ MongoDB 版本自动检测
  - ✅ MongoDB 8.x 强制使用 mongosh 备份
  - ✅ 详细的进度显示和日志
  - ✅ 自动压缩和备份验证
- **备份路径**: `F:\Business_plat\backups\`
- **兼容性**: MongoDB 8.2.1 + mongodump 100.x

#### 5. 数据格式迁移脚本准备 ⭐ 🆕
- **文件**: `backend/scripts/migrate_doeeet_data_format.js`
- **状态**: ✅ 已创建，待执行
- **目的**: 修复 `doeeet_tasks` 集合数据格式
- **操作**: 字段展平（`title.value` → `title`）
- **安全**: 自动创建备份集合

#### 4. 数据适配器实现 ⭐
**转换逻辑**:
```typescript
// MongoDB数据格式 → 前端UI格式
const adaptedComponents = result.data.components.map((comp: any) => {
  // 解析Python列表格式的family_path
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层在末尾，叶子在开头
    mainCategory: familyPathArray[familyPathArray.length - 1],
    subCategory: familyPathArray[1] || '',
    category: familyPathArray[0] || '',
    qualityLevel: comp.quality_name,
    status: comp.obsolescence_type,
    stockStatus: comp.has_stock === 'Yes',
    qplName: comp.qpl_name || '',
    qualified: comp.qualified === 'Y'
  };
});
```

### 🎯 当前优先级任务

#### P0 - 立即执行（数据安全优先）
1. **数据库备份** ⏰ 30分钟 🔴
   - 🔄 执行备份脚本 (`.\scripts\backup_database.ps1`)
   - 验证备份完整性
   - 备份位置：`F:\Business_plat\backups\`

2. **数据格式迁移** ⏰ 1-2小时 🔴
   - 🔄 执行迁移脚本 (`node scripts/migrate_doeeet_data_format.js`)
   - 修复 `doeeet_tasks` 数据格式
   - 验证迁移结果

3. **后端API验证** ⏰ 30分钟 🔴
   - 测试迁移后的API响应
   - 验证数据完整性
   - 检查前端兼容性

#### P1 - 短期实施（功能开发）
4. **启动前端服务并验证数据流** ⏰ 1小时
   - 启动前端开发服务器 (`npm start`)
   - 测试ComponentSearch页面真实搜索
   - 验证180万组件数据展示
   - 检查分页、排序功能

5. **实现组件详情弹窗** ⏰ 2-3小时
   - 调用 `/api/doeeet/components/:id/parameters`
   - 展示技术参数表格
   - 显示参数定义翻译（中英文）

6. **参数对比功能开发** ⏰ 1-2天
   - 后端：创建 `ComparisonService.ts`
   - 后端：实现 `POST /api/doeeet/compare` API
   - 前端：组件多选功能 (Checkbox列)
   - 前端：对比抽屉UI
   - 前端：参数差异高亮

#### P2 - 中期实施
7. **分面搜索（Facets）** ⏰ 1天
   - 后端：搜索结果中添加聚合统计
   - 前端：分面筛选器UI组件
   - 动态更新可用选项数量

8. **Redis缓存集成** ⏰ 1-2天
   - 实现 `CacheService.ts`
   - 缓存搜索结果、分类树
   - 性能优化：目标从200ms降至10-20ms

### 📊 项目整体进度

| 阶段 | 状态 | 进度 | 说明 |
|------|------|------|------|
| 阶段一：数据导入 | ✅ 完成 | 100% | 1.8M组件 + 137M参数 |
| 阶段二：搜索API | ✅ 基本完成 | 95% | 10个端点已实现，分面搜索待补充 |
| 阶段三：前端开发 | 🔄 进行中 | 65% | ✅ 动态参数表头、✅ 分类筛选、✅ CSV导出 |
| 阶段四：测试部署 | ⏳ 待开始 | 0% | 预计11月下旬 |

**整体进度**: 80% ✅

**Phase 2.5 新增功能** (2025-10-31):
- ✅ 动态参数表头展示（智能表头 + HTML支持）
- ✅ 分类筛选器集成（级联选择 + 分类统计）
- ✅ CSV导出功能（包含动态参数）
- ✅ 工具函数库（8个核心函数）
- ✅ 完整文档（3份详细文档）

### 🔧 技术问题解决记录

#### 问题1: TypeScript编译错误
```
错误信息: 
Property 'userId' does not exist on type 'string | JwtPayload'

解决方案:
const decoded = jwt.verify(token, process.env.JWT_SECRET!) as JwtPayload;

位置: backend/src/middleware/authMiddleware.ts:19
```

#### 问题2: DoEEEt数据格式特殊性
```python
# family_path 是Python列表字符串
"['Peripheral-Controller', 'Digital', 'Microcircuits']"

# 需要替换单引号为双引号后JSON.parse
JSON.parse(comp.family_path.replace(/'/g, '"'))
```

### 📈 关键指标

| 指标 | 当前状态 | 目标 | 完成度 |
|------|---------|------|--------|
| 后端服务 | ✅ 运行中 (端口3001, MongoDB 8.2.1) | 稳定运行 | 100% |
| 数据导入 | ✅ 1.8M组件 | 完成 | 100% |
| 数据备份 | 🔄 脚本已完善 | 备份完成 | 80% |
| 数据迁移 | 🔄 脚本已创建 | 迁移完成 | 50% |
| 搜索API | ✅ 10个端点 | 完成 | 100% |
| 动态参数表头 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| 分类筛选器 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| CSV导出 | ✅ 已实现 | 完成 | 100% ⭐ |
| 搜索性能 | ⚠️ 200ms | <50ms | 需Redis优化 |
| 前端数据打通 | ⚠️ 1/12页面 | 全部接入 | 8% |
| 参数对比 | ❌ 未实现 | 已实现 | 0% |
| 分面搜索 | ❌ 未实现 | 已实现 | 0% |

## 更新日志

### 2025-11-12 (v2.4.1) 🔄
- ✅ **组件对比体验优化**：过滤掉参数名称为 `Unknown` 或空白的对比行，减少噪声信息
- ✅ **参数标题完善**：对比矩阵优先展示首个有效参数名，缺失时统一显示“未命名参数”，保证列标题一致
- 📁 **影响文件**：`frontend/src/components/ComponentCompareModal.tsx`

### 2025-11-01 (v2.4) 🔍
- ✅ **对比分析完成**: 完成与 DOEEET 原始网站的深入对比分析
- ✅ **改进思路文档**: 
  - 5个核心功能模块的对比分析（分类浏览、筛选面板、筛选器、结果展示、搜索整合）
  - 详细的改进思路和实施优先级建议
  - 技术实现要点总结
- ✅ **文档更新**: 
  - [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 添加对比分析与改进思路章节
  - [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 添加对比分析与改进思路章节
- 📋 **实施计划**: 
  - Phase 1: 核心布局改造（高优先级）
  - Phase 2: 筛选功能增强（高优先级）
  - Phase 3: 用户体验优化（中优先级）
  - Phase 4: 高级功能（低优先级）

### 2025-10-31 (v2.3) 🆕⭐
- ✅ **Phase 2.5 完成**: 动态参数表头功能全面上线
- ✅ **动态参数表头展示**: 
  - 智能表头（short_name + Tooltip）
  - HTML标签支持（`<sub>`, `<sup>`）
  - DOMPurify安全清理
  - 参数列可排序、可筛选
- ✅ **分类筛选器集成**: 
  - CategoryFilter组件集成到ComponentSearch
  - 级联选择器展示 2-5 层分类
  - Tab导航显示15个顶层分类
  - 分类统计数据分析完成（1.8M组件）
- ✅ **CSV导出功能**: 
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码支持中文
  - 自动文件名（带时间戳）
- ✅ **工具函数库**: `parameterUtils.tsx` (8个核心函数)
- ✅ **文档完善**: 
  - [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
  - [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
  - [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)
  - [DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)
  - [DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)
- 📝 **项目进度更新**: 阶段三从45%提升至65%，整体进度80%
- 📊 **数据分析**: 完成 family_path 结构分析（14个顶层分类，181个叶子分类）

### 2025-10-30 (v2.2)
- ✅ **数据库备份脚本完善**: 支持 MongoDB 8.2.1，强制使用 mongosh
- ✅ **数据迁移脚本创建**: `migrate_doeeet_data_format.js`，修复数据格式
- 🔄 **优先级调整**: 数据备份与迁移（P0）→ 前端验证 → 参数对比 → 分面搜索
- 📝 **项目进度更新**: 阶段三从40%提升至45%，整体进度72%
- 📝 **技术债务**: MongoDB 8.x 与 mongodump 100.x 兼容性问题已解决

### 2024-10-30 下午 (v2.1)
- ✅ **后端编译问题修复**: jsonwebtoken类型断言
- ✅ **后端服务启动**: 端口3001，MongoDB+Redis正常
- ✅ **ComponentSearch接入API**: 数据适配器实现完成
- 📝 **优先级调整**: 前端数据流验证 → 参数对比 → 分面搜索 → Redis缓存
- 📝 **项目进度更新**: 阶段三从30%提升至40%，整体进度70%

### 2024-10-30 上午
- ✅ 完成Phase 1.1: 前端组件搜索页面集成
- ✅ 完成Phase 1.2: 组件详情弹窗
- ✅ 完成Phase 1.3: 首页分类统计
- ✅ 完成Phase 2.1-2.3: 参数范围筛选
- ✅ 完成Phase 2.5: 参数对比功能（计划中）

## 下一步计划

### 本周内 (10月31日 - 11月3日)
1. ✅ ~~后端服务启动并验证~~
2. ✅ ~~ComponentSearch API集成~~
3. ✅ ~~数据库备份脚本完善~~
4. ✅ ~~动态参数表头实现~~ ⭐
5. ✅ ~~分类筛选器集成~~ ⭐
6. ✅ ~~CSV导出功能~~ ⭐
7. ✅ ~~family_path数据分析~~ ⭐
8. 🔄 **前端服务启动并测试** (当前任务)
9. 🔄 真机测试动态参数表头
10. 🔄 性能测试和优化

### 下周 (11月4日 - 11月10日)
1. 🔄 执行数据库备份（如需要）
2. 🔄 执行数据格式迁移（如需要）
3. ⏳ 参数列配置保存（显示/隐藏、拖拽排序）
4. ⏳ 参数对比功能开发
5. ⏳ 分面搜索实现
6. ⏳ Redis缓存性能优化

### 中期计划 (11月中下旬)
1. 其他11个搜索页面迁移
2. 全面集成测试
3. 参数列的高级筛选
4. 参数统计图表展示
5. 移动端适配

### 长期计划
1. **Phase 3**: 数字模型关联和下载（按需实施）
2. **性能优化**: 进一步优化大数据量查询
3. **用户反馈**: 收集用户反馈并迭代改进
4. **文档完善**: API文档、用户手册等
5. **国际化支持**: 中英文切换

## 📚 相关文档索引

### Phase 2.5: 动态参数表头完整文档

#### 核心文档
1. **[DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)**
   - 核心功能总结
   - 技术实现详解
   - 数据统计和性能优化
   - 实施进度（75%完成）

2. **[DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)**
   - 集成到ComponentSearch的完整过程
   - 数据流和技术细节
   - 测试指南和已知问题
   - 状态：✅ 集成完成，待测试

3. **[动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)**
   - 数据结构详解
   - 展示逻辑和规则
   - 3种实现方案对比
   - HTML渲染和安全性

4. **[动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)**
   - 5分钟快速上手
   - API完整参考
   - 使用场景和示例
   - 常见问题解答

#### 数据分析文档
5. **[DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)**
   - 1.8M组件分类结构分析
   - 14个顶层分类统计
   - 路径长度分布（2-5层）
   - 前端筛选器设计建议
   - MongoDB聚合查询示例

#### 示例代码
6. **[parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)**
   - 8个核心工具函数
   - TypeScript类型定义
   - JSDoc完整注释

7. **[DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)**
   - 完整使用示例
   - 最佳实践演示

8. **[ComponentSearch.tsx](./frontend/src/pages/components/ComponentSearch.tsx)**
   - 实际集成代码
   - 生产环境实现

### 其他功能文档
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md)
- [DoEEEt-README.md](./DoEEEt-README.md)

---

## 🎯 Phase 2.5 核心成果总结

### ✅ 已完成功能（2025-10-31）

#### 1. 动态参数表头系统
- **智能表头展示**
  - 有 `short_name`: 显示简写 + Tooltip（完整名称）
  - 无 `short_name`: 直接显示完整名称
  - 覆盖率：80%参数有简写，20%仅有完整名称
  
- **HTML标签支持**
  - 支持 `<sub>`、`<sup>`、`<b>`、`<i>` 等标签
  - 示例：T<sub>STG</sub>、V<sub>CC</sub>、I<sub>O</sub>
  - DOMPurify安全清理，防XSS攻击
  
- **参数列功能**
  - 可排序（升序/降序）
  - 可筛选（输入框筛选）
  - 可自定义宽度
  - 超长省略（ellipsis）

### 2.6 表头渲染规范与固定参数取值方案 🆕

本节明确搜索结果与对比表中“动态参数表头”的展示规范，以及 Package 与 TOP（Operating Temperature）两项固定参数的取值来源与后端聚合方案，确保与 DOEEET 原站表现一致。

#### 展示规范
- 有 short_name 时：标题显示为“✖ short_name”，鼠标悬停显示完整 name（Tooltip）。
- 无 short_name 时：标题直接显示 name（不显示 Tooltip）。
- HTML 标签支持：允许 `<sub>` / `<sup>` 等（通过 DOMPurify 清理后安全渲染）。
- 空值显示：统一使用 “--” 代替 “Unknown”，长文本启用省略与悬停展示完整值。

示例：
```
✖ T_A [Max]        ← 列标题显示 short_name
(Access Time [Max]) ← 悬停 Tooltip 显示 name
```

#### 固定参数（Package 与 TOP）策略
- 固定两项，固定顺序展示在基础信息之后、动态参数之前：
  1) Package（parameter_key = `5df8d422-39bd-431f-9095-582a3f6f8fc1`）
  2) Operating Temperature（TOP，parameter_key = `2f2e7f5a-7cd0-47da-8feb-a29336285a3e`）
- 名称来源：`parameter_definitions`（通过 parameter_key 关联，获取 name 与 short_name）。
- 取值来源：`parameters`（按组件 component_id + parameter_key 获取具体值）。

#### 后端聚合与响应结构
为减少多次 IO 与确保顺序稳定，后端在详情与搜索结果适配时统一聚合输出三段数据：
1) static：来自 components/general 的静态字段（型号、制造商、质量等级、生命周期等）。
2) fixedExtras：仅包含 Package 与 TOP 两项（按上述固定顺序）。
3) dynamic：依据该器件 family_path 在 `meta.json` 匹配到的 `meta` 有序列表进行生成；即使某项无值也保留结构（值为 null/空字符串），方便前端一致渲染与列对齐。

接口响应示例（节选）：
```json
{
  "static": { "part_number": "CY7C432-80DMB", "manufacturer_name": "Teledyne e2v Inc", "...": "..." },
  "fixedExtras": [
    { "key": "5df8d422-39bd-431f-9095-582a3f6f8fc1", "name": "Package", "shortName": "Package", "value": "CDIP-28" },
    { "key": "2f2e7f5a-7cd0-47da-8feb-a29336285a3e", "name": "Operating Temperature Range", "shortName": "T<sub>OP</sub>", "value": "-55°C to +125°C" }
  ],
  "dynamic": [
    { "key": "24d759de-b13d-4aa4-af76-42e60d2302ec", "name": "Number of Contacts", "shortName": "#Contacts", "value": 20, "category": "Mechanical Data" }
  ]
}
```

实现要点：
- 批量取值：一次性读取该组件的所有 parameters 记录 → 构建 `Map<parameter_key,value>`；再批量查询 definitions → 构建 `Map<parameter_key,{name,short_name,category}>`。
- 固定参数优先：先拼装 fixedExtras（Package、TOP），再按 meta.json 的 `meta` 顺序生成 dynamic。
- 缓存优化：`meta.json` 常驻内存或 Redis（TTL 建议 ≥ 1h）；definitions 也可缓存；组件详情可短期缓存 30m。
- 兼容性：提供查询参数 `includeEmpty=false` 以允许前端在需要时隐藏无值项（默认保留结构）。

### ⛳ 横向参数表模式（Beta）实施方案（静态+动态“一行展示”）

为对齐 DOEEET 的“每个器件一整行，左静态右动态”的交互，本期在搜索结果与详情弹窗中引入“横向参数表模式（Beta）”。核心是基于一套“列方案生成器”，将固定字段与动态参数列拼接为同一张宽表。

#### 一、列方案
- 静态列（固定）：
  - `partNumber`、`manufacturer`、`mainCategory/primaryCategory/secondaryCategory`（可视情况只留主类）、`package`、`TOP`
- 动态列（可变）：
  - 来源：接口返回的 `parameterDefinitions`（当前分类对应的候选参数定义）
  - 标题：优先 `short_name`，悬停显示完整 `name`；无 `short_name` 时直接显示 `name`
  - 取值：从每行数据的 `parameters[paramKey]` 读取

#### 二、数据整形
- 列表接口返回形如：
  - `entry.static`（静态字段）、`entry.fixedExtras`（Package/TOP）、`entry.dynamic[]`（若后端已返回动态值）
- 前端行对象构造：
  - `row.parameters = reduce(entry.dynamic, (acc, {key,value}) => (acc[key]=value, acc), {})`
  - `row.package/top` 优先取 `fixedExtras`；缺失时回退到 `static.part_type` 等

#### 三、渲染与交互
- 搜索结果表：
  - 列集合：`[静态列] + generateDynamicParameterColumns(parameterDefinitions)`
  - 冻结左侧关键列：`partNumber`、`manufacturer`
  - 横向滚动：`scroll.x` 启用，列宽自适应，超长 Tooltip
- 详情弹窗：
  - 以同一套列方案渲染一行数据（`dataSource=[selectedComponent]`），替换原三列“参数名称/值/分类”结构
  - 保留“基础信息”上方的 `Descriptions`，参数区切换为横向宽表

#### 四、性能策略
- 按当前页动态渲染可见列，启用列宽最小值与省略
- 后端尽量返回当前分类的 `parameterDefinitions`，避免首屏收集全库键集合
- 逐步演进：Beta 阶段只按 `parameterDefinitions` 生成列，不做“低频列阈值/列管理器”，后续再启用

#### 五、落地改动说明（已实施）
- 前端
  - `frontend/src/pages/components/ComponentSearch.tsx`
    - 列表：将搜索结果的 `entry.dynamic` 聚合为 `row.parameters`；并基于 `parameterDefinitions` 生成动态列，拼接到静态列后面
    - 详情：用“横向参数表（一行）”替换原三列表格，复用相同的动态列生成器
  - `frontend/src/utils/parameterUtils.tsx`
    - 复用 `generateParameterColumnTitle` 与 `generateDynamicParameterColumns`，标题规则与 Tooltip 保持与前述规范一致
- 兼容性
  - 若后端暂未返回 `entry.dynamic`，动态列仍会渲染但显示为 “-”，不影响页面可用性

#### 六、下一步（可选增强）
- 列管理器（显示/隐藏、拖拽排序、持久化）
- 参数值标准化与单位合并（如温度、电压范围格式）
- 虚拟化渲染以优化超宽表性能（>150 列）
#### 2. 分类筛选系统
- **数据分析完成**
  - 14个顶层分类（Resistors占45.88%，Capacitors占27.99%）
  - 181个叶子分类
  - 路径深度2-5层（86.86%为2层）
  - 1.8M组件100%有分类路径
  
- **UI组件集成**
  - CategoryFilter级联选择器
  - Tab导航（15个顶层分类）
  - 分类统计数量显示
  - 选择联动搜索

#### 3. 数据导出系统
- **CSV导出**
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码（支持Excel打开中文）
  - 自动文件名（带时间戳）
  - 1000行 < 1s（预期性能）

#### 4. 工具函数库
**8个核心函数** (`parameterUtils.tsx`):
```typescript
1. generateParameterColumnTitle()      // 生成智能表头
2. generateDynamicParameterColumns()   // 批量生成动态列
3. generateGroupedParameterColumns()   // 生成分组列
4. exportParametersToCSV()             // 导出CSV
5. downloadCSV()                       // 下载CSV文件
6. groupParametersByCategory()         // 按分类分组参数
7. formatParameterValue()              // 格式化参数值
8. extractParameterKeys()              // 提取参数键列表
```

### 📊 数据统计

| 项目 | 数量 | 说明 |
|------|------|------|
| 组件总数 | 1,797,417 | 有分类路径的组件 |
| 参数定义 | 360个 | 唯一参数键 |
| 有简写参数 | ~288个 (80%) | 有 short_name |
| 无简写参数 | ~72个 (20%) | 仅有 name |
| 顶层分类 | 14个 | Resistors, Capacitors等 |
| 叶子分类 | 181个 | 最细分类 |
| 文档数量 | 8份 | 完整技术文档 |
| 代码文件 | 3个 | 工具函数+示例+集成 |

### 🎨 UI效果预览

```
┌─────────────────────────────────────────────────────────────┐
│                  DoEEEt 器件搜索系统                         │
├─────────────────────────────────────────────────────────────┤
│ [分类筛选] ▼                                                 │
│   > Resistors (824,599)  > Capacitors (503,149)             │
│   > Connectors (160,090) > Crystals (131,524) ...          │
├─────────────────────────────────────────────────────────────┤
│ 型号: [_____] 制造商: [_____]  [搜索] [重置] [导出CSV]     │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────┬────────ⓘ┬──────ⓘ┬────────ⓘ┐           │
│ │ 器件型号 │ 制造 │  #Pins  │ T_STG  │  V_CC   │ ...       │
│ │         │ 商   │         │        │         │           │
│ ├─────────┼──────┼─────────┼────────┼─────────┤           │
│ │ 860300  │ SIB  │ 68      │-55~150°│ 3.3~5V  │ ...       │
│ │ 860301  │ SIB  │ 72      │-40~125°│ 5V      │ ...       │
│ └─────────┴──────┴─────────┴────────┴─────────┘           │
│                                                             │
│ 💡 提示：鼠标悬停在 #Pins, T_STG 等列上查看完整参数名      │
└─────────────────────────────────────────────────────────────┘
```

### 🚀 技术亮点

1. **类型安全**: 完整的TypeScript类型定义
2. **代码复用**: 8个通用工具函数，可在多页面复用
3. **性能优化**: 动态列宽、虚拟滚动支持
4. **安全性**: DOMPurify防XSS攻击
5. **可维护性**: JSDoc注释 + 详细文档
6. **用户体验**: Tooltip、省略、排序、筛选

### 📈 项目影响

- **开发效率提升**: 工具函数库减少50%重复代码
- **用户体验提升**: 智能表头 + 分类筛选，降低学习成本
- **维护成本降低**: 完整文档 + 类型定义，便于后期维护
- **可扩展性强**: 支持任意数量的动态参数，支持多级分类

---

## 联系方式

如有问题或建议，请联系开发团队。

**最后更新**: 2025-11-01  
**版本**: v2.4  
**整体进度**: 80% ✅


### 2025-11-11 (v2.4.1) 🛠️
- ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
  - `GET /api/doeeet/components/:id`（组件详情弹窗）
  - `GET /api/doeeet/categories/tree`（分类筛选器）
- ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
- ✅ Linter 检查通过（无新增告警）
- 影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
  - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`

#### 接下来建议
- P0：抽象统一的前端请求层（含超时、错误映射、重试/熔断开关），替换页面内分散实现
- P1：为 `POST /api/doeeet/components/compare` 套同样的超时/错误策略
- P1：后端 Faceting 与缓存（按既定里程碑 B），完善筛选器可用项和计数

### 2025-11-19 (v2.4.2) ⚙️
- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
- 🔄 下一步：在 README 或启动脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 数据目录
- ✅ 辐照测试数据导入：在 `space_env` 虚拟环境内依次执行
  1. Dry-run：`python backend\scripts\import_irradiation_excel.py --dry-run` → 成功解析 `Sheet1` 的 1,921 行数据但不写库
  2. 正式导入：`python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- ✅ 导入结果：`business_plat.irradiation_tests` 集合被清空并写入 1,921 条记录，对应最新 Excel 数据；脚本会在导入后回显 sheet 名称与写入数量
- 📋 验证建议：
  - `mongosh` 中执行 `db.irradiation_tests.countDocuments()`/`findOne()` 抽样字段映射
  - 如需长期查询性能，可视参数模式补充 `component_id`、`test_type` 等索引

```

## Summary
- 在 `DoEEEt功能开发总览.md` 新增“2025-11-19（辐照测试数据）”更新，概述脚本命令、导入行数与后续抽样校验建议，便于快速了解数据状态。  
```174:177:DoEEEt功能开发总览.md
### 🆕 2025-11-19 更新（辐照测试数据）
- 通过 `backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing` 完成最新 Excel 数据导入，写入 `business_plat.irradiation_tests`
- 本次导入覆盖 1,921 行记录，脚本 dry-run 与正式导入均成功执行，确保集合内容为最新
- 建议在 MongoDB 中使用 `db.irradiation_tests.findOne()`/抽样统计确认字段映射及索引需求
```

- 在 `DoEEEt集成实施总结.md` 的 v2.4.2 更新中补充完整执行流程：dry-run 校验、正式导入、结果回显与验证/索引建议，形成可复用的操作记录。  
```1368:1379:DoEEEt集成实施总结.md
### 2025-11-19 (v2.4.2) ⚙️
- ✅ 辐照测试数据导入：在 `space_env` 虚拟环境内依次执行
  1. Dry-run：`python backend\scripts\import_irradiation_excel.py --dry-run` → 成功解析 `Sheet1` 的 1,921 行数据但不写库
  2. 正式导入：`python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- ✅ 导入结果：`business_plat.irradiation_tests` 集合被清空并写入 1,921 条记录，对应最新 Excel 数据；脚本会在导入后回显 sheet 名称与写入数量
- 📋 验证建议：
  - `mongosh` 中执行 `db.irradiation_tests.countDocuments()`/`findOne()` 抽样字段映射
  - 如需长期查询性能，可视参数模式补充 `component_id`、`test_type` 等索引
```

## Next Steps
- 依据总结文案中的建议，抽查 `irradiation_tests` 集合并视查询模式补建索引；如需固化操作流程，可把命令片段同步到 `README` 或脚本输出中。

```plaintext
### 🆕 2025-11-19 更新（辐照测试数据）
- 通过 `backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing` 完成最新 Excel 数据导入，写入 `business_plat.irradiation_tests`
- 本次导入覆盖 1,921 行记录，脚本 dry-run 与正式导入均成功执行，确保集合内容为最新
- 建议在 MongoDB 中使用 `db.irradiation_tests.findOne()`/抽样统计确认字段映射及索引需求
```

```plaintext
### 2025-11-19 (v2.4.2) ⚙️
- ✅ 辐照测试数据导入：在 `space_env` 虚拟环境内依次执行
  1. Dry-run：`python backend\scripts\import_irradiation_excel.py --dry-run` → 成功解析 `Sheet1` 的 1,921 行数据但不写库
  2. 正式导入：`python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- ✅ 导入结果：`business_plat.irradiation_tests` 集合被清空并写入 1,921 条记录，对应最新 Excel 数据；脚本会在导入后回显 sheet 名称与写入数量
- 📋 验证建议：
  - `mongosh` 中执行 `db.irradiation_tests.countDocuments()`/`findOne()` 抽样字段映射
  - 如需长期查询性能，可视参数模式补充 `component_id`、`test_type` 等索引
```

---

**User**

好的，接下按照辐照数据模块思路实现吧，读取数据库中的irradiation_tests集合中的数据
辐照数据模块思路
现状复核 ComponentSearch.tsx/HomePage.tsx：确认“器件查询”导航如何组织 tab、下拉、路由，梳理现有子模块（智能搜索、器件比对、供应商检索、在线选用）的接入方式（路由 or 组件展示），确定新增模块的挂载点以及复用的 UI 组件/状态管理。
数据接入：使用后台或前端读取 F:\Business_plat\通用器件辐照数据.xlsx。优先在后端加解析逻辑（例如新增 service/controller 接收上传或预置数据）。若 Excel 不频繁变化，可使用脚本将其转为 JSON 并放入 data/，由 DoeeetSearchService 暴露 API；若需实时读取，则在后端使用 xlsx/exceljs 解析并缓存。
API 设计：新增 /api/radiation-data（分页、筛选参数），返回字段与表头一致（序号、产品类别、细类、名称、型号规格、封装形式、总剂量、单粒子、位移、抗静电能量、质量等级、通用/详细规范编号、供应商名称、备注）。考虑排序、模糊查询（型号/供应商）及指标过滤（例如按总剂量范围）。
前端模块：在 “器件查询” 下新增标签项“辐照数据”。创建独立页面/组件（例如 RadiationDataTable.tsx），包含：表格渲染（参照截图样式）、搜索筛选（按型号/供应商/等级等）、分页。若使用 antd，利用 Table + Form；如果为自研 UI，则遵循现有组件风格。
状态与交互：使用现有查询模块的状态管理方案（Redux/Context/局部 state），统一 loading、错误提示、空状态。若需要导出 Excel/CSV，可沿用已有导出工具。
权限与导航：更新 HomePage 或导航配置，确保菜单和路由同步；若需要登录权限控制，复用 Login/Auth 逻辑。
数据更新流程：定义 Excel → 系统的更新机制（手动脚本、后台上传、CI 导入），并记录文档，避免手工拷贝错误。

---

**Cursor**

## 实施方案概览
- **挂载点梳理**：`Layout.tsx` 中 “器件查询” 子菜单指向 `/components/search|compare|suppliers|selection`，`ComponentSearch.tsx` 是主入口但没有内置 Tabs；因此辐照数据模块将追加一个并列路由（如 `/components/radiation-data`），在 `Layout` 菜单与 `HomePage` 卡片点击逻辑里补充该入口即可确保导航一致。
- **数据来源策略**：`backend/scripts/import_irradiation_excel.py` 已把 `通用器件辐照数据.xlsx` 写入 `business_plat.irradiation_tests`，字段映射清晰（序号/产品类别...备注）。后端直接连 MongoDB 读该集合即可，保持 Excel→脚本→Mongo 的更新链路，若后续需直接解析 Excel，可在同一 service 中扩展文件读取模式。

## 后端实现计划
- **模型定义**：新增 `backend/src/models/IrradiationTest.ts`（复用 mongoose），字段覆盖脚本里 15 个业务列 + `created_at`、`_source`。索引建议：`model`、`supplier`、`quality_grade`、`category` 组合支持模糊/筛选；`created_at` 便于按更新时间排序。
- **Service / Repository**：创建 `backend/src/services/RadiationDataService.ts`，职责：
  - 组装查询条件（关键字模糊搜 `model|model_spec|supplier`，下拉筛选 `category/subcategory/quality_grade`，范围筛选例如 `total_dose` 若为数字可解析上下限）。
  - 做统一分页排序（默认 `model` 升序，可传 `sortField+sortOrder`）。
  - 适度缓存（可沿用 `CacheService`，key = query hash，TTL 5 min），以免表格翻页频繁命中 Mongo。
- **Controller & Route**：
  - `backend/src/controllers/radiationDataController.ts` 暴露 `listRadiationData`。
  - `backend/src/routes/radiationDataRoutes.ts` 注册 `GET /api/radiation-data`（query: `page`, `limit`, `keyword`, `category`, `qualityGrade`, `supplier`, `sortField`, `sortOrder` 等）。
  - 在 `backend/src/index.ts` 挂载 `app.use('/api/radiation-data', radiationDataRoutes);` 并在 `API_MODULES_SUMMARY.md`、`API_QUICK_REFERENCE.md` 补文档。
- **DTO & 校验**：在 `backend/src/types/index.ts` 添加 `IrradiationTest` 接口；控制器使用 `express-validator`（若已有）或自定义校验保证分页/排序参数合法。
- **测试与脚本**：新增 `backend/tests/radiationData.test.ts`（可仿 `testRoutes`），覆盖分页、筛选、空状态。维护脚本 `import_irradiation_excel.py` 文档，写入 README（如何在数据更新后触发缓存失效）。

## 前端实现计划
- **路由与导航**：
  - 在 `App.tsx` 中添加 `<Route path="components/radiation-data" element={<RadiationDataPage />} />`。
  - `Layout.tsx` 与 `HomePage.tsx` 的 “器件查询”模块列表加入 “辐照数据” 项指向新路由，保持入口一致。
- **服务层**：
  - `frontend/src/services/api.ts` 或新建 `radiationDataService.ts`，封装 `fetchRadiationData(params)`，集中处理 querystring、错误映射，沿用 `httpClient`.
- **UI 组件**：
  - 新建 `frontend/src/pages/components/RadiationDataPage.tsx`，结构建议：
    - 顶部描述卡片（说明数据来源/更新时间，引用 `DoEEEt功能开发总览` 内的信息）。
    - `Form`（关键词输入 + Select：产品类别/质量等级/供应商 + 可能的剂量范围输入）。
    - `Table`（列与 Excel 表头保持一致；为长文本列设置 `ellipsis`、`Tooltip`）。
    - 分页控件使用 `Table` 自带 pagination，受控 `current/pageSize/total`。
    - 统一状态：`loading`、`error`（`Alert`）、空数据（`Empty`）。错误处理复用 `httpClient` 的 message 提示。
  - 可选：添加 `Button` 导出 CSV（沿用 `utils/parameterUtils` 的 `downloadCSV` 思路，字段直接来自响应）。
- **状态管理**：页面局部 `useState` 即可，如需跨页共享查询条件，可借鉴 `ComponentSearch` 的 `useSearchParams`，把筛选同步到 URL 方便分享。
- **权限/鉴权**：页面受 `ProtectedRoute` 保护；若需细粒度权限，可在 `Layout` menu 渲染时根据角色判断是否展示。
- **样式**：复用 `ComponentSearch` 的 `Card`/`Row`/`Col` 组合；若有现成的 Table 样式组件，可抽离到 `components/RadiationDataTable.tsx`。

## 数据更新与运维
- 维持 `space_env` 脚本→Mongo 的导入流程；完成导入后运行一个 `curl -X POST /api/cache/purge?scope=radiation-data`（若实现缓存）以确保前端看到新数据。
- 在 `DoEEEt功能开发总览.md` / README 中补“辐照数据模块：数据更新步骤”章节，记录 dry-run、正式导入及 API 缓存失效命令。
- 未来若需在线上传 Excel，可在后台添加上传接口，沿用 `import_irradiation_excel.py` 的 `COLUMN_CONFIGS` 做字段校验。

## 下一步
- 若以上方案无异议，下一步将按顺序落地：先实现后端模型+API（含测试），再开发前端页面并串联导航，最后补文档与导入流程说明。请确认是否需要额外功能（如导出/图表展示）或特定筛选项，以便在编码阶段一并考虑。

---

**User**

把概览更新在@DoEEEt功能开发总览.md 中，把详细方案更新在@DoEEEt集成实施总结.md 中，更新完咱们再开始

---

**Cursor**

```markdown
 DoEEEt 功能开发总览

## 📋 项目概述

DoEEEt（Defense & Aerospace Electronic Equipment Database）是一个专门用于航空航天电子器件的数据库系统，包含了15个顶层分类、181个叶子分类、360个动态参数的完整电子元器件数据。

本文档总览了 DoEEEt 功能的开发进度和实施计划。

---

## 🎯 核心功能模块

### 1. ✅ 分类筛选功能（已完成 100%）

**功能描述**：
- 15个顶层分类展示（Microcircuits, Capacitors, Connectors 等）
- 2-5层深度的分类层级导航
- 双重交互方式：级联选择器 + Tab侧边栏

**技术实现**：
- 后端：`buildCategoryTree()` 服务 + Redis缓存
- 前端：`CategoryFilter` 组件（Cascader + Tabs）
- API：`/api/doeeet/categories/tree`

**文档**：
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md)
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md)

**状态**: ✅ 已完成（2025-10-31）

---

### 2. ✅ 动态参数表头（已完成 100%）

**功能描述**：
- 智能表头展示（有 `short_name` 显示简写 + Tooltip，无则显示完整名称）
- HTML标签支持（下标 `<sub>`、上标 `<sup>`）
- 360个动态参数的灵活展示

**技术实现**：
- 工具函数库：`parameterUtils.tsx`
- 8个核心函数：生成列、分组、导出CSV等
- 安全防护：DOMPurify清理HTML

**文档**：
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)

**示例代码**：
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

**状态**: ✅ 已集成到 `ComponentSearch` 页面（2025-10-31）

#### 🆕 表头与固定参数规范（概述）
- 表头规则：有 `short_name` → 显示“✖ short_name”且 Hover 显示完整 `name`；无 `short_name` → 直接显示 `name`。
- 固定参数：`Package` 与 `TOP (Operating Temperature)` 固定两列、固定顺序展示；名称从 `parameter_definitions`，取值从 `parameters`（按 `component_id + parameter_key`）。
- 聚合输出：后端统一返回 `static`（基础信息）、`fixedExtras`（Package/TOP）、`dynamic`（按 `meta.json` 顺序），空值用 “--”。

---

### 3. ⏳ 组件搜索功能（进行中 40%）

**功能描述**：
- 关键词搜索（器件型号、制造商）
- 分类筛选（集成 CategoryFilter）
- 参数范围筛选（电压、温度等）
- 分页、排序、导出

**待实施任务**：
- [x] 集成 CategoryFilter 到 ComponentSearch 页面
- [x] 集成动态参数表头到搜索结果
- [ ] 实现参数范围筛选
- [ ] 优化搜索性能

**状态**: ⏳ 进行中

---

### 4. ⏳ 动态参数筛选器（计划中 0%）

**功能描述**：
- 根据选择的分类，动态显示该分类的参数筛选器
- 支持范围筛选（数值型参数）
- 支持枚举筛选（离散值参数）

**实现思路**：
```tsx
// 监听分类变化
useEffect(() => {
  if (selectedCategory.length > 0) {
    loadDynamicParameters(selectedCategory);
  }
}, [selectedCategory]);

// 加载该分类的参数配置
const loadDynamicParameters = async (categoryPath: string[]) => {
  const response = await fetch(`/api/doeeet/category-meta/${encodeURIComponent(JSON.stringify(categoryPath))}`);
  const result = await response.json();
  setDynamicParams(result.data.meta);
};

// 渲染动态筛选器
<DynamicParameterFilter
  parameters={dynamicParams}
  onParameterChange={handleParameterChange}
/>
```

**状态**: ⏳ 计划中

---

### 5. ⏳ 组件详情页（计划中 20%）

**功能描述**：
- 基本信息展示（型号、制造商、封装等）
- 参数列表（分类展示）
- 数据表文档（Datasheet）
- 供应商信息
- 辐照测试数据

**待实施任务**：
- [ ] 完善参数详情展示（使用 parameterUtils）
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据展示
- [ ] 实现替代品推荐

**状态**: ⏳ 计划中

---

## 📊 开发进度总览

| 功能模块 | 进度 | 状态 | 预计完成时间 |
|---------|------|------|-------------|
| 分类筛选功能 | 100% | ✅ 完成 | 2025-10-31 |
| 动态参数表头 | 75% | ✅ 核心完成 | 2025-11-01 |
| 组件搜索功能 | 40% | ⏳ 进行中 | 2025-11-03 |
| 动态参数筛选器 | 0% | ⏳ 计划中 | 2025-11-05 |
| 组件详情页 | 20% | ⏳ 计划中 | 2025-11-07 |
| 组件对比功能 | 0% | 📋 待规划 | TBD |
| 替代品推荐 | 0% | 📋 待规划 | TBD |
| 批量导入/导出 | 0% | 📋 待规划 | TBD |
| 辐照数据模块 | 0% | 📋 待规划 | TBD |

**整体进度**: 47%

---

## 🏗️ 技术架构

### 🆕 2025-11-11 更新（稳定性）
- 已为前端两处关键数据加载增加统一超时与错误处理（15s）：
  - 组件详情：`GET /api/doeeet/components/:id`
  - 分类树：`GET /api/doeeet/categories/tree`（失败不再使用静态回退，避免误导）
- Linter 全量通过；影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx`（详情弹窗数据加载）
  - `frontend/src/components/CategoryFilter.tsx`（分类树加载）

### 🆕 2025-11-12 更新（对比体验）
- 组件对比表过滤掉参数名称为 `Unknown` 或空白的行，避免无意义参数占位
- 对比表参数标题优先展示首个有效参数名；若缺失则显示“未命名参数”，保持列标题一致性
- 影响文件：
  - `frontend/src/components/ComponentCompareModal.tsx`

### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放

### 🆕 2025-11-19 更新（辐照测试数据）
- 通过 `backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing` 完成最新 Excel 数据导入，写入 `business_plat.irradiation_tests`
- 本次导入覆盖 1,921 行记录，脚本 dry-run 与正式导入均成功执行，确保集合内容为最新
- 建议在 MongoDB 中使用 `db.irradiation_tests.findOne()`/抽样统计确认字段映射及索引需求
- 🔄 新需求：新增“辐照数据”模块（器件查询 → 辐照数据）用于展示该集合内容，需后端 API + 前端页面联动


### 前端技术栈
```
React 18.2
├── TypeScript 4.9
├── Ant Design 5.12
├── Vite 4.5
└── React Router 6.20
```

### 前后端对齐计划（2025-11-10）
- 接口契约与字段命名统一
  - 后端输出统一字段：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`（"Yes"|"No"）
  - 详情/搜索/对比接口字段保持一致，前端避免额外适配层
- 查询参数规范与校验
  - 支持并校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
  - `familyPath` 传入 JSON 数组字符串（如 `["Resistors","Film"]`）
- 响应结构与分页
  - 统一 `{ success, data, error }`
  - 列表附带 `{ total, totalPages, page, limit, hasNextPage }`
- 性能与稳定性
  - 索引：`component_id`、`manufacturer_name`、`family_path`、`has_stock`、全文索引
  - 缓存：列表短缓存（30–120s），详情缓存（5–15m）
  - 速率限制与慢查询日志
- 前端改造
  - 建立统一 API SDK（TS 类型、统一错误处理）
  - 搜索/筛选状态与 URL 同步
  - 列表虚拟化、加载/空态/错误态与重试

### 里程碑（A-D）
- 里程碑 A（页面与布局）
  - `CategoryBrowsePage`、面包屑、左侧筛选 + 右侧结果布局
- 里程碑 B（筛选与数据）
  - Faceting 聚合（制造商/质量/库存/分类）+ 缓存
  - `FilterPanel`：折叠、Stacked/Scroll、显示计数、已选条件 chips、动态加载
- 里程碑 C（结果与表格）
  - 将动态参数表头全面接入结果表格，优化横向滚动/虚拟化
  - 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - 单位转换（pF ↔ µF/mF/F）与筛选器联动
  - 分类内局部搜索提示与命中高亮

### 后端技术栈
```
Node.js 18+
├── Express 4.x
├── TypeScript 4.9
├── MongoDB 6.x (数据库: business_plat)
├── Redis 7.x
└── meta.json（分类配置源）
```

### 数据流架构
```
meta.json 
  ↓ (读取)
DoeeetSearchService.buildCategoryTree()
  ↓ (构建树 + 缓存)
Redis (TTL: 1小时)
  ↓ (API)
/api/doeeet/categories/tree
  ↓ (HTTP)
前端组件 (CategoryFilter, DynamicParameterTable, etc.)
  ↓ (用户交互)
搜索 / 筛选 / 详情查看
```

---

## 📁 项目文件结构

```
Business_plat/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── DoeeetComponent.ts           # DoEEEt组件模型
│   │   │   └── ...
│   │   ├── services/
│   │   │   ├── DoeeetSearchService.ts       # 搜索服务（含分类树构建）
│   │   │   └── CacheService.ts              # Redis缓存服务
│   │   ├── controllers/
│   │   │   └── doeeetComponentController.ts # 控制器
│   │   └── routes/
│   │       └── doeeetRoutes.ts              # 路由配置
│   └── data/
│       └── meta.json                        # 分类配置源文件
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   └── CategoryFilter.tsx           # 分类筛选组件
│   │   ├── utils/
│   │   │   └── parameterUtils.tsx           # 动态参数工具函数
│   │   ├── examples/
│   │   │   └── DynamicParameterTableExample.tsx  # 示例代码
│   │   └── pages/
│   │       └── components/
│   │           └── ComponentSearch.tsx      # 搜索页面
│   └── docs/
│       ├── CategoryFilter使用说明.md
│       ├── 动态参数表头展示说明.md
│       └── 动态参数表头-快速开始.md
│
└── [根目录文档]
    ├── DoEEEt集成实施总结.md
    ├── DoEEEt项目开发计划.md
    ├── 前端分类筛选功能实施方案.md
    ├── 前端分类筛选-快速开始.md
    ├── DoEEEt动态参数表头实施总结.md
    └── DoEEEt功能开发总览.md (本文档)
```

---

## 🚀 快速开始

### 1. 启动 MongoDB 数据库

**Windows 系统**:
```bash
cd backend
.\start-mongodb-local.bat
```

**说明**:
- 脚本会自动检查 MongoDB 是否已安装
- 如果检测到 Windows 服务 `MongoDB` 正在运行，会尝试自动停止（默认服务数据目录: `E:\data\db`，项目数据目录: `F:\Business_plat\backend\data`）
- 停止 Windows 服务需要以管理员身份运行终端；若停止失败请手动执行 `net stop MongoDB`
- 自动停止服务并释放端口后再启动本地实例，避免读写到错误的数据目录
- 脚本会自动创建数据目录和日志目录（如果不存在）
- 数据目录: `backend/data`
- 日志文件: `backend/logs/mongod.log`
- 配置文件: `backend/mongod.conf`

**启动步骤**:
1. 打开 PowerShell 或命令提示符
2. 切换到 `backend` 目录: `cd backend`
3. 运行启动脚本: `.\start-mongodb-local.bat`
4. 脚本会自动检查环境并启动 MongoDB
5. 如果 MongoDB 已安装，会看到 "✅ MongoDB 启动成功！" 提示

**验证 MongoDB 是否运行**:
```bash
# 使用 mongosh 连接
mongosh mongodb://127.0.0.1:27017

# 或检查端口
netstat -an | findstr ":27017"

# 或访问健康检查（需要后端服务运行）
curl http://localhost:3001/health
```

**数据库配置**:
- 数据库名称: `business_plat`
- 连接地址: `mongodb://localhost:27017/business_plat`
- 集合名称: `components` (包含所有 DoEEEt 组件数据)
- 默认端口: `27017`

**注意事项**:
- 确保 MongoDB 已安装并添加到 PATH 环境变量
- MongoDB 安装路径通常是: `C:\Program Files\MongoDB\Server\8.2\bin`
- 如果启动失败，请检查日志文件: `backend/logs/mongod.log`
- 启动脚本会在当前窗口运行 MongoDB，关闭窗口会停止服务

---

### 2. 启动后端服务

```bash
cd backend
npm install

# 确保 .env 文件配置正确
# MONGODB_URI=mongodb://localhost:27017/business_plat

npm run dev
```

**启动成功标志**:
- ✅ MongoDB 连接成功
- ✅ Redis 连接成功
- ✅ 服务器启动成功，端口: 3001
- ✅ 数据自动保存机制已启动（间隔: 30秒）

**服务地址**:
- API 地址: `http://localhost:3001`
- 健康检查: `http://localhost:3001/health`

**验证服务是否运行**:
```bash
# 测试分类树 API
curl http://localhost:3001/api/doeeet/categories/tree

# 或访问健康检查端点
curl http://localhost:3001/health
```

---

### 3. 启动前端服务

```bash
cd frontend
npm install

# 安装可选依赖（用于HTML清理）
npm install dompurify @types/dompurify

npm run dev
```

**访问**: http://localhost:3000

---

### 4. 使用分类筛选

```tsx
import CategoryFilter from '@/components/CategoryFilter';

<CategoryFilter 
  onCategoryChange={(path) => console.log('选择的分类:', path)}
  selectedCategory={[]}
/>
```

---

### 5. 使用动态参数表头

```tsx
import { generateDynamicParameterColumns } from '@/utils/parameterUtils';

const dynamicColumns = generateDynamicParameterColumns(
  parameterDefinitions,
  { sortable: true }
);
```

---

## 📚 文档索引

### 核心文档

#### 分类筛选相关
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md) - 完整实施方案
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md) - 组件API文档
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md) - 5分钟上手

#### 动态参数表头相关
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md) - 实施总结
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md) - 详细文档
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md) - 快速上手

#### 总体文档
- [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 整体集成总结
- [DoEEEt项目开发计划.md](./DoEEEt项目开发计划.md) - 项目计划
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 本文档

### 示例代码
- [CategoryFilter.tsx](./frontend/src/components/CategoryFilter.tsx)
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

---

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：标题、结果总数、子分类卡片/列表）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 全局改为左右布局（左侧筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合并返回匹配数量：制造商/质量等级/库存/分类）
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、显示计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search"（质量等级等快速入口）
2. ⏳ 分类页面内的局部搜索提示（Search within <Category>）
3. ⏳ 搜索命中高亮

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

### 里程碑（对齐 DOEEET 的分类与搜索体验）
- 里程碑 A（页面与布局）
  - [ ] `CategoryBrowsePage`：分类标题与总数、子分类卡片/列表、跳转联动
  - [ ] 面包屑导航：Home > 顶类 > 子类
  - [ ] 左侧筛选 + 右侧结果的页面布局
- 里程碑 B（筛选与数据）
  - [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
  - [ ] `FilterPanel`：折叠、Stacked/Scroll、计数、已选条件chips、动态加载
- 里程碑 C（结果与表格）
  - [ ] 集成动态参数表头到搜索结果表格；横向滚动与虚拟化优化
  - [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - [ ] 单位转换工具与筛选器联动
  - [ ] 分类内局部搜索提示与搜索高亮

---

## 🎯 近期开发计划

### Week 1 (2025-10-31 ~ 2025-11-06)

#### Day 1-2: 集成分类筛选和动态参数表头
- [ ] 将 CategoryFilter 集成到 ComponentSearch 页面
- [ ] 将动态参数表头集成到搜索结果
- [ ] 测试和优化

#### Day 3-5: 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`（标题、总数、子分类卡片/列表）
- [ ] 新增面包屑导航并与分类路由联动
- [ ] 改版为“左侧筛选 + 右侧结果”布局（影响搜索与浏览页）

#### Day 3-4: 实现动态参数筛选器
- [ ] 监听分类变化
- [ ] 加载对应分类的参数配置
- [ ] 创建 DynamicParameterFilter 组件
- [ ] 实现范围筛选和枚举筛选

#### Day 5-7: 优化和测试
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 添加单元测试
- [ ] 用户体验优化
- [ ] 编写完整文档

---

### Week 2 (2025-11-07 ~ 2025-11-13)

#### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel` 组件（折叠/展开、Stacked/Scroll、计数、已选条件chips）
- [ ] 筛选器选项动态加载（基于当前结果集）

#### 组件详情页增强
- [ ] 完善参数详情展示
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据
- [ ] 实现替代品推荐

#### 搜索功能增强
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- [ ] 单位转换工具与筛选联动
- [ ] 分类内局部搜索提示与高亮

---

## 🐛 已知问题

### 1. CategoryFilter 组件
- [ ] Tab切换时动画不流畅（低优先级）
- [ ] 移动端适配待优化

### 2. 动态参数表头
- [ ] 待集成到实际页面进行测试
- [ ] 大数据量下性能待优化（考虑虚拟滚动）

### 3. 搜索功能
- [ ] 搜索结果高亮待实现
- [ ] 分页加载待优化

---

## 🤝 贡献指南

### 开发流程
1. Fork 项目
2. 创建 feature 分支
3. 提交代码并添加测试
4. 提交 Pull Request

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 必须有单元测试
- 必须有 JSDoc 注释

---

## 📞 联系信息

**项目团队**: 开发团队  
**最后更新**: 2025-11-01  
**当前版本**: v0.5 (开发中)  
**预计发布**: v1.0 (2025-11-15)

---

## 🎉 里程碑

### v0.1 (2025-10-25)
- ✅ DoEEEt数据库集成
- ✅ 基础数据模型

### v0.3 (2025-10-29)
- ✅ 分类树构建服务
- ✅ Redis缓存集成

### v0.5 (2025-10-31) - 当前版本
- ✅ CategoryFilter 组件
- ✅ 动态参数表头工具函数
- ✅ 完整文档

### v0.7 (2025-11-06) - 计划中
- ⏳ 完整搜索功能
- ⏳ 动态参数筛选器
- ⏳ 组件详情页

### v1.0 (2025-11-15) - 目标
- 📋 完整的DoEEEt功能
- 📋 性能优化
- 📋 完整的测试覆盖

---

## 📈 数据统计

### DoEEEt 数据库规模
- **总组件数**: ~50,000+ 个电子元器件
- **顶层分类**: 15 个
- **叶子分类**: 181 个
- **动态参数**: 360 个唯一参数键
- **制造商**: ~200+ 家

### 功能覆盖率
- **分类筛选**: 100% (15/15 顶层分类)
- **参数展示**: 100% (360/360 动态参数)
- **搜索功能**: 40% (基础搜索已实现)
- **详情展示**: 20% (基础信息已实现)

---

**感谢使用 DoEEEt 系统！**

如有问题，请查阅相关文档或联系开发团队。


```

```markdown
 DoEEEt 功能开发总览

## 📋 项目概述

DoEEEt（Defense & Aerospace Electronic Equipment Database）是一个专门用于航空航天电子器件的数据库系统，包含了15个顶层分类、181个叶子分类、360个动态参数的完整电子元器件数据。

本文档总览了 DoEEEt 功能的开发进度和实施计划。

---

## 🎯 核心功能模块

### 1. ✅ 分类筛选功能（已完成 100%）

**功能描述**：
- 15个顶层分类展示（Microcircuits, Capacitors, Connectors 等）
- 2-5层深度的分类层级导航
- 双重交互方式：级联选择器 + Tab侧边栏

**技术实现**：
- 后端：`buildCategoryTree()` 服务 + Redis缓存
- 前端：`CategoryFilter` 组件（Cascader + Tabs）
- API：`/api/doeeet/categories/tree`

**文档**：
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md)
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md)

**状态**: ✅ 已完成（2025-10-31）

---

### 2. ✅ 动态参数表头（已完成 100%）

**功能描述**：
- 智能表头展示（有 `short_name` 显示简写 + Tooltip，无则显示完整名称）
- HTML标签支持（下标 `<sub>`、上标 `<sup>`）
- 360个动态参数的灵活展示

**技术实现**：
- 工具函数库：`parameterUtils.tsx`
- 8个核心函数：生成列、分组、导出CSV等
- 安全防护：DOMPurify清理HTML

**文档**：
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)

**示例代码**：
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

**状态**: ✅ 已集成到 `ComponentSearch` 页面（2025-10-31）

#### 🆕 表头与固定参数规范（概述）
- 表头规则：有 `short_name` → 显示“✖ short_name”且 Hover 显示完整 `name`；无 `short_name` → 直接显示 `name`。
- 固定参数：`Package` 与 `TOP (Operating Temperature)` 固定两列、固定顺序展示；名称从 `parameter_definitions`，取值从 `parameters`（按 `component_id + parameter_key`）。
- 聚合输出：后端统一返回 `static`（基础信息）、`fixedExtras`（Package/TOP）、`dynamic`（按 `meta.json` 顺序），空值用 “--”。

---

### 3. ⏳ 组件搜索功能（进行中 40%）

**功能描述**：
- 关键词搜索（器件型号、制造商）
- 分类筛选（集成 CategoryFilter）
- 参数范围筛选（电压、温度等）
- 分页、排序、导出

**待实施任务**：
- [x] 集成 CategoryFilter 到 ComponentSearch 页面
- [x] 集成动态参数表头到搜索结果
- [ ] 实现参数范围筛选
- [ ] 优化搜索性能

**状态**: ⏳ 进行中

---

### 4. ⏳ 动态参数筛选器（计划中 0%）

**功能描述**：
- 根据选择的分类，动态显示该分类的参数筛选器
- 支持范围筛选（数值型参数）
- 支持枚举筛选（离散值参数）

**实现思路**：
```tsx
// 监听分类变化
useEffect(() => {
  if (selectedCategory.length > 0) {
    loadDynamicParameters(selectedCategory);
  }
}, [selectedCategory]);

// 加载该分类的参数配置
const loadDynamicParameters = async (categoryPath: string[]) => {
  const response = await fetch(`/api/doeeet/category-meta/${encodeURIComponent(JSON.stringify(categoryPath))}`);
  const result = await response.json();
  setDynamicParams(result.data.meta);
};

// 渲染动态筛选器
<DynamicParameterFilter
  parameters={dynamicParams}
  onParameterChange={handleParameterChange}
/>
```

**状态**: ⏳ 计划中

---

### 5. ⏳ 组件详情页（计划中 20%）

**功能描述**：
- 基本信息展示（型号、制造商、封装等）
- 参数列表（分类展示）
- 数据表文档（Datasheet）
- 供应商信息
- 辐照测试数据

**待实施任务**：
- [ ] 完善参数详情展示（使用 parameterUtils）
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据展示
- [ ] 实现替代品推荐

**状态**: ⏳ 计划中

---

### 6. 📋 辐照数据模块（新需求）

**功能描述**：
- 直接面向 `business_plat.irradiation_tests` 集合的查询展示
- 页面入口：导航“器件查询” → “辐照数据”，提供表格/筛选/导出能力
- 支持关键词、产品类别、质量等级、供应商等筛选，并显示核心辐照指标（总剂量、单粒子效应等）

**实施要点**：
- 后端新增 `IrradiationTest` 模型、`/api/radiation-data` 查询 API、服务层分页/缓存
- 前端新增 `RadiationDataPage`，封装查询表单 + `Table` 展示 + CSV 导出
- 导航/HomeCard 联动，确保与现有器件搜索体验一致

**状态**: 📋 方案确认中（2025-11-19）

---

## 📊 开发进度总览

| 功能模块 | 进度 | 状态 | 预计完成时间 |
|---------|------|------|-------------|
| 分类筛选功能 | 100% | ✅ 完成 | 2025-10-31 |
| 动态参数表头 | 75% | ✅ 核心完成 | 2025-11-01 |
| 组件搜索功能 | 40% | ⏳ 进行中 | 2025-11-03 |
| 动态参数筛选器 | 0% | ⏳ 计划中 | 2025-11-05 |
| 组件详情页 | 20% | ⏳ 计划中 | 2025-11-07 |
| 组件对比功能 | 0% | 📋 待规划 | TBD |
| 替代品推荐 | 0% | 📋 待规划 | TBD |
| 批量导入/导出 | 0% | 📋 待规划 | TBD |
| 辐照数据模块 | 0% | 📋 待规划 | TBD |

**整体进度**: 47%

---

## 🏗️ 技术架构

### 🆕 2025-11-11 更新（稳定性）
- 已为前端两处关键数据加载增加统一超时与错误处理（15s）：
  - 组件详情：`GET /api/doeeet/components/:id`
  - 分类树：`GET /api/doeeet/categories/tree`（失败不再使用静态回退，避免误导）
- Linter 全量通过；影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx`（详情弹窗数据加载）
  - `frontend/src/components/CategoryFilter.tsx`（分类树加载）

### 🆕 2025-11-12 更新（对比体验）
- 组件对比表过滤掉参数名称为 `Unknown` 或空白的行，避免无意义参数占位
- 对比表参数标题优先展示首个有效参数名；若缺失则显示“未命名参数”，保持列标题一致性
- 影响文件：
  - `frontend/src/components/ComponentCompareModal.tsx`

### 🆕 2025-11-19 更新（本地环境）
- Windows 环境下发现端口 `27017` 被系统级 `MongoDB` 服务（PID 5812）与 MongoDB Compass 客户端（PID 4384）占用，导致项目自带实例无法启动
- 当前处理流程：`taskkill /PID 4384 /F` → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- 若需要继续使用 Compass，需在项目的 MongoDB 实例成功启动后再打开，以免产生新的占用连接
- 已在排查过程中验证 `netstat -ano | findstr 27017` 可快速确认端口是否释放

### 🆕 2025-11-19 更新（辐照测试数据）
- 通过 `backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing` 完成最新 Excel 数据导入，写入 `business_plat.irradiation_tests`
- 本次导入覆盖 1,921 行记录，脚本 dry-run 与正式导入均成功执行，确保集合内容为最新
- 建议在 MongoDB 中使用 `db.irradiation_tests.findOne()`/抽样统计确认字段映射及索引需求
- 🔄 新需求：新增“辐照数据”模块（器件查询 → 辐照数据）用于展示该集合内容，需后端 API + 前端页面联动


### 前端技术栈
```
React 18.2
├── TypeScript 4.9
├── Ant Design 5.12
├── Vite 4.5
└── React Router 6.20
```

### 前后端对齐计划（2025-11-10）
- 接口契约与字段命名统一
  - 后端输出统一字段：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`（"Yes"|"No"）
  - 详情/搜索/对比接口字段保持一致，前端避免额外适配层
- 查询参数规范与校验
  - 支持并校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
  - `familyPath` 传入 JSON 数组字符串（如 `["Resistors","Film"]`）
- 响应结构与分页
  - 统一 `{ success, data, error }`
  - 列表附带 `{ total, totalPages, page, limit, hasNextPage }`
- 性能与稳定性
  - 索引：`component_id`、`manufacturer_name`、`family_path`、`has_stock`、全文索引
  - 缓存：列表短缓存（30–120s），详情缓存（5–15m）
  - 速率限制与慢查询日志
- 前端改造
  - 建立统一 API SDK（TS 类型、统一错误处理）
  - 搜索/筛选状态与 URL 同步
  - 列表虚拟化、加载/空态/错误态与重试

### 里程碑（A-D）
- 里程碑 A（页面与布局）
  - `CategoryBrowsePage`、面包屑、左侧筛选 + 右侧结果布局
- 里程碑 B（筛选与数据）
  - Faceting 聚合（制造商/质量/库存/分类）+ 缓存
  - `FilterPanel`：折叠、Stacked/Scroll、显示计数、已选条件 chips、动态加载
- 里程碑 C（结果与表格）
  - 将动态参数表头全面接入结果表格，优化横向滚动/虚拟化
  - 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - 单位转换（pF ↔ µF/mF/F）与筛选器联动
  - 分类内局部搜索提示与命中高亮

### 后端技术栈
```
Node.js 18+
├── Express 4.x
├── TypeScript 4.9
├── MongoDB 6.x (数据库: business_plat)
├── Redis 7.x
└── meta.json（分类配置源）
```

### 数据流架构
```
meta.json 
  ↓ (读取)
DoeeetSearchService.buildCategoryTree()
  ↓ (构建树 + 缓存)
Redis (TTL: 1小时)
  ↓ (API)
/api/doeeet/categories/tree
  ↓ (HTTP)
前端组件 (CategoryFilter, DynamicParameterTable, etc.)
  ↓ (用户交互)
搜索 / 筛选 / 详情查看
```

---

## 📁 项目文件结构

```
Business_plat/
├── backend/
│   ├── src/
│   │   ├── models/
│   │   │   ├── DoeeetComponent.ts           # DoEEEt组件模型
│   │   │   └── ...
│   │   ├── services/
│   │   │   ├── DoeeetSearchService.ts       # 搜索服务（含分类树构建）
│   │   │   └── CacheService.ts              # Redis缓存服务
│   │   ├── controllers/
│   │   │   └── doeeetComponentController.ts # 控制器
│   │   └── routes/
│   │       └── doeeetRoutes.ts              # 路由配置
│   └── data/
│       └── meta.json                        # 分类配置源文件
│
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   │   └── CategoryFilter.tsx           # 分类筛选组件
│   │   ├── utils/
│   │   │   └── parameterUtils.tsx           # 动态参数工具函数
│   │   ├── examples/
│   │   │   └── DynamicParameterTableExample.tsx  # 示例代码
│   │   └── pages/
│   │       └── components/
│   │           └── ComponentSearch.tsx      # 搜索页面
│   └── docs/
│       ├── CategoryFilter使用说明.md
│       ├── 动态参数表头展示说明.md
│       └── 动态参数表头-快速开始.md
│
└── [根目录文档]
    ├── DoEEEt集成实施总结.md
    ├── DoEEEt项目开发计划.md
    ├── 前端分类筛选功能实施方案.md
    ├── 前端分类筛选-快速开始.md
    ├── DoEEEt动态参数表头实施总结.md
    └── DoEEEt功能开发总览.md (本文档)
```

---

## 🚀 快速开始

### 1. 启动 MongoDB 数据库

**Windows 系统**:
```bash
cd backend
.\start-mongodb-local.bat
```

**说明**:
- 脚本会自动检查 MongoDB 是否已安装
- 如果检测到 Windows 服务 `MongoDB` 正在运行，会尝试自动停止（默认服务数据目录: `E:\data\db`，项目数据目录: `F:\Business_plat\backend\data`）
- 停止 Windows 服务需要以管理员身份运行终端；若停止失败请手动执行 `net stop MongoDB`
- 自动停止服务并释放端口后再启动本地实例，避免读写到错误的数据目录
- 脚本会自动创建数据目录和日志目录（如果不存在）
- 数据目录: `backend/data`
- 日志文件: `backend/logs/mongod.log`
- 配置文件: `backend/mongod.conf`

**启动步骤**:
1. 打开 PowerShell 或命令提示符
2. 切换到 `backend` 目录: `cd backend`
3. 运行启动脚本: `.\start-mongodb-local.bat`
4. 脚本会自动检查环境并启动 MongoDB
5. 如果 MongoDB 已安装，会看到 "✅ MongoDB 启动成功！" 提示

**验证 MongoDB 是否运行**:
```bash
# 使用 mongosh 连接
mongosh mongodb://127.0.0.1:27017

# 或检查端口
netstat -an | findstr ":27017"

# 或访问健康检查（需要后端服务运行）
curl http://localhost:3001/health
```

**数据库配置**:
- 数据库名称: `business_plat`
- 连接地址: `mongodb://localhost:27017/business_plat`
- 集合名称: `components` (包含所有 DoEEEt 组件数据)
- 默认端口: `27017`

**注意事项**:
- 确保 MongoDB 已安装并添加到 PATH 环境变量
- MongoDB 安装路径通常是: `C:\Program Files\MongoDB\Server\8.2\bin`
- 如果启动失败，请检查日志文件: `backend/logs/mongod.log`
- 启动脚本会在当前窗口运行 MongoDB，关闭窗口会停止服务

---

### 2. 启动后端服务

```bash
cd backend
npm install

# 确保 .env 文件配置正确
# MONGODB_URI=mongodb://localhost:27017/business_plat

npm run dev
```

**启动成功标志**:
- ✅ MongoDB 连接成功
- ✅ Redis 连接成功
- ✅ 服务器启动成功，端口: 3001
- ✅ 数据自动保存机制已启动（间隔: 30秒）

**服务地址**:
- API 地址: `http://localhost:3001`
- 健康检查: `http://localhost:3001/health`

**验证服务是否运行**:
```bash
# 测试分类树 API
curl http://localhost:3001/api/doeeet/categories/tree

# 或访问健康检查端点
curl http://localhost:3001/health
```

---

### 3. 启动前端服务

```bash
cd frontend
npm install

# 安装可选依赖（用于HTML清理）
npm install dompurify @types/dompurify

npm run dev
```

**访问**: http://localhost:3000

---

### 4. 使用分类筛选

```tsx
import CategoryFilter from '@/components/CategoryFilter';

<CategoryFilter 
  onCategoryChange={(path) => console.log('选择的分类:', path)}
  selectedCategory={[]}
/>
```

---

### 5. 使用动态参数表头

```tsx
import { generateDynamicParameterColumns } from '@/utils/parameterUtils';

const dynamicColumns = generateDynamicParameterColumns(
  parameterDefinitions,
  { sortable: true }
);
```

---

## 📚 文档索引

### 核心文档

#### 分类筛选相关
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md) - 完整实施方案
- [CategoryFilter使用说明.md](./frontend/docs/CategoryFilter使用说明.md) - 组件API文档
- [前端分类筛选-快速开始.md](./前端分类筛选-快速开始.md) - 5分钟上手

#### 动态参数表头相关
- [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md) - 实施总结
- [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md) - 详细文档
- [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md) - 快速上手

#### 总体文档
- [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 整体集成总结
- [DoEEEt项目开发计划.md](./DoEEEt项目开发计划.md) - 项目计划
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 本文档

### 示例代码
- [CategoryFilter.tsx](./frontend/src/components/CategoryFilter.tsx)
- [parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)
- [DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)

---

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：标题、结果总数、子分类卡片/列表）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 全局改为左右布局（左侧筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合并返回匹配数量：制造商/质量等级/库存/分类）
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、显示计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search"（质量等级等快速入口）
2. ⏳ 分类页面内的局部搜索提示（Search within <Category>）
3. ⏳ 搜索命中高亮

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

### 里程碑（对齐 DOEEET 的分类与搜索体验）
- 里程碑 A（页面与布局）
  - [ ] `CategoryBrowsePage`：分类标题与总数、子分类卡片/列表、跳转联动
  - [ ] 面包屑导航：Home > 顶类 > 子类
  - [ ] 左侧筛选 + 右侧结果的页面布局
- 里程碑 B（筛选与数据）
  - [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
  - [ ] `FilterPanel`：折叠、Stacked/Scroll、计数、已选条件chips、动态加载
- 里程碑 C（结果与表格）
  - [ ] 集成动态参数表头到搜索结果表格；横向滚动与虚拟化优化
  - [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- 里程碑 D（体验增强）
  - [ ] 单位转换工具与筛选器联动
  - [ ] 分类内局部搜索提示与搜索高亮

---

## 🎯 近期开发计划

### Week 1 (2025-10-31 ~ 2025-11-06)

#### Day 1-2: 集成分类筛选和动态参数表头
- [ ] 将 CategoryFilter 集成到 ComponentSearch 页面
- [ ] 将动态参数表头集成到搜索结果
- [ ] 测试和优化

#### Day 3-5: 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`（标题、总数、子分类卡片/列表）
- [ ] 新增面包屑导航并与分类路由联动
- [ ] 改版为“左侧筛选 + 右侧结果”布局（影响搜索与浏览页）

#### Day 3-4: 实现动态参数筛选器
- [ ] 监听分类变化
- [ ] 加载对应分类的参数配置
- [ ] 创建 DynamicParameterFilter 组件
- [ ] 实现范围筛选和枚举筛选

#### Day 5-7: 优化和测试
- [ ] 性能优化（虚拟滚动、懒加载）
- [ ] 添加单元测试
- [ ] 用户体验优化
- [ ] 编写完整文档

---

### Week 2 (2025-11-07 ~ 2025-11-13)

#### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel` 组件（折叠/展开、Stacked/Scroll、计数、已选条件chips）
- [ ] 筛选器选项动态加载（基于当前结果集）

#### 组件详情页增强
- [ ] 完善参数详情展示
- [ ] 集成数据表文档
- [ ] 添加辐照测试数据
- [ ] 实现替代品推荐

#### 搜索功能增强
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）
- [ ] 单位转换工具与筛选联动
- [ ] 分类内局部搜索提示与高亮

---

## 🐛 已知问题

### 1. CategoryFilter 组件
- [ ] Tab切换时动画不流畅（低优先级）
- [ ] 移动端适配待优化

### 2. 动态参数表头
- [ ] 待集成到实际页面进行测试
- [ ] 大数据量下性能待优化（考虑虚拟滚动）

### 3. 搜索功能
- [ ] 搜索结果高亮待实现
- [ ] 分页加载待优化

---

## 🤝 贡献指南

### 开发流程
1. Fork 项目
2. 创建 feature 分支
3. 提交代码并添加测试
4. 提交 Pull Request

### 代码规范
- TypeScript 严格模式
- ESLint + Prettier
- 必须有单元测试
- 必须有 JSDoc 注释

---

## 📞 联系信息

**项目团队**: 开发团队  
**最后更新**: 2025-11-01  
**当前版本**: v0.5 (开发中)  
**预计发布**: v1.0 (2025-11-15)

---

## 🎉 里程碑

### v0.1 (2025-10-25)
- ✅ DoEEEt数据库集成
- ✅ 基础数据模型

### v0.3 (2025-10-29)
- ✅ 分类树构建服务
- ✅ Redis缓存集成

### v0.5 (2025-10-31) - 当前版本
- ✅ CategoryFilter 组件
- ✅ 动态参数表头工具函数
- ✅ 完整文档

### v0.7 (2025-11-06) - 计划中
- ⏳ 完整搜索功能
- ⏳ 动态参数筛选器
- ⏳ 组件详情页

### v1.0 (2025-11-15) - 目标
- 📋 完整的DoEEEt功能
- 📋 性能优化
- 📋 完整的测试覆盖

---

## 📈 数据统计

### DoEEEt 数据库规模
- **总组件数**: ~50,000+ 个电子元器件
- **顶层分类**: 15 个
- **叶子分类**: 181 个
- **动态参数**: 360 个唯一参数键
- **制造商**: ~200+ 家

### 功能覆盖率
- **分类筛选**: 100% (15/15 顶层分类)
- **参数展示**: 100% (360/360 动态参数)
- **搜索功能**: 40% (基础搜索已实现)
- **详情展示**: 20% (基础信息已实现)

---

**感谢使用 DoEEEt 系统！**

如有问题，请查阅相关文档或联系开发团队。


```

```markdown
# DoEEEt电子元件搜索系统集成实施总结

## 项目概览

本文档记录了DoEEEt电子元件数据库与业务平台的集成实施过程，包括已完成的功能、技术架构和下一步计划。

## 数据概况

- **数据源**: DoEEEt (Defense Operational Electronic Equipment and Technology)
- **数据规模**: 
  - 组件 (components): 1.8M+ 条记录
  - 参数 (parameters): 137M+ 条记录
  - 参数定义 (parameter_definitions): 313 个参数类型
  - 动态参数定义 (meta.json): 360 个唯一参数键

### 数据文件映射关系（对应《数据说明》）

- components ↔ `general.csv`
- parameters ↔ `parameter.csv`
- parameter_definitions ↔ `parameter_final.csv`（集成时忽略 example 列）

### 分类结构分析 (基于 meta.json)

#### 顶层分类（15个）

```javascript
const topCategories = [
  "Cable Assemblies",        // 叶子分类: 3
  "Capacitors",              // 叶子分类: 8
  "Connectors",              // 叶子分类: 11
  "Crystals and Oscillators", // 叶子分类: 3
  "Discretes",               // 叶子分类: 30
  "Filters",                 // 叶子分类: 4
  "Inductors",               // 叶子分类: 3
  "Microcircuits",           // 叶子分类: 89 (最大类别)
  "Relays",                  // 叶子分类: 4
  "Resistors",               // 叶子分类: 6
  "RF Passive Components",   // 叶子分类: 2
  "Switches",                // 叶子分类: 5
  "Thermistors",             // 叶子分类: 3
  "Transformers",            // 叶子分类: 7
  "Wires and Cables",        // 叶子分类: 3
];
```

#### 分类层级统计

- **总计**: 181 个最细叶子分类（meta.json 中配置的分类）
- **路径深度分布**:
  - 深度 2 (例: `Capacitors > Ceramic`): 54 个 (29.83%)
  - 深度 3 (例: `Connectors > Circular > Circular Accessories`): 51 个 (28.18%)
  - 深度 4 (例: `Discretes > Diode > RF-Microwave Diode > PIN`): 61 个 (33.70%)
  - 深度 5 (例: `Microcircuits > Digital > Memory > RAM > SRAM`): 15 个 (8.29%)

#### family_path 数据结构

```python
# 实际存储格式：从“叶子(最低级)”到“顶层(最高级)”的层级数组
"['Peripheral-Controller', 'Digital', 'Microcircuits']"
#    ↑ 叶子(最低级)             ↑ 中间层级          ↑ 顶层

# 提取规则（与数据库一致）：
# - 叶子分类：family_path[0]
# - 顶层分类：family_path[-1] (最后一个元素)
```

#### 最常用的动态参数 (Top 10)

| 参数名称 | 使用率 | 说明 |
|---------|-------|------|
| Storage Temperature Range | 93.37% | 存储温度范围 |
| SEE sens. | 92.82% | 单粒子效应灵敏度 |
| TID (HDR) sens. | 92.82% | 总电离剂量（高剂量率）灵敏度 |
| TID (LDR) sens. | 92.82% | 总电离剂量（低剂量率）灵敏度 |
| TNID sens. | 92.82% | 中子辐射灵敏度 |
| Finish | 81.22% | 表面处理 |
| Package Material | 72.93% | 封装材料 |
| Number of Pins | 71.27% | 引脚数量 |
| TID (HDR) | 66.30% | 总电离剂量（高剂量率） |
| TID (LDR) | 66.30% | 总电离剂量（低剂量率） |

#### 注意事项

1. **meta.json 中没有 "Aerospace" 分类**
   - "Aerospace" 不是分类维度，而是质量等级或筛选条件
   - 可能对应 `comp-qualified = Y` 或特殊的 `quality_name`
   
2. **动态参数配置**
   - 每个叶子分类有不同的动态参数列表（在 meta.json 的 `meta` 数组中）
   - 共有 360 个唯一的动态参数键
   - 如果某个分类不在 meta.json 中，则只显示固定参数

## 已完成功能 (Phase 1, Phase 2 & Phase 2.5)

### Phase 1: 基础集成功能 ✅

#### 1.1 前端组件搜索页面 ✅
**文件**: `frontend/src/pages/components/ComponentSearch.tsx`

**功能**:
- 集成DoEEEt API (`/api/doeeet/search`)
- 支持多维度搜索：
  - 型号搜索 (partNumber)
  - 制造商筛选 (manufacturer)
  - 质量等级筛选 (qualityName: 883, QML Q, EP等)
  - 库存状态筛选 (hasStock: Yes/No)
  - 淘汰状态筛选 (obsolescenceType: Active, Obsolete, Risk, Last Time Buy)
- 数据格式转换：将DoEEEt数据格式适配到前端UI
- 解析family_path分类层次结构
- 分页和排序支持
- ✨ **新增**: 动态参数表头展示（Phase 2.5）
- ✨ **新增**: 分类筛选器集成（Phase 2.5）
- ✨ **新增**: CSV导出功能（Phase 2.5）

**技术实现**:
```typescript
// API调用示例
const response = await fetch(`/api/doeeet/search?${params.toString()}`);
const result = await response.json();

// 数据转换
const adaptedComponents = result.data.components.map((comp: any) => {
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层分类为最后一个元素
    mainCategory: familyPathArray[familyPathArray.length - 1],
    // ... 其他字段映射
  };
});
```

#### 1.2 组件详情弹窗 ✅
**功能**:
- 点击组件型号查看详细信息
- 动态加载组件参数 (`/api/doeeet/components/:id`)
- 显示参数定义翻译（中英文参数名、符号、分类）
- 参数表格展示：
  - 参数名称（完整名称 + 符号）
  - 参数值（支持数组值解析）
  - 参数分类
  - 单位和示例

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Thermal Resistance, Junction to Case [Max]"
  short_name: string;     // "&theta;<sub>JC</sub> [Max]"
  category: string;       // "Generic Functional & Electrical"
  value: any;             // 实际参数值
}
```

#### 1.3 首页分类统计卡片 ✅
**文件**: `frontend/src/pages/HomePage.tsx`

**功能**:
- 实时显示11个主要分类的组件数量
- 从API获取统计数据 (`/api/doeeet/statistics`)
- 动态更新分类统计卡片
- 支持点击跳转到对应分类搜索

**后端增强**:
- 在 `DoeeetSearchService.getStatistics()` 中添加 `categoryStats`
- 使用MongoDB聚合管道按family_path分组统计
- 解析family_path提取主分类
- Redis缓存优化（TTL: 1小时）

### Phase 2: 高级搜索功能 ✅

#### 2.1 动态参数表头展示 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (工具函数库)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 智能表头展示：
  - 有 `short_name` 时显示简写 + Tooltip（完整名称）
  - 无 `short_name` 时直接显示完整名称
- HTML 标签支持（`<sub>`, `<sup>` 等）
- 安全清理（DOMPurify）
- 根据分类动态生成参数列
- 参数列可排序、可筛选

**数据结构**:
```typescript
interface ParameterDefinition {
  parameter_key: string;
  name: string;           // "Storage Temperature Range"
  short_name?: string;    // "T<sub>STG</sub>"
  category: string;       // "Thermal"
  example?: string;       // "-55°C to 150°C"
}
```

**工具函数**:
```typescript
// 8个核心函数
- generateParameterColumnTitle()      // 生成智能表头
- generateDynamicParameterColumns()   // 批量生成动态列
- generateGroupedParameterColumns()   // 生成分组列
- exportParametersToCSV()             // 导出CSV
- downloadCSV()                       // 下载CSV
- groupParametersByCategory()         // 按分类分组
- formatParameterValue()              // 格式化参数值
- extractParameterKeys()              // 提取参数键
```

**UI效果**:
```
┌────────────────┬──────────┬─────────ⓘ───┬─────────ⓘ───┐
│ 器件型号        │ 制造商    │ #Pins       │ T_STG        │
│                │          │ ↑ Tooltip   │ ↑ Tooltip    │
├────────────────┼──────────┼─────────────┼──────────────┤
│ 860300YA       │ SIB      │ 68          │ -55°C~150°C  │
└────────────────┴──────────┴─────────────┴──────────────┘
```

**参数覆盖率**:
- 总参数数: 360个
- 有 `short_name`: ~80% (288个)
- 无 `short_name`: ~20% (72个)

#### 2.2 分类筛选器集成 ✅ ⭐ 新增
**文件**: 
- `frontend/src/components/CategoryFilter.tsx` (已有组件)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 级联选择器（Cascader）展示分类层级
- Tab导航展示顶层分类（15个）
- 支持 2-5 层分类路径选择
- 分类选择后自动触发搜索
- 显示每个分类的组件数量

**分类统计**:
| 顶层分类 | 组件数量 | 占比 | 路径深度 |
|---------|---------|------|---------|
| Resistors | 824,599 | 45.88% | 2层 |
| Capacitors | 503,149 | 27.99% | 2层 |
| Connectors | 160,090 | 8.91% | 3层 |
| Crystals and Oscillators | 131,524 | 7.32% | 2层 |
| Switches | 53,377 | 2.97% | 2层 |
| Discretes | 45,564 | 2.53% | 2-4层 |
| Thermistors | 31,302 | 1.74% | 2层 |
| Microcircuits | 25,652 | 1.43% | 2-5层 |
| 其他 (6类) | 22,160 | 1.23% | 2-3层 |

**数据流**:
```
用户选择分类
    ↓
CategoryFilter.onCategoryChange(path)
    ↓
setSelectedCategory(['Resistors', 'Film'])
    ↓
handleSearch() → /api/doeeet/search?familyPath=["Resistors","Film"]
    ↓
后端筛选 + 返回对应的 parameterDefinitions
    ↓
前端生成动态参数列
```

#### 2.3 参数范围筛选 ✅
**文件**: 
- `frontend/src/components/ParameterRangeFilter.tsx` (新建)
- `backend/src/services/DoeeetSearchService.ts` (已支持)

**功能**:
- 支持数值型参数的范围查询
- 常用参数快速选择：
  - 电压 (Voltage)
  - 电流 (Current)
  - 功率 (Power)
  - 频率 (Frequency)
  - 工作温度 (Temperature)
  - 电阻、电容、电感等
- 最小值/最大值输入
- 多参数组合筛选
- 动态添加/删除筛选条件

**API格式**:
```json
{
  "parameters": {
    "voltage": { "min": 3.3, "max": 5.0 },
    "temperature": { "min": -40, "max": 85 }
  }
}
```

**后端实现**:
```typescript
// 范围查询支持
if (typeof value === 'object' && ('min' in value || 'max' in value)) {
  const rangeQuery: any = { parameter_key: key };
  if (value.min !== undefined) {
    rangeQuery.numeric_value = { $gte: value.min };
  }
  if (value.max !== undefined) {
    rangeQuery.numeric_value = { 
      ...rangeQuery.numeric_value, 
      $lte: value.max 
    };
  }
  paramQueries.push(rangeQuery);
}
```

#### 2.4 CSV导出功能 ✅ ⭐ 新增
**文件**: 
- `frontend/src/utils/parameterUtils.tsx` (导出函数)
- `frontend/src/pages/components/ComponentSearch.tsx` (已集成)

**功能**:
- 导出当前搜索结果为CSV
- 包含所有静态列和动态参数列
- 自动生成文件名（带时间戳）
- 支持中文编码（UTF-8 BOM）

**使用示例**:
```tsx
<Button 
  icon={<DownloadOutlined />}
  onClick={() => {
    const csvContent = exportParametersToCSV(components, parameterDefinitions);
    downloadCSV(csvContent, `components_${Date.now()}.csv`);
    message.success('导出成功！');
  }}
>
  导出CSV
</Button>
```

**CSV格式**:
```csv
器件型号,制造商,分类,Number of Pins,Storage Temperature Range,...
860300YA,SIB International,Resistors,68,-55°C~150°C,...
860301YA,SIB International,Capacitors,72,-40°C~125°C,...
```

#### 2.5 参数对比功能 ✅
**文件**:
- `frontend/src/components/ComponentCompareModal.tsx` (新建)
- `backend/src/controllers/doeeetComponentController.ts` (新增compareComponents)
- `backend/src/routes/doeeetRoutes.ts` (新增路由)

**功能**:
- 多选组件（2-5个）
- 批量对比按钮
- 对比模态框展示：
  - 基本信息对比表
  - 参数对比矩阵
  - 参数差异高亮
- 支持大量参数滚动查看

**API Endpoint**:
```
POST /api/doeeet/components/compare
Body: { componentIds: string[] }
```

**对比矩阵数据结构**:
```typescript
interface ComparisonMatrix {
  components: ComponentInfo[];      // 组件基本信息
  parameters: ParameterRow[];       // 参数对比矩阵
}

interface ParameterRow {
  key: string;
  component_0: { name, value, numericValue };
  component_1: { name, value, numericValue };
  // ...
}
```

## 技术架构

### 后端技术栈
- **框架**: Express.js + TypeScript
- **数据库**: MongoDB (1.8M+ 组件记录)
- **缓存**: Redis (搜索结果、组件详情、统计数据)
- **日志**: Winston

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI库**: Ant Design
- **路由**: React Router v6
- **状态管理**: React Hooks

### 数据库设计

#### Collections

1. **components** (1.8M 文档)
```javascript
{
  _id: ObjectId,
  component_id: String,          // UUID
  part_number: String,           // "5962-8864203YA"
  part_type: String,             // "P1754-40QGMB"
  manufacturer_name: String,     // "Pyramid Semiconductor"
  family_path: String,           // "['Peripheral-Controller', 'Digital', 'Microcircuits']"
  quality_name: String,          // "883"
  obsolescence_type: String,     // "Active"
  has_stock: String,             // "Yes"/"No"
  qpl_name: String,              // "QPDSIS-38535"
  qualified: String,             // "Y"/"N"
  cad: String,
  created_at: Date,
  updated_at: Date
}
```

2. **parameters** (数百万文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID + type
  component_id: String,          // 外键
  parameter_value: String,       // "['0.00000']"
  numeric_value: Number,         // 用于范围查询
  created_at: Date,
  updated_at: Date
}
```

3. **parameter_definitions** (313 文档)
```javascript
{
  _id: ObjectId,
  parameter_key: String,         // UUID
  name: String,                  // "Thermal Resistance, Junction to Case [Max]"
  short_name: String,            // "&theta;<sub>JC</sub> [Max]"
  category: String,              // "Generic Functional & Electrical"
  example: String,               // "5°C/W"
  created_at: Date,
  updated_at: Date
}
```
注：本集合与数据说明中的 `parameter_final.csv` 对应；集成与展示时请忽略 `example` 列（不参与前后端逻辑与显示）。

### API接口列表

#### 搜索API
- `GET /api/doeeet/search` - 复合搜索
- `GET /api/doeeet/fulltext` - 全文搜索
- `GET /api/doeeet/suggestions` - 搜索建议
- `GET /api/doeeet/category/:category` - 分类浏览

#### 组件API
- `GET /api/doeeet/components/:id` - 组件详情
- `POST /api/doeeet/components/compare` - 对比组件 ✨ 新增

#### 元数据API
- `GET /api/doeeet/manufacturers` - 制造商列表
- `GET /api/doeeet/categories` - 分类列表
- `GET /api/doeeet/parameter-definitions` - 参数定义
- `GET /api/doeeet/statistics` - 统计信息 ✨ 增强

## 性能优化

### 1. Redis缓存策略
```typescript
// 缓存TTL配置
const CacheTTL = {
  SEARCH_RESULT: 300,        // 5分钟
  COMPONENT_DETAIL: 1800,    // 30分钟
  METADATA: 3600,            // 1小时
  STATISTICS: 3600           // 1小时
};
```

### 2. MongoDB索引
```javascript
// components集合索引
{
  component_id: 1,           // 唯一索引
  part_number: 1,            // 搜索索引
  manufacturer_name: 1,
  obsolescence_type: 1,
  family_path: 1
}

// parameters集合索引
{
  component_id: 1,
  parameter_key: 1,
  numeric_value: 1           // 范围查询索引
}

// 全文搜索索引
{
  part_number: "text",
  manufacturer_name: "text",
  part_type: "text"
}
```

### 3. 分页优化
- 默认每页20条
- 最大限制100条
- Skip + Limit实现

### 缓存与限流（新增）
- 实现 `CacheService.ts`
- 缓存搜索结果、分类树
- 性能优化：目标从200ms降至10-20ms

## 🔍 对比分析与改进思路

### 当前实现 vs DOEEET 原始网站功能对比

基于对 DOEEET 原始网站的深入分析，以下是当前实现与原始网站的功能差距和改进思路：

#### 1. 分类浏览页面结构

**DOEEET 原始网站特点**：
- ✅ 独立的分类浏览页面（如 "Capacitors" 页面）
- ✅ 显示分类标题和总数（如 "Capacitors (1743121)"）
- ✅ 显示子分类列表，每个子分类显示数量（如 "Aluminum Solid (5860 items)"）
- ✅ 面包屑导航（Home > Capacitors > Aluminum Solid）
- ✅ "COMPONENTS" 和 "DOCUMENTS" 标签页切换

**当前实现**：
- ✅ 有 `CategoryFilter` 组件，集成在搜索页面中
- ❌ 缺少独立的分类浏览页面
- ❌ 缺少分类数量统计显示
- ❌ 缺少面包屑导航

**改进思路**：
- 创建独立的分类浏览页面（`CategoryBrowsePage`）
- 显示分类标题、总数和子分类列表（带数量）
- 添加面包屑导航组件
- 支持点击子分类直接进入该分类的搜索结果页

---

#### 2. 筛选面板布局和交互

**DOEEET 原始网站特点**：
- ✅ 左侧固定筛选面板（可折叠）
- ✅ "Stacked" 和 "Scroll" 两种视图模式
- ✅ 每个筛选选项显示匹配数量（Faceting）
- ✅ 筛选器分组清晰（制造商、库存、规格、质量等级等）
- ✅ "HIDE FILTERS" 切换按钮
- ✅ 筛选器支持搜索输入框（如制造商筛选器）

**当前实现**：
- ✅ 筛选器在顶部，垂直布局
- ❌ 没有固定左侧面板
- ❌ 没有 "Stacked"/"Scroll" 视图模式
- ❌ 没有显示匹配数量
- ❌ 筛选器选项是静态的，没有动态加载

**改进思路**：
- 改为左右布局：左侧固定筛选面板，右侧结果列表
- 实现筛选面板折叠/展开功能
- 添加 "Stacked" 和 "Scroll" 视图模式切换
- 后端支持 Faceting，返回每个筛选选项的匹配数量
- 筛选器选项动态加载（根据当前搜索结果）

---

#### 3. 筛选器功能增强

**DOEEET 原始网站特点**：
- ✅ 数值型筛选器有单位转换（如电容值显示为 µF，而非 pF）
- ✅ 筛选器支持 "Expand all" 展开所有选项
- ✅ 有 "Quick Search" 部分（Parts grade）
- ✅ 已选筛选条件可以单独移除

**当前实现**：
- ✅ 参数范围筛选器使用原始单位（pF）
- ❌ 没有 "Expand all" 功能
- ❌ 没有 "Quick Search" 部分
- ❌ 没有已选筛选条件概览

**改进思路**：
- 实现单位转换功能（pF → µF/mF/F）
- 添加 "Expand all" 功能
- 添加 "Quick Search" 部分（质量等级快速筛选）
- 在筛选面板顶部显示已选筛选条件，支持单独移除

---

#### 4. 结果展示优化

**DOEEET 原始网站特点**：
- ✅ 结果统计显示（如 "5869 Results"）
- ✅ 表格列数很多，但支持横向滚动
- ✅ 有比较功能（checkbox）
- ✅ 表格列可以自定义显示/隐藏

**当前实现**：
- ✅ 有结果统计，但显示位置不够突出
- ✅ 表格列数较多，但缺少列自定义功能
- ✅ 有比较功能

**改进思路**：
- 在结果区域顶部突出显示结果统计
- 添加列自定义功能（用户可以选择显示哪些列）
- 优化表格横向滚动体验

---

#### 5. 搜索与浏览的整合

**DOEEET 原始网站特点**：
- ✅ 在分类页面时，搜索框提示 "Search within Capacitors"
- ✅ 搜索结果明确显示所属分类
- ✅ 分类浏览和搜索无缝切换

**当前实现**：
- ✅ 搜索和分类筛选是分离的
- ❌ 没有在分类页面内的局部搜索提示

**改进思路**：
- 在分类浏览页面添加局部搜索功能
- 搜索框根据当前分类显示提示文字
- 搜索结果中高亮显示分类信息

---

### 实施优先级建议

#### Phase 1: 核心布局改造（高优先级）
1. ⏳ 创建独立的分类浏览页面（`CategoryBrowsePage`：分类标题、结果总数、子分类列表/卡片）
2. ⏳ 添加面包屑导航（Home > 顶类 > 子类）
3. ⏳ 改为左右布局（左侧固定筛选面板 + 右侧结果）

#### Phase 2: 筛选功能增强（高优先级）
1. ⏳ 后端 Faceting（聚合返回匹配数量：制造商/质量等级/库存/分类）+ 缓存
2. ⏳ `FilterPanel` 组件（折叠/展开、"Stacked"/"Scroll"、计数、已选条件chips）
3. ⏳ 筛选器选项动态加载（随当前结果集变化）

#### Phase 3: 用户体验优化（中优先级）
1. ⏳ 列自定义（显示/隐藏、拖拽排序、配置持久化）
2. ⏳ 单位转换功能（pF ↔ µF/mF/F 等）
3. ⏳ 已选筛选条件概览与单独移除
4. ⏳ "Expand all" 功能

#### Phase 4: 高级功能（低优先级）
1. ⏳ "Quick Search" 部分
2. ⏳ 分类页面局部搜索（Search within <Category>）
3. ⏳ 结果高亮显示

---

### 技术实现要点

1. **后端 Faceting API**：需要修改搜索接口，返回每个筛选选项的匹配数量
2. **筛选面板组件**：创建可复用的 `FilterPanel` 组件，支持折叠、视图模式切换
3. **分类浏览页面**：创建 `CategoryBrowsePage`，支持路由参数（如 `/browse/Capacitors`）
4. **单位转换工具**：创建参数单位转换工具函数

---

## 本次对齐实施计划（2025-11-10）

### 阶段 0（契约与正确性）
- [ ] 接口契约与字段命名统一：`component_id`、`part_number`、`manufacturer_name`、`family_path`、`has_stock`
- [ ] 查询参数校验：`keyword`、`manufacturer`、`familyPath`、`hasStock`、`sort`、`page`、`limit`
- [ ] 响应结构统一：`{ success, data, error }`；分页元数据 `{ total, totalPages, page, limit, hasNextPage }`
- [ ] 错误码与错误体：400/404/500；`error.code`、`error.message`

### 里程碑 A（页面与布局）
- [ ] 新增 `CategoryBrowsePage`：显示分类标题、总数、子分类卡片/列表；支持点击进入搜索页
- [ ] 新增面包屑导航：Home > 顶类 > 子类，支持路由联动
- [ ] 页面布局改造：统一为“左侧筛选面板 + 右侧结果列表”

### 里程碑 B（筛选与数据）
- [ ] 后端 Faceting 聚合与缓存（制造商/质量/库存/分类）
- [ ] `FilterPanel`：折叠/展开、Stacked/Scroll 视图、显示计数、已选条件chips
- [ ] 筛选项动态加载（基于当前结果集）

### 里程碑 C（结果与表格）
- [ ] 将动态参数表头接入搜索结果表格并优化横向滚动/虚拟化
- [ ] 列自定义（显示/隐藏、拖拽排序、配置持久化）

### 里程碑 D（体验增强）
- [ ] 单位转换（pF ↔ µF/mF/F）与筛选器联动
- [ ] 分类内局部搜索提示（Search within <Category>）与结果高亮

---

## 待实现功能 (Phase 3 & 优化)

### Phase 2.6: 动态参数表头增强 ⏳
- [ ] 参数列的显示/隐藏控制
- [ ] 参数列的拖拽排序
- [ ] 参数列配置保存到 localStorage
- [ ] 参数列的分组展示（按 category）
- [ ] 参数列的高级筛选（范围、正则等）
- [ ] 参数统计图表展示

### Phase 3.1: 关联数字模型 ⏳
- 展示组件关联的3D CAD模型
- 模型预览（使用Three.js或类似库）
- 模型信息展示

### Phase 3.2: 模型下载功能 ⏳
- 支持多种CAD格式下载
- 下载进度显示
- 批量下载支持

### Phase 3.3: 分面搜索（Facets）⏳
- 实现分面搜索
- 统计每个筛选条件的可用选项数量
- 动态更新可用筛选选项

## 使用说明

### 1. 启动服务

**后端**:
```bash
cd backend
npm install
npm run dev
```

**前端**:
```bash
cd frontend
npm install
npm start
```

### 2. 访问系统

- 前端URL: http://localhost:3000
- 后端API: http://localhost:3001

### 3. 主要功能入口

1. **组件搜索**: 导航栏 -> 器件查询 -> 器件搜索
2. **首页统计**: 首页 -> 11个分类统计卡片
3. **参数筛选**: 组件搜索页面 -> 参数范围筛选卡片
4. **组件对比**: 
   - 选择2-5个组件
   - 点击"批量对比"按钮
   - 查看对比结果

## 数据统计

### 分类统计（示例）
- Peripheral-Controller: ~800,000
- Digital: ~500,000
- Microcircuits: ~300,000
- Analog: ~200,000
- 其他分类: 各有数量

### 制造商统计
- 18+ 制造商
- 包括Pyramid Semiconductor, Analog Devices, Texas Instruments等

### 参数统计
- 313个参数定义
- 涵盖电气、热学、机械等多个分类

## 测试建议

### 功能测试
1. 搜索功能测试
   - 型号搜索: "5962-8864203YA"
   - 制造商筛选: "Pyramid Semiconductor"
   - 组合筛选测试

2. 参数筛选测试
   - 单参数范围: 电压 3.3V-5V
   - 多参数组合: 电压 + 温度

3. 组件对比测试
   - 选择2个相似组件对比
   - 选择5个组件对比
   - 查看参数差异

### 性能测试
1. 大数据量搜索响应时间
2. 缓存命中率监控
3. 并发用户测试

## 注意事项

1. **数据格式**: DoEEEt的family_path使用Python列表字符串格式，需要特殊解析
2. **参数值**: 参数值也是数组字符串格式，需要解析后显示
3. **缓存策略**: 注意Redis缓存的TTL设置，避免数据过期问题
4. **错误处理**: 前端有降级方案，API失败时显示模拟数据

## 开发团队

- 后端开发: Express.js + MongoDB + Redis
- 前端开发: React + TypeScript + Ant Design
- 数据导入: Python脚本处理DoEEEt CSV数据

## 🔥 最新状态更新 (2025-10-30)

### ✅ 重大进展

#### 1. 后端服务正常运行 ⭐
- **状态**: ✅ 已启动并稳定运行
- **端口**: 3001
- **服务**:
  - MongoDB 8.2.1 连接正常 (1.8M组件数据)
  - Redis连接正常 (缓存服务)
  - 所有API端点可访问

#### 2. TypeScript编译问题修复 ⭐
- **问题**: `jsonwebtoken` 类型声明错误导致编译失败
- **解决方案**: 使用类型断言 `as JwtPayload`
- **影响文件**: `backend/src/middleware/authMiddleware.ts`
- **状态**: ✅ 已修复，编译通过

#### 3. ComponentSearch页面API集成完成 ⭐
- **文件**: `frontend/src/pages/components/ComponentSearch.tsx`
- **状态**: ✅ 已接入真实API (`/api/doeeet/search`)
- **功能验证**:
  - ✅ API调用逻辑正确
  - ✅ 数据适配器已实现 (MongoDB → UI)
  - ✅ 支持搜索、筛选、分页
  - 🔄 待测试：前端服务启动后的实际运行效果

#### 4. 数据库备份脚本完善 ⭐ 🆕
- **文件**: `backend/scripts/backup_database.ps1`
- **状态**: ✅ 已完善，支持 MongoDB 8.x
- **功能**:
  - ✅ MongoDB 版本自动检测
  - ✅ MongoDB 8.x 强制使用 mongosh 备份
  - ✅ 详细的进度显示和日志
  - ✅ 自动压缩和备份验证
- **备份路径**: `F:\Business_plat\backups\`
- **兼容性**: MongoDB 8.2.1 + mongodump 100.x

#### 5. 数据格式迁移脚本准备 ⭐ 🆕
- **文件**: `backend/scripts/migrate_doeeet_data_format.js`
- **状态**: ✅ 已创建，待执行
- **目的**: 修复 `doeeet_tasks` 集合数据格式
- **操作**: 字段展平（`title.value` → `title`）
- **安全**: 自动创建备份集合

#### 4. 数据适配器实现 ⭐
**转换逻辑**:
```typescript
// MongoDB数据格式 → 前端UI格式
const adaptedComponents = result.data.components.map((comp: any) => {
  // 解析Python列表格式的family_path
  let familyPathArray = JSON.parse(comp.family_path.replace(/'/g, '"'));
  
  return {
    id: comp.component_id,
    partNumber: comp.part_number,
    manufacturer: comp.manufacturer_name,
    // 顶层在末尾，叶子在开头
    mainCategory: familyPathArray[familyPathArray.length - 1],
    subCategory: familyPathArray[1] || '',
    category: familyPathArray[0] || '',
    qualityLevel: comp.quality_name,
    status: comp.obsolescence_type,
    stockStatus: comp.has_stock === 'Yes',
    qplName: comp.qpl_name || '',
    qualified: comp.qualified === 'Y'
  };
});
```

### 🎯 当前优先级任务

#### P0 - 立即执行（数据安全优先）
1. **数据库备份** ⏰ 30分钟 🔴
   - 🔄 执行备份脚本 (`.\scripts\backup_database.ps1`)
   - 验证备份完整性
   - 备份位置：`F:\Business_plat\backups\`

2. **数据格式迁移** ⏰ 1-2小时 🔴
   - 🔄 执行迁移脚本 (`node scripts/migrate_doeeet_data_format.js`)
   - 修复 `doeeet_tasks` 数据格式
   - 验证迁移结果

3. **后端API验证** ⏰ 30分钟 🔴
   - 测试迁移后的API响应
   - 验证数据完整性
   - 检查前端兼容性

#### P1 - 短期实施（功能开发）
4. **启动前端服务并验证数据流** ⏰ 1小时
   - 启动前端开发服务器 (`npm start`)
   - 测试ComponentSearch页面真实搜索
   - 验证180万组件数据展示
   - 检查分页、排序功能

5. **实现组件详情弹窗** ⏰ 2-3小时
   - 调用 `/api/doeeet/components/:id/parameters`
   - 展示技术参数表格
   - 显示参数定义翻译（中英文）

6. **参数对比功能开发** ⏰ 1-2天
   - 后端：创建 `ComparisonService.ts`
   - 后端：实现 `POST /api/doeeet/compare` API
   - 前端：组件多选功能 (Checkbox列)
   - 前端：对比抽屉UI
   - 前端：参数差异高亮

#### P2 - 中期实施
7. **分面搜索（Facets）** ⏰ 1天
   - 后端：搜索结果中添加聚合统计
   - 前端：分面筛选器UI组件
   - 动态更新可用选项数量

8. **Redis缓存集成** ⏰ 1-2天
   - 实现 `CacheService.ts`
   - 缓存搜索结果、分类树
   - 性能优化：目标从200ms降至10-20ms

### 📊 项目整体进度

| 阶段 | 状态 | 进度 | 说明 |
|------|------|------|------|
| 阶段一：数据导入 | ✅ 完成 | 100% | 1.8M组件 + 137M参数 |
| 阶段二：搜索API | ✅ 基本完成 | 95% | 10个端点已实现，分面搜索待补充 |
| 阶段三：前端开发 | 🔄 进行中 | 65% | ✅ 动态参数表头、✅ 分类筛选、✅ CSV导出 |
| 阶段四：测试部署 | ⏳ 待开始 | 0% | 预计11月下旬 |

**整体进度**: 80% ✅

**Phase 2.5 新增功能** (2025-10-31):
- ✅ 动态参数表头展示（智能表头 + HTML支持）
- ✅ 分类筛选器集成（级联选择 + 分类统计）
- ✅ CSV导出功能（包含动态参数）
- ✅ 工具函数库（8个核心函数）
- ✅ 完整文档（3份详细文档）

### 🔧 技术问题解决记录

#### 问题1: TypeScript编译错误
```
错误信息: 
Property 'userId' does not exist on type 'string | JwtPayload'

解决方案:
const decoded = jwt.verify(token, process.env.JWT_SECRET!) as JwtPayload;

位置: backend/src/middleware/authMiddleware.ts:19
```

#### 问题2: DoEEEt数据格式特殊性
```python
# family_path 是Python列表字符串
"['Peripheral-Controller', 'Digital', 'Microcircuits']"

# 需要替换单引号为双引号后JSON.parse
JSON.parse(comp.family_path.replace(/'/g, '"'))
```

### 📈 关键指标

| 指标 | 当前状态 | 目标 | 完成度 |
|------|---------|------|--------|
| 后端服务 | ✅ 运行中 (端口3001, MongoDB 8.2.1) | 稳定运行 | 100% |
| 数据导入 | ✅ 1.8M组件 | 完成 | 100% |
| 数据备份 | 🔄 脚本已完善 | 备份完成 | 80% |
| 数据迁移 | 🔄 脚本已创建 | 迁移完成 | 50% |
| 搜索API | ✅ 10个端点 | 完成 | 100% |
| 动态参数表头 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| 分类筛选器 | ✅ 已实现并集成 | 完成 | 100% ⭐ |
| CSV导出 | ✅ 已实现 | 完成 | 100% ⭐ |
| 搜索性能 | ⚠️ 200ms | <50ms | 需Redis优化 |
| 前端数据打通 | ⚠️ 1/12页面 | 全部接入 | 8% |
| 参数对比 | ❌ 未实现 | 已实现 | 0% |
| 分面搜索 | ❌ 未实现 | 已实现 | 0% |

## 更新日志

### 2025-11-12 (v2.4.1) 🔄
- ✅ **组件对比体验优化**：过滤掉参数名称为 `Unknown` 或空白的对比行，减少噪声信息
- ✅ **参数标题完善**：对比矩阵优先展示首个有效参数名，缺失时统一显示“未命名参数”，保证列标题一致
- 📁 **影响文件**：`frontend/src/components/ComponentCompareModal.tsx`

### 2025-11-01 (v2.4) 🔍
- ✅ **对比分析完成**: 完成与 DOEEET 原始网站的深入对比分析
- ✅ **改进思路文档**: 
  - 5个核心功能模块的对比分析（分类浏览、筛选面板、筛选器、结果展示、搜索整合）
  - 详细的改进思路和实施优先级建议
  - 技术实现要点总结
- ✅ **文档更新**: 
  - [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md) - 添加对比分析与改进思路章节
  - [DoEEEt集成实施总结.md](./DoEEEt集成实施总结.md) - 添加对比分析与改进思路章节
- 📋 **实施计划**: 
  - Phase 1: 核心布局改造（高优先级）
  - Phase 2: 筛选功能增强（高优先级）
  - Phase 3: 用户体验优化（中优先级）
  - Phase 4: 高级功能（低优先级）

### 2025-10-31 (v2.3) 🆕⭐
- ✅ **Phase 2.5 完成**: 动态参数表头功能全面上线
- ✅ **动态参数表头展示**: 
  - 智能表头（short_name + Tooltip）
  - HTML标签支持（`<sub>`, `<sup>`）
  - DOMPurify安全清理
  - 参数列可排序、可筛选
- ✅ **分类筛选器集成**: 
  - CategoryFilter组件集成到ComponentSearch
  - 级联选择器展示 2-5 层分类
  - Tab导航显示15个顶层分类
  - 分类统计数据分析完成（1.8M组件）
- ✅ **CSV导出功能**: 
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码支持中文
  - 自动文件名（带时间戳）
- ✅ **工具函数库**: `parameterUtils.tsx` (8个核心函数)
- ✅ **文档完善**: 
  - [动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)
  - [动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)
  - [DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)
  - [DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)
  - [DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)
- 📝 **项目进度更新**: 阶段三从45%提升至65%，整体进度80%
- 📊 **数据分析**: 完成 family_path 结构分析（14个顶层分类，181个叶子分类）

### 2025-10-30 (v2.2)
- ✅ **数据库备份脚本完善**: 支持 MongoDB 8.2.1，强制使用 mongosh
- ✅ **数据迁移脚本创建**: `migrate_doeeet_data_format.js`，修复数据格式
- 🔄 **优先级调整**: 数据备份与迁移（P0）→ 前端验证 → 参数对比 → 分面搜索
- 📝 **项目进度更新**: 阶段三从40%提升至45%，整体进度72%
- 📝 **技术债务**: MongoDB 8.x 与 mongodump 100.x 兼容性问题已解决

### 2024-10-30 下午 (v2.1)
- ✅ **后端编译问题修复**: jsonwebtoken类型断言
- ✅ **后端服务启动**: 端口3001，MongoDB+Redis正常
- ✅ **ComponentSearch接入API**: 数据适配器实现完成
- 📝 **优先级调整**: 前端数据流验证 → 参数对比 → 分面搜索 → Redis缓存
- 📝 **项目进度更新**: 阶段三从30%提升至40%，整体进度70%

### 2024-10-30 上午
- ✅ 完成Phase 1.1: 前端组件搜索页面集成
- ✅ 完成Phase 1.2: 组件详情弹窗
- ✅ 完成Phase 1.3: 首页分类统计
- ✅ 完成Phase 2.1-2.3: 参数范围筛选
- ✅ 完成Phase 2.5: 参数对比功能（计划中）

## 下一步计划

### 本周内 (10月31日 - 11月3日)
1. ✅ ~~后端服务启动并验证~~
2. ✅ ~~ComponentSearch API集成~~
3. ✅ ~~数据库备份脚本完善~~
4. ✅ ~~动态参数表头实现~~ ⭐
5. ✅ ~~分类筛选器集成~~ ⭐
6. ✅ ~~CSV导出功能~~ ⭐
7. ✅ ~~family_path数据分析~~ ⭐
8. 🔄 **前端服务启动并测试** (当前任务)
9. 🔄 真机测试动态参数表头
10. 🔄 性能测试和优化

### 下周 (11月4日 - 11月10日)
1. 🔄 执行数据库备份（如需要）
2. 🔄 执行数据格式迁移（如需要）
3. ⏳ 参数列配置保存（显示/隐藏、拖拽排序）
4. ⏳ 参数对比功能开发
5. ⏳ 分面搜索实现
6. ⏳ Redis缓存性能优化

### 中期计划 (11月中下旬)
1. 其他11个搜索页面迁移
2. 全面集成测试
3. 参数列的高级筛选
4. 参数统计图表展示
5. 移动端适配

### 长期计划
1. **Phase 3**: 数字模型关联和下载（按需实施）
2. **性能优化**: 进一步优化大数据量查询
3. **用户反馈**: 收集用户反馈并迭代改进
4. **文档完善**: API文档、用户手册等
5. **国际化支持**: 中英文切换

---

## 新增：辐照数据模块实施方案（2025-11-19）

### 背景与目标
- `backend\scripts\import_irradiation_excel.py` 已将《通用器件辐照数据.xlsx》导入 `business_plat.irradiation_tests`（1,921 条记录）
- 需要提供一个与 DoEEEt 功能一致的“辐照数据”查询模块，满足内部器件辐照指标检索、筛选及导出

### 后端改造
- **数据模型**：在 `backend/src/models/IrradiationTest.ts` 定义 mongoose schema（字段覆盖 Excel 列：产品类别、子类别、器件型号、供应商、质量等级、总剂量、单粒子效应、测试机构、备注等），补充 `created_at`、`_source`
- **索引策略**：`model`、`supplier`、`quality_grade`、`category` 复合索引；`created_at`/`updated_at` 单索引；如需范围筛选（剂量值），对相应数值字段建索引
- **服务层**：新增 `RadiationDataService`，完成：
  - 查询参数解析：`keyword` 模糊匹配型号/规格/供应商；`category/subcategory/qualityGrade/supplier` 精确筛选
  - 数值范围：`total_dose_min/max`、`see_min/max` 等可选范围
  - 分页与排序：统一 `page/limit/sortField/sortOrder`，默认按 `model` 升序
  - 缓存：复用 `CacheService`，基于 query hash 缓存 5 分钟
- **控制器与路由**：`backend/src/controllers/radiationDataController.ts` + `backend/src/routes/radiationDataRoutes.ts`，暴露 `GET /api/radiation-data`
- **契约与校验**：控制器内使用 `express-validator` 校验分页/排序参数；响应沿用 `{ success, data, error }` 结构，列表返回 `{ items, total, page, limit, hasNextPage }`
- **测试**：在 `backend/tests/radiationData.test.ts` 增加分页、筛选、空数据用例；更新 `API_MODULES_SUMMARY.md`、`API_QUICK_REFERENCE.md`

### 前端改造
- **导航与路由**：
  - `Layout.tsx` 的“器件查询”子菜单新增 “辐照数据” 链接
  - `HomePage.tsx` 分类卡片补充入口
  - `App.tsx` 新增路由：`<Route path="/components/radiation-data" element={<RadiationDataPage />} />`
- **页面实现 (`RadiationDataPage.tsx`)**：
  - 顶部说明卡：数据来源、更新时间、导入脚本说明
  - 查询表单：关键词输入 + Select（产品类别/子类别/质量等级/供应商）+ 可选数值范围输入
  - 表格展示：列按 Excel 表头（允许 `ellipsis` + `Tooltip`），支持排序、分页、空态/错误态
  - 导出：复用 `parameterUtils.tsx` 的导出工具或创建 `downloadRadiationCSV`，导出当前查询结果
- **服务层**：在 `frontend/src/services` 新增 `radiationDataService.ts`，封装 `fetchRadiationData(params)`，统一错误提示
- **状态与 URL**：表单状态与 `useSearchParams` 同步，便于分享链接；`useEffect` 根据 URL 自动加载数据
- **样式**：继承 `ComponentSearch` 的 `Card`/`Table` 风格，保持布局一致；移动端使用 `Drawer` 表单

### 运维与数据流程
- 数据更新流程：`python backend\scripts\import_irradiation_excel.py --dry-run` → `--collection irradiation_tests --drop-existing`
- 导入完成后执行缓存失效（若引入缓存，可提供 `/api/cache/purge?scope=radiation-data`）
- 在 README 或启动脚本提示中新增“释放 27017 端口 & 辐照数据导入步骤”，防止写入系统 MongoDB 目录

### 里程碑拆解
1. **P0**：后端模型 + API（含测试） → 交付供前端串联
2. **P1**：前端页面 + 导航联动 + 导出能力
3. **P2**：文档更新（README、DoEEEt 功能总览、API 索引）+ 运行手册（导入、缓存刷新、验证）
4. **P3（可选）**：后续扩展图表展示/统计卡片、Excel 在线上传入口

> 完成以上步骤后再进入编码阶段，确保方案与现有 DoEEEt 架构保持一致。

## 📚 相关文档索引

### Phase 2.5: 动态参数表头完整文档

#### 核心文档
1. **[DoEEEt动态参数表头实施总结.md](./DoEEEt动态参数表头实施总结.md)**
   - 核心功能总结
   - 技术实现详解
   - 数据统计和性能优化
   - 实施进度（75%完成）

2. **[DoEEEt动态参数表头集成完成总结.md](./DoEEEt动态参数表头集成完成总结.md)**
   - 集成到ComponentSearch的完整过程
   - 数据流和技术细节
   - 测试指南和已知问题
   - 状态：✅ 集成完成，待测试

3. **[动态参数表头展示说明.md](./frontend/docs/动态参数表头展示说明.md)**
   - 数据结构详解
   - 展示逻辑和规则
   - 3种实现方案对比
   - HTML渲染和安全性

4. **[动态参数表头-快速开始.md](./frontend/docs/动态参数表头-快速开始.md)**
   - 5分钟快速上手
   - API完整参考
   - 使用场景和示例
   - 常见问题解答

#### 数据分析文档
5. **[DoEEEt分类路径(family_path)分析报告.md](./DoEEEt分类路径(family_path)分析报告.md)**
   - 1.8M组件分类结构分析
   - 14个顶层分类统计
   - 路径长度分布（2-5层）
   - 前端筛选器设计建议
   - MongoDB聚合查询示例

#### 示例代码
6. **[parameterUtils.tsx](./frontend/src/utils/parameterUtils.tsx)**
   - 8个核心工具函数
   - TypeScript类型定义
   - JSDoc完整注释

7. **[DynamicParameterTableExample.tsx](./frontend/src/examples/DynamicParameterTableExample.tsx)**
   - 完整使用示例
   - 最佳实践演示

8. **[ComponentSearch.tsx](./frontend/src/pages/components/ComponentSearch.tsx)**
   - 实际集成代码
   - 生产环境实现

### 其他功能文档
- [前端分类筛选功能实施方案.md](./前端分类筛选功能实施方案.md)
- [DoEEEt功能开发总览.md](./DoEEEt功能开发总览.md)
- [DoEEEt-README.md](./DoEEEt-README.md)

---

## 🎯 Phase 2.5 核心成果总结

### ✅ 已完成功能（2025-10-31）

#### 1. 动态参数表头系统
- **智能表头展示**
  - 有 `short_name`: 显示简写 + Tooltip（完整名称）
  - 无 `short_name`: 直接显示完整名称
  - 覆盖率：80%参数有简写，20%仅有完整名称
  
- **HTML标签支持**
  - 支持 `<sub>`、`<sup>`、`<b>`、`<i>` 等标签
  - 示例：T<sub>STG</sub>、V<sub>CC</sub>、I<sub>O</sub>
  - DOMPurify安全清理，防XSS攻击
  
- **参数列功能**
  - 可排序（升序/降序）
  - 可筛选（输入框筛选）
  - 可自定义宽度
  - 超长省略（ellipsis）

### 2.6 表头渲染规范与固定参数取值方案 🆕

本节明确搜索结果与对比表中“动态参数表头”的展示规范，以及 Package 与 TOP（Operating Temperature）两项固定参数的取值来源与后端聚合方案，确保与 DOEEET 原站表现一致。

#### 展示规范
- 有 short_name 时：标题显示为“✖ short_name”，鼠标悬停显示完整 name（Tooltip）。
- 无 short_name 时：标题直接显示 name（不显示 Tooltip）。
- HTML 标签支持：允许 `<sub>` / `<sup>` 等（通过 DOMPurify 清理后安全渲染）。
- 空值显示：统一使用 “--” 代替 “Unknown”，长文本启用省略与悬停展示完整值。

示例：
```
✖ T_A [Max]        ← 列标题显示 short_name
(Access Time [Max]) ← 悬停 Tooltip 显示 name
```

#### 固定参数（Package 与 TOP）策略
- 固定两项，固定顺序展示在基础信息之后、动态参数之前：
  1) Package（parameter_key = `5df8d422-39bd-431f-9095-582a3f6f8fc1`）
  2) Operating Temperature（TOP，parameter_key = `2f2e7f5a-7cd0-47da-8feb-a29336285a3e`）
- 名称来源：`parameter_definitions`（通过 parameter_key 关联，获取 name 与 short_name）。
- 取值来源：`parameters`（按组件 component_id + parameter_key 获取具体值）。

#### 后端聚合与响应结构
为减少多次 IO 与确保顺序稳定，后端在详情与搜索结果适配时统一聚合输出三段数据：
1) static：来自 components/general 的静态字段（型号、制造商、质量等级、生命周期等）。
2) fixedExtras：仅包含 Package 与 TOP 两项（按上述固定顺序）。
3) dynamic：依据该器件 family_path 在 `meta.json` 匹配到的 `meta` 有序列表进行生成；即使某项无值也保留结构（值为 null/空字符串），方便前端一致渲染与列对齐。

接口响应示例（节选）：
```json
{
  "static": { "part_number": "CY7C432-80DMB", "manufacturer_name": "Teledyne e2v Inc", "...": "..." },
  "fixedExtras": [
    { "key": "5df8d422-39bd-431f-9095-582a3f6f8fc1", "name": "Package", "shortName": "Package", "value": "CDIP-28" },
    { "key": "2f2e7f5a-7cd0-47da-8feb-a29336285a3e", "name": "Operating Temperature Range", "shortName": "T<sub>OP</sub>", "value": "-55°C to +125°C" }
  ],
  "dynamic": [
    { "key": "24d759de-b13d-4aa4-af76-42e60d2302ec", "name": "Number of Contacts", "shortName": "#Contacts", "value": 20, "category": "Mechanical Data" }
  ]
}
```

实现要点：
- 批量取值：一次性读取该组件的所有 parameters 记录 → 构建 `Map<parameter_key,value>`；再批量查询 definitions → 构建 `Map<parameter_key,{name,short_name,category}>`。
- 固定参数优先：先拼装 fixedExtras（Package、TOP），再按 meta.json 的 `meta` 顺序生成 dynamic。
- 缓存优化：`meta.json` 常驻内存或 Redis（TTL 建议 ≥ 1h）；definitions 也可缓存；组件详情可短期缓存 30m。
- 兼容性：提供查询参数 `includeEmpty=false` 以允许前端在需要时隐藏无值项（默认保留结构）。

### ⛳ 横向参数表模式（Beta）实施方案（静态+动态“一行展示”）

为对齐 DOEEET 的“每个器件一整行，左静态右动态”的交互，本期在搜索结果与详情弹窗中引入“横向参数表模式（Beta）”。核心是基于一套“列方案生成器”，将固定字段与动态参数列拼接为同一张宽表。

#### 一、列方案
- 静态列（固定）：
  - `partNumber`、`manufacturer`、`mainCategory/primaryCategory/secondaryCategory`（可视情况只留主类）、`package`、`TOP`
- 动态列（可变）：
  - 来源：接口返回的 `parameterDefinitions`（当前分类对应的候选参数定义）
  - 标题：优先 `short_name`，悬停显示完整 `name`；无 `short_name` 时直接显示 `name`
  - 取值：从每行数据的 `parameters[paramKey]` 读取

#### 二、数据整形
- 列表接口返回形如：
  - `entry.static`（静态字段）、`entry.fixedExtras`（Package/TOP）、`entry.dynamic[]`（若后端已返回动态值）
- 前端行对象构造：
  - `row.parameters = reduce(entry.dynamic, (acc, {key,value}) => (acc[key]=value, acc), {})`
  - `row.package/top` 优先取 `fixedExtras`；缺失时回退到 `static.part_type` 等

#### 三、渲染与交互
- 搜索结果表：
  - 列集合：`[静态列] + generateDynamicParameterColumns(parameterDefinitions)`
  - 冻结左侧关键列：`partNumber`、`manufacturer`
  - 横向滚动：`scroll.x` 启用，列宽自适应，超长 Tooltip
- 详情弹窗：
  - 以同一套列方案渲染一行数据（`dataSource=[selectedComponent]`），替换原三列“参数名称/值/分类”结构
  - 保留“基础信息”上方的 `Descriptions`，参数区切换为横向宽表

#### 四、性能策略
- 按当前页动态渲染可见列，启用列宽最小值与省略
- 后端尽量返回当前分类的 `parameterDefinitions`，避免首屏收集全库键集合
- 逐步演进：Beta 阶段只按 `parameterDefinitions` 生成列，不做“低频列阈值/列管理器”，后续再启用

#### 五、落地改动说明（已实施）
- 前端
  - `frontend/src/pages/components/ComponentSearch.tsx`
    - 列表：将搜索结果的 `entry.dynamic` 聚合为 `row.parameters`；并基于 `parameterDefinitions` 生成动态列，拼接到静态列后面
    - 详情：用“横向参数表（一行）”替换原三列表格，复用相同的动态列生成器
  - `frontend/src/utils/parameterUtils.tsx`
    - 复用 `generateParameterColumnTitle` 与 `generateDynamicParameterColumns`，标题规则与 Tooltip 保持与前述规范一致
- 兼容性
  - 若后端暂未返回 `entry.dynamic`，动态列仍会渲染但显示为 “-”，不影响页面可用性

#### 六、下一步（可选增强）
- 列管理器（显示/隐藏、拖拽排序、持久化）
- 参数值标准化与单位合并（如温度、电压范围格式）
- 虚拟化渲染以优化超宽表性能（>150 列）
#### 2. 分类筛选系统
- **数据分析完成**
  - 14个顶层分类（Resistors占45.88%，Capacitors占27.99%）
  - 181个叶子分类
  - 路径深度2-5层（86.86%为2层）
  - 1.8M组件100%有分类路径
  
- **UI组件集成**
  - CategoryFilter级联选择器
  - Tab导航（15个顶层分类）
  - 分类统计数量显示
  - 选择联动搜索

#### 3. 数据导出系统
- **CSV导出**
  - 导出静态列 + 动态参数列
  - UTF-8 BOM编码（支持Excel打开中文）
  - 自动文件名（带时间戳）
  - 1000行 < 1s（预期性能）

#### 4. 工具函数库
**8个核心函数** (`parameterUtils.tsx`):
```typescript
1. generateParameterColumnTitle()      // 生成智能表头
2. generateDynamicParameterColumns()   // 批量生成动态列
3. generateGroupedParameterColumns()   // 生成分组列
4. exportParametersToCSV()             // 导出CSV
5. downloadCSV()                       // 下载CSV文件
6. groupParametersByCategory()         // 按分类分组参数
7. formatParameterValue()              // 格式化参数值
8. extractParameterKeys()              // 提取参数键列表
```

### 📊 数据统计

| 项目 | 数量 | 说明 |
|------|------|------|
| 组件总数 | 1,797,417 | 有分类路径的组件 |
| 参数定义 | 360个 | 唯一参数键 |
| 有简写参数 | ~288个 (80%) | 有 short_name |
| 无简写参数 | ~72个 (20%) | 仅有 name |
| 顶层分类 | 14个 | Resistors, Capacitors等 |
| 叶子分类 | 181个 | 最细分类 |
| 文档数量 | 8份 | 完整技术文档 |
| 代码文件 | 3个 | 工具函数+示例+集成 |

### 🎨 UI效果预览

```
┌─────────────────────────────────────────────────────────────┐
│                  DoEEEt 器件搜索系统                         │
├─────────────────────────────────────────────────────────────┤
│ [分类筛选] ▼                                                 │
│   > Resistors (824,599)  > Capacitors (503,149)             │
│   > Connectors (160,090) > Crystals (131,524) ...          │
├─────────────────────────────────────────────────────────────┤
│ 型号: [_____] 制造商: [_____]  [搜索] [重置] [导出CSV]     │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┬──────┬────────ⓘ┬──────ⓘ┬────────ⓘ┐           │
│ │ 器件型号 │ 制造 │  #Pins  │ T_STG  │  V_CC   │ ...       │
│ │         │ 商   │         │        │         │           │
│ ├─────────┼──────┼─────────┼────────┼─────────┤           │
│ │ 860300  │ SIB  │ 68      │-55~150°│ 3.3~5V  │ ...       │
│ │ 860301  │ SIB  │ 72      │-40~125°│ 5V      │ ...       │
│ └─────────┴──────┴─────────┴────────┴─────────┘           │
│                                                             │
│ 💡 提示：鼠标悬停在 #Pins, T_STG 等列上查看完整参数名      │
└─────────────────────────────────────────────────────────────┘
```

### 🚀 技术亮点

1. **类型安全**: 完整的TypeScript类型定义
2. **代码复用**: 8个通用工具函数，可在多页面复用
3. **性能优化**: 动态列宽、虚拟滚动支持
4. **安全性**: DOMPurify防XSS攻击
5. **可维护性**: JSDoc注释 + 详细文档
6. **用户体验**: Tooltip、省略、排序、筛选

### 📈 项目影响

- **开发效率提升**: 工具函数库减少50%重复代码
- **用户体验提升**: 智能表头 + 分类筛选，降低学习成本
- **维护成本降低**: 完整文档 + 类型定义，便于后期维护
- **可扩展性强**: 支持任意数量的动态参数，支持多级分类

---

## 联系方式

如有问题或建议，请联系开发团队。

**最后更新**: 2025-11-01  
**版本**: v2.4  
**整体进度**: 80% ✅


### 2025-11-11 (v2.4.1) 🛠️
- ✅ 前端稳定性增强：为以下接口增加统一超时与错误处理（15s 超时，按状态码提示；失败不做误导性降级）
  - `GET /api/doeeet/components/:id`（组件详情弹窗）
  - `GET /api/doeeet/categories/tree`（分类筛选器）
- ✅ 分类树失败时不再回退静态顶层分类，避免误导；失败时清空并提示
- ✅ Linter 检查通过（无新增告警）
- 影响文件：
  - `frontend/src/pages/components/ComponentSearch.tsx` → `showDetail`
  - `frontend/src/components/CategoryFilter.tsx` → `loadCategoryTree`

#### 接下来建议
- P0：抽象统一的前端请求层（含超时、错误映射、重试/熔断开关），替换页面内分散实现
- P1：为 `POST /api/doeeet/components/compare` 套同样的超时/错误策略
- P1：后端 Faceting 与缓存（按既定里程碑 B），完善筛选器可用项和计数

### 2025-11-19 (v2.4.2) ⚙️
- ✅ 本地环境排查：确认端口 `27017` 被系统服务 `mongod.exe`（PID 5812）与 MongoDB Compass（PID 4384）占用，导致项目自带 MongoDB 无法启动
- ✅ 制定释放端口流程：关闭 Compass → `taskkill /PID 5812 /F`（或 `net stop MongoDB`）→ 再执行 `backend\start-mongodb-local.bat`
- ✅ 补充验证手段：通过 `netstat -ano | findstr 27017` 快速确认端口状态；若无输出即可重新启动项目实例
- 🔄 下一步：在 README 或启动脚本提示中固化上述步骤，避免再次写入到系统 MongoDB 数据目录
- ✅ 辐照测试数据导入：在 `space_env` 虚拟环境内依次执行
  1. Dry-run：`python backend\scripts\import_irradiation_excel.py --dry-run` → 成功解析 `Sheet1` 的 1,921 行数据但不写库
  2. 正式导入：`python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- ✅ 导入结果：`business_plat.irradiation_tests` 集合被清空并写入 1,921 条记录，对应最新 Excel 数据；脚本会在导入后回显 sheet 名称与写入数量
- 📋 验证建议：
  - `mongosh` 中执行 `db.irradiation_tests.countDocuments()`/`findOne()` 抽样字段映射
  - 如需长期查询性能，可视参数模式补充 `component_id`、`test_type` 等索引

```

## 文档更新完成
- `DoEEEt功能开发总览.md`：新增“辐照数据模块”概览，更新进度总览与最新动态，确保团队在高层视角下知道该模块的范围、入口与当前状态。
- `DoEEEt集成实施总结.md`：追加“辐照数据模块实施方案”章节，分解后端/前端/运维改造要点与里程碑，为后续落地提供完整执行指引。

目前只是文档更新，尚未改动代码或运行测试。若需要我继续实现实际功能，请告诉我下一步优先级。

---

**User**

好的，开始按照计划改代码吧

---

**Cursor**

```typescript
import mongoose, { Schema, Document, Model } from 'mongoose';

export interface SourceMetadata {
  row_number?: number;
  workbook?: string;
}

export interface IIrradiationTest extends Document {
  source_index?: number | string;
  category: string;
  subcategory?: string;
  product_name: string;
  model?: string;
  model_spec?: string;
  package?: string;
  total_dose?: string;
  total_dose_numeric?: number;
  single_event?: string;
  single_event_numeric?: number;
  displacement?: string;
  displacement_numeric?: number;
  esd_rating?: string;
  quality_grade?: string;
  general_spec?: string;
  detail_spec?: string;
  supplier?: string;
  remark?: string;
  created_at?: Date;
  updated_at?: Date;
  _source?: SourceMetadata;
}

const IrradiationTestSchema = new Schema<IIrradiationTest>(
  {
    source_index: { type: Schema.Types.Mixed },
    category: { type: String, required: true, trim: true },
    subcategory: { type: String, trim: true },
    product_name: { type: String, required: true, trim: true },
    model: { type: String, trim: true, index: true },
    model_spec: { type: String, trim: true },
    package: { type: String, trim: true },
    total_dose: { type: String, trim: true },
    total_dose_numeric: { type: Number },
    single_event: { type: String, trim: true },
    single_event_numeric: { type: Number },
    displacement: { type: String, trim: true },
    displacement_numeric: { type: Number },
    esd_rating: { type: String, trim: true },
    quality_grade: { type: String, trim: true, index: true },
    general_spec: { type: String, trim: true },
    detail_spec: { type: String, trim: true },
    supplier: { type: String, trim: true, index: true },
    remark: { type: String, trim: true },
    created_at: { type: Date, default: Date.now },
    updated_at: { type: Date },
    _source: {
      row_number: { type: Number },
      workbook: { type: String, trim: true },
    },
  },
  {
    collection: 'irradiation_tests',
    versionKey: false,
  }
);

IrradiationTestSchema.index({ category: 1, subcategory: 1 });
IrradiationTestSchema.index({ product_name: 1 });
IrradiationTestSchema.index({ model: 1, supplier: 1 });
IrradiationTestSchema.index({ quality_grade: 1, supplier: 1 });
IrradiationTestSchema.index(
  {
    product_name: 'text',
    model: 'text',
    model_spec: 'text',
    supplier: 'text',
    remark: 'text',
  },
  { name: 'irradiation_text_idx', weights: { model: 5, supplier: 4 } }
);

export const IrradiationTest: Model<IIrradiationTest> = mongoose.model<IIrradiationTest>(
  'IrradiationTest',
  IrradiationTestSchema
);


```

```typescript
// 导出所有数据模型
export { Component } from './Component';
export { Standard } from './Standard';
export { RadiationTest } from './RadiationTest';
export { IrradiationTest } from './IrradiationTest';
export { Supplier } from './Supplier';
export { DocumentModel } from './Document';
export { PolicyRegulationModel } from './PolicyRegulation';
export { TestRecord } from './TestRecord';
export { ProcurementRequest } from './ProcurementRequest';
export { FunctionalUnit, DigitalModel } from './ApplicationSupport';
export { User } from './User';

// 导出枚举类型

// 导出接口类型
export type { IComponent } from './Component';
export type { IStandard } from './Standard';
export type { IRadiationTest } from './RadiationTest';
export type { IIrradiationTest } from './IrradiationTest';
export type { ISupplier } from './Supplier';
export type { IDocument } from './Document';
export type { IPolicyRegulation } from './PolicyRegulation';
export type { ITestRecord } from './TestRecord';
export type { IProcurementRequest } from './ProcurementRequest';
export type { IFunctionalUnit, IDigitalModel } from './ApplicationSupport';
export type { IUser } from './User';


```

```typescript
// API响应类型
export interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  message?: string;
  pagination?: PaginationInfo;
  timestamp: string;
}

export interface ApiError {
  success: false;
  error: {
    code: string;
    message: string;
    stack?: string;
  };
  timestamp: string;
  path: string;
}

// 分页信息
export interface PaginationInfo {
  currentPage: number;
  totalPages: number;
  totalItems: number;
  itemsPerPage: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
}

// 查询参数
export interface QueryParams {
  page?: number;
  limit?: number;
  sort?: string;
  order?: 'asc' | 'desc';
  search?: string;
  category?: string;
  manufacturer?: string;
  supplier?: string;
  inStock?: boolean;
}

// 器件相关类型
export interface ComponentData {
  id: string;
  partNumber: string;
  name: string;
  description?: string;
  category: string;
  subcategory?: string;
  // 三级分类系统
  mainCategory: string;
  category1?: string;
  category2?: string;
  manufacturer: string;
  datasheet?: string;
  image?: string;
  
  // 航天器件专用字段
  package: string;
  lifecycle: LifecycleStatus;
  qualityLevel: QualityLevel;
  radiationLevel?: RadiationLevel;
  radiationHardness?: RadiationHardness;
  temperatureGrade?: TemperatureGrade;
  packageType?: PackageType;
  lifecycleStatus?: LifecycleStatus;
  
  // 参数信息
  specifications: ComponentSpecifications;
  parameters: ComponentParameters;
  
  // 标准合规
  standards: string[]; // 相关标准编号 (MIL/ESCC/ISO等)
  
  // 关联数据
  alternativeParts: string[]; // 替代料号
  documents: DocumentReference[];
  radiationData: RadiationTestReference[];

  radiationTests?: RadiationTestReference[];
  
  // 认证信息
  certifications?: Array<{
    type: string;
    number: string;
    issuedBy: string;
    issuedDate: Date;
    expiryDate?: Date;
    status: 'valid' | 'expired' | 'suspended' | 'revoked';
  }>;
  
  // 质量等级详细信息
  qualityGrade?: {
    screening?: string;
    testing?: string;
    reliability?: string;
  };
  
  // 标准符合性
  standardCompliance?: Array<{
    standardCode: string;
    standardType: StandardType;
    complianceLevel: string;
    verificationDate?: Date;
    notes?: string;
  }>;
  
  // 供应链信息
  supplyChain?: {
    primarySupplier?: string;
    alternativeSuppliers?: string[];
    leadTimeWeeks?: number;
    minimumOrderQuantity?: number;
    availability?: 'in_stock' | 'limited' | 'long_lead' | 'obsolete' | 'unknown';
  };
  
  // 技术特性
  technicalSpecs?: {
    operatingTemp?: {
      min?: number;
      max?: number;
      unit?: string;
    };
    storageTemp?: {
      min?: number;
      max?: number;
      unit?: string;
    };
    powerConsumption?: {
      typical?: number;
      maximum?: number;
      unit?: string;
    };
    dimensions?: {
      length?: number;
      width?: number;
      height?: number;
      unit?: string;
    };
    weight?: {
      value?: number;
      unit?: string;
    };
  };
  
  // 可靠性数据
  reliability?: {
    mtbf?: number;
    failureRate?: number;
    confidenceLevel?: number;
    testHours?: number;
    lastUpdated?: Date;
  };
  
  // 元数据
  metadata?: {
    isObsolete?: boolean;
    isRestricted?: boolean;
    isPreferred?: boolean;
    riskLevel?: 'low' | 'medium' | 'high' | 'critical';
    tags?: string[];
    notes?: string;
    lastReviewed?: Date;
    reviewedBy?: string;
  };
  
  // 商业信息
  pricing: ComponentPricing[];
  availability: ComponentAvailability[];
  suppliers: SupplierInfo[];
  
  createdAt: Date;
  updatedAt: Date;
}

// 质量等级枚举
export enum QualityLevel {
  SPACE = 'space',        // 宇航级
  MILITARY = 'military',  // 军用级
  INDUSTRIAL = 'industrial', // 工业级
  COMMERCIAL = 'commercial'  // 商业级
}

// 生命周期状态
export enum LifecycleStatus {
  ACTIVE = 'active',         // 量产
  NRND = 'nrnd',            // 不建议新设计使用
  OBSOLETE = 'obsolete',     // 停产
  EOL = 'eol',              // 生命周期结束
  PREVIEW = 'preview'        // 预览版
}

// 辐照等级
export enum RadiationLevel {
  LOW = 'low',              // 低辐照
  MEDIUM = 'medium',        // 中辐照  
  HIGH = 'high',            // 高辐照
  EXTREME = 'extreme'       // 极端辐照
}

// 辐射抗性
export enum RadiationHardness {
  NONE = 'NONE',           // 无抗辐射
  LOW = 'LOW',             // 低抗辐射
  MEDIUM = 'MEDIUM',       // 中等抗辐射
  HIGH = 'HIGH',           // 高抗辐射
  ULTRA_HIGH = 'ULTRA_HIGH' // 超高抗辐射
}

// 温度等级
export enum TemperatureGrade {
  COMMERCIAL = 'COMMERCIAL', // 商业级 (0°C to +70°C)
  INDUSTRIAL = 'INDUSTRIAL', // 工业级 (-40°C to +85°C)
  AUTOMOTIVE = 'AUTOMOTIVE', // 汽车级 (-40°C to +125°C)
  MILITARY = 'MILITARY',     // 军用级 (-55°C to +125°C)
  SPACE = 'SPACE'           // 航天级 (-55°C to +150°C)
}

// 封装类型
export enum PackageType {
  DIP = 'DIP',
  SOIC = 'SOIC',
  QFP = 'QFP',
  BGA = 'BGA',
  LGA = 'LGA',
  CSP = 'CSP',
  TQFP = 'TQFP',
  LQFP = 'LQFP',
  PLCC = 'PLCC',
  PGA = 'PGA',
  SOP = 'SOP',
  SSOP = 'SSOP',
  TSSOP = 'TSSOP',
  MSOP = 'MSOP',
  QFN = 'QFN',
  DFN = 'DFN',
  WLCSP = 'WLCSP',
  FLIPCHIP = 'FLIPCHIP',
  CERAMIC = 'CERAMIC',
  METAL_CAN = 'METAL_CAN',
  BARE_DIE = 'BARE_DIE',
  CUSTOM = 'CUSTOM'
}

// 器件参数结构
export interface ComponentParameters {
  electrical: ElectricalParameters;
  mechanical: MechanicalParameters;
  thermal: ThermalParameters;
  environmental: EnvironmentalParameters;
  radiation?: RadiationParameters;
}

export interface ElectricalParameters {
  voltage?: {
    operating?: number;
    maximum?: number;
    minimum?: number;
    unit: string;
  };
  current?: {
    operating?: number;
    maximum?: number;
    unit: string;
  };
  power?: {
    maximum?: number;
    dissipation?: number;
    unit: string;
  };
  frequency?: {
    operating?: number;
    maximum?: number;
    unit: string;
  };
  resistance?: number;
  capacitance?: number;
  inductance?: number;
}

export interface MechanicalParameters {
  dimensions?: {
    length?: number;
    width?: number;
    height?: number;
    unit: string;
  };
  weight?: {
    value: number;
    unit: string;
  };
  pinCount?: number;
  leadPitch?: number;
}

export interface ThermalParameters {
  operatingTemp?: {
    min: number;
    max: number;
    unit: string;
  };
  storageTemp?: {
    min: number;
    max: number;
    unit: string;
  };
  thermalResistance?: number;
  junctionTemp?: number;
}

export interface EnvironmentalParameters {
  humidity?: {
    min: number;
    max: number;
    unit: string;
  };
  vibration?: {
    frequency: number;
    acceleration: number;
  };
  shock?: {
    acceleration: number;
    duration: number;
  };
  altitude?: {
    max: number;
    unit: string;
  };
}

export interface RadiationParameters {
  tid?: {
    level: number;
    unit: string;
    testCondition?: string;
  };
  see?: {
    threshold: number;
    crossSection: number;
    unit: string;
  };
  dd?: {
    threshold: number;
    sensitivity: number;
    unit: string;
  };
  neutron?: {
    fluence: number;
    energy: number;
    unit: string;
  };
}

export interface ComponentSpecifications {
  [key: string]: string | number | boolean;
}

export interface ComponentPricing {
  supplier: string;
  currency: string;
  price: number;
  quantity: number;
  leadTime?: number;
}

export interface ComponentAvailability {
  supplier: string;
  stockQuantity: number;
  location?: string;
  lastUpdated: Date;
}

// 文档引用
export interface DocumentReference {
  id: string;
  type: 'datasheet' | 'certificate' | 'report' | 'standard';
  title: string;
  url: string;
  version?: string;
  uploadedAt: Date;
}

// 辐照测试引用
export interface RadiationTestReference {
  id: string;
  testType: RadiationTestType;
  testDate: Date;
  testLab: string;
  certificationLevel: string;
  reportUrl?: string;
  summary: string;
}

export enum RadiationTestType {
  TID = 'tid',        // Total Ionizing Dose
  SEE = 'see',        // Single Event Effects
  DD = 'dd',          // Displacement Damage
  NEUTRON = 'neutron', // Neutron Effects
  PROTON = 'proton'   // Proton Effects
}



// 供应商信息
export interface SupplierInfo {
  id: string;
  name: string;
  code: string;
  qualificationLevel: SupplierQualificationLevel;
  contactInfo: SupplierContact;
  isActive: boolean;
  lastAuditDate?: Date;
  certifications: string[];
  capabilities?: {
    productCategories?: string[];
    services?: string[];
    qualityStandards?: Array<{
      standard: string;
      certificationNumber?: string;
      validUntil?: Date;
      issuedBy?: string;
    }>;
    radiationTesting?: {
      hasCapability?: boolean;
      testTypes?: string[];
      accreditation?: string;
    };
    spaceQualification?: {
      hasExperience?: boolean;
      programs?: string[];
      certificationLevel?: string;
    };
  };
  performance?: any;
  riskAssessment?: any;
  contractInfo?: any;
  metadata?: any;
}

export enum SupplierQualificationLevel {
  A = 'A',  // A级供应商
  B = 'B',  // B级供应商
  C = 'C',  // C级供应商
  UNQUALIFIED = 'unqualified' // 未认证
}

// 供应商联系信息
export interface SupplierContact {
  primaryContact: {
    name: string;
    title?: string;
    email: string;
    phone?: string;
    mobile?: string;
  };
  technicalContact?: {
    name?: string;
    title?: string;
    email?: string;
    phone?: string;
    mobile?: string;
  };
  address: {
    street: string;
    city: string;
    state?: string;
    country: string;
    postalCode?: string;
    coordinates?: {
      latitude: number;
      longitude: number;
    };
  };
  website?: string;
  socialMedia?: {
    linkedin?: string;
    twitter?: string;
  };
}

// 供应商相关类型
export interface SupplierData {
  id: string;
  name: string;
  code: string;
  description?: string;
  website?: string;
  contactInfo: SupplierContact;
  address: SupplierAddress;
  rating?: number;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export interface SupplierContact {
  email?: string;
  phone?: string;
  contactPerson?: string;
}

export interface SupplierAddress {
  street?: string;
  city?: string;
  state?: string;
  country?: string;
  postalCode?: string;
}

// 搜索相关类型
export interface SearchFilters {
  category?: string[];
  manufacturer?: string[];
  supplier?: string[];
  priceRange?: {
    min: number;
    max: number;
  };
  specifications?: {
    [key: string]: string | number | boolean;
  };
  inStock?: boolean;
}

export interface SearchResult {
  components: any[];
  filters: {
    categories: string[];
    manufacturers: string[];
    suppliers: string[];
    priceRange: {
      min: number;
      max: number;
    };
  };
  pagination: PaginationInfo;
}

// 上传文件类型
export interface UploadedFile {
  filename: string;
  originalName: string;
  mimeType: string;
  size: number;
  path: string;
  uploadedAt: Date;
}

// ================= 业务核心数据模型 =================



// 标准文档数据模型
export interface StandardData {
  id: string;
  standardCode: string;  // 标准编号 如 MIL-STD-883K
  standardType: StandardType;
  title: string;
  version: string;
  status: StandardStatus;
  publishDate: Date;
  effectiveDate: Date;
  
  // 标准关系
  replacedBy?: string;     // 替代标准ID
  replaces?: string[];     // 被替代的标准ID
  relatedStandards: string[];
  
  // 内容信息
  abstract?: string;
  scope: string;
  fileUrl?: string;
  downloadCount: number;
  
  // 关联信息
  relatedComponents: string[];  // 关联的器件ID
  category: string[];          // 适用类别
  
  createdAt: Date;
  updatedAt: Date;
}

export enum StandardType {
  MIL = 'MIL',        // 美国军用标准
  ESCC = 'ESCC',      // 欧空局标准
  ISO = 'ISO',        // 国际标准化组织
  IEC = 'IEC',        // 国际电工委员会
  GB = 'GB',          // 国家标准
  GJB = 'GJB',        // 国军标
  JEDEC = 'JEDEC',    // JEDEC标准
  NASA = 'NASA'       // NASA标准
}

export enum StandardStatus {
  ACTIVE = 'active',       // 现行
  WITHDRAWN = 'withdrawn', // 废止
  SUPERSEDED = 'superseded', // 被替代
  DRAFT = 'draft'          // 草案
}

// 辐照测试数据模型
export interface RadiationTestData {
  id: string;
  componentId: string;
  componentPartNumber: string;
  testType: RadiationTestType;
  testCondition: RadiationTestCondition;
  testResult: RadiationTestResult;
  testDate: Date;
  testLab: string;
  testOperator: string;
  
  // 认证信息
  certificationLevel: string;
  passFailStatus: 'pass' | 'fail' | 'conditional';
  
  // 文档
  reportFile?: string;
  certificateFile?: string;
  dataFiles: string[];
  
  // 批次信息
  batchNumber: string;
  sampleCount: number;
  
  createdAt: Date;
  updatedAt: Date;
}

export interface RadiationTestCondition {
  // TID 测试条件
  totalDose?: number;        // 总剂量 (rad)
  doseRate?: number;         // 剂量率 (rad/s)
  biasCondition?: string;    // 偏置条件
  
  // SEE 测试条件
  particleType?: string;     // 粒子类型
  particleEnergy?: number;   // 粒子能量 (MeV)
  fluence?: number;          // 注量 (particles/cm²)
  
  // 环境条件
  temperature?: number;      // 测试温度 (°C)
  humidity?: number;         // 湿度 (%)
  duration?: number;         // 测试时长 (hours)
}

export interface RadiationTestResult {
  // TID 结果
  tidLevel?: number;         // TID等级 (rad)
  parametricShift?: {        // 参数漂移
    parameter: string;
    beforeValue: number;
    afterValue: number;
    shiftPercent: number;
  }[];
  
  // SEE 结果
  seeThreshold?: number;     // SEE阈值 (MeV·cm²/mg)
  crossSection?: number;     // 截面 (cm²)
  errorRate?: number;        // 错误率
  
  // 通用结果
  functionalStatus: 'pass' | 'fail' | 'degraded';
  notes?: string;
  rawData?: any;
}

// 辐照数据查询类型
export interface IrradiationDataRecord {
  _id: string;
  source_index?: number | string;
  category: string;
  subcategory?: string;
  product_name: string;
  model?: string;
  model_spec?: string;
  package?: string;
  total_dose?: string;
  total_dose_numeric?: number;
  single_event?: string;
  single_event_numeric?: number;
  displacement?: string;
  displacement_numeric?: number;
  esd_rating?: string;
  quality_grade?: string;
  general_spec?: string;
  detail_spec?: string;
  supplier?: string;
  remark?: string;
  created_at?: Date;
  updated_at?: Date;
}

export interface RadiationDataListResponse {
  items: IrradiationDataRecord[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
}

export interface RadiationDataFilterOptions {
  categories: string[];
  subcategories: string[];
  qualityGrades: string[];
  suppliers: string[];
}

```

```typescript
import crypto from 'crypto';
import { FilterQuery } from 'mongoose';
import { IrradiationTest, IIrradiationTest } from '../models/IrradiationTest';
import { CacheService, getCacheService, CacheTTL } from './CacheService';
import { RadiationDataFilterOptions, RadiationDataListResponse } from '../types';

export interface RadiationDataQuery {
  page?: number | string;
  limit?: number | string;
  keyword?: string;
  category?: string;
  subcategory?: string;
  qualityGrade?: string;
  supplier?: string;
  sortField?: string;
  sortOrder?: 'asc' | 'desc' | string;
  totalDoseMin?: number | string;
  totalDoseMax?: number | string;
  singleEventMin?: number | string;
  singleEventMax?: number | string;
}

interface NormalizedRadiationQuery {
  page: number;
  limit: number;
  keyword?: string;
  category?: string;
  subcategory?: string;
  qualityGrade?: string;
  supplier?: string;
  sortField: string;
  sortOrder: 'asc' | 'desc';
  totalDoseMin?: number;
  totalDoseMax?: number;
  singleEventMin?: number;
  singleEventMax?: number;
}

const DEFAULT_PAGE = 1;
const DEFAULT_LIMIT = 20;
const MAX_LIMIT = 100;
const DEFAULT_SORT_FIELD = 'model';
const SORTABLE_FIELDS = new Set([
  'model',
  'product_name',
  'quality_grade',
  'supplier',
  'total_dose_numeric',
  'single_event_numeric',
  'created_at',
]);

export class RadiationDataService {
  private cacheService: CacheService;

  constructor(cacheService: CacheService = getCacheService()) {
    this.cacheService = cacheService;
  }

  async listRadiationData(query: RadiationDataQuery): Promise<RadiationDataListResponse> {
    const normalized = this.normalizeQuery(query);
    const cacheKey = this.buildCacheKey(normalized);

    return this.cacheService.getOrSet<RadiationDataListResponse>(cacheKey, async () => {
      const filters = this.buildFilters(normalized);
      const sort = this.buildSort(normalized);
      const skip = (normalized.page - 1) * normalized.limit;

      const [items, total] = await Promise.all([
        IrradiationTest.find(filters)
          .sort(sort)
          .skip(skip)
          .limit(normalized.limit)
          .lean(),
        IrradiationTest.countDocuments(filters),
      ]);

      const totalPages = Math.ceil(total / normalized.limit) || 1;

      return {
        items,
        total,
        page: normalized.page,
        limit: normalized.limit,
        totalPages,
        hasNextPage: normalized.page < totalPages,
        hasPrevPage: normalized.page > 1,
      };
    }, CacheTTL.RADIATION_DATA);
  }

  async getFilterOptions(): Promise<RadiationDataFilterOptions> {
    return this.cacheService.getOrSet<RadiationDataFilterOptions>(
      'radiation:data:filters',
      async () => {
        const [categories, subcategories, qualityGrades, suppliers] = await Promise.all([
          IrradiationTest.distinct('category'),
          IrradiationTest.distinct('subcategory'),
          IrradiationTest.distinct('quality_grade'),
          IrradiationTest.distinct('supplier'),
        ]);

        const normalizeDistinct = (values: unknown[]) =>
          values
            .filter((value): value is string => typeof value === 'string' && value.trim().length > 0)
            .map((value) => value.trim())
            .sort((a, b) => a.localeCompare(b, 'zh-CN'));

        return {
          categories: normalizeDistinct(categories),
          subcategories: normalizeDistinct(subcategories),
          qualityGrades: normalizeDistinct(qualityGrades),
          suppliers: normalizeDistinct(suppliers),
        };
      },
      CacheTTL.RADIATION_FILTERS
    );
  }

  private normalizeQuery(query: RadiationDataQuery): NormalizedRadiationQuery {
    const page = Math.max(
      DEFAULT_PAGE,
      Number.isFinite(Number(query.page)) ? Number(query.page) : DEFAULT_PAGE
    );

    const limitRaw = Number.isFinite(Number(query.limit)) ? Number(query.limit) : DEFAULT_LIMIT;
    const limit = Math.min(Math.max(1, limitRaw), MAX_LIMIT);

    const sortField = SORTABLE_FIELDS.has(String(query.sortField || '').trim())
      ? String(query.sortField).trim()
      : DEFAULT_SORT_FIELD;
    const sortOrder = String(query.sortOrder).toLowerCase() === 'desc' ? 'desc' : 'asc';

    const sanitize = (value?: string | string[] | null) =>
      typeof value === 'string' ? value.trim() || undefined : undefined;

    const parseNumber = (value?: string | number) => {
      if (value === undefined || value === null || value === '') {
        return undefined;
      }
      const parsed = Number(value);
      return Number.isFinite(parsed) ? parsed : undefined;
    };

    return {
      page,
      limit,
      keyword: sanitize(query.keyword),
      category: sanitize(query.category),
      subcategory: sanitize(query.subcategory),
      qualityGrade: sanitize(query.qualityGrade),
      supplier: sanitize(query.supplier),
      sortField,
      sortOrder,
      totalDoseMin: parseNumber(query.totalDoseMin),
      totalDoseMax: parseNumber(query.totalDoseMax),
      singleEventMin: parseNumber(query.singleEventMin),
      singleEventMax: parseNumber(query.singleEventMax),
    };
  }

  private buildFilters(query: NormalizedRadiationQuery): FilterQuery<IIrradiationTest> {
    const filters: FilterQuery<IIrradiationTest> = {};

    if (query.keyword) {
      const keywordRegex = new RegExp(this.escapeRegex(query.keyword), 'i');
      filters.$or = [
        { model: keywordRegex },
        { model_spec: keywordRegex },
        { supplier: keywordRegex },
        { product_name: keywordRegex },
      ];
    }

    if (query.category) {
      filters.category = query.category;
    }

    if (query.subcategory) {
      filters.subcategory = query.subcategory;
    }

    if (query.qualityGrade) {
      filters.quality_grade = query.qualityGrade;
    }

    if (query.supplier) {
      filters.supplier = query.supplier;
    }

    const exprConditions: any[] = [];

    if (query.totalDoseMin !== undefined) {
      exprConditions.push({ $gte: [this.numericFieldExpr('total_dose'), query.totalDoseMin] });
    }

    if (query.totalDoseMax !== undefined) {
      exprConditions.push({ $lte: [this.numericFieldExpr('total_dose'), query.totalDoseMax] });
    }

    if (query.singleEventMin !== undefined) {
      exprConditions.push({ $gte: [this.numericFieldExpr('single_event'), query.singleEventMin] });
    }

    if (query.singleEventMax !== undefined) {
      exprConditions.push({ $lte: [this.numericFieldExpr('single_event'), query.singleEventMax] });
    }

    if (exprConditions.length === 1) {
      filters.$expr = exprConditions[0];
    } else if (exprConditions.length > 1) {
      filters.$expr = { $and: exprConditions };
    }

    return filters;
  }

  private buildSort(query: NormalizedRadiationQuery): Record<string, 1 | -1> {
    const direction = query.sortOrder === 'desc' ? -1 : 1;
    return { [query.sortField]: direction };
  }

  private numericFieldExpr(field: string) {
    return {
      $ifNull: [
        `$${field}_numeric`,
        {
          $convert: {
            input: { $ifNull: [`$${field}`, null] },
            to: 'double',
            onError: null,
            onNull: null,
          },
        },
      ],
    };
  }

  private buildCacheKey(query: NormalizedRadiationQuery): string {
    const serialized = JSON.stringify(query);
    const hash = crypto.createHash('md5').update(serialized).digest('hex').substring(0, 24);
    return `radiation:data:list:${hash}`;
  }

  private escapeRegex(value: string): string {
    return value.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }
}


```

```typescript
import { Redis } from 'ioredis';
import { getRedisClient } from '../config/redis';
import crypto from 'crypto';

/**
 * 缓存TTL配置（秒）
 */
export const CacheTTL = {
  SEARCH_RESULT: 3600,        // 搜索结果: 1小时
  COMPONENT_DETAIL: 7200,     // 组件详情: 2小时
  MANUFACTURERS: 86400,       // 制造商列表: 24小时
  CATEGORIES: 86400,          // 分类树: 24小时
  PARAMETER_DEFS: 86400,      // 参数定义: 24小时
  FAMILY_META: 86400,         // 产品族元数据: 24小时
  SUGGESTIONS: 1800,          // 搜索建议: 30分钟
  STATISTICS: 3600,           // 统计数据: 1小时
  FACETS: 3600,               // 分面聚合: 1小时
  RADIATION_DATA: 300,        // 辐照数据列表: 5分钟
  RADIATION_FILTERS: 1800,    // 辐照筛选项: 30分钟
} as const;

/**
 * 缓存统计接口
 */
export interface CacheStats {
  hits: number;
  misses: number;
  hitRate: number;
  memory: string;
  keys: number;
  dbSize: number;
}

/**
 * Redis缓存服务
 * 
 * 提供统一的缓存操作接口，支持：
 * - 基础CRUD操作
 * - 批量操作
 * - 模式匹配删除
 * - 缓存统计
 * - 搜索结果缓存
 * - 组件数据缓存
 * - 元数据缓存
 */
export class CacheService {
  private redis: Redis;
  private hits: number = 0;
  private misses: number = 0;

  constructor(redisClient?: Redis) {
    this.redis = redisClient || getRedisClient();
  }

  // ============ 基础操作 ============

  /**
   * 获取缓存
   * @param key 缓存键
   * @returns 解析后的对象或null
   */
  async get<T = any>(key: string): Promise<T | null> {
    try {
      const value = await this.redis.get(key);
      
      if (value === null) {
        this.misses++;
        return null;
      }
      
      this.hits++;
      return JSON.parse(value) as T;
    } catch (error) {
      console.error(`❌ 缓存获取失败 [${key}]:`, error);
      return null;
    }
  }

  /**
   * 设置缓存
   * @param key 缓存键
   * @param value 缓存值（会自动JSON序列化）
   * @param ttl 过期时间（秒），不传则永不过期
   */
  async set(key: string, value: any, ttl?: number): Promise<void> {
    try {
      const serialized = JSON.stringify(value);
      
      if (ttl) {
        await this.redis.setex(key, ttl, serialized);
      } else {
        await this.redis.set(key, serialized);
      }
    } catch (error) {
      console.error(`❌ 缓存设置失败 [${key}]:`, error);
      throw error;
    }
  }

  /**
   * 删除缓存
   * @param key 缓存键
   * @returns 删除的键数量
   */
  async del(key: string): Promise<number> {
    try {
      return await this.redis.del(key);
    } catch (error) {
      console.error(`❌ 缓存删除失败 [${key}]:`, error);
      return 0;
    }
  }

  /**
   * 检查缓存是否存在
   * @param key 缓存键
   */
  async exists(key: string): Promise<boolean> {
    try {
      const result = await this.redis.exists(key);
      return result === 1;
    } catch (error) {
      console.error(`❌ 缓存检查失败 [${key}]:`, error);
      return false;
    }
  }

  /**
   * 设置过期时间
   * @param key 缓存键
   * @param ttl 过期时间（秒）
   */
  async expire(key: string, ttl: number): Promise<boolean> {
    try {
      const result = await this.redis.expire(key, ttl);
      return result === 1;
    } catch (error) {
      console.error(`❌ 设置过期时间失败 [${key}]:`, error);
      return false;
    }
  }

  // ============ 高级操作 ============

  /**
   * 获取或设置缓存（Lazy Loading模式）
   * 
   * 如果缓存存在，返回缓存值；
   * 如果缓存不存在，调用fetchFn获取数据并缓存
   * 
   * @param key 缓存键
   * @param fetchFn 数据获取函数
   * @param ttl 过期时间（秒）
   */
  async getOrSet<T = any>(
    key: string,
    fetchFn: () => Promise<T>,
    ttl?: number
  ): Promise<T> {
    // 1. 尝试从缓存获取
    const cached = await this.get<T>(key);
    if (cached !== null) {
      return cached;
    }

    // 2. 缓存未命中，从数据库获取
    try {
      const data = await fetchFn();
      
      // 3. 写入缓存
      await this.set(key, data, ttl);
      
      return data;
    } catch (error) {
      console.error(`❌ getOrSet失败 [${key}]:`, error);
      throw error;
    }
  }

  /**
   * 批量获取缓存
   * @param keys 缓存键数组
   * @returns 对应的值数组（未命中的为null）
   */
  async mget<T = any>(keys: string[]): Promise<(T | null)[]> {
    if (keys.length === 0) return [];

    try {
      const values = await this.redis.mget(...keys);
      
      return values.map((value) => {
        if (value === null) {
          this.misses++;
          return null;
        }
        
        this.hits++;
        return JSON.parse(value) as T;
      });
    } catch (error) {
      console.error('❌ 批量获取缓存失败:', error);
      return keys.map(() => null);
    }
  }

  /**
   * 批量设置缓存
   * @param entries 键值对数组 [key, value, ttl?]
   */
  async mset(entries: [string, any, number?][]): Promise<void> {
    if (entries.length === 0) return;

    try {
      const pipeline = this.redis.pipeline();
      
      for (const [key, value, ttl] of entries) {
        const serialized = JSON.stringify(value);
        
        if (ttl) {
          pipeline.setex(key, ttl, serialized);
        } else {
          pipeline.set(key, serialized);
        }
      }
      
      await pipeline.exec();
    } catch (error) {
      console.error('❌ 批量设置缓存失败:', error);
      throw error;
    }
  }

  /**
   * 删除匹配模式的所有键
   * 
   * 使用SCAN命令安全删除，避免阻塞Redis
   * 
   * @param pattern 匹配模式（支持*和?通配符）
   * @returns 删除的键数量
   */
  async deletePattern(pattern: string): Promise<number> {
    try {
      let cursor = '0';
      let deletedCount = 0;
      const matchPattern = pattern.startsWith('doeet:') ? pattern : `doeet:${pattern}`;

      do {
        // 使用SCAN遍历
        const [newCursor, keys] = await this.redis.scan(
          cursor,
          'MATCH',
          matchPattern,
          'COUNT',
          100
        );
        
        cursor = newCursor;
        
        if (keys.length > 0) {
          // 批量删除
          const deleted = await this.redis.del(...keys);
          deletedCount += deleted;
        }
      } while (cursor !== '0');

      console.log(`✅ 删除缓存模式 [${pattern}]: ${deletedCount}个键`);
      return deletedCount;
    } catch (error) {
      console.error(`❌ 删除缓存模式失败 [${pattern}]:`, error);
      return 0;
    }
  }

  // ============ 业务方法 - 搜索相关 ============

  /**
   * 生成查询Hash（用于缓存Key）
   * 
   * 对查询对象进行排序后生成MD5 hash，确保相同查询生成相同key
   */
  private generateQueryHash(query: any): string {
    // 排序对象键，确保相同查询生成相同hash
    const sorted = Object.keys(query)
      .sort()
      .reduce((acc, key) => {
        const value = query[key];
        // 处理数组和对象
        acc[key] = typeof value === 'object' ? JSON.stringify(value) : value;
        return acc;
      }, {} as any);

    const str = JSON.stringify(sorted);
    return crypto.createHash('md5').update(str).digest('hex').substring(0, 16);
  }

  /**
   * 缓存搜索结果
   * @param query 搜索查询对象
   * @param result 搜索结果
   */
  async cacheSearchResult(query: any, result: any): Promise<void> {
    const hash = this.generateQueryHash(query);
    const key = `search:query:${hash}`;
    
    await this.set(key, result, CacheTTL.SEARCH_RESULT);
  }

  /**
   * 获取缓存的搜索结果
   * @param query 搜索查询对象
   */
  async getCachedSearchResult(query: any): Promise<any | null> {
    const hash = this.generateQueryHash(query);
    const key = `search:query:${hash}`;
    
    return await this.get(key);
  }

  /**
   * 缓存全文搜索结果
   */
  async cacheFullTextSearchResult(query: string, page: number, result: any): Promise<void> {
    const hash = this.generateQueryHash({ query, page });
    const key = `search:fulltext:${hash}`;
    
    await this.set(key, result, CacheTTL.SEARCH_RESULT);
  }

  /**
   * 获取缓存的全文搜索结果
   */
  async getCachedFullTextSearchResult(query: string, page: number): Promise<any | null> {
    const hash = this.generateQueryHash({ query, page });
    const key = `search:fulltext:${hash}`;
    
    return await this.get(key);
  }

  /**
   * 缓存分类浏览结果
   */
  async cacheCategoryBrowse(familyPath: string[], page: number, result: any): Promise<void> {
    const pathStr = familyPath.join('/');
    const key = `search:category:${pathStr}:p${page}`;
    
    await this.set(key, result, CacheTTL.SEARCH_RESULT);
  }

  /**
   * 获取缓存的分类浏览结果
   */
  async getCachedCategoryBrowse(familyPath: string[], page: number): Promise<any | null> {
    const pathStr = familyPath.join('/');
    const key = `search:category:${pathStr}:p${page}`;
    
    return await this.get(key);
  }

  // ============ 业务方法 - 组件相关 ============

  /**
   * 缓存组件详情（包含参数）
   * @param componentId 组件ID
   * @param data 组件数据（包含参数）
   */
  async cacheComponentDetail(componentId: string, data: any): Promise<void> {
    const key = `component:detail:${componentId}`;
    await this.set(key, data, CacheTTL.COMPONENT_DETAIL);
  }

  /**
   * 获取缓存的组件详情
   * @param componentId 组件ID
   */
  async getCachedComponentDetail(componentId: string): Promise<any | null> {
    const key = `component:detail:${componentId}`;
    return await this.get(key);
  }

  /**
   * 批量缓存组件详情
   */
  async batchCacheComponentDetails(components: Array<{ id: string; data: any }>): Promise<void> {
    const entries: [string, any, number][] = components.map(({ id, data }) => [
      `component:detail:${id}`,
      data,
      CacheTTL.COMPONENT_DETAIL,
    ]);
    
    await this.mset(entries);
  }

  /**
   * 批量获取组件详情
   */
  async batchGetComponentDetails(componentIds: string[]): Promise<(any | null)[]> {
    const keys = componentIds.map((id) => `doeet:component:detail:${id}`);
    return await this.mget(keys);
  }

  // ============ 业务方法 - 元数据相关 ============

  /**
   * 缓存制造商列表
   */
  async cacheManufacturers(manufacturers: any[]): Promise<void> {
    await this.set('meta:manufacturers', manufacturers, CacheTTL.MANUFACTURERS);
  }

  /**
   * 获取缓存的制造商列表
   */
  async getCachedManufacturers(): Promise<any[] | null> {
    return await this.get('meta:manufacturers');
  }

  /**
   * 缓存分类树
   */
  async cacheCategoriesTree(tree: any): Promise<void> {
    await this.set('meta:categories:tree', tree, CacheTTL.CATEGORIES);
  }

  /**
   * 获取缓存的分类树
   */
  async getCachedCategoriesTree(): Promise<any | null> {
    return await this.get('meta:categories:tree');
  }

  /**
   * 缓存参数定义列表
   */
  async cacheParameterDefinitions(definitions: any[]): Promise<void> {
    await this.set('meta:parameter_definitions', definitions, CacheTTL.PARAMETER_DEFS);
  }

  /**
   * 获取缓存的参数定义列表
   */
  async getCachedParameterDefinitions(): Promise<any[] | null> {
    return await this.get('meta:parameter_definitions');
  }

  /**
   * 缓存产品族元数据
   */
  async cacheFamilyMeta(familyPath: string[], meta: any): Promise<void> {
    const pathStr = familyPath.join('/');
    const key = `meta:family:${pathStr}`;
    await this.set(key, meta, CacheTTL.FAMILY_META);
  }

  /**
   * 获取缓存的产品族元数据
   */
  async getCachedFamilyMeta(familyPath: string[]): Promise<any | null> {
    const pathStr = familyPath.join('/');
    const key = `meta:family:${pathStr}`;
    return await this.get(key);
  }

  /**
   * 缓存统计数据
   */
  async cacheStatistics(stats: any): Promise<void> {
    await this.set('meta:statistics', stats, CacheTTL.STATISTICS);
  }

  /**
   * 获取缓存的统计数据
   */
  async getCachedStatistics(): Promise<any | null> {
    return await this.get('meta:statistics');
  }

  // ============ 缓存失效 ============

  /**
   * 清除所有搜索缓存
   */
  async invalidateSearchCache(): Promise<number> {
    return await this.deletePattern('search:*');
  }

  /**
   * 清除特定组件的缓存
   */
  async invalidateComponentCache(componentId: string): Promise<void> {
    await this.del(`component:detail:${componentId}`);
    // 也清除搜索缓存，因为可能包含该组件
    await this.invalidateSearchCache();
  }

  /**
   * 清除所有元数据缓存
   */
  async invalidateMetaCache(): Promise<number> {
    return await this.deletePattern('meta:*');
  }

  /**
   * 清除所有缓存
   */
  async invalidateAllCache(): Promise<void> {
    await this.redis.flushdb();
    console.log('✅ 已清除所有缓存');
  }

  // ============ 统计和监控 ============

  /**
   * 获取缓存统计信息
   */
  async getCacheStats(): Promise<CacheStats> {
    try {
      // 获取内存信息
      const info = await this.redis.info('memory');
      const memoryMatch = info.match(/used_memory_human:(.+)/);
      const memory = memoryMatch ? memoryMatch[1].trim() : 'Unknown';

      // 获取key数量
      const dbSize = await this.redis.dbsize();

      // 计算命中率
      const total = this.hits + this.misses;
      const hitRate = total > 0 ? (this.hits / total) * 100 : 0;

      return {
        hits: this.hits,
        misses: this.misses,
        hitRate: Math.round(hitRate * 100) / 100,
        memory,
        keys: dbSize,
        dbSize,
      };
    } catch (error) {
      console.error('❌ 获取缓存统计失败:', error);
      throw error;
    }
  }

  /**
   * 重置统计计数器
   */
  resetStats(): void {
    this.hits = 0;
    this.misses = 0;
  }

  /**
   * 获取所有匹配的keys（用于调试）
   */
  async getKeys(pattern: string = '*'): Promise<string[]> {
    try {
      const matchPattern = pattern.startsWith('doeet:') ? pattern : `doeet:${pattern}`;
      const keys: string[] = [];
      let cursor = '0';

      do {
        const [newCursor, foundKeys] = await this.redis.scan(
          cursor,
          'MATCH',
          matchPattern,
          'COUNT',
          100
        );
        
        cursor = newCursor;
        keys.push(...foundKeys);
      } while (cursor !== '0');

      return keys;
    } catch (error) {
      console.error('❌ 获取keys失败:', error);
      return [];
    }
  }

  // ============ 连接管理 ============

  /**
   * 测试Redis连接
   */
  async ping(): Promise<boolean> {
    try {
      const result = await this.redis.ping();
      return result === 'PONG';
    } catch (error) {
      console.error('❌ Redis ping失败:', error);
      return false;
    }
  }

  /**
   * 关闭连接
   */
  async close(): Promise<void> {
    await this.redis.quit();
  }
}

/**
 * 全局缓存服务单例
 */
let cacheServiceInstance: CacheService | null = null;

export function getCacheService(): CacheService {
  if (!cacheServiceInstance) {
    cacheServiceInstance = new CacheService();
  }
  return cacheServiceInstance;
}


```

```typescript
import { Request, Response } from 'express';
import { RadiationDataService } from '../services/RadiationDataService';
import { logger } from '../utils/logger';

const radiationDataService = new RadiationDataService();

export const listRadiationData = async (req: Request, res: Response) => {
  try {
    const data = await radiationDataService.listRadiationData(req.query);
    res.json({
      success: true,
      data,
      message: '辐照数据获取成功',
      timestamp: new Date().toISOString(),
    });
  } catch (error) {
    logger.error('获取辐照数据失败', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'RADIATION_DATA_ERROR',
        message: '获取辐照数据失败，请稍后重试',
      },
      timestamp: new Date().toISOString(),
      path: req.path,
    });
  }
};

export const getRadiationFilterOptions = async (_req: Request, res: Response) => {
  try {
    const options = await radiationDataService.getFilterOptions();
    res.json({
      success: true,
      data: options,
      message: '筛选项获取成功',
      timestamp: new Date().toISOString(),
    });
  } catch (error) {
    logger.error('获取辐照筛选项失败', error);
    res.status(500).json({
      success: false,
      error: {
        code: 'RADIATION_FILTER_ERROR',
        message: '获取辐照筛选项失败，请稍后重试',
      },
      timestamp: new Date().toISOString(),
      path: '/api/radiation-data/options',
    });
  }
};


```

```typescript
import { Router } from 'express';
import { asyncHandler } from '../middleware/errorHandler';
import { getRadiationFilterOptions, listRadiationData } from '../controllers/radiationDataController';

const router = Router();

/**
 * @route   GET /api/radiation-data
 * @desc    获取通用器件辐照数据
 * @query   keyword, category, subcategory, supplier, qualityGrade,
 *          totalDoseMin, totalDoseMax, singleEventMin, singleEventMax,
 *          sortField, sortOrder, page, limit
 * @access  Private (受保护路由，由前端处理)
 */
router.get('/', asyncHandler(listRadiationData));

/**
 * @route   GET /api/radiation-data/options
 * @desc    获取筛选下拉可选项
 * @access  Private
 */
router.get('/options', asyncHandler(getRadiationFilterOptions));

export default router;


```

```typescript
import express from 'express';
import cors from 'cors';
import dotenv from 'dotenv';
import { errorHandler } from './middleware/errorHandler';
import { logger } from './utils/logger';

// 数据库导入
import { connectDB, disconnectDB } from './config/database';

// 路由导入
import supplierRoutes from './routes/supplierRoutes';
import searchRoutes from './routes/searchRoutes';
import selectionRoutes from './routes/selectionRoutes';
import standardRoutes from './routes/standardRoutes';
import qualityRoutes from './routes/qualityRoutes';
import testRoutes from './routes/testRoutes';
import procurementRoutes from './routes/procurementRoutes';
import identificationRoutes from './routes/identificationRoutes';
import documentRoutes from './routes/documentRoutes';
import policyRegulationRoutes from './routes/policyRegulationRoutes';
import applicationSupportRoutes from './routes/applicationSupportRoutes';
import digitalModelRoutes from './routes/digitalModelRoutes';
import adminRoutes from './routes/adminRoutes';
import userRoutes from './routes/userRoutes';

// 新增分析路由
import analyticsRoutes from './routes/analyticsRoutes';
import supplierAnalyticsRoutes from './routes/supplierAnalyticsRoutes';
import qualityAnalyticsRoutes from './routes/qualityAnalyticsRoutes';

// DoEEEt搜索路由
import doeeetRoutes from './routes/doeeetRoutes';
import radiationDataRoutes from './routes/radiationDataRoutes';

// 加载环境变量
dotenv.config();

const app = express();
const PORT = process.env.PORT || 3001;

// 中间件配置
app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// 静态文件服务
app.use('/uploads', express.static('uploads'));

// API路由
app.use('/api/users', userRoutes);
app.use('/api/suppliers', supplierRoutes);
app.use('/api/search', searchRoutes);
app.use('/api/selections', selectionRoutes);
app.use('/api/standards', standardRoutes);
app.use('/api/quality', qualityRoutes);
app.use('/api/tests', testRoutes);
app.use('/api/procurement', procurementRoutes);
app.use('/api/identification', identificationRoutes);
app.use('/api/documents', documentRoutes);
app.use('/api/policy-regulations', policyRegulationRoutes);
app.use('/api/application-support', applicationSupportRoutes);
app.use('/api/digital-models', digitalModelRoutes);
app.use('/api/admin', adminRoutes);

// 分析服务路由
app.use('/api/analytics', analyticsRoutes);
app.use('/api/supplier-analytics', supplierAnalyticsRoutes);
app.use('/api/quality-analytics', qualityAnalyticsRoutes);

// DoEEEt搜索服务路由
app.use('/api/doeeet', doeeetRoutes);
app.use('/api/radiation-data', radiationDataRoutes);

// 健康检查端点
app.get('/health', (req, res) => {
  res.json({ 
    status: 'OK', 
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV || 'development'
  });
});

// 错误处理中间件
app.use(errorHandler);

// 启动服务器
async function startServer() {
  try {
    // 连接数据库
    await connectDB();
    
    app.listen(PORT, () => {
      logger.info(`🚀 服务器启动成功，端口: ${PORT}`);
      logger.info(`📡 API地址: http://localhost:${PORT}`);
      logger.info(`🏥 健康检查: http://localhost:${PORT}/health`);
      logger.info(`💾 数据存储: MongoDB`);
    });
  } catch (error) {
    logger.error('❌ 服务器启动失败:', error);
    process.exit(1);
  }
}

// 优雅关闭
process.on('SIGTERM', async () => {
  logger.info('🛑 收到SIGTERM信号，开始优雅关闭...');
  
  try {
    await disconnectDB();
    logger.info('💾 已断开数据库连接');
  } catch (error) {
    logger.error('❌ 断开数据库连接失败:', error);
  }
  
  process.exit(0);
});

process.on('SIGINT', async () => {
  logger.info('🛑 收到SIGINT信号，开始优雅关闭...');
  
  try {
    await disconnectDB();
    logger.info('💾 已断开数据库连接');
  } catch (error) {
    logger.error('❌ 断开数据库连接失败:', error);
  }
  
  process.exit(0);
});

startServer();

```

```typescript
export { ComponentService } from './ComponentService';
export { AnalyticsService } from './AnalyticsService';
export { SupplierService } from './SupplierService';
export { QualityService } from './QualityService';
export { RadiationDataService } from './RadiationDataService';

export type {
  ComponentSearchParams,
  ComponentComparisonResult,
  ComponentFilterCriteria
} from './ComponentService';

export type {
  MarketTrendData,
  ComponentUsageStats,
  PriceAnalysis,
  SupplyChainRisk
} from './AnalyticsService';

export type {
  SupplierPerformanceMetrics,
  SupplierRiskAssessment,
  SupplierComparisonResult,
  SupplierAuditResult
} from './SupplierService';

export type {
  QualityAssessmentResult,
  DefectAnalysis,
  ComplianceStatus,
  QualityMetrics
} from './QualityService';

```

```javascript
/** @type {import('jest').Config} */
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
  roots: ['<rootDir>/tests'],
  moduleFileExtensions: ['ts', 'js', 'json'],
  testMatch: ['**/?(*.)+(spec|test).ts'],
  collectCoverageFrom: ['src/**/*.{ts,tsx}', '!src/**/*.d.ts'],
  globals: {
    'ts-jest': {
      tsconfig: '<rootDir>/tsconfig.json',
    },
  },
};


```

```typescript
import { RadiationDataService } from '../src/services/RadiationDataService';
import { IrradiationTest } from '../src/models/IrradiationTest';

jest.mock('../src/models/IrradiationTest', () => ({
  IrradiationTest: {
    find: jest.fn(),
    countDocuments: jest.fn(),
    distinct: jest.fn(),
  },
}));

const createQueryChain = (items: unknown[]) => {
  const lean = jest.fn().mockResolvedValue(items);
  const limit = jest.fn().mockReturnValue({ lean });
  const skip = jest.fn().mockReturnValue({ limit });
  const sort = jest.fn().mockReturnValue({ skip });
  (IrradiationTest.find as jest.Mock).mockReturnValue({ sort });
  return { lean, limit, skip, sort };
};

describe('RadiationDataService', () => {
  const mockCache = {
    getOrSet: jest.fn((_key: string, fetcher: () => Promise<any>) => fetcher()),
  } as any;

  beforeEach(() => {
    jest.clearAllMocks();
    (IrradiationTest.countDocuments as jest.Mock).mockResolvedValue(1);
  });

  it('builds filters based on incoming query', async () => {
    const items = [{ product_name: 'Test' }];
    createQueryChain(items);

    const service = new RadiationDataService(mockCache);

    const result = await service.listRadiationData({
      category: '微电路',
      keyword: 'ABC',
      totalDoseMin: 1000,
    });

    expect(result.items).toEqual(items);
    expect(IrradiationTest.find).toHaveBeenCalledTimes(1);
    const queryArg = (IrradiationTest.find as jest.Mock).mock.calls[0][0];
    expect(queryArg.category).toBe('微电路');
    expect(queryArg.$or).toBeDefined();
  });

  it('returns sorted filter options without empty values', async () => {
    (IrradiationTest.distinct as jest.Mock).mockResolvedValueOnce(['B', 'A', '', null])
      .mockResolvedValueOnce(['x'])
      .mockResolvedValueOnce(['QML', undefined])
      .mockResolvedValueOnce(['Supplier']);

    const service = new RadiationDataService(mockCache);
    const options = await service.getFilterOptions();

    expect(options.categories).toEqual(['A', 'B']);
    expect(options.subcategories).toEqual(['x']);
    expect(options.qualityGrades).toEqual(['QML']);
    expect(options.suppliers).toEqual(['Supplier']);
  });
});


```

```typescript
// 用户相关类型
export interface User {
  id: number;
  username: string;
  email: string;
  role: 'admin' | 'tenant' | 'staff';
  created_at: string;
  updated_at: string;
}

// 租户相关类型
export interface Tenant {
  id: number;
  name: string;
  contact_person: string;
  phone: string;
  email: string;
  address: string;
  status: 'active' | 'inactive';
  created_at: string;
  updated_at: string;
}

// 办公空间相关类型
export interface Office {
  id: number;
  name: string;
  description: string;
  area: number;
  capacity: number;
  price_per_month: number;
  status: 'available' | 'occupied' | 'maintenance';
  amenities: string[];
  images: string[];
  floor: number;
  created_at: string;
  updated_at: string;
}

// 租赁合同相关类型
export interface Contract {
  id: number;
  tenant_id: number;
  office_id: number;
  start_date: string;
  end_date: string;
  monthly_rent: number;
  deposit: number;
  status: 'active' | 'expired' | 'terminated';
  terms: string;
  created_at: string;
  updated_at: string;
  tenant?: Tenant;
  office?: Office;
}

// 财务记录相关类型
export interface FinancialRecord {
  id: number;
  contract_id: number;
  type: 'rent' | 'deposit' | 'utility' | 'service';
  amount: number;
  description: string;
  date: string;
  status: 'paid' | 'pending' | 'overdue';
  created_at: string;
  updated_at: string;
  contract?: Contract;
}

// API响应类型
export interface ApiResponse<T> {
  success: boolean;
  data: T;
  message?: string;
  errors?: Record<string, string[]>;
}

// 分页响应类型
export interface PaginatedResponse<T> {
  success: boolean;
  data: T[] | {
    items: T[];
    total: number;
    page: number;
  };
  pagination?: {
    currentPage: number;
    totalPages: number;
    totalItems: number;
    itemsPerPage: number;
    hasNextPage: boolean;
    hasPrevPage: boolean;
  };
  message?: string;
  timestamp?: string;
}

// 登录请求类型
export interface LoginRequest {
  username: string;
  password: string;
}

// 登录响应类型
export interface LoginResponse {
  access_token: string;
  token_type: string;
  user: User;
}

// 器件相关类型
export interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  mainCategory?: string; // 主分类（如：航空电子、处理器、集成电路）
  category: string;
  subcategory?: string;
  // 三级分类系统
  category1?: string;
  category2?: string;
  description: string;
  specifications: Record<string, any>;
  qualityLevel: 'commercial' | 'industrial' | 'military' | 'aerospace';
  packageType: string;
  operatingTemp: {
    min: number;
    max: number;
  };
  voltage: {
    min: number;
    max: number;
  };
  pricing?: {
    price: number;
    currency: string;
    supplier: string;
    quantity: number;
  }[];
  availability?: {
    supplier: string;
    stockQuantity: number;
    leadTime: number;
    minimumOrder: number;
  }[];
  certifications: string[];
  datasheet?: string;
  lifecycle: 'active' | 'discontinued' | 'not_recommended';
  inStock?: boolean;
  stock?: number;
  createdAt?: string | Date;
  updatedAt?: string | Date;
}

// 器件搜索参数
export interface ComponentSearchParams {
  partNumber?: string;
  manufacturer?: string;
  category?: string;
  specifications?: Record<string, any>;
  priceRange?: {
    min: number;
    max: number;
  };
  availability?: boolean;
  certifications?: string[];
  packageType?: string;
  operatingTemp?: {
    min: number;
    max: number;
  };
  page?: number;
  pageSize?: number;
  sortBy?: 'price' | 'availability' | 'rating' | 'partNumber';
  sortOrder?: 'asc' | 'desc';
}

// 器件对比结果
export interface ComponentComparisonResult {
  components: Component[];
  comparisonMatrix: {
    [componentId: string]: {
      [attribute: string]: any;
    };
  };
  recommendations: {
    componentId: string;
    reason: string;
    score: number;
  }[];
}

export interface RadiationDataRecord {
  _id: string;
  source_index?: number | string;
  category: string;
  subcategory?: string;
  product_name: string;
  model?: string;
  model_spec?: string;
  package?: string;
  total_dose?: string;
  single_event?: string;
  displacement?: string;
  esd_rating?: string;
  quality_grade?: string;
  general_spec?: string;
  detail_spec?: string;
  supplier?: string;
  remark?: string;
  created_at?: string;
  updated_at?: string;
}

export interface RadiationDataListResponse {
  items: RadiationDataRecord[];
  total: number;
  page: number;
  limit: number;
  totalPages: number;
  hasNextPage: boolean;
  hasPrevPage: boolean;
}

export interface RadiationFilterOptions {
  categories: string[];
  subcategories: string[];
  qualityGrades: string[];
  suppliers: string[];
}
```

```typescript
import axios from 'axios';
import type { 
  ApiResponse, 
  PaginatedResponse, 
  LoginRequest, 
  LoginResponse,
  User,
  Tenant,
  Office,
  Contract,
  FinancialRecord,
  Component,
  ComponentSearchParams,
  ComponentComparisonResult,
  RadiationDataListResponse,
  RadiationFilterOptions
} from '@/types';

// 创建axios实例
const api = axios.create({
  baseURL: '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 请求拦截器
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// 响应拦截器
api.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('access_token');
      localStorage.removeItem('user');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

// 认证相关API
export const authAPI = {
  login: (data: LoginRequest): Promise<ApiResponse<LoginResponse>> =>
    api.post('/auth/login', data).then(res => res.data),
  
  logout: (): Promise<ApiResponse<null>> =>
    api.post('/auth/logout').then(res => res.data),
  
  getCurrentUser: (): Promise<ApiResponse<User>> =>
    api.get('/auth/me').then(res => res.data),
};

// 用户相关API
export const userAPI = {
  getUsers: (params?: { page?: number; per_page?: number; role?: string }): Promise<PaginatedResponse<User>> =>
    api.get('/users', { params }).then(res => res.data),
  
  getUser: (id: number): Promise<ApiResponse<User>> =>
    api.get(`/users/${id}`).then(res => res.data),
  
  createUser: (data: Partial<User>): Promise<ApiResponse<User>> =>
    api.post('/users', data).then(res => res.data),
  
  updateUser: (id: number, data: Partial<User>): Promise<ApiResponse<User>> =>
    api.put(`/users/${id}`, data).then(res => res.data),
  
  deleteUser: (id: number): Promise<ApiResponse<null>> =>
    api.delete(`/users/${id}`).then(res => res.data),
};

// 租户相关API
export const tenantAPI = {
  getTenants: (params?: { page?: number; per_page?: number; status?: string }): Promise<PaginatedResponse<Tenant>> =>
    api.get('/tenants', { params }).then(res => res.data),
  
  getTenant: (id: number): Promise<ApiResponse<Tenant>> =>
    api.get(`/tenants/${id}`).then(res => res.data),
  
  createTenant: (data: Partial<Tenant>): Promise<ApiResponse<Tenant>> =>
    api.post('/tenants', data).then(res => res.data),
  
  updateTenant: (id: number, data: Partial<Tenant>): Promise<ApiResponse<Tenant>> =>
    api.put(`/tenants/${id}`, data).then(res => res.data),
  
  deleteTenant: (id: number): Promise<ApiResponse<null>> =>
    api.delete(`/tenants/${id}`).then(res => res.data),
};

// 办公空间相关API
export const officeAPI = {
  getOffices: (params?: { page?: number; per_page?: number; status?: string }): Promise<PaginatedResponse<Office>> =>
    api.get('/offices', { params }).then(res => res.data),
  
  getOffice: (id: number): Promise<ApiResponse<Office>> =>
    api.get(`/offices/${id}`).then(res => res.data),
  
  createOffice: (data: Partial<Office>): Promise<ApiResponse<Office>> =>
    api.post('/offices', data).then(res => res.data),
  
  updateOffice: (id: number, data: Partial<Office>): Promise<ApiResponse<Office>> =>
    api.put(`/offices/${id}`, data).then(res => res.data),
  
  deleteOffice: (id: number): Promise<ApiResponse<null>> =>
    api.delete(`/offices/${id}`).then(res => res.data),
};

// 合同相关API
export const contractAPI = {
  getContracts: (params?: { page?: number; per_page?: number; status?: string }): Promise<PaginatedResponse<Contract>> =>
    api.get('/contracts', { params }).then(res => res.data),
  
  getContract: (id: number): Promise<ApiResponse<Contract>> =>
    api.get(`/contracts/${id}`).then(res => res.data),
  
  createContract: (data: Partial<Contract>): Promise<ApiResponse<Contract>> =>
    api.post('/contracts', data).then(res => res.data),
  
  updateContract: (id: number, data: Partial<Contract>): Promise<ApiResponse<Contract>> =>
    api.put(`/contracts/${id}`, data).then(res => res.data),
  
  deleteContract: (id: number): Promise<ApiResponse<null>> =>
    api.delete(`/contracts/${id}`).then(res => res.data),
};

// 财务记录相关API
export const financialAPI = {
  getFinancialRecords: (params?: { page?: number; per_page?: number; type?: string; status?: string }): Promise<PaginatedResponse<FinancialRecord>> =>
    api.get('/financial-records', { params }).then(res => res.data),
  
  getFinancialRecord: (id: number): Promise<ApiResponse<FinancialRecord>> =>
    api.get(`/financial-records/${id}`).then(res => res.data),
  
  createFinancialRecord: (data: Partial<FinancialRecord>): Promise<ApiResponse<FinancialRecord>> =>
    api.post('/financial-records', data).then(res => res.data),
  
  updateFinancialRecord: (id: number, data: Partial<FinancialRecord>): Promise<ApiResponse<FinancialRecord>> =>
    api.put(`/financial-records/${id}`, data).then(res => res.data),
  
  deleteFinancialRecord: (id: number): Promise<ApiResponse<null>> =>
    api.delete(`/financial-records/${id}`).then(res => res.data),
};

// 器件相关API
export const componentAPI = {
  // 获取器件列表
  getComponents: (params?: {
    page?: number;
    limit?: number;
    search?: string;
    category?: string;
    manufacturer?: string;
    inStock?: boolean;
  }): Promise<PaginatedResponse<Component>> =>
    api.get('/components', { params }).then(res => res.data),

  // 根据ID获取器件详情
  getComponent: (id: string): Promise<ApiResponse<Component>> =>
    api.get(`/components/${id}`).then(res => res.data),

  // 获取器件详细信息（包含供应商、价格历史等）
  getComponentDetails: (id: string): Promise<ApiResponse<{
    component: Component;
    specifications: Record<string, any>;
    suppliers: any[];
    priceHistory: any[];
    alternatives: Component[];
    certifications: any[];
  }>> =>
    api.get(`/components/${id}/detailed`).then(res => res.data),

  // 高级搜索
  advancedSearch: (params: ComponentSearchParams): Promise<ApiResponse<{
    components: Component[];
    total: number;
    page: number;
    pageSize: number;
    filters: any;
  }>> =>
    api.post('/components/search/advanced', params).then(res => res.data),

  // 器件对比
  compareComponents: (componentIds: string[]): Promise<ApiResponse<ComponentComparisonResult>> =>
    api.post('/components/compare', { componentIds }).then(res => res.data),

  // 获取智能推荐
  getRecommendations: (requirements: {
    specifications: Record<string, any>;
    priceThreshold: number;
    availabilityRequired: boolean;
    certificationRequired: string[];
    temperatureRange: { min: number; max: number };
  }, userHistory?: string[]): Promise<ApiResponse<Component[]>> =>
    api.post('/components/recommendations/intelligent', { requirements, userHistory }).then(res => res.data),

  // 检查器件库存
  checkInventory: (id: string): Promise<ApiResponse<{
    totalStock: number;
    suppliers: {
      supplierId: string;
      supplierName: string;
      stock: number;
      price: number;
      leadTime: number;
      minimumOrder: number;
    }[];
    lastUpdated: Date;
  }>> =>
    api.get(`/components/${id}/inventory`).then(res => res.data),

  // 根据分类获取器件
  getComponentsByCategory: (category: string, params?: {
    page?: number;
    limit?: number;
  }): Promise<PaginatedResponse<Component>> =>
    api.get(`/components/category/${category}`, { params }).then(res => res.data),

  // 获取器件推荐（基于单个器件）
  getComponentRecommendations: (id: string): Promise<ApiResponse<Component[]>> =>
    api.get(`/components/${id}/recommendations`).then(res => res.data),
};

// 辐照数据 API
export const radiationDataAPI = {
  list: (params: Record<string, any> = {}): Promise<ApiResponse<RadiationDataListResponse>> =>
    api.get('/radiation-data', { params }).then(res => res.data),
  getFilters: (): Promise<ApiResponse<RadiationFilterOptions>> =>
    api.get('/radiation-data/options').then(res => res.data),
};

export default api;

```

```typescriptreact
import React, { useEffect, useMemo, useState } from 'react';
import {
  Alert,
  Button,
  Card,
  Col,
  Empty,
  Form,
  Input,
  InputNumber,
  Row,
  Select,
  Space,
  Table,
  Tag,
  Typography,
} from 'antd';
import type { ColumnsType, TablePaginationConfig, TableProps } from 'antd/es/table';
import { DownloadOutlined, ReloadOutlined, SearchOutlined } from '@ant-design/icons';
import { useSearchParams } from 'react-router-dom';
import dayjs from 'dayjs';
import { radiationDataAPI } from '@/services/api';
import type {
  RadiationDataListResponse,
  RadiationDataRecord,
  RadiationFilterOptions,
} from '@/types';
import { downloadCSV } from '@/utils/parameterUtils';

const { Title, Paragraph, Text } = Typography;

const DEFAULT_PAGE_SIZE = 20;

const columnDefinitions: ColumnsType<RadiationDataRecord> = [
  {
    title: '产品类别',
    dataIndex: 'category',
    key: 'category',
    width: 160,
    render: (value: string) => <Tag color="blue">{value}</Tag>,
  },
  {
    title: '产品细类',
    dataIndex: 'subcategory',
    key: 'subcategory',
    width: 160,
  },
  {
    title: '产品名称',
    dataIndex: 'product_name',
    key: 'product_name',
    width: 200,
  },
  {
    title: '产品型号',
    dataIndex: 'model',
    key: 'model',
    width: 180,
  },
  {
    title: '型号规格',
    dataIndex: 'model_spec',
    key: 'model_spec',
    width: 200,
  },
  {
    title: '封装形式',
    dataIndex: 'package',
    key: 'package',
    width: 140,
  },
  {
    title: '总剂量',
    dataIndex: 'total_dose',
    key: 'total_dose',
    width: 160,
  },
  {
    title: '单粒子',
    dataIndex: 'single_event',
    key: 'single_event',
    width: 160,
  },
  {
    title: '位移',
    dataIndex: 'displacement',
    key: 'displacement',
    width: 140,
  },
  {
    title: '抗静电能力',
    dataIndex: 'esd_rating',
    key: 'esd_rating',
    width: 140,
  },
  {
    title: '质量等级',
    dataIndex: 'quality_grade',
    key: 'quality_grade',
    width: 140,
    render: (value: string) =>
      value ? (
        <Tag color="purple" style={{ minWidth: 80, textAlign: 'center' }}>
          {value}
        </Tag>
      ) : (
        '--'
      ),
  },
  {
    title: '供应商',
    dataIndex: 'supplier',
    key: 'supplier',
    width: 200,
  },
  {
    title: '通用规范',
    dataIndex: 'general_spec',
    key: 'general_spec',
    width: 200,
  },
  {
    title: '详细规范',
    dataIndex: 'detail_spec',
    key: 'detail_spec',
    width: 200,
  },
  {
    title: '备注',
    dataIndex: 'remark',
    key: 'remark',
    width: 240,
    ellipsis: true,
  },
];

const RadiationDataPage: React.FC = () => {
  const [form] = Form.useForm();
  const [searchParams, setSearchParams] = useSearchParams();
  const [options, setOptions] = useState<RadiationFilterOptions>({
    categories: [],
    subcategories: [],
    qualityGrades: [],
    suppliers: [],
  });
  const [listResponse, setListResponse] = useState<RadiationDataListResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [exporting, setExporting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const currentParams = useMemo(() => {
    const params: Record<string, string> = {};
    searchParams.forEach((value, key) => {
      if (value) {
        params[key] = value;
      }
    });
    return params;
  }, [searchParams]);

  const initialFormValues = useMemo(
    () => ({
      keyword: currentParams.keyword,
      category: currentParams.category,
      subcategory: currentParams.subcategory,
      supplier: currentParams.supplier,
      qualityGrade: currentParams.qualityGrade,
      totalDoseMin: currentParams.totalDoseMin ? Number(currentParams.totalDoseMin) : undefined,
      totalDoseMax: currentParams.totalDoseMax ? Number(currentParams.totalDoseMax) : undefined,
      singleEventMin: currentParams.singleEventMin
        ? Number(currentParams.singleEventMin)
        : undefined,
      singleEventMax: currentParams.singleEventMax
        ? Number(currentParams.singleEventMax)
        : undefined,
    }),
    [currentParams]
  );

  useEffect(() => {
    form.setFieldsValue(initialFormValues);
  }, [form, initialFormValues]);

  useEffect(() => {
    const bootstrap = async () => {
      try {
        const response = await radiationDataAPI.getFilters();
        if (response.success) {
          setOptions(response.data);
        }
      } catch (err) {
        console.warn('获取筛选选项失败', err);
      }
    };
    bootstrap();
  }, []);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await radiationDataAPI.list({
          page: currentParams.page,
          limit: currentParams.limit,
          keyword: currentParams.keyword,
          category: currentParams.category,
          subcategory: currentParams.subcategory,
          supplier: currentParams.supplier,
          qualityGrade: currentParams.qualityGrade,
          totalDoseMin: currentParams.totalDoseMin,
          totalDoseMax: currentParams.totalDoseMax,
          singleEventMin: currentParams.singleEventMin,
          singleEventMax: currentParams.singleEventMax,
          sortField: currentParams.sortField,
          sortOrder: currentParams.sortOrder,
        });

        if (response.success) {
          setListResponse(response.data);
        } else {
          setError(response.message || '数据获取失败');
        }
      } catch (err: any) {
        const message =
          err?.response?.data?.error?.message || err?.message || '数据获取失败，请稍后重试';
        setError(message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [currentParams]);

  const updateSearchParams = (next: Record<string, any>) => {
    const merged = {
      page: next.page ?? currentParams.page ?? '1',
      limit: next.limit ?? currentParams.limit ?? String(DEFAULT_PAGE_SIZE),
      keyword: next.keyword ?? currentParams.keyword,
      category: next.category ?? currentParams.category,
      subcategory: next.subcategory ?? currentParams.subcategory,
      supplier: next.supplier ?? currentParams.supplier,
      qualityGrade: next.qualityGrade ?? currentParams.qualityGrade,
      totalDoseMin: next.totalDoseMin ?? currentParams.totalDoseMin,
      totalDoseMax: next.totalDoseMax ?? currentParams.totalDoseMax,
      singleEventMin: next.singleEventMin ?? currentParams.singleEventMin,
      singleEventMax: next.singleEventMax ?? currentParams.singleEventMax,
      sortField: next.sortField ?? currentParams.sortField,
      sortOrder: next.sortOrder ?? currentParams.sortOrder,
    };

    Object.keys(merged).forEach((key) => {
      const value = merged[key];
      if (value === undefined || value === null || value === '' || Number.isNaN(value)) {
        delete merged[key];
      } else {
        merged[key] = String(value);
      }
    });

    setSearchParams(merged, { replace: true });
  };

  const handleSearch = (values: Record<string, any>) => {
    updateSearchParams({
      ...values,
      page: '1',
    });
  };

  const handleReset = () => {
    form.resetFields();
    setSearchParams(
      {
        page: '1',
        limit: String(DEFAULT_PAGE_SIZE),
      },
      { replace: true }
    );
  };

  const handleTableChange: TableProps<RadiationDataRecord>['onChange'] = (
    pagination,
    _filters,
    sorter
  ) => {
    const nextParams: Record<string, any> = {
      page: pagination.current,
      limit: pagination.pageSize,
    };

    if (Array.isArray(sorter)) {
      delete nextParams.sortField;
      delete nextParams.sortOrder;
    } else if (sorter && sorter.field && sorter.order) {
      nextParams.sortField = sorter.field;
      nextParams.sortOrder = sorter.order === 'descend' ? 'desc' : 'asc';
    } else {
      nextParams.sortField = undefined;
      nextParams.sortOrder = undefined;
    }

    updateSearchParams(nextParams);
  };

  const handleExport = async () => {
    if (!listResponse?.items?.length) return;
    setExporting(true);
    try {
      const headers = columnDefinitions.map((column) => column.title).filter(Boolean) as string[];
      const rows = listResponse.items.map((item) =>
        columnDefinitions.map((column) => {
          const key = column.dataIndex as keyof RadiationDataRecord;
          const value = item[key];
          return value === undefined || value === null ? '--' : String(value);
        })
      );
      const csvLines = [
        headers.join(','),
        ...rows.map((row) => row.map((cell) => `"${cell.replace(/"/g, '""')}"`).join(',')),
      ];
      downloadCSV(csvLines.join('\n'), `radiation-data-${dayjs().format('YYYYMMDD-HHmmss')}.csv`);
    } finally {
      setExporting(false);
    }
  };

  const pagination: TablePaginationConfig = {
    current: Number(currentParams.page) || 1,
    pageSize: Number(currentParams.limit) || DEFAULT_PAGE_SIZE,
    total: listResponse?.total || 0,
    showSizeChanger: true,
    pageSizeOptions: ['10', '20', '50', '100'],
  };

  return (
    <div>
      <Space direction="vertical" size="large" style={{ width: '100%' }}>
        <Card>
          <Title level={3} style={{ marginBottom: 8 }}>
            辐照数据查询
          </Title>
          <Paragraph style={{ marginBottom: 0, color: '#475467' }}>
            展示《通用器件辐照数据.xlsx》导入的 1,921 条记录，可按型号、供应商、质量等级等进行筛选。
            数据来自最新一次脚本导入（见 `backend/scripts/import_irradiation_excel.py`）。
          </Paragraph>
          <Paragraph style={{ marginTop: 8 }}>
            <Text type="secondary">
              若 Excel 更新，请重新导入并清除缓存 `radiation:data:*`，即可让页面实时展示最新内容。
            </Text>
          </Paragraph>
        </Card>

        <Card>
          <Form layout="vertical" form={form} onFinish={handleSearch}>
            <Row gutter={16}>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="关键词" name="keyword">
                  <Input
                    allowClear
                    placeholder="型号 / 规格 / 供应商"
                    prefix={<SearchOutlined />}
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="产品类别" name="category">
                  <Select
                    allowClear
                    placeholder="选择类别"
                    options={options.categories.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="产品细类" name="subcategory">
                  <Select
                    allowClear
                    placeholder="选择细类"
                    options={options.subcategories.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="质量等级" name="qualityGrade">
                  <Select
                    allowClear
                    placeholder="选择等级"
                    options={options.qualityGrades.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="供应商" name="supplier">
                  <Select
                    allowClear
                    placeholder="选择供应商"
                    options={options.suppliers.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="总剂量范围 (rad)">
                  <Input.Group compact>
                    <Form.Item name="totalDoseMin" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最小值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                    <Input
                      disabled
                      value="~"
                      style={{ width: 40, textAlign: 'center', background: '#fafafa' }}
                    />
                    <Form.Item name="totalDoseMax" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最大值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                  </Input.Group>
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="单粒子范围 (MeV·cm²/mg)">
                  <Input.Group compact>
                    <Form.Item name="singleEventMin" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最小值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                    <Input
                      disabled
                      value="~"
                      style={{ width: 40, textAlign: 'center', background: '#fafafa' }}
                    />
                    <Form.Item name="singleEventMax" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最大值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                  </Input.Group>
                </Form.Item>
              </Col>
            </Row>
            <Space>
              <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                查询
              </Button>
              <Button icon={<ReloadOutlined />} onClick={handleReset}>
                重置
              </Button>
              <Button
                icon={<DownloadOutlined />}
                onClick={handleExport}
                loading={exporting}
                disabled={!listResponse?.items?.length}
              >
                导出 CSV
              </Button>
            </Space>
          </Form>
        </Card>

        {error && (
          <Alert
            type="error"
            message="加载失败"
            description={error}
            showIcon
            style={{ marginBottom: 16 }}
          />
        )}

        <Card>
          <Table<RadiationDataRecord>
            rowKey={(record) => record._id || `${record.product_name}-${record.model}`}
            columns={columnDefinitions}
            dataSource={listResponse?.items || []}
            loading={loading}
            pagination={pagination}
            onChange={handleTableChange}
            scroll={{ x: 1800 }}
            locale={{
              emptyText: loading ? (
                '加载中...'
              ) : (
                <Empty description="暂无数据，试试调整筛选条件" />
              ),
            }}
          />
        </Card>
      </Space>
    </div>
  );
};

export default RadiationDataPage;


```

```typescriptreact
import React from 'react';
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';
import { ConfigProvider } from 'antd';
import zhCN from 'antd/locale/zh_CN';
import { AuthProvider } from '@/hooks/useAuth';
import Layout from '@/components/Layout';
import Login from '@/pages/Login';

import HomePage from '@/pages/HomePage';
import ProtectedRoute from '@/components/ProtectedRoute';

// 航天元器件平台页面
import ComponentSearch from '@/pages/components/ComponentSearch';
import DigitalICSearch from '@/pages/components/DigitalICSearch';
import AnalogICSearch from '@/pages/components/AnalogICSearch';
import HybridICSearch from '@/pages/components/HybridICSearch';
import DiscreteSearch from '@/pages/components/DiscreteSearch';
import MicrowaveSearch from '@/pages/components/MicrowaveSearch';
import VacuumSearch from '@/pages/components/VacuumSearch';
import OptoelectronicSearch from '@/pages/components/OptoelectronicSearch';
import ElectromechanicalSearch from '@/pages/components/ElectromechanicalSearch';
import PowerSearch from '@/pages/components/PowerSearch';
import GeneralSearch from '@/pages/components/GeneralSearch';
import MicrosystemsSearch from '@/pages/components/MicrosystemsSearch';
import GlobalSearch from '@/pages/components/GlobalSearch';
import ComponentCompare from '@/pages/components/ComponentCompare';
import SupplierSearch from '@/pages/SupplierSearch';
import StandardQuery from '@/pages/standards/StandardQuery';

import SelectionManagement from '@/pages/SelectionManagement';
import RadiationDataPage from '@/pages/components/RadiationDataPage';

// 采购服务模块
import OnlineProcurement from '@/pages/procurement/OnlineProcurement';
import InventoryManagement from '@/pages/procurement/InventoryManagement';
import SupplyChainMonitoring from '@/pages/procurement/SupplyChainMonitoring';

// 应用支持模块
import FunctionalUnits from '@/pages/application/FunctionalUnits';
import DigitalModels from '@/pages/application/DigitalModels';
import QPLManagement from '@/pages/application/QPLManagement';
import CounterfeitDetection from '@/pages/application/CounterfeitDetection';


// 试验检测模块
import RadiationTesting from '@/pages/testing/RadiationTesting';

// 质量管理模块
import QualityNotifications from '@/pages/quality/QualityNotifications';
import QualityWarnings from '@/pages/quality/QualityWarnings';

import QualityZeroDefect from '@/pages/quality/QualityZeroDefect';
import QualityTraceability from '@/pages/quality/QualityTraceability';

// 标准服务模块
import StandardsDocuments from '@/pages/standards/StandardDocuments';
import StandardComparison from '@/pages/standards/StandardComparison';
import VersionManagement from '@/pages/standards/VersionManagement';

// 工程服务模块
import Sourcing from '@/pages/engineering/Sourcing';
import Testing from '@/pages/engineering/Testing';

// 资料及培训模块
import TechnicalDocuments from '@/pages/documents/TechnicalDocuments';
import TestData from '@/pages/documents/TestData';
import TechnicalNews from '@/pages/documents/TechnicalNews';
import TechnicalTraining from '@/pages/documents/TechnicalTraining';
import PolicyRegulation from '@/pages/documents/PolicyRegulation';

// 工程服务模块 - 新增页面
import SecurityCertification from '@/pages/engineering/SecurityCertification';
import DesignSimulation from '@/pages/engineering/DesignSimulation';

// 试验检测模块 - 新增页面
import ComponentIdentification from '@/pages/test/ComponentIdentification';

import './App.css';
import CategoryBrowsePage from '@/pages/categories/CategoryBrowsePage';

const App: React.FC = () => {
  return (
    <ConfigProvider locale={zhCN}>
      <AuthProvider>
        <Router
          future={{
            v7_startTransition: true,
            v7_relativeSplatPath: true,
          }}
        >
          <Routes>
            <Route path="/login" element={<Login />} />
            <Route path="/" element={
              <ProtectedRoute>
                <Layout />
              </ProtectedRoute>
            }>
              <Route index element={<HomePage />} />
              
              {/* 标准服务 */}
              <Route path="standards/search" element={<StandardQuery />} />
              <Route path="standards/compare" element={<StandardComparison />} />
              <Route path="standards/versions" element={<VersionManagement />} />
              <Route path="standards/analysis" element={<StandardsDocuments />} />
              
              {/* 器件查询服务 */}
              <Route path="components/search" element={<ComponentSearch />} />
              <Route path="components/radiation-data" element={<RadiationDataPage />} />
              <Route path="components/digital-ic" element={<DigitalICSearch />} />
              <Route path="components/analog-ic" element={<AnalogICSearch />} />
              <Route path="components/hybrid-ic" element={<HybridICSearch />} />
              <Route path="components/discrete" element={<DiscreteSearch />} />
              <Route path="components/microwave" element={<MicrowaveSearch />} />
              <Route path="components/vacuum" element={<VacuumSearch />} />
              <Route path="components/optoelectronic" element={<OptoelectronicSearch />} />
              <Route path="components/electromechanical" element={<ElectromechanicalSearch />} />
              <Route path="components/power" element={<PowerSearch />} />
              <Route path="components/general" element={<GeneralSearch />} />
              <Route path="components/microsystems" element={<MicrosystemsSearch />} />
              <Route path="components/global-search" element={<GlobalSearch />} />
              <Route path="components/compare" element={<ComponentCompare />} />
              <Route path="components/suppliers" element={<SupplierSearch />} />
              <Route path="components/selection" element={<SelectionManagement />} />
              
              {/* 类别浏览重定向 */}
              <Route path="categories/*" element={<CategoryBrowsePage />} />
              
              {/* 采购服务 */}
              <Route path="procurement/sourcing" element={<Sourcing />} />
              <Route path="procurement/online" element={<OnlineProcurement />} />
              <Route path="procurement/inventory" element={<InventoryManagement />} />
              <Route path="procurement/supply-chain" element={<SupplyChainMonitoring />} />
              
              {/* 应用支持 */}
              <Route path="application/units" element={<FunctionalUnits />} />
              <Route path="application/models" element={<DigitalModels />} />
              <Route path="application/simulation" element={<DesignSimulation />} />
              <Route path="application/qpl" element={<QPLManagement />} />
              <Route path="application/counterfeit" element={<CounterfeitDetection />} />
              
              {/* 质量管理 */}
              <Route path="quality/zero-defect" element={<QualityZeroDefect />} />
              <Route path="quality/notification" element={<QualityNotifications />} />
              <Route path="quality/warning" element={<QualityWarnings />} />
              <Route path="quality/traceability" element={<QualityTraceability />} />
              
              {/* 试验检测 */}
              <Route path="testing/routine" element={<Testing />} />
              <Route path="testing/qualification" element={<ComponentIdentification />} />
              <Route path="testing/radiation" element={<RadiationTesting />} />
              <Route path="testing/supply-security" element={<SecurityCertification />} />
              
              {/* 资料及培训 */}
              <Route path="documents/technical" element={<TechnicalDocuments />} />
              <Route path="documents/test-data" element={<TestData />} />
              <Route path="documents/news" element={<TechnicalNews />} />
              <Route path="documents/training" element={<TechnicalTraining />} />
              <Route path="documents/policy" element={<PolicyRegulation />} />
              
              {/* 其他页面待实现 */}
              <Route path="*" element={<div style={{padding: 24}}>页面开发中...</div>} />
            </Route>
          </Routes>
        </Router>
      </AuthProvider>
    </ConfigProvider>
  );
};

export default App;

```

```typescriptreact
import React, { useState } from 'react';
import { Outlet, useNavigate, useLocation } from 'react-router-dom';
import {
  Layout as AntLayout,
  Menu,
  Dropdown,
  Avatar,
  theme,
  Space,
  Row,
  Col,
  Button,
  Drawer,
} from 'antd';

import {
  DashboardOutlined,
  SearchOutlined,
  ShoppingCartOutlined,
  ExperimentOutlined,
  SafetyOutlined,
  ToolOutlined,
  BookOutlined,
  CloudServerOutlined,
  UserOutlined,
  LogoutOutlined,
  SettingOutlined,
  MenuOutlined,
} from '@ant-design/icons';
import { useAuth } from '@/hooks/useAuth';
import './layout.css';

const { Header, Content } = AntLayout;

const Layout: React.FC = () => {
  const [mobileMenuVisible, setMobileMenuVisible] = useState(false);
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();
  const {
    token: { colorBgContainer },
  } = theme.useToken();

  // 菜单项配置 - 基于7大核心模块
  const menuItems = [
    {
      key: '/',
      icon: <DashboardOutlined />,
      label: '首页',
    },
    {
      key: '/standards',
      icon: <BookOutlined />,
      label: '标准服务',
      children: [
        {
          key: '/standards/search',
          label: '标准查询',
        },
        {
          key: '/standards/compare',
          label: '标准对比',
        },
        {
          key: '/standards/versions',
          label: '版本管理',
        },
        {
          key: '/standards/analysis',
          label: '标准解析',
        },
      ],
    },
    {
      key: '/components',
      icon: <SearchOutlined />,
      label: '器件查询',
      children: [
        {
          key: '/components/search',
          label: '智能搜索',
        },
        {
          key: '/components/radiation-data',
          label: '辐照数据',
        },
        {
          key: '/components/compare',
          label: '器件比对',
        },
        {
          key: '/components/suppliers',
          label: '供应商检索',
        },
        {
          key: '/components/selection',
          label: '在线选用',
        },
      ],
    },
    {
      key: '/procurement',
      icon: <ShoppingCartOutlined />,
      label: '采购服务',
      children: [
        {
          key: '/procurement/sourcing',
          label: '货源开发',
        },
        {
          key: '/procurement/online',
          label: '在线采购',
        },
        {
          key: '/procurement/inventory',
          label: '库存追踪',
        },
        {
          key: '/procurement/supply-chain',
          label: '供应链监控',
        },
      ],
    },
    {
      key: '/application',
      icon: <ToolOutlined />,
      label: '应用支持',
      children: [
        {
          key: '/application/units',
          label: '功能单元',
        },
        {
          key: '/application/models',
          label: '数字模型',
        },
        {
          key: '/application/simulation',
          label: '应用仿真',
        },
        {
          key: '/application/qpl',
          label: '合格产品目录',
        },
        {
          key: '/application/counterfeit',
          label: '假冒伪劣库',
        },
      ],
    },
    {
      key: '/quality',
      icon: <SafetyOutlined />,
      label: '质量管理',
      children: [
        {
          key: '/quality/zero-defect',
          label: '质量归零',
        },
        {
          key: '/quality/notification',
          label: '质量通报',
        },
        {
          key: '/quality/warning',
          label: '预警发布',
        },
        {
          key: '/quality/traceability',
          label: '追溯查询',
        },
      ],
    },
    {
      key: '/testing',
      icon: <ExperimentOutlined />,
      label: '试验检测',
      children: [
        {
          key: '/testing/routine',
          label: '常规检测',
        },
        {
          key: '/testing/qualification',
          label: '器件鉴定',
        },
        {
          key: '/testing/radiation',
          label: '辐照评估',
        },
        {
          key: '/testing/supply-security',
          label: '供应安全评价',
        },
      ],
    },
    {
      key: '/documents',
      icon: <CloudServerOutlined />,
      label: '资料及培训',
      children: [
        {
          key: '/documents/technical',
          label: '技术文档',
        },
        {
          key: '/documents/test-data',
          label: '测试数据',
        },
        {
          key: '/documents/news',
          label: '技术动态',
        },
        {
          key: '/documents/training',
          label: '技术培训',
        },
        {
          key: '/documents/policy',
          label: '政策法规',
        },
      ],
    },
  ];

  // 根据用户角色过滤菜单
  const filteredMenuItems = menuItems.filter(item => {
    if (!('roles' in item) || !item.roles) return true;
    const roles = item.roles as string[];
    return Array.isArray(roles) && roles.includes(user?.role || '');
  });

  const handleMenuClick = ({ key }: { key: string }) => {
    navigate(key);
  };

  const handleLogout = () => {
    logout();
  };

  const userMenuItems = [
    {
      key: 'profile',
      icon: <UserOutlined />,
      label: '个人资料',
    },
    {
      key: 'settings',
      icon: <SettingOutlined />,
      label: '设置',
    },
    {
      type: 'divider' as const,
    },
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: '退出登录',
      onClick: handleLogout,
    },
  ];

  return (
    <AntLayout style={{ minHeight: '100vh' }}>
      <Header className="top-navigation" style={{ 
        background: '#001529',
        padding: '0 24px',
        position: 'fixed',
        top: 0,
        left: 0,
        right: 0,
        zIndex: 1000,
      }}>
        <Row justify="space-between" align="middle" style={{ height: '100%' }}>
          <Col flex="auto">
            <div 
              className="platform-logo"
              onClick={() => navigate('/')}
              style={{ cursor: 'pointer' }}
            >
              <span style={{ 
                color: '#ffffff', 
                fontSize: '24px', 
                fontWeight: 'bold',
                letterSpacing: '2px'
              }}>
                CASI
              </span>
            </div>
            <Menu
              theme="dark"
              mode="horizontal"
              selectedKeys={[location.pathname]}
              items={filteredMenuItems}
              onClick={handleMenuClick}
              style={{ 
                background: 'transparent',
                border: 'none',
                display: 'inline-block',
                lineHeight: '64px',
              }}
              className="desktop-menu"
            />
            <Button
              type="text"
              icon={<MenuOutlined />}
              onClick={() => setMobileMenuVisible(true)}
              className="mobile-menu-trigger"
              style={{ color: 'white', display: 'none' }}
            />
          </Col>
          <Col>
            <Space>
              <span className="user-info">
                欢迎，{user?.username}
              </span>
              <Dropdown
                menu={{ items: userMenuItems }}
                placement="bottomRight"
                arrow
              >
                <Avatar 
                  style={{ backgroundColor: '#1890ff', cursor: 'pointer' }}
                  icon={<UserOutlined />}
                />
              </Dropdown>
            </Space>
          </Col>
        </Row>
      </Header>

      {/* 移动端抽屉菜单 */}
      <Drawer
        title="导航菜单"
        placement="left"
        onClose={() => setMobileMenuVisible(false)}
        open={mobileMenuVisible}
        styles={{ body: { padding: 0 } }}
      >
        <Menu
          mode="inline"
          selectedKeys={[location.pathname]}
          items={filteredMenuItems}
          onClick={(info) => {
            handleMenuClick(info);
            setMobileMenuVisible(false);
          }}
        />
      </Drawer>

      <Content
        className="main-content"
        style={{
          marginTop: '64px',
          padding: location.pathname === '/' ? '0' : '24px',
          minHeight: 'calc(100vh - 64px)',
          background: location.pathname === '/' ? 'transparent' : colorBgContainer,
        }}
      >
        <Outlet />
      </Content>
    </AntLayout>
  );
};

export default Layout;

```

```typescriptreact
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import '../styles/homepage.css';

import {
  Card,
  Input,
  Tag,
  Row,
  Col,
  Typography,
  Button,
  Space,
  Statistic,
  List,
  Avatar,
  Select,
  Tabs,
} from 'antd';
import {
  SearchOutlined,
  BookOutlined,
  ShoppingCartOutlined,
  ToolOutlined,
  SafetyCertificateOutlined,
  ExperimentOutlined,
  FileTextOutlined,
  RightOutlined,
  TrophyOutlined,
  BellOutlined,
  FileProtectOutlined,
  ThunderboltOutlined,
  DatabaseOutlined,
  ApiOutlined,
  RadarChartOutlined,
  SettingOutlined,
  BugOutlined,
  AppstoreOutlined,
  SwapOutlined,
  UsbOutlined,
  WifiOutlined,
  PoweroffOutlined,
  HeatMapOutlined,
  BranchesOutlined,
  PartitionOutlined,
  BlockOutlined,
  NodeIndexOutlined,
  FileSearchOutlined,
  DiffOutlined,
  BarChartOutlined,
  BulbOutlined,
  BuildOutlined,
} from '@ant-design/icons';

const { Search } = Input;
const { Title, Paragraph, Text } = Typography;
const { Option } = Select;

// DoEEEt真实的顶级分类数据（从数据库统计得出）
const componentCategoriesBase = [
  { 
    icon: <BarChartOutlined />, 
    title: '电阻器', 
    subtitle: 'Resistors',
    color: '#1890ff',
    description: '固定电阻、可变电阻、网络电阵列等',
    familyPath: 'Resistors',
    count: 824599
  },
  { 
    icon: <ThunderboltOutlined />, 
    title: '电容器', 
    subtitle: 'Capacitors',
    color: '#52c41a',
    description: '陶瓷电容、钽电容、薄膜电容等',
    familyPath: 'Capacitors',
    count: 527329
  },
  { 
    icon: <UsbOutlined />, 
    title: '连接器', 
    subtitle: 'Connectors',
    color: '#fa8c16',
    description: 'PCB连接器、D型连接器、射频连接器等',
    familyPath: 'Connectors',
    count: 160090
  },
  { 
    icon: <WifiOutlined />, 
    title: '晶振与振荡器', 
    subtitle: 'Crystals and Oscillators',
    color: '#722ed1',
    description: '晶体振荡器、石英晶体等',
    familyPath: 'Crystals and Oscillators',
    count: 131525
  },
  { 
    icon: <PoweroffOutlined />, 
    title: '开关', 
    subtitle: 'Switches',
    color: '#eb2f96',
    description: '拨动开关、按键开关、旋转开关等',
    familyPath: 'Switches',
    count: 53377
  },
  { 
    icon: <NodeIndexOutlined />, 
    title: '分立器件', 
    subtitle: 'Discretes',
    color: '#13c2c2',
    description: '二极管、三极管、场效应管、功率器件等',
    familyPath: 'Discretes',
    count: 51638
  },
  { 
    icon: <HeatMapOutlined />, 
    title: '热敏电阻', 
    subtitle: 'Thermistors',
    color: '#fa541c',
    description: 'NTC、RTD、热电阻等',
    familyPath: 'Thermistors',
    count: 31302
  },
  { 
    icon: <PartitionOutlined />, 
    title: '微电路', 
    subtitle: 'Microcircuits',
    color: '#2f54eb',
    description: '数字微电路、模拟微电路、外围控制器等',
    familyPath: 'Microcircuits',
    count: 29962
  },
  { 
    icon: <ApiOutlined />, 
    title: '电缆组件', 
    subtitle: 'Cable Assemblies',
    color: '#08979c',
    description: '射频电缆、微波电缆、连接线等',
    familyPath: 'Cable Assemblies',
    count: 9435
  },
  { 
    icon: <BranchesOutlined />, 
    title: '电感器', 
    subtitle: 'Inductors',
    color: '#531dab',
    description: '功率电感、定制电感、RF电感等',
    familyPath: 'Inductors',
    count: 8849
  },
  { 
    icon: <SwapOutlined />, 
    title: '继电器', 
    subtitle: 'Relays',
    color: '#096dd9',
    description: '混合继电器、电磁继电器、固态继电器等',
    familyPath: 'Relays',
    count: 6015
  },
  { 
    icon: <BlockOutlined />, 
    title: '变压器', 
    subtitle: 'Transformers',
    color: '#c41d7f',
    description: '电源变压器、隔离变压器、脉冲变压器等',
    familyPath: 'Transformers',
    count: 3363
  },
  { 
    icon: <DiffOutlined />, 
    title: '滤波器', 
    subtitle: 'Filters',
    color: '#389e0d',
    description: '共模扼流圈、EMI滤波器、信号滤波器等',
    familyPath: 'Filters',
    count: 2565
  },
  { 
    icon: <FileSearchOutlined />, 
    title: '电线电缆', 
    subtitle: 'Wires and Cables',
    color: '#d46b08',
    description: '导线、电缆、屏蔽线等',
    familyPath: 'Wires and Cables',
    count: 1125
  },
  { 
    icon: <RadarChartOutlined />, 
    title: '射频无源器件', 
    subtitle: 'RF Passive Components',
    color: '#9254de',
    description: '同轴衰减器、负载、耦合器等',
    familyPath: 'RF Passive Components',
    count: 243
  },
];

// 7大核心服务模块
const serviceModules = [
  {
    key: 'standards',
    title: '标准服务',
    icon: <BookOutlined />,
    description: '国际航天标准文档查询与管理',
    features: ['MIL标准', 'ESCC标准', '标准对比', '版本管理'],
    link: '/standards',
    color: '#1890ff',
    stats: { count: '15,000+', label: '标准文档' }
  },
  {
    key: 'components',
    title: '器件查询',
    icon: <SearchOutlined />,
    description: '器件信息管理与查询服务',
    features: ['智能搜索', '器件比对', '供应商检索', '在线选用'],
    link: '/components',
    color: '#52c41a',
    stats: { count: '50,000+', label: '器件型号' }
  },
  {
    key: 'procurement',
    title: '采购服务',
    icon: <ShoppingCartOutlined />,
    description: '专业的航天器件采购与供应链管理',
    features: ['货源开发', '在线采购', '库存管理', '供应链监控'],
    link: '/procurement',
    color: '#fa8c16',
    stats: { count: '2,000+', label: '合格供应商' }
  },
  {
    key: 'application',
    title: '应用支持',
    icon: <ToolOutlined />,
    description: '器件应用技术支持与设计服务',
    features: ['应用指南', '功能单元', '数字模型', '仿真分析'],
    link: '/application',
    color: '#eb2f96',
    stats: { count: '8,000+', label: '应用案例' }
  },
  {
    key: 'quality',
    title: '质量管理',
    icon: <SafetyCertificateOutlined />,
    description: '质量问题管理与追溯服务',
    features: ['问题上报', '质量归零', '预警通报', '追溯查询'],
    link: '/quality',
    color: '#722ed1',
    stats: { count: '99.9%', label: '质量可靠性' }
  },
  {
    key: 'testing',
    title: '试验检测',
    icon: <ExperimentOutlined />,
    description: '专业的航天器件试验检测服务',
    features: ['常规检测', '器件鉴定', '辐照测试', '安全评价'],
    link: '/testing',
    color: '#13c2c2',
    stats: { count: '500+', label: '检测项目' }
  },
  {
    key: 'documents',
    title: '文件培训',
    icon: <FileTextOutlined />,
    description: '技术文档管理与专业培训服务',
    features: ['技术文档', '测试数据', '培训课程', '行业资讯'],
    link: '/documents',
    color: '#fa541c',
    stats: { count: '10,000+', label: '技术文档' }
  },
];

// 最新动态数据
const latestNews = [
  {
    id: 1,
    type: 'news',
    title: '新版MIL-STD-883标准发布',
    content: '美军标MIL-STD-883K版本正式发布，新增多项测试方法...',
    date: '2024-01-15',
    icon: <FileProtectOutlined style={{ color: '#1890ff' }} />
  },
  {
    id: 2,
    type: 'quality',
    title: '质量预警：某型存储器批次问题',
    content: '发现某厂商2023年第4季度生产的SRAM器件存在质量隐患...',
    date: '2024-01-14',
    icon: <BellOutlined style={{ color: '#ff4d4f' }} />
  },
  {
    id: 3,
    type: 'achievement',
    title: '平台器件数据库突破5万种',
    content: '经过持续建设，平台器件数据库已收录超过5万种航天级器件...',
    date: '2024-01-12',
    icon: <TrophyOutlined style={{ color: '#52c41a' }} />
  },
];

const HomePage: React.FC = () => {
  const navigate = useNavigate();
  const [searchCategory, setSearchCategory] = useState('model');
  const [componentCategories, setComponentCategories] = useState(componentCategoriesBase.map(cat => ({ ...cat, count: '...' })));
  const [statsLoading, setStatsLoading] = useState(true);

  // 获取统计数据
  useEffect(() => {
    const fetchStatistics = async () => {
      try {
        setStatsLoading(true);
        const response = await fetch('/api/doeeet/statistics');
        const result = await response.json();
        
        if (result.success && result.data) {
          // 更新分类统计数据
          const updatedCategories = componentCategoriesBase.map(cat => {
            const stats = result.data.categoryStats || {};
            // 尝试匹配分类名称
            const count = stats[cat.familyPath] || stats[cat.title] || 0;
            return {
              ...cat,
              count: count > 0 ? count.toLocaleString() : '0'
            };
          });
          setComponentCategories(updatedCategories);
        }
      } catch (error) {
        console.error('获取统计数据失败:', error);
        // 使用默认值
        setComponentCategories(componentCategoriesBase.map(cat => ({ ...cat, count: '-' })));
      } finally {
        setStatsLoading(false);
      }
    };
    
    fetchStatistics();
  }, []);

  const handleSearch = (value: string) => {
    if (value.trim()) {
      navigate(`/components/search?q=${encodeURIComponent(value)}&category=${searchCategory}`);
    }
  };

  const handleCategoryClick = (category: string) => {
    // 为特定分类指定专门的路由
    if (category === '数字单片集成电路') {
      navigate('/components/digital-ic');
    } else if (category === '模拟单片集成电路') {
      navigate('/components/analog-ic');
    } else if (category === '混合集成电路') {
      navigate('/components/hybrid-ic');
    } else if (category === '半导体分立器件') {
      navigate('/components/discrete');
    } else if (category === '固态微波器件与电路') {
      navigate('/components/microwave');
    } else if (category === '真空电子器件') {
      navigate('/components/vacuum');
    } else if (category === '光电子器件') {
      navigate('/components/optoelectronic');
    } else if (category === '机电组件') {
      navigate('/components/electromechanical');
    } else if (category === '电能源') {
      navigate('/components/power');
    } else if (category === '通用与特种元件') {
      navigate('/components/general');
    } else if (category === '微系统') {
      navigate('/components/microsystems');
    } else {
      navigate(`/components/search?category=${encodeURIComponent(category)}`);
    }
  };

  const handleModuleClick = (link: string) => {
    navigate(link);
  };

  return (
    <div style={{ background: '#f5f5f5', minHeight: '100vh' }}>
      {/* Hero Section - 类似 doEEEt 的深蓝色背景 */}
      <div style={{
        background: 'linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%)',
        padding: '60px 0 80px',
        color: 'white',
        textAlign: 'center',
        position: 'relative',
        overflow: 'hidden'
      }}>
        {/* 左侧火箭背景图 */}
        <div 
          className="hero-bg-rocket"
          style={{
            backgroundImage: 'url(/images/flight_2.jpg)'
          }}
        />
        
        {/* 右侧芯片背景图 */}
        <div 
          className="hero-bg-chip"
          style={{
            backgroundImage: 'url(/images/chip.jpg)'
          }}
        />
        <div style={{ 
          maxWidth: 1200, 
          margin: '0 auto', 
          padding: '0 24px',
          position: 'relative',
          zIndex: 2
        }}>
          <Title level={1} style={{ 
            color: 'white', 
            fontSize: '42px', 
            marginBottom: 16,
            fontWeight: 'normal'
          }}>
            商业航天元器件及其应用支持一站式服务平台
          </Title>
          <Paragraph style={{ 
            color: 'rgba(255,255,255,0.9)', 
            fontSize: '18px', 
            marginBottom: 50,
            maxWidth: 800,
            margin: '0 auto 50px'
          }}>
            查找来自数百家制造商的电气电子机电(EEE)器件和数据表，为商业航天提供专业的元器件解决方案
          </Paragraph>
          
          {/* 主搜索框 - 参考知网的设计 */}
          <div style={{ maxWidth: 1000, margin: '0 auto' }}>
            {/* 搜索类别选择 */}
            <div style={{ 
              marginBottom: 16,
              display: 'flex',
              justifyContent: 'center'
            }}>
              <div style={{
                background: 'rgba(255,255,255,0.1)',
                borderRadius: '8px',
                padding: '4px',
                backdropFilter: 'blur(10px)'
              }}>
                <Space.Compact>
                  <Button
                    type={searchCategory === 'model' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('model')}
                    style={{
                      background: searchCategory === 'model' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'model' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'model' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    型号规格
                  </Button>
                  <Button
                    type={searchCategory === 'supplier' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('supplier')}
                    style={{
                      background: searchCategory === 'supplier' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'supplier' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'supplier' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    供应商
                  </Button>
                  <Button
                    type={searchCategory === 'standard' ? 'primary' : 'default'}
                    onClick={() => setSearchCategory('standard')}
                    style={{
                      background: searchCategory === 'standard' ? '#3b82f6' : 'transparent',
                      borderColor: searchCategory === 'standard' ? '#3b82f6' : 'rgba(255,255,255,0.3)',
                      color: searchCategory === 'standard' ? 'white' : 'rgba(255,255,255,0.9)',
                      height: '36px'
                    }}
                  >
                    标准编号
                  </Button>
                </Space.Compact>
              </div>
            </div>

            {/* 搜索框 */}
            <Search
              placeholder={
                searchCategory === 'model' ? "搜索元器件的型号规格..." :
                searchCategory === 'supplier' ? "搜索供应商名称..." :
                "搜索标准编号..."
              }
              size="large"
              enterButton={
                <Button 
                  type="primary" 
                  size="large"
                  icon={<SearchOutlined />}
                  style={{ 
                    background: '#3b82f6',
                    borderColor: '#3b82f6',
                    height: '50px',
                    paddingLeft: 24,
                    paddingRight: 24
                  }}
                >
                  搜索
                </Button>
              }
              onSearch={handleSearch}
              styles={{
                input: {
                  fontSize: '16px',
                  height: '50px',
                  paddingLeft: '16px'
                }
              }}
            />
            <div style={{ marginTop: 20, textAlign: 'left' }}>
              <Text style={{ color: 'rgba(255,255,255,0.7)', fontSize: '14px' }}>
                热门搜索：
              </Text>
              <Space wrap style={{ marginLeft: 8 }}>
                {searchCategory === 'model' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('LM358')}
                    >
                      LM358
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('STM32F103')}
                    >
                      STM32F103
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('AD8232')}
                    >
                      AD8232
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('TPS62180')}
                    >
                      TPS62180
                    </Tag>
                  </>
                )}
                {searchCategory === 'supplier' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('深圳国微')}
                    >
                      深圳国微
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('复旦微')}
                    >
                      复旦微
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('兆易创新')}
                    >
                      兆易创新
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('英飞凌')}
                    >
                      英飞凌
                    </Tag>
                  </>
                )}
                {searchCategory === 'standard' && (
                  <>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('GJB 548')}
                    >
                      GJB 548
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('MIL-STD-883')}
                    >
                      MIL-STD-883
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('Q/QJA 20084')}
                    >
                      Q/QJA 20084
                    </Tag>
                    <Tag 
                      style={{ 
                        background: 'rgba(255,255,255,0.1)', 
                        color: 'white', 
                        border: '1px solid rgba(255,255,255,0.3)',
                        cursor: 'pointer'
                      }}
                      onClick={() => handleSearch('Q/QJA 20085')}
                    >
                      Q/QJA 20085
                    </Tag>
                  </>
                )}
              </Space>
            </div>
          </div>
        </div>
      </div>

      <div style={{ maxWidth: 1200, margin: '0 auto', padding: '0 24px' }}>
        {/* 器件分类浏览 - 参考 doEEEt 的 Browse by category */}
        <section style={{ padding: '60px 0 40px' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            按类别浏览
          </Title>
          <Row gutter={[20, 20]} justify="center">
            {componentCategories.map((category, index) => (
              <Col xs={12} sm={8} md={6} lg={4} key={index}>
                <Card
                  hoverable
                  style={{
                    height: '140px',
                    borderRadius: 8,
                    border: '1px solid #e2e8f0',
                    transition: 'all 0.3s',
                    cursor: 'pointer'
                  }}
                  styles={{ 
                    body: {
                      padding: '20px 16px',
                      height: '100%',
                      display: 'flex',
                      flexDirection: 'column',
                      justifyContent: 'center',
                      alignItems: 'center'
                    }
                  }}
                  onClick={() => handleCategoryClick(category.title)}
                >
                  <div 
                    style={{ 
                      fontSize: '24px', 
                      marginBottom: 12,
                      color: category.color,
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }}
                  >
                    {category.icon}
                  </div>
                  <Title 
                    level={5} 
                    style={{ 
                      marginBottom: 4, 
                      color: category.color,
                      textAlign: 'center',
                      fontSize: '14px',
                      fontWeight: '600'
                    }}
                  >
                    {category.title}
                  </Title>
                  <Text 
                    style={{ 
                      color: '#64748b',
                      fontSize: '12px',
                      textAlign: 'center'
                    }}
                  >
                    {category.subtitle}
                  </Text>
                </Card>
              </Col>
            ))}
          </Row>
        </section>

        {/* 服务和工具 - 类似 doEEEt 的 Services and tools */}
        <section style={{ padding: '40px 0' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            服务和工具
          </Title>
          <Row gutter={[24, 24]}>
            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/standards/search')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <FileSearchOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#3b82f6',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    标准查询
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    查询国际和行业标准，获取最新的技术规范和认证要求。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#3b82f6',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/components/compare')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <DiffOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#10b981',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    器件比对
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    在同一显示屏中比较多个器件，通过参数筛选找到最佳选择。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#10b981',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/procurement/online')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <ShoppingCartOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#f59e0b',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    在线采购
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    快速便捷的器件采购平台，添加器件到购物车并获取报价。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#f59e0b',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>

            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/application/models')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <BarChartOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#8b5cf6',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    数字模型
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    访问器件的数字化模型和仿真数据，支持设计验证和分析。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#8b5cf6',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>
            <Col xs={24} sm={12} lg={6}>
              <Card
                hoverable
                style={{
                  height: '200px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/components/radiation-data')}
              >
                <div style={{ textAlign: 'center', padding: '20px 0' }}>
                  <RadarChartOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#0ea5e9',
                      marginBottom: 16 
                    }} 
                  />
                  <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                    辐照数据
                  </Title>
                  <Paragraph style={{ color: '#64748b', margin: 0 }}>
                    快速检索通用器件辐照测试指标，支持分类筛选与 CSV 导出。
                  </Paragraph>
                  <Button 
                    type="link" 
                    style={{ 
                      marginTop: 12,
                      color: '#0ea5e9',
                      fontWeight: '500'
                    }}
                  >
                    进入工具 <RightOutlined />
                  </Button>
                </div>
              </Card>
            </Col>
          </Row>
        </section>

        {/* 内容和资源 - 类似 doEEEt 的 Content and resources */}
        <section style={{ padding: '40px 0 60px' }}>
          <Title 
            level={2} 
            style={{ 
              textAlign: 'left', 
              marginBottom: 40,
              fontSize: '32px',
              color: '#1e293b',
              fontWeight: 'bold'
            }}
          >
            内容和资源
          </Title>
          <Row gutter={[24, 24]}>
            <Col xs={24} md={12}>
              <Card
                hoverable
                style={{
                  height: '160px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/documents/technical')}
              >
                <div style={{ display: 'flex', alignItems: 'center', height: '100%' }}>
                  <BookOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#3b82f6',
                      marginRight: 20 
                    }} 
                  />
                  <div style={{ flex: 1 }}>
                    <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                      技术博客：掌握高可靠器件最新动态
                    </Title>

                    <Button 
                      type="link" 
                      style={{ 
                        padding: 0,
                        marginTop: 8,
                        color: '#3b82f6',
                        fontWeight: '500'
                      }}
                    >
                      访问技术博客 <RightOutlined />
                    </Button>
                  </div>
                </div>
              </Card>
            </Col>

            <Col xs={24} md={12}>
              <Card
                hoverable
                style={{
                  height: '160px',
                  borderRadius: 8,
                  border: '1px solid #e2e8f0',
                  cursor: 'pointer'
                }}
                onClick={() => handleModuleClick('/documents/training')}
              >
                <div style={{ display: 'flex', alignItems: 'center', height: '100%' }}>
                  <TrophyOutlined 
                    style={{ 
                      fontSize: '48px', 
                      color: '#10b981',
                      marginRight: 20 
                    }} 
                  />
                  <div style={{ flex: 1 }}>
                    <Title level={4} style={{ marginBottom: 8, color: '#1e293b' }}>
                      活动/网络研讨会：不错过任何活动
                    </Title>

                    <Button 
                      type="link" 
                      style={{ 
                        padding: 0,
                        marginTop: 8,
                        color: '#10b981',
                        fontWeight: '500'
                      }}
                      onClick={(e) => {
                        e.stopPropagation();
                        handleModuleClick('/documents/training');
                      }}
                    >
                      查看日程表 <RightOutlined />
                    </Button>
                  </div>
                </div>
              </Card>
            </Col>
          </Row>
        </section>
      </div>
    </div>
  );
};

export default HomePage;

```

---

**User**


测试没问题
(space_env) F:\Business_plat\backend>npm test -- --runTestsByPath tests/radiationDataService.test.ts

> aerospace-platform-backend@1.0.0 test F:\Business_plat\backend
> jest "--runTestsByPath" "tests/radiationDataService.test.ts"

 PASS  tests/radiationDataService.test.ts
  RadiationDataService
    √ builds filters based on incoming query (2 ms)
    √ returns sorted filter options without empty values (7 ms)

Test Suites: 1 passed, 1 total
Tests:       2 passed, 2 total
Snapshots:   0 total
Time:        3.901 s
Ran all test suites within paths "tests/radiationDataService.test.ts".

(space_env) F:\Business_plat\backend>

---

**Cursor**

Radiation data experience is wired up end-to-end:

- Added `RadiationDataPage` with filtering, pagination, sorting, and CSV export wired to `radiationDataAPI`.
- Registered the route in `frontend/src/App.tsx`, linked it from the left nav in `frontend/src/components/Layout.tsx`, and exposed it on the dashboard card in `frontend/src/pages/HomePage.tsx`.

Backend coverage: `npm test -- --runTestsByPath tests/radiationDataService.test.ts` (passes). Let me know if you want any UI polish or extra tests.

---

**User**

以后请都用中文回答

---

**Cursor**

收到，后续我会使用中文回复。

---

**User**

刚才这个是什么意思
Radiation data experience is wired up end-to-end:
Added RadiationDataPage with filtering, pagination, sorting, and CSV export wired to radiationDataAPI.
Registered the route in frontend/src/App.tsx, linked it from the left nav in frontend/src/components/Layout.tsx, and exposed it on the dashboard card in frontend/src/pages/HomePage.tsx.
Backend coverage: npm test -- --runTestsByPath tests/radiationDataService.test.ts (passes). Let me know if you want any UI polish or extra tests.

---

**Cursor**

这段说明主要是在总结我们刚刚完成的工作内容和验证情况，具体意思如下：

- “Radiation data experience is wired up end-to-end” 表示辐射数据这块的前后端流程已经完整打通，可以从前端页面一直调用到后端接口并正确返回数据。
- “Added RadiationDataPage...” 说明新增了 `RadiationDataPage` 页面，包含筛选、分页、排序和导出 CSV 功能，并且这些操作已经通过 `radiationDataAPI` 调用后端接口。
- “Registered the route... linked it from the left nav... exposed it on the dashboard card...” 表示已经在前端路由中注册了新的页面，并且在左侧导航栏和首页仪表盘卡片里加入了入口，用户可以从这些入口进入辐射数据页面。
- “Backend coverage: npm test ... (passes)” 表示后台相关的单元测试都执行通过，说明服务端逻辑当前运行正常。

整体就是在告诉你：辐射数据功能已经从界面、导航到接口全部接好，并且通过了测试；如果你还需要额外的 UI 调整或更多测试，可以继续提需求。

---

**User**

我可以启动前后端查看了么

---

**Cursor**

可以，现在功能已经接通，前后端都可以启动来查看实际效果。按你们项目的常规方式启动即可——例如：

- 后端（若是 Node）：在 `backend` 目录执行 `npm install`（首次需要），然后 `npm run dev` 或 `npm start`。
- 前端：在 `frontend` 目录执行 `npm install`（首次需要），再运行 `npm start`。

如果需要具体命令或遇到启动问题，告诉我，我可以帮你一步步操作。

---

**User**

产品型号这列不要了

---

**Cursor**

```typescriptreact
import React, { useEffect, useMemo, useState } from 'react';
import {
  Alert,
  Button,
  Card,
  Col,
  Empty,
  Form,
  Input,
  InputNumber,
  Row,
  Select,
  Space,
  Table,
  Tag,
  Typography,
} from 'antd';
import type { ColumnsType, TablePaginationConfig, TableProps } from 'antd/es/table';
import { DownloadOutlined, ReloadOutlined, SearchOutlined } from '@ant-design/icons';
import { useSearchParams } from 'react-router-dom';
import dayjs from 'dayjs';
import { radiationDataAPI } from '@/services/api';
import type {
  RadiationDataListResponse,
  RadiationDataRecord,
  RadiationFilterOptions,
} from '@/types';
import { downloadCSV } from '@/utils/parameterUtils';

const { Title, Paragraph, Text } = Typography;

const DEFAULT_PAGE_SIZE = 20;

const columnDefinitions: ColumnsType<RadiationDataRecord> = [
  {
    title: '产品类别',
    dataIndex: 'category',
    key: 'category',
    width: 160,
    render: (value: string) => <Tag color="blue">{value}</Tag>,
  },
  {
    title: '产品细类',
    dataIndex: 'subcategory',
    key: 'subcategory',
    width: 160,
  },
  {
    title: '产品名称',
    dataIndex: 'product_name',
    key: 'product_name',
    width: 200,
  },
  {
    title: '型号规格',
    dataIndex: 'model_spec',
    key: 'model_spec',
    width: 200,
  },
  {
    title: '封装形式',
    dataIndex: 'package',
    key: 'package',
    width: 140,
  },
  {
    title: '总剂量',
    dataIndex: 'total_dose',
    key: 'total_dose',
    width: 160,
  },
  {
    title: '单粒子',
    dataIndex: 'single_event',
    key: 'single_event',
    width: 160,
  },
  {
    title: '位移',
    dataIndex: 'displacement',
    key: 'displacement',
    width: 140,
  },
  {
    title: '抗静电能力',
    dataIndex: 'esd_rating',
    key: 'esd_rating',
    width: 140,
  },
  {
    title: '质量等级',
    dataIndex: 'quality_grade',
    key: 'quality_grade',
    width: 140,
    render: (value: string) =>
      value ? (
        <Tag color="purple" style={{ minWidth: 80, textAlign: 'center' }}>
          {value}
        </Tag>
      ) : (
        '--'
      ),
  },
  {
    title: '供应商',
    dataIndex: 'supplier',
    key: 'supplier',
    width: 200,
  },
  {
    title: '通用规范',
    dataIndex: 'general_spec',
    key: 'general_spec',
    width: 200,
  },
  {
    title: '详细规范',
    dataIndex: 'detail_spec',
    key: 'detail_spec',
    width: 200,
  },
  {
    title: '备注',
    dataIndex: 'remark',
    key: 'remark',
    width: 240,
    ellipsis: true,
  },
];

const RadiationDataPage: React.FC = () => {
  const [form] = Form.useForm();
  const [searchParams, setSearchParams] = useSearchParams();
  const [options, setOptions] = useState<RadiationFilterOptions>({
    categories: [],
    subcategories: [],
    qualityGrades: [],
    suppliers: [],
  });
  const [listResponse, setListResponse] = useState<RadiationDataListResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [exporting, setExporting] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const currentParams = useMemo(() => {
    const params: Record<string, string> = {};
    searchParams.forEach((value, key) => {
      if (value) {
        params[key] = value;
      }
    });
    return params;
  }, [searchParams]);

  const initialFormValues = useMemo(
    () => ({
      keyword: currentParams.keyword,
      category: currentParams.category,
      subcategory: currentParams.subcategory,
      supplier: currentParams.supplier,
      qualityGrade: currentParams.qualityGrade,
      totalDoseMin: currentParams.totalDoseMin ? Number(currentParams.totalDoseMin) : undefined,
      totalDoseMax: currentParams.totalDoseMax ? Number(currentParams.totalDoseMax) : undefined,
      singleEventMin: currentParams.singleEventMin
        ? Number(currentParams.singleEventMin)
        : undefined,
      singleEventMax: currentParams.singleEventMax
        ? Number(currentParams.singleEventMax)
        : undefined,
    }),
    [currentParams]
  );

  useEffect(() => {
    form.setFieldsValue(initialFormValues);
  }, [form, initialFormValues]);

  useEffect(() => {
    const bootstrap = async () => {
      try {
        const response = await radiationDataAPI.getFilters();
        if (response.success) {
          setOptions(response.data);
        }
      } catch (err) {
        console.warn('获取筛选选项失败', err);
      }
    };
    bootstrap();
  }, []);

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true);
      setError(null);
      try {
        const response = await radiationDataAPI.list({
          page: currentParams.page,
          limit: currentParams.limit,
          keyword: currentParams.keyword,
          category: currentParams.category,
          subcategory: currentParams.subcategory,
          supplier: currentParams.supplier,
          qualityGrade: currentParams.qualityGrade,
          totalDoseMin: currentParams.totalDoseMin,
          totalDoseMax: currentParams.totalDoseMax,
          singleEventMin: currentParams.singleEventMin,
          singleEventMax: currentParams.singleEventMax,
          sortField: currentParams.sortField,
          sortOrder: currentParams.sortOrder,
        });

        if (response.success) {
          setListResponse(response.data);
        } else {
          setError(response.message || '数据获取失败');
        }
      } catch (err: any) {
        const message =
          err?.response?.data?.error?.message || err?.message || '数据获取失败，请稍后重试';
        setError(message);
      } finally {
        setLoading(false);
      }
    };

    fetchData();
  }, [currentParams]);

  const updateSearchParams = (next: Record<string, any>) => {
    const merged = {
      page: next.page ?? currentParams.page ?? '1',
      limit: next.limit ?? currentParams.limit ?? String(DEFAULT_PAGE_SIZE),
      keyword: next.keyword ?? currentParams.keyword,
      category: next.category ?? currentParams.category,
      subcategory: next.subcategory ?? currentParams.subcategory,
      supplier: next.supplier ?? currentParams.supplier,
      qualityGrade: next.qualityGrade ?? currentParams.qualityGrade,
      totalDoseMin: next.totalDoseMin ?? currentParams.totalDoseMin,
      totalDoseMax: next.totalDoseMax ?? currentParams.totalDoseMax,
      singleEventMin: next.singleEventMin ?? currentParams.singleEventMin,
      singleEventMax: next.singleEventMax ?? currentParams.singleEventMax,
      sortField: next.sortField ?? currentParams.sortField,
      sortOrder: next.sortOrder ?? currentParams.sortOrder,
    };

    Object.keys(merged).forEach((key) => {
      const value = merged[key];
      if (value === undefined || value === null || value === '' || Number.isNaN(value)) {
        delete merged[key];
      } else {
        merged[key] = String(value);
      }
    });

    setSearchParams(merged, { replace: true });
  };

  const handleSearch = (values: Record<string, any>) => {
    updateSearchParams({
      ...values,
      page: '1',
    });
  };

  const handleReset = () => {
    form.resetFields();
    setSearchParams(
      {
        page: '1',
        limit: String(DEFAULT_PAGE_SIZE),
      },
      { replace: true }
    );
  };

  const handleTableChange: TableProps<RadiationDataRecord>['onChange'] = (
    pagination,
    _filters,
    sorter
  ) => {
    const nextParams: Record<string, any> = {
      page: pagination.current,
      limit: pagination.pageSize,
    };

    if (Array.isArray(sorter)) {
      delete nextParams.sortField;
      delete nextParams.sortOrder;
    } else if (sorter && sorter.field && sorter.order) {
      nextParams.sortField = sorter.field;
      nextParams.sortOrder = sorter.order === 'descend' ? 'desc' : 'asc';
    } else {
      nextParams.sortField = undefined;
      nextParams.sortOrder = undefined;
    }

    updateSearchParams(nextParams);
  };

  const handleExport = async () => {
    if (!listResponse?.items?.length) return;
    setExporting(true);
    try {
      const headers = columnDefinitions.map((column) => column.title).filter(Boolean) as string[];
      const rows = listResponse.items.map((item) =>
        columnDefinitions.map((column) => {
          const key = column.dataIndex as keyof RadiationDataRecord;
          const value = item[key];
          return value === undefined || value === null ? '--' : String(value);
        })
      );
      const csvLines = [
        headers.join(','),
        ...rows.map((row) => row.map((cell) => `"${cell.replace(/"/g, '""')}"`).join(',')),
      ];
      downloadCSV(csvLines.join('\n'), `radiation-data-${dayjs().format('YYYYMMDD-HHmmss')}.csv`);
    } finally {
      setExporting(false);
    }
  };

  const pagination: TablePaginationConfig = {
    current: Number(currentParams.page) || 1,
    pageSize: Number(currentParams.limit) || DEFAULT_PAGE_SIZE,
    total: listResponse?.total || 0,
    showSizeChanger: true,
    pageSizeOptions: ['10', '20', '50', '100'],
  };

  return (
    <div>
      <Space direction="vertical" size="large" style={{ width: '100%' }}>
        <Card>
          <Title level={3} style={{ marginBottom: 8 }}>
            辐照数据查询
          </Title>
          <Paragraph style={{ marginBottom: 0, color: '#475467' }}>
            展示《通用器件辐照数据.xlsx》导入的 1,921 条记录，可按型号、供应商、质量等级等进行筛选。
            数据来自最新一次脚本导入（见 `backend/scripts/import_irradiation_excel.py`）。
          </Paragraph>
          <Paragraph style={{ marginTop: 8 }}>
            <Text type="secondary">
              若 Excel 更新，请重新导入并清除缓存 `radiation:data:*`，即可让页面实时展示最新内容。
            </Text>
          </Paragraph>
        </Card>

        <Card>
          <Form layout="vertical" form={form} onFinish={handleSearch}>
            <Row gutter={16}>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="关键词" name="keyword">
                  <Input
                    allowClear
                    placeholder="型号 / 规格 / 供应商"
                    prefix={<SearchOutlined />}
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="产品类别" name="category">
                  <Select
                    allowClear
                    placeholder="选择类别"
                    options={options.categories.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="产品细类" name="subcategory">
                  <Select
                    allowClear
                    placeholder="选择细类"
                    options={options.subcategories.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="质量等级" name="qualityGrade">
                  <Select
                    allowClear
                    placeholder="选择等级"
                    options={options.qualityGrades.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="供应商" name="supplier">
                  <Select
                    allowClear
                    placeholder="选择供应商"
                    options={options.suppliers.map((value) => ({ label: value, value }))}
                    showSearch
                  />
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="总剂量范围 (rad)">
                  <Input.Group compact>
                    <Form.Item name="totalDoseMin" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最小值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                    <Input
                      disabled
                      value="~"
                      style={{ width: 40, textAlign: 'center', background: '#fafafa' }}
                    />
                    <Form.Item name="totalDoseMax" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最大值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                  </Input.Group>
                </Form.Item>
              </Col>
              <Col xs={24} md={12} lg={8}>
                <Form.Item label="单粒子范围 (MeV·cm²/mg)">
                  <Input.Group compact>
                    <Form.Item name="singleEventMin" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最小值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                    <Input
                      disabled
                      value="~"
                      style={{ width: 40, textAlign: 'center', background: '#fafafa' }}
                    />
                    <Form.Item name="singleEventMax" noStyle>
                      <InputNumber
                        min={0}
                        placeholder="最大值"
                        style={{ width: '50%' }}
                      />
                    </Form.Item>
                  </Input.Group>
                </Form.Item>
              </Col>
            </Row>
            <Space>
              <Button type="primary" htmlType="submit" icon={<SearchOutlined />} loading={loading}>
                查询
              </Button>
              <Button icon={<ReloadOutlined />} onClick={handleReset}>
                重置
              </Button>
              <Button
                icon={<DownloadOutlined />}
                onClick={handleExport}
                loading={exporting}
                disabled={!listResponse?.items?.length}
              >
                导出 CSV
              </Button>
            </Space>
          </Form>
        </Card>

        {error && (
          <Alert
            type="error"
            message="加载失败"
            description={error}
            showIcon
            style={{ marginBottom: 16 }}
          />
        )}

        <Card>
          <Table<RadiationDataRecord>
            rowKey={(record) => record._id || `${record.product_name}-${record.model}`}
            columns={columnDefinitions}
            dataSource={listResponse?.items || []}
            loading={loading}
            pagination={pagination}
            onChange={handleTableChange}
            scroll={{ x: 1800 }}
            locale={{
              emptyText: loading ? (
                '加载中...'
              ) : (
                <Empty description="暂无数据，试试调整筛选条件" />
              ),
            }}
          />
        </Card>
      </Space>
    </div>
  );
};

export default RadiationDataPage;



```

已在 `frontend/src/pages/components/RadiationDataPage.tsx` 删除「产品型号」列定义，表格与 CSV 导出都会不再包含该列，界面上即不再显示该字段。无需额外操作即可生效。

---

**User**

总剂量和单粒子这里应该是科学计数法，可能excel表格导入数据库时出错了，你思考下怎么改

---

**Cursor**

## 处理思路

- 方案 A（推荐）：复查 Excel→数据库导入脚本，在解析 “总剂量/单粒子” 两列时强制转换为科学计数法字符串。
  - 伪逻辑：  
    1. 读取单元格原值 `value`.  
    2. 若是数字 → `scientific = value.toExponential(2)`（或自定义格式）；若包含单位 → 分离数值与单位再拼接。  
    3. 写入 MongoDB 时保存 `scientific`（必要时附带单位字段）。  
  - 优点：根治数据源问题，前端、导出 CSV 等全部同步正确；无需前端特例化。  
  - 缺点：需重新执行导入脚本并刷新缓存；若历史数据多，操作成本稍高。

- 方案 B：在接口层或前端渲染时将现有字段动态转换为科学计数法。
  - 伪逻辑：  
    1. API 返回当前字符串，如 `1×103Gy (Si)`。  
    2. 前端渲染前用正则提取数字部分并换算 → `formatScientific(rawValue)`.  
    3. 保留单位/括号信息。  
  - 优点：不需要重新导数；实现速度快。  
  - 缺点：前端逻辑复杂、易与导出/排序等需求冲突；数据源依旧不规范。

请确认选择的方向（或提供 Excel 示例行），我再给出具体实现步骤/代码。

---

**User**

按照方案A吧，你看总剂量应该是1000Gy（Si），单粒子的单位也有点问题，你看下excel原表和现在数据库中的区别

---

**Cursor**

```python
#!/usr/bin/env python
"""
Import 通用器件辐照数据.xlsx into a MongoDB collection.

Usage example (PowerShell):
    cd F:\Business_plat
    .\space_env\Scripts\activate
    python backend\scripts\import_irradiation_excel.py \
        --collection irradiation_tests --drop-existing
"""

from __future__ import annotations

import argparse
import sys
from dataclasses import dataclass
from datetime import datetime
from pathlib import Path
from typing import Iterable, List, Optional

import re
from decimal import Decimal, InvalidOperation, getcontext

from openpyxl import load_workbook
from pymongo import MongoClient
from pymongo.collection import Collection

getcontext().prec = 28

REPO_ROOT = Path(__file__).resolve().parents[2]

DEFAULT_WORKBOOK = REPO_ROOT / "通用器件辐照数据.xlsx"
DEFAULT_MONGO_URI = "mongodb://127.0.0.1:27017"
DEFAULT_DB = "business_plat"
DEFAULT_COLLECTION = "irradiation_tests"


@dataclass(frozen=True)
class ColumnConfig:
    header: str
    field: str
    required: bool = False


COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ColumnConfig("产品类别", "category", required=True),
    ColumnConfig("产品细类", "subcategory"),
    ColumnConfig("产品名称", "product_name", required=True),
    ColumnConfig("产品型号", "model"),
    ColumnConfig("型号规格", "model_spec"),
    ColumnConfig("封装形式", "package"),
    ColumnConfig("总剂量", "total_dose"),
    ColumnConfig("单粒子", "single_event"),
    ColumnConfig("位移", "displacement"),
    ColumnConfig("抗静电能力", "esd_rating"),
    ColumnConfig("质量等级", "quality_grade"),
    ColumnConfig("通用规范编号", "general_spec"),
    ColumnConfig("详细规范编号", "detail_spec"),
    ColumnConfig("供应商名称", "supplier"),
    ColumnConfig("备注", "remark"),
]


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        description="Read 通用器件辐照数据.xlsx and insert rows into MongoDB."
    )
    parser.add_argument(
        "--workbook",
        type=Path,
        default=DEFAULT_WORKBOOK,
        help=f"Path to Excel workbook (default: {DEFAULT_WORKBOOK})",
    )
    parser.add_argument(
        "--sheet",
        type=str,
        default=None,
        help="Worksheet name to import (default: workbook active sheet)",
    )
    parser.add_argument(
        "--mongo-uri",
        type=str,
        default=DEFAULT_MONGO_URI,
        help=f"MongoDB connection URI (default: {DEFAULT_MONGO_URI})",
    )
    parser.add_argument(
        "--database",
        type=str,
        default=DEFAULT_DB,
        help=f"Target database (default: {DEFAULT_DB})",
    )
    parser.add_argument(
        "--collection",
        type=str,
        default=DEFAULT_COLLECTION,
        help=f"Target collection name (default: {DEFAULT_COLLECTION})",
    )
    parser.add_argument(
        "--batch-size",
        type=int,
        default=200,
        help="Number of documents per insert_many batch (default: 200)",
    )
    parser.add_argument(
        "--drop-existing",
        action="store_true",
        help="Drop the target collection before inserting",
    )
    parser.add_argument(
        "--dry-run",
        action="store_true",
        help="Parse workbook but do not write to MongoDB",
    )
    return parser


def normalize_cell(value):
    if value is None:
        return None
    if isinstance(value, str):
        trimmed = value.strip()
        return trimmed or None
    return value


SUPERSCRIPT_TRANSLATION = str.maketrans("⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻", "0123456789+-")
SCIENTIFIC_PATTERN = re.compile(
    r"^\s*([+-]?\d+(?:\.\d+)?)\s*[×xX]\s*10\^([+-]?\d+)(?P<unit>.*)$"
)


def normalize_superscripts(text: str) -> str:
    if not text:
        return text

    def repl(match: re.Match) -> str:
        exponent = match.group("exp").translate(SUPERSCRIPT_TRANSLATION)
        return f"10^{exponent}"

    replaced = re.sub(r"10(?P<exp>[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻]+)", repl, text)
    return replaced.translate(SUPERSCRIPT_TRANSLATION)


def format_decimal(value: Decimal) -> str:
    normalized = value.normalize()
    if normalized == normalized.to_integral():
        return str(normalized.quantize(Decimal(1)))
    return format(normalized, "f").rstrip("0").rstrip(".")


def normalize_total_dose(value: Optional[str]) -> Optional[str]:
    if not value:
        return value
    normalized = normalize_superscripts(value)
    match = SCIENTIFIC_PATTERN.match(normalized)
    if not match:
        return value
    base, exponent, unit = match.group(1), match.group(2), match.group("unit") or ""
    try:
        decimal_value = Decimal(base) * (Decimal(10) ** Decimal(exponent))
    except InvalidOperation:
        return value
    formatted_number = format_decimal(decimal_value)
    unit_text = unit.strip()
    return f"{formatted_number} {unit_text}".strip()


def normalize_single_event(value: Optional[str]) -> Optional[str]:
    if not value:
        return value
    normalized = normalize_superscripts(value)
    normalized = re.sub(r"cm\s*(?:\^|\*\*)?\s*2", "cm²", normalized, flags=re.IGNORECASE)
    normalized = re.sub(r"cm2", "cm²", normalized, flags=re.IGNORECASE)
    return normalized


def transform_field(field: str, value: Optional[str]) -> Optional[str]:
    if field == "total_dose":
        return normalize_total_dose(value)
    if field == "single_event":
        return normalize_single_event(value)
    return value


def row_is_empty(values: Iterable[Optional[object]]) -> bool:
    return all(v is None or (isinstance(v, str) and not v.strip()) for v in values)


def ensure_headers(header_row: List[Optional[str]]) -> dict[str, int]:
    header_to_index: dict[str, int] = {}
    for idx, value in enumerate(header_row):
        if value is None:
            continue
        header_to_index[str(value).strip()] = idx

    missing_required = [
        config.header
        for config in COLUMN_CONFIGS
        if config.required and config.header not in header_to_index
    ]
    if missing_required:
        raise ValueError(f"Missing required columns: {', '.join(missing_required)}")
    return header_to_index


def prepare_document(
    row_values: List[Optional[object]],
    header_to_index: dict[str, int],
    row_number: int,
    workbook_name: str,
) -> dict:
    doc: dict = {}
    for config in COLUMN_CONFIGS:
        idx = header_to_index.get(config.header)
        value = row_values[idx] if idx is not None and idx < len(row_values) else None
        normalized_value = normalize_cell(value)
        doc[config.field] = transform_field(config.field, normalized_value)
    doc["created_at"] = datetime.utcnow()
    doc["_source"] = {
        "row_number": row_number,
        "workbook": workbook_name,
    }
    return doc


def drop_collection_if_requested(collection: Collection, drop: bool) -> None:
    if drop:
        print(f"Dropping existing collection: {collection.full_name}")
        collection.drop()


def insert_documents(
    collection: Collection,
    docs: List[dict],
    dry_run: bool,
) -> int:
    if not docs or dry_run:
        return 0 if dry_run else 0
    result = collection.insert_many(docs)
    return len(result.inserted_ids)


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    workbook_path: Path = args.workbook
    if not workbook_path.exists():
        parser.error(f"Workbook not found: {workbook_path}")

    wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
    ws = wb[args.sheet] if args.sheet else wb.active

    header_row = next(ws.iter_rows(min_row=1, max_row=1, values_only=True), None)
    if not header_row:
        parser.error("Header row is empty")
    header_to_index = ensure_headers(list(header_row))

    client = MongoClient(args.mongo_uri)
    db = client[args.database]
    collection = db[args.collection]

    drop_collection_if_requested(collection, args.drop_existing and not args.dry_run)

    batch: List[dict] = []
    total_rows = 0
    inserted_docs = 0

    for row_number, row_values in enumerate(
        ws.iter_rows(min_row=2, values_only=True), start=2
    ):
        if row_is_empty(row_values):
            continue
        total_rows += 1
        doc = prepare_document(
            list(row_values), header_to_index, row_number, workbook_path.name
        )
        batch.append(doc)
        if len(batch) >= args.batch_size:
            inserted_docs += insert_documents(collection, batch, args.dry_run)
            batch.clear()

    if batch:
        inserted_docs += insert_documents(collection, batch, args.dry_run)

    if args.dry_run:
        print(
            f"[Dry run] Parsed {total_rows} data rows from sheet '{ws.title}'. "
            f"No documents written."
        )
    else:
        print(
            f"Imported {inserted_docs} documents "
            f"into {args.database}.{args.collection} "
            f"from sheet '{ws.title}'."
        )
    return 0


if __name__ == "__main__":
    sys.exit(main())



```

```python
#!/usr/bin/env python
"""
Import 通用器件辐照数据.xlsx into a MongoDB collection.

Usage example (PowerShell):
    cd F:\Business_plat
    .\space_env\Scripts\activate
    python backend\scripts\import_irradiation_excel.py \
        --collection irradiation_tests --drop-existing
"""

from __future__ import annotations

import argparse
import sys
from dataclasses import dataclass
from datetime import datetime
from pathlib import Path
from typing import Iterable, List, Optional

import re
from decimal import Decimal, InvalidOperation, getcontext

from openpyxl import load_workbook
from pymongo import MongoClient
from pymongo.collection import Collection

getcontext().prec = 28

REPO_ROOT = Path(__file__).resolve().parents[2]

DEFAULT_WORKBOOK = REPO_ROOT / "通用器件辐照数据.xlsx"
DEFAULT_MONGO_URI = "mongodb://127.0.0.1:27017"
DEFAULT_DB = "business_plat"
DEFAULT_COLLECTION = "irradiation_tests"


@dataclass(frozen=True)
class ColumnConfig:
    header: str
    field: str
    required: bool = False


COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ColumnConfig("产品类别", "category", required=True),
    ColumnConfig("产品细类", "subcategory"),
    ColumnConfig("产品名称", "product_name", required=True),
    ColumnConfig("产品型号", "model"),
    ColumnConfig("型号规格", "model_spec"),
    ColumnConfig("封装形式", "package"),
    ColumnConfig("总剂量", "total_dose"),
    ColumnConfig("单粒子", "single_event"),
    ColumnConfig("位移", "displacement"),
    ColumnConfig("抗静电能力", "esd_rating"),
    ColumnConfig("质量等级", "quality_grade"),
    ColumnConfig("通用规范编号", "general_spec"),
    ColumnConfig("详细规范编号", "detail_spec"),
    ColumnConfig("供应商名称", "supplier"),
    ColumnConfig("备注", "remark"),
]


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        description="Read 通用器件辐照数据.xlsx and insert rows into MongoDB."
    )
    parser.add_argument(
        "--workbook",
        type=Path,
        default=DEFAULT_WORKBOOK,
        help=f"Path to Excel workbook (default: {DEFAULT_WORKBOOK})",
    )
    parser.add_argument(
        "--sheet",
        type=str,
        default=None,
        help="Worksheet name to import (default: workbook active sheet)",
    )
    parser.add_argument(
        "--mongo-uri",
        type=str,
        default=DEFAULT_MONGO_URI,
        help=f"MongoDB connection URI (default: {DEFAULT_MONGO_URI})",
    )
    parser.add_argument(
        "--database",
        type=str,
        default=DEFAULT_DB,
        help=f"Target database (default: {DEFAULT_DB})",
    )
    parser.add_argument(
        "--collection",
        type=str,
        default=DEFAULT_COLLECTION,
        help=f"Target collection name (default: {DEFAULT_COLLECTION})",
    )
    parser.add_argument(
        "--batch-size",
        type=int,
        default=200,
        help="Number of documents per insert_many batch (default: 200)",
    )
    parser.add_argument(
        "--drop-existing",
        action="store_true",
        help="Drop the target collection before inserting",
    )
    parser.add_argument(
        "--dry-run",
        action="store_true",
        help="Parse workbook but do not write to MongoDB",
    )
    return parser


def normalize_cell(value):
    if value is None:
        return None
    if isinstance(value, str):
        trimmed = value.strip()
        return trimmed or None
    return value


SUPERSCRIPT_TRANSLATION = str.maketrans("⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻", "0123456789+-")
SCIENTIFIC_PATTERN = re.compile(
    r"^\s*([+-]?\d+(?:\.\d+)?)\s*[×xX]\s*10\^([+-]?\d+)(?P<unit>.*)$"
)


def normalize_superscripts(text: str) -> str:
    if not text:
        return text

    def repl(match: re.Match) -> str:
        exponent = match.group("exp").translate(SUPERSCRIPT_TRANSLATION)
        return f"10^{exponent}"

    return re.sub(r"10(?P<exp>[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻]+)", repl, text)


def format_decimal(value: Decimal) -> str:
    normalized = value.normalize()
    if normalized == normalized.to_integral():
        return str(normalized.quantize(Decimal(1)))
    return format(normalized, "f").rstrip("0").rstrip(".")


def normalize_total_dose(value: Optional[str]) -> Optional[str]:
    if not value:
        return value
    normalized = normalize_superscripts(value)
    match = SCIENTIFIC_PATTERN.match(normalized)
    if not match:
        return value
    base, exponent, unit = match.group(1), match.group(2), match.group("unit") or ""
    try:
        decimal_value = Decimal(base) * (Decimal(10) ** Decimal(exponent))
    except InvalidOperation:
        return value
    formatted_number = format_decimal(decimal_value)
    unit_text = unit.strip()
    return f"{formatted_number} {unit_text}".strip()


def normalize_single_event(value: Optional[str]) -> Optional[str]:
    if not value:
        return value
    normalized = normalize_superscripts(value)
    normalized = re.sub(r"cm\s*(?:\^|\*\*)?\s*2", "cm²", normalized, flags=re.IGNORECASE)
    normalized = re.sub(r"cm2", "cm²", normalized, flags=re.IGNORECASE)
    return normalized


def transform_field(field: str, value: Optional[str]) -> Optional[str]:
    if field == "total_dose":
        return normalize_total_dose(value)
    if field == "single_event":
        return normalize_single_event(value)
    return value


def row_is_empty(values: Iterable[Optional[object]]) -> bool:
    return all(v is None or (isinstance(v, str) and not v.strip()) for v in values)


def ensure_headers(header_row: List[Optional[str]]) -> dict[str, int]:
    header_to_index: dict[str, int] = {}
    for idx, value in enumerate(header_row):
        if value is None:
            continue
        header_to_index[str(value).strip()] = idx

    missing_required = [
        config.header
        for config in COLUMN_CONFIGS
        if config.required and config.header not in header_to_index
    ]
    if missing_required:
        raise ValueError(f"Missing required columns: {', '.join(missing_required)}")
    return header_to_index


def prepare_document(
    row_values: List[Optional[object]],
    header_to_index: dict[str, int],
    row_number: int,
    workbook_name: str,
) -> dict:
    doc: dict = {}
    for config in COLUMN_CONFIGS:
        idx = header_to_index.get(config.header)
        value = row_values[idx] if idx is not None and idx < len(row_values) else None
        normalized_value = normalize_cell(value)
        doc[config.field] = transform_field(config.field, normalized_value)
    doc["created_at"] = datetime.utcnow()
    doc["_source"] = {
        "row_number": row_number,
        "workbook": workbook_name,
    }
    return doc


def drop_collection_if_requested(collection: Collection, drop: bool) -> None:
    if drop:
        print(f"Dropping existing collection: {collection.full_name}")
        collection.drop()


def insert_documents(
    collection: Collection,
    docs: List[dict],
    dry_run: bool,
) -> int:
    if not docs or dry_run:
        return 0 if dry_run else 0
    result = collection.insert_many(docs)
    return len(result.inserted_ids)


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    workbook_path: Path = args.workbook
    if not workbook_path.exists():
        parser.error(f"Workbook not found: {workbook_path}")

    wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
    ws = wb[args.sheet] if args.sheet else wb.active

    header_row = next(ws.iter_rows(min_row=1, max_row=1, values_only=True), None)
    if not header_row:
        parser.error("Header row is empty")
    header_to_index = ensure_headers(list(header_row))

    client = MongoClient(args.mongo_uri)
    db = client[args.database]
    collection = db[args.collection]

    drop_collection_if_requested(collection, args.drop_existing and not args.dry_run)

    batch: List[dict] = []
    total_rows = 0
    inserted_docs = 0

    for row_number, row_values in enumerate(
        ws.iter_rows(min_row=2, values_only=True), start=2
    ):
        if row_is_empty(row_values):
            continue
        total_rows += 1
        doc = prepare_document(
            list(row_values), header_to_index, row_number, workbook_path.name
        )
        batch.append(doc)
        if len(batch) >= args.batch_size:
            inserted_docs += insert_documents(collection, batch, args.dry_run)
            batch.clear()

    if batch:
        inserted_docs += insert_documents(collection, batch, args.dry_run)

    if args.dry_run:
        print(
            f"[Dry run] Parsed {total_rows} data rows from sheet '{ws.title}'. "
            f"No documents written."
        )
    else:
        print(
            f"Imported {inserted_docs} documents "
            f"into {args.database}.{args.collection} "
            f"from sheet '{ws.title}'."
        )
    return 0


if __name__ == "__main__":
    sys.exit(main())



```

## 处理思路
- 读取 Excel 时新增标准化流程：先识别 “a×10ⁿ” 结构（含上标字符），用 `Decimal` 转成普通十进制，再拼回后缀单位，例如 `Gy (Si)`，避免在前端丢失上标导致成 `103`。
- 针对单粒子字段，对 `cm2` / `cm^2` 等写法统一替换为 `cm²`，保持原有 `·` 与其余单位不变。
- 以上逻辑集中在导入脚本里，确保数据库层面就保存正确格式，前端和 CSV 无需额外处理。

## 代码位置
```
backend/scripts/import_irradiation_excel.py
- 新增 `normalize_superscripts`、`normalize_total_dose`、`normalize_single_event` 等工具函数
- `prepare_document` 中对 `total_dose`、`single_event` 应用转换
```

## 使用指引（需手动执行）
1. 打开 PowerShell (`Win + X` → Windows PowerShell)。
2. 进入仓库根目录：`cd F:\Business_plat`。
3. 激活 Python 虚拟环境（若已有 `space_env`）：`.\space_env\Scripts\activate`。
4. 重新导入辐照数据（会清空旧集合）：`python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`。
5. 如使用了 Redis 缓存，请清空 `radiation:data:*` 相关键后再刷新页面。

完成导入、确认前端显示正确后，请告知，我再把 TODO 中的验证项更新/协助。

```plaintext
backend/scripts/import_irradiation_excel.py
- 新增 `normalize_superscripts`、`normalize_total_dose`、`normalize_single_event` 等工具函数
- `prepare_document` 中对 `total_dose`、`single_event` 应用转换
```

---

**User**

我在CMD中
(space_env) F:\Business_plat>.\space_env\Scripts\activate
系统找不到指定的路径。

(space_env) F:\Business_plat>

---

**Cursor**

看提示 `(space_env)` 已经在命令行前缀里，说明当前虚拟环境其实是激活状态；再次运行 `.\space_env\Scripts\activate` 会去找脚本但路径里可能不存在这个虚拟环境目录，所以才报 “找不到指定的路径”。直接执行导入脚本即可，比如：

```
(space_env) F:\Business_plat>python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

如果你确实需要重新激活，可以先 `deactivate`，然后确认 `F:\Business_plat\space_env\Scripts\activate.bat` 是否存在；若是 PowerShell 则用 `Activate.ps1`。如文件缺失，可能虚拟环境不在这个目录，需要找到正确的 venv 位置或重新创建。

```plaintext
(space_env) F:\Business_plat>python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing
```

---

**User**

单粒子可以了，但是总剂量的3次方还是没显示出来

---

**Cursor**

```python
#!/usr/bin/env python
"""
Import 通用器件辐照数据.xlsx into a MongoDB collection.

Usage example (PowerShell):
    cd F:\Business_plat
    .\space_env\Scripts\activate
    python backend\scripts\import_irradiation_excel.py \
        --collection irradiation_tests --drop-existing
"""

from __future__ import annotations

import argparse
import sys
from dataclasses import dataclass
from datetime import datetime
from pathlib import Path
from typing import Iterable, List, Optional

import re
from decimal import Decimal, InvalidOperation, getcontext

from openpyxl import load_workbook
from pymongo import MongoClient
from pymongo.collection import Collection

getcontext().prec = 28

REPO_ROOT = Path(__file__).resolve().parents[2]

DEFAULT_WORKBOOK = REPO_ROOT / "通用器件辐照数据.xlsx"
DEFAULT_MONGO_URI = "mongodb://127.0.0.1:27017"
DEFAULT_DB = "business_plat"
DEFAULT_COLLECTION = "irradiation_tests"


@dataclass(frozen=True)
class ColumnConfig:
    header: str
    field: str
    required: bool = False


COLUMN_CONFIGS: List[ColumnConfig] = [
    ColumnConfig("序号", "source_index"),
    ColumnConfig("产品类别", "category", required=True),
    ColumnConfig("产品细类", "subcategory"),
    ColumnConfig("产品名称", "product_name", required=True),
    ColumnConfig("产品型号", "model"),
    ColumnConfig("型号规格", "model_spec"),
    ColumnConfig("封装形式", "package"),
    ColumnConfig("总剂量", "total_dose"),
    ColumnConfig("单粒子", "single_event"),
    ColumnConfig("位移", "displacement"),
    ColumnConfig("抗静电能力", "esd_rating"),
    ColumnConfig("质量等级", "quality_grade"),
    ColumnConfig("通用规范编号", "general_spec"),
    ColumnConfig("详细规范编号", "detail_spec"),
    ColumnConfig("供应商名称", "supplier"),
    ColumnConfig("备注", "remark"),
]


def build_parser() -> argparse.ArgumentParser:
    parser = argparse.ArgumentParser(
        description="Read 通用器件辐照数据.xlsx and insert rows into MongoDB."
    )
    parser.add_argument(
        "--workbook",
        type=Path,
        default=DEFAULT_WORKBOOK,
        help=f"Path to Excel workbook (default: {DEFAULT_WORKBOOK})",
    )
    parser.add_argument(
        "--sheet",
        type=str,
        default=None,
        help="Worksheet name to import (default: workbook active sheet)",
    )
    parser.add_argument(
        "--mongo-uri",
        type=str,
        default=DEFAULT_MONGO_URI,
        help=f"MongoDB connection URI (default: {DEFAULT_MONGO_URI})",
    )
    parser.add_argument(
        "--database",
        type=str,
        default=DEFAULT_DB,
        help=f"Target database (default: {DEFAULT_DB})",
    )
    parser.add_argument(
        "--collection",
        type=str,
        default=DEFAULT_COLLECTION,
        help=f"Target collection name (default: {DEFAULT_COLLECTION})",
    )
    parser.add_argument(
        "--batch-size",
        type=int,
        default=200,
        help="Number of documents per insert_many batch (default: 200)",
    )
    parser.add_argument(
        "--drop-existing",
        action="store_true",
        help="Drop the target collection before inserting",
    )
    parser.add_argument(
        "--dry-run",
        action="store_true",
        help="Parse workbook but do not write to MongoDB",
    )
    return parser


def normalize_cell(value):
    if value is None:
        return None
    if isinstance(value, str):
        trimmed = value.strip()
        return trimmed or None
    return value


SUPERSCRIPT_TRANSLATION = str.maketrans("⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻", "0123456789+-")
SUPERSCRIPT_REVERSE_TRANSLATION = str.maketrans("0123456789+-", "⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻")
SCIENTIFIC_PATTERN = re.compile(
    r"^\s*([+-]?\d+(?:\.\d+)?)\s*[×xX]\s*10\^([+-]?\d+)(?P<unit>.*)$"
)
PLAIN_NUMBER_PATTERN = re.compile(r"^\s*([+-]?\d+(?:\.\d+)?)")


def normalize_superscripts(text: str) -> str:
    if not text:
        return text

    def repl(match: re.Match) -> str:
        exponent = match.group("exp").translate(SUPERSCRIPT_TRANSLATION)
        return f"10^{exponent}"

    return re.sub(r"10(?P<exp>[⁰¹²³⁴⁵⁶⁷⁸⁹⁺⁻]+)", repl, text)


def to_superscript(text: str) -> str:
    return text.translate(SUPERSCRIPT_REVERSE_TRANSLATION)


def extract_leading_decimal(text: str) -> Optional[Decimal]:
    if not text:
        return None
    match = PLAIN_NUMBER_PATTERN.match(text)
    if not match:
        return None
    try:
        return Decimal(match.group(1))
    except InvalidOperation:
        return None


def format_decimal(value: Decimal) -> str:
    normalized = value.normalize()
    if normalized == normalized.to_integral():
        return str(normalized.quantize(Decimal(1)))
    return format(normalized, "f").rstrip("0").rstrip(".")


def normalize_total_dose(value: Optional[str]) -> tuple[Optional[str], Optional[Decimal]]:
    if not value:
        return value, None

    normalized = normalize_superscripts(value)
    match = SCIENTIFIC_PATTERN.match(normalized)
    if match:
        base_text = match.group(1)
        exponent_text = match.group(2)
        unit_text = (match.group("unit") or "").strip()
        try:
            base_decimal = Decimal(base_text)
            exponent_decimal = int(Decimal(exponent_text))
        except InvalidOperation:
            return value, extract_leading_decimal(value)

        numeric_value = base_decimal * (Decimal(10) ** exponent_decimal)
        formatted_base = format_decimal(base_decimal)
        superscript_exponent = to_superscript(str(exponent_decimal))
        display = f"{formatted_base}×10{superscript_exponent}{unit_text}"
        return display, numeric_value

    numeric_fallback = extract_leading_decimal(normalized)
    return normalized, numeric_fallback


def normalize_single_event(value: Optional[str]) -> tuple[Optional[str], Optional[Decimal]]:
    if not value:
        return value, None
    normalized = normalize_superscripts(value)
    normalized = re.sub(r"cm\s*(?:\^|\*\*)?\s*2", "cm²", normalized, flags=re.IGNORECASE)
    normalized = re.sub(r"cm2", "cm²", normalized, flags=re.IGNORECASE)
    numeric = extract_leading_decimal(normalized)
    return normalized, numeric


def transform_field(field: str, value: Optional[str]) -> tuple[Optional[str], Optional[Decimal]]:
    if field == "total_dose":
        return normalize_total_dose(value)
    if field == "single_event":
        return normalize_single_event(value)
    return value, None


def row_is_empty(values: Iterable[Optional[object]]) -> bool:
    return all(v is None or (isinstance(v, str) and not v.strip()) for v in values)


def ensure_headers(header_row: List[Optional[str]]) -> dict[str, int]:
    header_to_index: dict[str, int] = {}
    for idx, value in enumerate(header_row):
        if value is None:
            continue
        header_to_index[str(value).strip()] = idx

    missing_required = [
        config.header
        for config in COLUMN_CONFIGS
        if config.required and config.header not in header_to_index
    ]
    if missing_required:
        raise ValueError(f"Missing required columns: {', '.join(missing_required)}")
    return header_to_index


def prepare_document(
    row_values: List[Optional[object]],
    header_to_index: dict[str, int],
    row_number: int,
    workbook_name: str,
) -> dict:
    doc: dict = {}
    for config in COLUMN_CONFIGS:
        idx = header_to_index.get(config.header)
        value = row_values[idx] if idx is not None and idx < len(row_values) else None
        normalized_value = normalize_cell(value)
        text_value, numeric_value = transform_field(config.field, normalized_value)
        doc[config.field] = text_value
        if numeric_value is not None:
            doc[f"{config.field}_numeric"] = float(numeric_value)
    doc["created_at"] = datetime.utcnow()
    doc["_source"] = {
        "row_number": row_number,
        "workbook": workbook_name,
    }
    return doc


def drop_collection_if_requested(collection: Collection, drop: bool) -> None:
    if drop:
        print(f"Dropping existing collection: {collection.full_name}")
        collection.drop()


def insert_documents(
    collection: Collection,
    docs: List[dict],
    dry_run: bool,
) -> int:
    if not docs or dry_run:
        return 0 if dry_run else 0
    result = collection.insert_many(docs)
    return len(result.inserted_ids)


def main() -> int:
    parser = build_parser()
    args = parser.parse_args()

    workbook_path: Path = args.workbook
    if not workbook_path.exists():
        parser.error(f"Workbook not found: {workbook_path}")

    wb = load_workbook(filename=workbook_path, data_only=True, read_only=True)
    ws = wb[args.sheet] if args.sheet else wb.active

    header_row = next(ws.iter_rows(min_row=1, max_row=1, values_only=True), None)
    if not header_row:
        parser.error("Header row is empty")
    header_to_index = ensure_headers(list(header_row))

    client = MongoClient(args.mongo_uri)
    db = client[args.database]
    collection = db[args.collection]

    drop_collection_if_requested(collection, args.drop_existing and not args.dry_run)

    batch: List[dict] = []
    total_rows = 0
    inserted_docs = 0

    for row_number, row_values in enumerate(
        ws.iter_rows(min_row=2, values_only=True), start=2
    ):
        if row_is_empty(row_values):
            continue
        total_rows += 1
        doc = prepare_document(
            list(row_values), header_to_index, row_number, workbook_path.name
        )
        batch.append(doc)
        if len(batch) >= args.batch_size:
            inserted_docs += insert_documents(collection, batch, args.dry_run)
            batch.clear()

    if batch:
        inserted_docs += insert_documents(collection, batch, args.dry_run)

    if args.dry_run:
        print(
            f"[Dry run] Parsed {total_rows} data rows from sheet '{ws.title}'. "
            f"No documents written."
        )
    else:
        print(
            f"Imported {inserted_docs} documents "
            f"into {args.database}.{args.collection} "
            f"from sheet '{ws.title}'."
        )
    return 0


if __name__ == "__main__":
    sys.exit(main())



```

## Superscript Fix
- `normalize_total_dose` now keeps the “×10” form, converts the exponent back to true superscripts, and simultaneously computes a numeric value with `Decimal` for filtering. `normalize_single_event` shares the same tuple return type so both text and numeric fields stay in sync.```169:210:backend/scripts/import_irradiation_excel.py
def normalize_total_dose(value: Optional[str]) -> tuple[Optional[str], Optional[Decimal]]:
    ...
        superscript_exponent = to_superscript(str(exponent_decimal))
        display = f"{formatted_base}×10{superscript_exponent}{unit_text}"
        return display, numeric_value
    numeric_fallback = extract_leading_decimal(normalized)
    return normalized, numeric_fallback

def normalize_single_event(value: Optional[str]) -> tuple[Optional[str], Optional[Decimal]]:
    ...
    numeric = extract_leading_decimal(normalized)
    return normalized, numeric
```
- During import we now store both the formatted string and the calculated numeric companion (`total_dose_numeric`, `single_event_numeric`), so the front-end can show superscripts while the API still filters/sorts by pure numbers.```234:248:backend/scripts/import_irradiation_excel.py
        text_value, numeric_value = transform_field(config.field, normalized_value)
        doc[config.field] = text_value
        if numeric_value is not None:
            doc[f"{config.field}_numeric"] = float(numeric_value)
```

## Next Steps
- 重新导入一次辐照数据（会清空旧集合再写入）：  
  `python backend\scripts\import_irradiation_excel.py --collection irradiation_tests --drop-existing`
- 如果用了 Redis 缓存，清掉 `radiation:data:*`，然后刷新页面检验“总剂量”是否已显示为 `1×10³Gy (Si)`.
- 告诉我导入与前端校验结果，我再把验证任务收尾。

```plaintext
- During import we now store both the formatted string and the calculated numeric companion (`total_dose_numeric`, `single_event_numeric`), so the front-end can show superscripts while the API still filters/sorts by pure numbers.```234:248:backend/scripts/import_irradiation_excel.py
        text_value, numeric_value = transform_field(config.field, normalized_value)
        doc[config.field] = text_value
        if numeric_value is not None:
            doc[f"{config.field}_numeric"] = float(numeric_value)
```

---

**User**

帮我切换为上一个git版本，我该如何操作

---

**Cursor**

检查当前 git 状态和历史，以确定如何切换到上一个版本。


---

**User**

(space_env) F:\Business_plat>git status
On branch full_dev_data_store
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   "DoEEEt\345\212\237\350\203\275\345\274\200\345\217\221\346\200\273\350\247\210.md"
        modified:   "DoEEEt\351\233\206\346\210\220\345\256\236\346\226\275\346\200\273\347\273\223.md"
        modified:   backend/data/persistent-data.json
        modified:   backend/dist/.tsbuildinfo
        modified:   backend/dist/controllers/doeeetComponentController.js
        modified:   backend/dist/controllers/doeeetComponentController.js.map
        modified:   backend/dist/index.js
        modified:   backend/dist/index.js.map
        modified:   backend/dist/models/index.js
        modified:   backend/dist/models/index.js.map
        modified:   backend/dist/services/AnalyticsService.js
        modified:   backend/dist/services/AnalyticsService.js.map
        modified:   backend/dist/services/DoeeetSearchService.js
        modified:   backend/dist/services/DoeeetSearchService.js.map
        modified:   backend/logs/combined.log
        modified:   backend/logs/error.log
        modified:   backend/src/index.ts
        modified:   backend/src/models/index.ts
        modified:   backend/src/services/CacheService.ts
        modified:   backend/src/services/index.ts
        modified:   backend/src/types/index.ts
        modified:   frontend/src/App.tsx
        modified:   frontend/src/components/Layout.tsx
        modified:   frontend/src/pages/HomePage.tsx
        modified:   frontend/src/services/api.ts
        modified:   frontend/src/types/index.ts

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        "DoEEEt\351\241\271\347\233\256\345\274\200\345\217\221\350\256\241\345\210\222.md"
        backend/jest.config.js
        backend/scripts/import_irradiation_excel.py
        backend/scripts/inspect_irradiation_excel.py
        backend/src/controllers/radiationDataController.ts
        backend/src/models/IrradiationTest.ts
        backend/src/routes/radiationDataRoutes.ts
        backend/src/services/RadiationDataService.ts
        backend/tests/
        "cursor\350\256\260\345\275\225/1109.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_10292_md.md"
        "cursor\350\256\260\345\275\225/cursor_cursor_1029_md.md"
        frontend/src/pages/components/RadiationDataPage.tsx
        records/
        "~$\351\200\232\347\224\250\345\231\250\344\273\266\350\276\220\347\205\247\346\225\260\346\215\256.xlsx"
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211-\345\277\253\351\200\237\345\274\200\345\247\213.md"
        "\345\211\215\347\253\257\345\210\206\347\261\273\347\255\233\351\200\211\345\212\237\350\203\275\345\256\236\346\226\275\346\226\271\346\241\210.md"
        "\345\211\215\347\253\257\345\256\236\346\226\275\346\226\271\346\241\210\346\200\273\347\273\223.md"
        "\351\200\232\347\224\250\345\231\250\344\273\266\350\276\220\347\205\247\346\225\260\346\215\256.xlsx"

no changes added to commit (use "git add" and/or "git commit -a")

(space_env) F:\Business_plat>

---

**Cursor**


查看最近的提交历史，确定上一个版本：


---

**User**

(space_env) F:\Business_plat>git log --oneline -10
70dcda8e (HEAD -> full_dev_data_store) 提交了进口元器件辐照数据指标
9f0ad7c7 前后端测试BUG修复，器件查询完整功能已有
dfcc918d 实现了doeeet数据基本的全量查询和展示功能
b30d0a63 完成了数据库调通和基本的界面展示
fd6f247c feat: 添加DoEEEt电子元件搜索功能
ebe2dd42 feat: 完成高性能MongoDB数据导入器，完成数据导入
b087279c 清理 stream_import_doeet.js 重复代码和冗余逻辑
3562b287 fix: 修复TypeScript编译错误和接口引用问题
f0e1b808 (full_dev, feature/infrastructure-clean) feat: 将平台logo从CAASPA更改为CASI
fb922698 fix: 修复Component类型引用问题并添加API使用示例

(space_env) F:\Business_plat>

---

**Cursor**


当前在 `70dcda8e`（提交了进口元器件辐照数据指标），上一个版本是 `9f0ad7c7`（前后端测试BUG修复，器件查询完整功能已有）。

你当前有未提交的修改。切换方式：

- 方式 1：丢弃当前所有修改，回退到上一个版本（危险）


---

**User**

帮我回退到这个版本
70dcda8e (HEAD -> full_dev_data_store) 提交了进口元器件辐照数据指标

---

**Cursor**


当前 HEAD 已在 `70dcda8e`。丢弃所有未提交的修改，回到该提交的干净状态：


---

**User**

刚才我把版本回退了一下，现在结合咱们的历史记录，把辐照数据的模块重做一下，你先说下思路

---

**Cursor**


查看当前辐照数据相关代码和历史记录，梳理重做思路。



继续查看相关文件，了解整体架构：



查看 DoEEEt 的路由和控制器实现，作为参考：



查看前端辐照数据页面和路由配置：



查看主应用文件，了解路由注册方式：



基于现有代码和历史记录，重做辐照数据模块的思路如下：

## 辐照数据模块重做思路

### 一、现状分析

已有：
- 数据导入脚本：`import_irradiation_excel.py`（功能完整）
- 数据模型：`IrradiationTest.ts`（字段完整，含索引）
- 服务层：`RadiationDataService.ts`（基础查询和筛选）
- 控制器：`radiationDataController.ts`（基础接口）
- 路由：`radiationDataRoutes.ts`（但未在主入口注册）
- 前端页面：`RadiationDataPage.tsx`（基础查询和展示）

问题：
1. 路由未在主入口注册，API 不可用
2. API 功能单一，缺少详情、统计、对比等
3. 前端功能基础，缺少详情页、对比等
4. 代码风格与 DoEEEt 模块不一致

### 二、重做方案（参考 DoEEEt 模块）

#### 1. 后端完善

1.1 路由注册
- 在 `backend/src/index.ts` 中注册 `radiationDataRoutes`

1.2 扩展 API（参考 `doeeetComponentController.ts`）
- 详情：`GET /api/radiation-data/:id`
- 统计：`GET /api/radiation-data/statistics`
- 批量查询：`POST /api/radiation-data/batch`
- 搜索建议：`GET /api/radiation-data/suggestions`
- 相似记录：`GET /api/radiation-data/:id/similar`
- 对比：`POST /api/radiation-data/compare`

1.3 服务层增强（参考 `DoeeetSearchService`）
- 全文搜索
- 高级筛选（数值范围、多条件组合）
- 缓存优化
- 统计聚合

1.4 统一响应格式
- 使用 `ok()` 工具函数
- 统一错误处理
- 统一数据格式化

#### 2. 前端优化

2.1 列表页增强（参考 `ComponentSearch.tsx`）
- 优化筛选 UI
- 添加高级筛选面板
- 优化表格展示
- 添加快速操作（查看详情、对比等）

2.2 新增详情页
- 展示完整信息
- 显示相关记录
- 支持导出单条数据

2.3 新增对比功能
- 多选对比
- 参数对比表格
- 可视化对比

2.4 优化用户体验
- 搜索建议/自动完成
- 加载状态优化
- 错误提示优化
- 响应式布局

#### 3. 数据层优化

3.1 索引优化
- 确保关键字段有索引
- 复合索引优化查询性能

3.2 数据验证
- 导入时数据校验
- API 参数验证

#### 4. 代码规范

4.1 统一代码风格
- 与 DoEEEt 模块保持一致
- 统一命名规范
- 统一错误处理

4.2 文档完善
- API 文档注释
- 使用示例

### 三、实施步骤建议

1. 修复路由注册（最紧急）
2. 扩展后端 API（详情、统计、批量查询）
3. 优化前端列表页
4. 新增详情页
5. 新增对比功能
6. 性能优化和测试

### 四、技术要点

- 参考 DoEEEt 模块的架构和实现方式
- 保持代码风格一致
- 充分利用现有缓存机制
- 优化数据库查询性能
- 提供良好的用户体验

需要我开始实施吗？建议先从修复路由注册和扩展基础 API 开始。

