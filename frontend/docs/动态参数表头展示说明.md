# åŠ¨æ€å‚æ•°è¡¨å¤´å±•ç¤ºè¯´æ˜

## ğŸ“Š æ•°æ®ç»“æ„

### parameter_definitions é›†åˆ

å­˜å‚¨åœ¨ MongoDB `doeet.parameter_definitions` é›†åˆä¸­ï¼š

```typescript
interface IDoeeetParameterDefinition {
  parameter_key: string;          // å‚æ•°å”¯ä¸€é”® (UUID)
  category: string;               // å‚æ•°åˆ†ç±»ï¼ˆå¦‚ "Mechanical Data", "Radiation: Potential Sensitivity"ï¼‰
  name: string;                   // å®Œæ•´å‚æ•°åç§°ï¼ˆå¦‚ "Number of Pins"ï¼‰
  short_name?: string;            // ç®€å†™åç§°ï¼ˆå¦‚ "#Pins"ï¼‰ï¼Œå¯é€‰
  example?: string;               // ç¤ºä¾‹å€¼
}
```

### ç¤ºä¾‹æ•°æ®

```json
{
  "_id": "684f e03f-bfea-4a24-a5a4-49e504e21ccd",
  "parameter_key": "684fe03f-bfea-4a24-a5a4-49e504e21ccd",
  "category": "Mechanical Data",
  "name": "Number of Pins",
  "short_name": "#Pins",
  "example": "68",
  "created_at": "2025-10-29T19:39:37.569+00:00",
  "updated_at": "2025-10-29T23:22:32.136+00:00"
}
```

```json
{
  "_id": "6631fc53-cd8f-4299-b629-f132b34fcc94",
  "parameter_key": "6631fc53-cd8f-4299-b629-f132b34fcc94",
  "category": "Radiation: Potential Sensitivity",
  "name": "TNID Comments",
  "short_name": "",
  "example": "CMOS TECHNOLOGY. Effect only exhibited by bipolar or BiCMOS devices, w...",
  "created_at": "2025-10-29T19:39:37.569+00:00",
  "updated_at": "2025-10-29T23:22:32.136+00:00"
}
```

---

## ğŸ¨ è¡¨å¤´å±•ç¤ºé€»è¾‘

### UIå±•ç¤ºè§„åˆ™

æ ¹æ® `short_name` æ˜¯å¦ä¸ºç©ºï¼Œå†³å®šè¡¨å¤´çš„å±•ç¤ºæ–¹å¼ï¼š

#### æƒ…å†µ1ï¼š`short_name` æœ‰å€¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      #Pins          â”‚  â† ç›´æ¥æ˜¾ç¤º short_name
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
  [é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤º Tooltip]
         â†“
  "Number of Pins"      â† å®Œæ•´çš„ name
```

**å›¾ç¤º**ï¼ˆå‚è€ƒç”¨æˆ·æä¾›çš„æˆªå›¾ï¼‰ï¼š
- è¡¨å¤´åˆ—æ ‡é¢˜æ˜¾ç¤ºï¼š`#Pins`
- é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºï¼š`Number of Pins`

#### æƒ…å†µ2ï¼š`short_name` ä¸ºç©º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TNID Comments     â”‚  â† ç›´æ¥æ˜¾ç¤º name
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å›¾ç¤º**ï¼š
- è¡¨å¤´åˆ—æ ‡é¢˜æ˜¾ç¤ºï¼š`TNID Comments`
- æ²¡æœ‰ç®€å†™ï¼Œç›´æ¥å±•ç¤ºå®Œæ•´åç§°

---

## ğŸ’» å®ç°ä»£ç 

### æ–¹æ¡ˆ1ï¼šTableåˆ—å®šä¹‰ï¼ˆAnt Designï¼‰

```tsx
import { Table, Tooltip } from 'antd';
import type { ColumnsType } from 'antd/es/table';

interface ParameterDefinition {
  parameter_key: string;
  name: string;
  short_name?: string;
  category: string;
  example?: string;
}

// ç”ŸæˆåŠ¨æ€å‚æ•°åˆ—
const generateDynamicColumns = (
  parameterDefinitions: ParameterDefinition[]
): ColumnsType<any> => {
  return parameterDefinitions.map((param) => ({
    title: param.short_name ? (
      // æœ‰ç®€å†™ï¼šæ˜¾ç¤ºç®€å†™ + Tooltip
      <Tooltip title={param.name}>
        <span dangerouslySetInnerHTML={{ __html: param.short_name }} />
      </Tooltip>
    ) : (
      // æ— ç®€å†™ï¼šç›´æ¥æ˜¾ç¤ºå®Œæ•´åç§°
      param.name
    ),
    dataIndex: ['parameters', param.parameter_key],
    key: param.parameter_key,
    width: 120,
    ellipsis: true,
  }));
};

// ä½¿ç”¨ç¤ºä¾‹
const MyComponent = () => {
  const [parameterDefinitions, setParameterDefinitions] = useState<ParameterDefinition[]>([]);
  
  // åŠ è½½å‚æ•°å®šä¹‰
  useEffect(() => {
    fetchParameterDefinitions().then(setParameterDefinitions);
  }, []);
  
  // åŸºç¡€åˆ—
  const baseColumns: ColumnsType<any> = [
    { title: 'å™¨ä»¶å‹å·', dataIndex: 'partNumber', key: 'partNumber', width: 150 },
    { title: 'åˆ¶é€ å•†', dataIndex: 'manufacturer', key: 'manufacturer', width: 120 },
  ];
  
  // åŠ¨æ€åˆ—
  const dynamicColumns = generateDynamicColumns(parameterDefinitions);
  
  // åˆå¹¶åˆ—
  const allColumns = [...baseColumns, ...dynamicColumns];
  
  return <Table columns={allColumns} dataSource={components} />;
};
```

---

### æ–¹æ¡ˆ2ï¼šé€šç”¨å·¥å…·å‡½æ•°

åˆ›å»ºæ–‡ä»¶ `frontend/src/utils/parameterUtils.tsx`ï¼š

```tsx
import { Tooltip } from 'antd';
import type { ColumnType } from 'antd/es/table';

/**
 * ç”Ÿæˆå‚æ•°åˆ—çš„è¡¨å¤´ JSX
 * @param name - å®Œæ•´å‚æ•°åç§°
 * @param shortName - ç®€å†™åç§°ï¼ˆå¯é€‰ï¼‰
 * @returns JSX å…ƒç´ 
 */
export const generateParameterColumnTitle = (
  name: string,
  shortName?: string
): React.ReactNode => {
  if (shortName && shortName.trim() !== '') {
    // æœ‰ç®€å†™ï¼šæ˜¾ç¤ºç®€å†™ + é¼ æ ‡æ‚¬åœæ˜¾ç¤ºå®Œæ•´åç§°
    return (
      <Tooltip title={name} placement="top">
        <span 
          dangerouslySetInnerHTML={{ __html: shortName }}
          style={{ cursor: 'help' }}
        />
      </Tooltip>
    );
  }
  
  // æ— ç®€å†™ï¼šç›´æ¥æ˜¾ç¤ºå®Œæ•´åç§°
  return name;
};

/**
 * æ‰¹é‡ç”ŸæˆåŠ¨æ€å‚æ•°åˆ—
 * @param parameterDefinitions - å‚æ•°å®šä¹‰æ•°ç»„
 * @param options - å¯é€‰é…ç½®
 * @returns Ant Design Tableåˆ—æ•°ç»„
 */
export const generateDynamicParameterColumns = <T extends Record<string, any>>(
  parameterDefinitions: Array<{
    parameter_key: string;
    name: string;
    short_name?: string;
    category?: string;
  }>,
  options?: {
    columnWidth?: number;
    ellipsis?: boolean;
    sortable?: boolean;
  }
): ColumnType<T>[] => {
  const { columnWidth = 120, ellipsis = true, sortable = false } = options || {};
  
  return parameterDefinitions.map((param) => ({
    title: generateParameterColumnTitle(param.name, param.short_name),
    dataIndex: ['parameters', param.parameter_key],
    key: param.parameter_key,
    width: columnWidth,
    ellipsis,
    ...(sortable && {
      sorter: (a: any, b: any) => {
        const aVal = a.parameters?.[param.parameter_key] || '';
        const bVal = b.parameters?.[param.parameter_key] || '';
        return String(aVal).localeCompare(String(bVal));
      },
    }),
  }));
};
```

---

### æ–¹æ¡ˆ3ï¼šåœ¨ ComponentSearch é¡µé¢ä¸­ä½¿ç”¨

```tsx
import React, { useState, useEffect } from 'react';
import { Table } from 'antd';
import { generateDynamicParameterColumns, generateParameterColumnTitle } from '@/utils/parameterUtils';
import type { ColumnsType } from 'antd/es/table';

interface Component {
  id: string;
  partNumber: string;
  manufacturer: string;
  parameters: {
    [key: string]: any; // parameter_key: value
  };
}

const ComponentSearch: React.FC = () => {
  const [components, setComponents] = useState<Component[]>([]);
  const [parameterDefinitions, setParameterDefinitions] = useState<any[]>([]);
  
  useEffect(() => {
    // åŠ è½½å‚æ•°å®šä¹‰
    fetch('/api/doeeet/parameter-definitions')
      .then(res => res.json())
      .then(data => setParameterDefinitions(data.data));
  }, []);
  
  // é™æ€åˆ—
  const staticColumns: ColumnsType<Component> = [
    {
      title: 'å™¨ä»¶å‹å·',
      dataIndex: 'partNumber',
      key: 'partNumber',
      width: 150,
      fixed: 'left',
    },
    {
      title: 'åˆ¶é€ å•†',
      dataIndex: 'manufacturer',
      key: 'manufacturer',
      width: 120,
      fixed: 'left',
    },
  ];
  
  // åŠ¨æ€å‚æ•°åˆ—
  const dynamicColumns = generateDynamicParameterColumns<Component>(
    parameterDefinitions,
    {
      columnWidth: 150,
      ellipsis: true,
      sortable: true,
    }
  );
  
  // åˆå¹¶æ‰€æœ‰åˆ—
  const columns: ColumnsType<Component> = [...staticColumns, ...dynamicColumns];
  
  return (
    <Table
      columns={columns}
      dataSource={components}
      scroll={{ x: 'max-content' }}
      pagination={{ pageSize: 20 }}
    />
  );
};

export default ComponentSearch;
```

---

## ğŸ” HTMLæ¸²æŸ“å¤„ç†

### ä¸ºä»€ä¹ˆä½¿ç”¨ `dangerouslySetInnerHTML`ï¼Ÿ

æŸäº› `short_name` åŒ…å« HTML æ ‡ç­¾ï¼ˆå¦‚ä¸‹æ ‡ `<sub>`ï¼‰ï¼š

```json
{
  "name": "Storage Temperature Range",
  "short_name": "T<sub>STG</sub>"
}
```

**æœŸæœ›æ¸²æŸ“æ•ˆæœ**ï¼šT<sub>STG</sub>ï¼ˆSTGæ˜¯ä¸‹æ ‡ï¼‰

**ä»£ç å®ç°**ï¼š
```tsx
<span dangerouslySetInnerHTML={{ __html: param.short_name }} />
```

### å®‰å…¨æ€§æ³¨æ„

`dangerouslySetInnerHTML` å­˜åœ¨ XSS é£é™©ã€‚å¦‚æœ `short_name` æ¥è‡ªç”¨æˆ·è¾“å…¥ï¼Œéœ€è¦å…ˆè¿›è¡Œ HTMLè½¬ä¹‰ã€‚

**æ¨èåšæ³•**ï¼š
```tsx
import DOMPurify from 'dompurify';

const sanitizedHTML = DOMPurify.sanitize(param.short_name);
<span dangerouslySetInnerHTML={{ __html: sanitizedHTML }} />
```

---

## ğŸ“‹ å®Œæ•´ç¤ºä¾‹

### å‡è®¾åç«¯APIè¿”å›

**GET /api/doeeet/search?familyPath=Microcircuits/Digital/Memory**

```json
{
  "success": true,
  "data": {
    "components": [
      {
        "id": "comp_001",
        "partNumber": "860300YA",
        "manufacturer": "SIB International formerly Rarefill",
        "parameters": {
          "684fe03f-bfea-4a24-a5a4-49e504e21ccd": "68",
          "6631fc53-cd8f-4299-b629-f132b34fcc94": "CMOS TECHNOLOGY. Effect only exhibited..."
        }
      }
    ],
    "parameterDefinitions": [
      {
        "parameter_key": "684fe03f-bfea-4a24-a5a4-49e504e21ccd",
        "name": "Number of Pins",
        "short_name": "#Pins",
        "category": "Mechanical Data"
      },
      {
        "parameter_key": "6631fc53-cd8f-4299-b629-f132b34fcc94",
        "name": "TNID Comments",
        "short_name": "",
        "category": "Radiation: Potential Sensitivity"
      }
    ]
  }
}
```

### å‰ç«¯æ¸²æŸ“æ•ˆæœ

| å™¨ä»¶å‹å·    | åˆ¶é€ å•†                         | #Pins â“˜ | TNID Comments                        |
|------------|-------------------------------|---------|--------------------------------------|
| 860300YA   | SIB International formerly... | 68      | CMOS TECHNOLOGY. Effect only exhi... |

**è¯´æ˜**ï¼š
- `#Pins` åˆ—ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤º "Number of Pins"
- `TNID Comments` åˆ—ï¼šæ— ç®€å†™ï¼Œç›´æ¥æ˜¾ç¤ºå®Œæ•´åç§°

---

## ğŸ¨ æ ·å¼ä¼˜åŒ–

### CSSæ ·å¼

```css
/* å‚æ•°åˆ—æ ‡é¢˜æ ·å¼ */
.parameter-column-title {
  cursor: help;
  border-bottom: 1px dotted #1890ff;
}

.parameter-column-title:hover {
  color: #1890ff;
}

/* å‚æ•°å€¼æ ·å¼ */
.parameter-value {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.parameter-value:hover {
  white-space: normal;
}
```

### åº”ç”¨æ ·å¼

```tsx
<Tooltip title={param.name} placement="top">
  <span 
    className="parameter-column-title"
    dangerouslySetInnerHTML={{ __html: param.short_name }}
  />
</Tooltip>
```

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

æ ¹æ® `meta.json` åˆ†æï¼š

- **æ€»å‚æ•°æ•°é‡**: 360ä¸ªå”¯ä¸€å‚æ•°é”®
- **æœ‰ `short_name` çš„å‚æ•°**: çº¦80%
- **æ—  `short_name` çš„å‚æ•°**: çº¦20%

**ç¤ºä¾‹**ï¼š

| å‚æ•°åˆ†ç±»                        | æœ‰ short_name | æ—  short_name |
|--------------------------------|--------------|--------------|
| Mechanical Data                | 90%          | 10%          |
| Electrical Characteristics     | 85%          | 15%          |
| Radiation: Potential Sensitivity| 60%          | 40%          |
| Package                        | 100%         | 0%           |

---

## ğŸ§ª å•å…ƒæµ‹è¯•

```typescript
import { generateParameterColumnTitle } from '@/utils/parameterUtils';
import { render } from '@testing-library/react';

describe('generateParameterColumnTitle', () => {
  test('æœ‰ short_name æ—¶æ˜¾ç¤º Tooltip', () => {
    const { container } = render(
      generateParameterColumnTitle('Number of Pins', '#Pins') as React.ReactElement
    );
    
    expect(container.querySelector('.ant-tooltip')).toBeTruthy();
    expect(container.textContent).toBe('#Pins');
  });
  
  test('æ—  short_name æ—¶ç›´æ¥æ˜¾ç¤º name', () => {
    const result = generateParameterColumnTitle('TNID Comments', '');
    expect(result).toBe('TNID Comments');
  });
  
  test('short_name ä¸ºç©ºå­—ç¬¦ä¸²æ—¶è§†ä¸ºæ— ç®€å†™', () => {
    const result = generateParameterColumnTitle('Test Name', '   ');
    expect(result).toBe('Test Name');
  });
});
```

---

## ğŸ”§ åç«¯APIå»ºè®®

ä¸ºäº†æ”¯æŒå‰ç«¯åŠ¨æ€åˆ—å±•ç¤ºï¼Œå»ºè®®åç«¯APIè¿”å›ï¼š

```typescript
interface SearchResponse {
  success: boolean;
  data: {
    components: Array<{
      id: string;
      partNumber: string;
      manufacturer: string;
      parameters: {
        [parameter_key: string]: any; // å‚æ•°é”®: å‚æ•°å€¼
      };
    }>;
    parameterDefinitions: Array<{
      parameter_key: string;
      name: string;
      short_name?: string;
      category: string;
      example?: string;
    }>;
    total: number;
    page: number;
    limit: number;
  };
}
```

**ç¤ºä¾‹APIè°ƒç”¨**ï¼š
```bash
GET /api/doeeet/search?familyPath=Microcircuits/Digital/Memory&page=1&limit=20
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [CategoryFilterç»„ä»¶ä½¿ç”¨è¯´æ˜](./CategoryFilterä½¿ç”¨è¯´æ˜.md)
- [DoEEEté›†æˆå®æ–½æ€»ç»“](../DoEEEté›†æˆå®æ–½æ€»ç»“.md)
- [Ant Design Table API](https://ant.design/components/table-cn/)

---

**æœ€åæ›´æ–°**: 2025-10-31  
**ç‰ˆæœ¬**: v1.0  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

